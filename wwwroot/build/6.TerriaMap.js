((self || window)["webpackJsonp"] = (self || window)["webpackJsonp"] || []).push([[6],{

/***/ "./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts":
/*!******************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isImageryProviderGridLayer = exports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.object.assign.js */ \"./node_modules/core-js/modules/es.object.assign.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _Event = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _SplitDirection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\"));\nvar _class, _descriptor, _descriptor2;\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(t, e) { if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e; if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\"); return _assertThisInitialized(t); }\nfunction _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); return e; }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }\nfunction _inherits(t, e) { if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, \"prototype\", { writable: !1 }), e && _setPrototypeOf(t, e); }\nfunction _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\nvar isImageryProviderGridLayer = exports.isImageryProviderGridLayer = function isImageryProviderGridLayer(obj) {\n  return typeof obj.requestImageForCanvas === \"function\";\n};\nvar ImageryProviderLeafletGridLayer = exports[\"default\"] = (_class = /*#__PURE__*/function (_L$GridLayer) {\n  function ImageryProviderLeafletGridLayer(leaflet, imageryProvider, options) {\n    var _this;\n    _classCallCheck(this, ImageryProviderLeafletGridLayer);\n    _this = _callSuper(this, ImageryProviderLeafletGridLayer, [Object.assign(options, {\n      async: true,\n      tileSize: 256\n    })]);\n    _this.leaflet = leaflet;\n    _this.imageryProvider = imageryProvider;\n    _defineProperty(_this, \"errorEvent\", new _Event[\"default\"]());\n    _defineProperty(_this, \"initialized\", false);\n    _defineProperty(_this, \"_usable\", false);\n    _defineProperty(_this, \"_delayedUpdate\", undefined);\n    _defineProperty(_this, \"_zSubtract\", 0);\n    _defineProperty(_this, \"_previousCredits\", []);\n    _initializerDefineProperty(_this, \"splitDirection\", _descriptor, _this);\n    _initializerDefineProperty(_this, \"splitPosition\", _descriptor2, _this);\n    (0, _mobx.makeObservable)(_this);\n\n    // Handle splitter rection (and disposing reaction)\n    var disposeSplitterReaction;\n    _this.on(\"add\", function () {\n      if (!disposeSplitterReaction) {\n        disposeSplitterReaction = _this._reactToSplitterChange();\n      }\n    });\n    _this.on(\"remove\", function () {\n      if (disposeSplitterReaction) {\n        disposeSplitterReaction();\n        disposeSplitterReaction = undefined;\n      }\n    });\n    return _this;\n  }\n  _inherits(ImageryProviderLeafletGridLayer, _L$GridLayer);\n  return _createClass(ImageryProviderLeafletGridLayer, [{\n    key: \"_reactToSplitterChange\",\n    value: function _reactToSplitterChange() {\n      var _this2 = this;\n      return (0, _mobx.autorun)(function () {\n        var container = _this2.getContainer();\n        if (container === null) {\n          return;\n        }\n        if (_this2.splitDirection === _SplitDirection[\"default\"].LEFT) {\n          var clipLeft = _this2._clipsForSplitter.left;\n          container.style.clip = clipLeft;\n        } else if (_this2.splitDirection === _SplitDirection[\"default\"].RIGHT) {\n          var clipRight = _this2._clipsForSplitter.right;\n          container.style.clip = clipRight;\n        } else {\n          container.style.clip = \"auto\";\n        }\n      });\n    }\n  }, {\n    key: \"_clipsForSplitter\",\n    get: function get() {\n      var clipLeft = \"\";\n      var clipRight = \"\";\n      var clipPositionWithinMap;\n      var clipX;\n      if (this.leaflet.size && this.leaflet.nw && this.leaflet.se) {\n        clipPositionWithinMap = this.leaflet.size.x * this.splitPosition;\n        clipX = Math.round(this.leaflet.nw.x + clipPositionWithinMap);\n        clipLeft = \"rect(\" + [this.leaflet.nw.y, clipX, this.leaflet.se.y, this.leaflet.nw.x].join(\"px,\") + \"px)\";\n        clipRight = \"rect(\" + [this.leaflet.nw.y, this.leaflet.se.x, this.leaflet.se.y, clipX].join(\"px,\") + \"px)\";\n      }\n      return {\n        left: clipLeft,\n        right: clipRight,\n        clipPositionWithinMap: clipPositionWithinMap,\n        clipX: clipX\n      };\n    }\n  }, {\n    key: \"createTile\",\n    value: function createTile(tilePoint, done) {\n      var canvas = _leaflet[\"default\"].DomUtil.create(\"canvas\", \"leaflet-tile\");\n      var size = this.getTileSize();\n      canvas.width = size.x;\n      canvas.height = size.y;\n      var n = this.imageryProvider.tilingScheme.getNumberOfXTilesAtLevel(tilePoint.z);\n      this.imageryProvider.requestImageForCanvas(_Math[\"default\"].mod(tilePoint.x, n), tilePoint.y, tilePoint.z, canvas).then(function (canvas) {\n        done(undefined, canvas);\n      });\n      return canvas; // Not yet drawn on, but Leaflet requires the tile\n    }\n  }, {\n    key: \"getFeaturePickingCoords\",\n    value: function getFeaturePickingCoords(map, longitudeRadians, latitudeRadians) {\n      var ll = new _Cartographic[\"default\"](_Math[\"default\"].negativePiToPi(longitudeRadians), latitudeRadians, 0.0);\n      var level = Math.round(map.getZoom());\n      var tilingScheme = this.imageryProvider.tilingScheme;\n      var coords = tilingScheme.positionToTileXY(ll, level);\n      return {\n        x: coords.x,\n        y: coords.y,\n        level: level\n      };\n    }\n  }, {\n    key: \"pickFeatures\",\n    value: function pickFeatures(x, y, level, longitudeRadians, latitudeRadians) {\n      return this.imageryProvider.pickFeatures(x, y, level, longitudeRadians, latitudeRadians);\n    }\n  }]);\n}(_leaflet[\"default\"].GridLayer), _descriptor = _applyDecoratedDescriptor(_class.prototype, \"splitDirection\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return _SplitDirection[\"default\"].NONE;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"splitPosition\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return 0.5;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"_clipsForSplitter\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"_clipsForSplitter\"), _class.prototype), _class);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldC9JbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyLnRzPzJjM2QiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEwgZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0IHtcclxuICBhdXRvcnVuLFxyXG4gIGNvbXB1dGVkLFxyXG4gIElSZWFjdGlvbkRpc3Bvc2VyLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgbWFrZU9ic2VydmFibGVcclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgQ2FydG9ncmFwaGljIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydG9ncmFwaGljXCI7XHJcbmltcG9ydCBDZXNpdW1FdmVudCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0V2ZW50XCI7XHJcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xyXG5pbXBvcnQgU3BsaXREaXJlY3Rpb24gZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvU3BsaXREaXJlY3Rpb25cIjtcclxuaW1wb3J0IExlYWZsZXQgZnJvbSBcIi4uLy4uL01vZGVscy9MZWFmbGV0XCI7XHJcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEltYWdlcnlQcm92aWRlcldpdGhHcmlkTGF5ZXJTdXBwb3J0IGV4dGVuZHMgSW1hZ2VyeVByb3ZpZGVyIHtcclxuICByZXF1ZXN0SW1hZ2VGb3JDYW52YXM6IChcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIGxldmVsOiBudW1iZXIsXHJcbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50XHJcbiAgKSA9PiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PjtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGlzSW1hZ2VyeVByb3ZpZGVyR3JpZExheWVyID0gKFxyXG4gIG9iajogYW55XHJcbik6IG9iaiBpcyBJbWFnZXJ5UHJvdmlkZXJXaXRoR3JpZExheWVyU3VwcG9ydCA9PiB7XHJcbiAgcmV0dXJuIHR5cGVvZiBvYmoucmVxdWVzdEltYWdlRm9yQ2FudmFzID09PSBcImZ1bmN0aW9uXCI7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyIGV4dGVuZHMgTC5HcmlkTGF5ZXIge1xyXG4gIHJlYWRvbmx5IGVycm9yRXZlbnQ6IENlc2l1bUV2ZW50ID0gbmV3IENlc2l1bUV2ZW50KCk7XHJcbiAgcmVhZG9ubHkgaW5pdGlhbGl6ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICByZWFkb25seSBfdXNhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgcmVhZG9ubHkgX2RlbGF5ZWRVcGRhdGU6IHVua25vd24gPSB1bmRlZmluZWQ7XHJcbiAgcmVhZG9ubHkgX3pTdWJ0cmFjdDogbnVtYmVyID0gMDtcclxuICByZWFkb25seSBfcHJldmlvdXNDcmVkaXRzOiB1bmtub3duW10gPSBbXTtcclxuXHJcbiAgQG9ic2VydmFibGUgc3BsaXREaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5OT05FO1xyXG4gIEBvYnNlcnZhYmxlIHNwbGl0UG9zaXRpb246IG51bWJlciA9IDAuNTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxlYWZsZXQ6IExlYWZsZXQsXHJcbiAgICByZWFkb25seSBpbWFnZXJ5UHJvdmlkZXI6IEltYWdlcnlQcm92aWRlcldpdGhHcmlkTGF5ZXJTdXBwb3J0LFxyXG4gICAgb3B0aW9uczogTC5HcmlkTGF5ZXJPcHRpb25zXHJcbiAgKSB7XHJcbiAgICBzdXBlcihPYmplY3QuYXNzaWduKG9wdGlvbnMsIHsgYXN5bmM6IHRydWUsIHRpbGVTaXplOiAyNTYgfSkpO1xyXG5cclxuICAgIG1ha2VPYnNlcnZhYmxlKHRoaXMpO1xyXG5cclxuICAgIC8vIEhhbmRsZSBzcGxpdHRlciByZWN0aW9uIChhbmQgZGlzcG9zaW5nIHJlYWN0aW9uKVxyXG4gICAgbGV0IGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uOiBJUmVhY3Rpb25EaXNwb3NlciB8IHVuZGVmaW5lZDtcclxuICAgIHRoaXMub24oXCJhZGRcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAoIWRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKSB7XHJcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24gPSB0aGlzLl9yZWFjdFRvU3BsaXR0ZXJDaGFuZ2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLm9uKFwicmVtb3ZlXCIsICgpID0+IHtcclxuICAgICAgaWYgKGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKSB7XHJcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24oKTtcclxuICAgICAgICBkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfcmVhY3RUb1NwbGl0dGVyQ2hhbmdlKCkge1xyXG4gICAgcmV0dXJuIGF1dG9ydW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lcigpO1xyXG4gICAgICBpZiAoY29udGFpbmVyID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5zcGxpdERpcmVjdGlvbiA9PT0gU3BsaXREaXJlY3Rpb24uTEVGVCkge1xyXG4gICAgICAgIGNvbnN0IHsgbGVmdDogY2xpcExlZnQgfSA9IHRoaXMuX2NsaXBzRm9yU3BsaXR0ZXI7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmNsaXAgPSBjbGlwTGVmdDtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLnNwbGl0RGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5SSUdIVCkge1xyXG4gICAgICAgIGNvbnN0IHsgcmlnaHQ6IGNsaXBSaWdodCB9ID0gdGhpcy5fY2xpcHNGb3JTcGxpdHRlcjtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IGNsaXBSaWdodDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IFwiYXV0b1wiO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIEBjb21wdXRlZFxyXG4gIGdldCBfY2xpcHNGb3JTcGxpdHRlcigpIHtcclxuICAgIGxldCBjbGlwTGVmdCA9IFwiXCI7XHJcbiAgICBsZXQgY2xpcFJpZ2h0ID0gXCJcIjtcclxuICAgIGxldCBjbGlwUG9zaXRpb25XaXRoaW5NYXA7XHJcbiAgICBsZXQgY2xpcFg7XHJcblxyXG4gICAgaWYgKHRoaXMubGVhZmxldC5zaXplICYmIHRoaXMubGVhZmxldC5udyAmJiB0aGlzLmxlYWZsZXQuc2UpIHtcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwID0gdGhpcy5sZWFmbGV0LnNpemUueCAqIHRoaXMuc3BsaXRQb3NpdGlvbjtcclxuICAgICAgY2xpcFggPSBNYXRoLnJvdW5kKHRoaXMubGVhZmxldC5udy54ICsgY2xpcFBvc2l0aW9uV2l0aGluTWFwKTtcclxuICAgICAgY2xpcExlZnQgPVxyXG4gICAgICAgIFwicmVjdChcIiArXHJcbiAgICAgICAgW3RoaXMubGVhZmxldC5udy55LCBjbGlwWCwgdGhpcy5sZWFmbGV0LnNlLnksIHRoaXMubGVhZmxldC5udy54XS5qb2luKFxyXG4gICAgICAgICAgXCJweCxcIlxyXG4gICAgICAgICkgK1xyXG4gICAgICAgIFwicHgpXCI7XHJcbiAgICAgIGNsaXBSaWdodCA9XHJcbiAgICAgICAgXCJyZWN0KFwiICtcclxuICAgICAgICBbdGhpcy5sZWFmbGV0Lm53LnksIHRoaXMubGVhZmxldC5zZS54LCB0aGlzLmxlYWZsZXQuc2UueSwgY2xpcFhdLmpvaW4oXHJcbiAgICAgICAgICBcInB4LFwiXHJcbiAgICAgICAgKSArXHJcbiAgICAgICAgXCJweClcIjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsZWZ0OiBjbGlwTGVmdCxcclxuICAgICAgcmlnaHQ6IGNsaXBSaWdodCxcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwOiBjbGlwUG9zaXRpb25XaXRoaW5NYXAsXHJcbiAgICAgIGNsaXBYOiBjbGlwWFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZVRpbGUodGlsZVBvaW50OiBMLkNvb3JkcywgZG9uZTogTC5Eb25lQ2FsbGJhY2spIHtcclxuICAgIGNvbnN0IGNhbnZhcyA9IEwuRG9tVXRpbC5jcmVhdGUoXHJcbiAgICAgIFwiY2FudmFzXCIsXHJcbiAgICAgIFwibGVhZmxldC10aWxlXCJcclxuICAgICkgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XHJcbiAgICBjb25zdCBzaXplID0gdGhpcy5nZXRUaWxlU2l6ZSgpO1xyXG4gICAgY2FudmFzLndpZHRoID0gc2l6ZS54O1xyXG4gICAgY2FudmFzLmhlaWdodCA9IHNpemUueTtcclxuXHJcbiAgICBjb25zdCBuID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIudGlsaW5nU2NoZW1lLmdldE51bWJlck9mWFRpbGVzQXRMZXZlbChcclxuICAgICAgdGlsZVBvaW50LnpcclxuICAgICk7XHJcbiAgICB0aGlzLmltYWdlcnlQcm92aWRlclxyXG4gICAgICAucmVxdWVzdEltYWdlRm9yQ2FudmFzKFxyXG4gICAgICAgIENlc2l1bU1hdGgubW9kKHRpbGVQb2ludC54LCBuKSxcclxuICAgICAgICB0aWxlUG9pbnQueSxcclxuICAgICAgICB0aWxlUG9pbnQueixcclxuICAgICAgICBjYW52YXNcclxuICAgICAgKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XHJcbiAgICAgICAgZG9uZSh1bmRlZmluZWQsIGNhbnZhcyk7XHJcbiAgICAgIH0pO1xyXG4gICAgcmV0dXJuIGNhbnZhczsgLy8gTm90IHlldCBkcmF3biBvbiwgYnV0IExlYWZsZXQgcmVxdWlyZXMgdGhlIHRpbGVcclxuICB9XHJcblxyXG4gIGdldEZlYXR1cmVQaWNraW5nQ29vcmRzKFxyXG4gICAgbWFwOiBMLk1hcCxcclxuICAgIGxvbmdpdHVkZVJhZGlhbnM6IG51bWJlcixcclxuICAgIGxhdGl0dWRlUmFkaWFuczogbnVtYmVyXHJcbiAgKSB7XHJcbiAgICBjb25zdCBsbCA9IG5ldyBDYXJ0b2dyYXBoaWMoXHJcbiAgICAgIENlc2l1bU1hdGgubmVnYXRpdmVQaVRvUGkobG9uZ2l0dWRlUmFkaWFucyksXHJcbiAgICAgIGxhdGl0dWRlUmFkaWFucyxcclxuICAgICAgMC4wXHJcbiAgICApO1xyXG4gICAgY29uc3QgbGV2ZWwgPSBNYXRoLnJvdW5kKG1hcC5nZXRab29tKCkpO1xyXG5cclxuICAgIGNvbnN0IHRpbGluZ1NjaGVtZSA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnRpbGluZ1NjaGVtZTtcclxuICAgIGNvbnN0IGNvb3JkcyA9IHRpbGluZ1NjaGVtZS5wb3NpdGlvblRvVGlsZVhZKGxsLCBsZXZlbCk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiBjb29yZHMueCxcclxuICAgICAgeTogY29vcmRzLnksXHJcbiAgICAgIGxldmVsOiBsZXZlbFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHBpY2tGZWF0dXJlcyhcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIGxldmVsOiBudW1iZXIsXHJcbiAgICBsb25naXR1ZGVSYWRpYW5zOiBudW1iZXIsXHJcbiAgICBsYXRpdHVkZVJhZGlhbnM6IG51bWJlclxyXG4gICkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnBpY2tGZWF0dXJlcyhcclxuICAgICAgeCxcclxuICAgICAgeSxcclxuICAgICAgbGV2ZWwsXHJcbiAgICAgIGxvbmdpdHVkZVJhZGlhbnMsXHJcbiAgICAgIGxhdGl0dWRlUmFkaWFuc1xyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWFBO0FBR0E7QUFDQTtBQUFBO0FBYUE7QUFJQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUpBO0FBQ0E7QUFaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQVNBO0FBT0E7QUFBQTtBQUFBO0FBMUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts":
/*!******************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.async-iterator.js */ \"./node_modules/core-js/modules/es.symbol.async-iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-string-tag.js */ \"./node_modules/core-js/modules/es.symbol.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.array.filter.js */ \"./node_modules/core-js/modules/es.array.filter.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.function.name.js */ \"./node_modules/core-js/modules/es.function.name.js\");\n__webpack_require__(/*! core-js/modules/es.json.to-string-tag.js */ \"./node_modules/core-js/modules/es.json.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.math.to-string-tag.js */ \"./node_modules/core-js/modules/es.math.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-properties.js */ \"./node_modules/core-js/modules/es.object.define-properties.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptors.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptors.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.promise.js */ \"./node_modules/core-js/modules/es.promise.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.get.js */ \"./node_modules/core-js/modules/es.reflect.get.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/web.timers.js */ \"./node_modules/core-js/modules/web.timers.js\");\nvar _i18next = _interopRequireDefault(__webpack_require__(/*! i18next */ \"./node_modules/i18next/dist/esm/i18next.js\"));\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _Cartesian = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\"));\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _Credit2 = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Credit */ \"./node_modules/terriajs-cesium/Source/Core/Credit.js\"));\nvar _defined = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/defined */ \"./node_modules/terriajs-cesium/Source/Core/defined.js\"));\nvar _Event = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _TileProviderError = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/TileProviderError */ \"./node_modules/terriajs-cesium/Source/Core/TileProviderError.js\"));\nvar _WebMercatorTilingScheme = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/WebMercatorTilingScheme */ \"./node_modules/terriajs-cesium/Source/Core/WebMercatorTilingScheme.js\"));\nvar _SplitDirection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nvar _TerriaError = _interopRequireDefault(__webpack_require__(/*! ../../Core/TerriaError */ \"./packages/terriajs/lib/Core/TerriaError.ts\"));\nvar _getUrlForImageryTile = _interopRequireDefault(__webpack_require__(/*! ../ImageryProvider/getUrlForImageryTile */ \"./packages/terriajs/lib/Map/ImageryProvider/getUrlForImageryTile.ts\"));\nvar _class, _descriptor, _descriptor2;\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, \"catch\": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _superPropGet(t, o, e, r) { var p = _get(_getPrototypeOf(1 & r ? t.prototype : t), o, e); return 2 & r && \"function\" == typeof p ? function (t) { return p.apply(e, t); } : p; }\nfunction _get() { return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) { var p = _superPropBase(e, t); if (p) { var n = Object.getOwnPropertyDescriptor(p, t); return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value; } }, _get.apply(null, arguments); }\nfunction _superPropBase(t, o) { for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t));); return t; }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(t, e) { if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e; if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\"); return _assertThisInitialized(t); }\nfunction _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); return e; }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }\nfunction _inherits(t, e) { if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, \"prototype\", { writable: !1 }), e && _setPrototypeOf(t, e); }\nfunction _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar swScratch = new _Cartographic[\"default\"]();\nvar neScratch = new _Cartographic[\"default\"]();\nvar swTileCoordinatesScratch = new _Cartesian[\"default\"]();\nvar neTileCoordinatesScratch = new _Cartesian[\"default\"]();\nvar Credit = /*#__PURE__*/function (_CesiumCredit) {\n  function Credit() {\n    var _this;\n    _classCallCheck(this, Credit);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, Credit, [].concat(args));\n    _defineProperty(_this, \"_shownInLeaflet\", void 0);\n    _defineProperty(_this, \"_shownInLeafletLastUpdate\", void 0);\n    return _this;\n  }\n  _inherits(Credit, _CesiumCredit);\n  return _createClass(Credit);\n}(_Credit2[\"default\"]);\nvar ImageryProviderLeafletTileLayer = exports[\"default\"] = (_class = /*#__PURE__*/function (_L$TileLayer) {\n  function ImageryProviderLeafletTileLayer(leaflet, imageryProvider) {\n    var _this2;\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    _classCallCheck(this, ImageryProviderLeafletTileLayer);\n    _this2 = _callSuper(this, ImageryProviderLeafletTileLayer, [undefined, _objectSpread(_objectSpread({}, options), {}, {\n      updateInterval: (0, _defined[\"default\"])(imageryProvider._leafletUpdateInterval) ? imageryProvider._leafletUpdateInterval : 100\n    })]);\n    _this2.leaflet = leaflet;\n    _this2.imageryProvider = imageryProvider;\n    _defineProperty(_this2, \"tileSize\", 256);\n    _defineProperty(_this2, \"errorEvent\", new _Event[\"default\"]());\n    _defineProperty(_this2, \"initialized\", false);\n    _defineProperty(_this2, \"_usable\", false);\n    _defineProperty(_this2, \"_delayedUpdate\", void 0);\n    _defineProperty(_this2, \"_zSubtract\", 0);\n    _defineProperty(_this2, \"_requestImageError\", void 0);\n    _defineProperty(_this2, \"_previousCredits\", []);\n    _defineProperty(_this2, \"_leafletUpdateInterval\", void 0);\n    _initializerDefineProperty(_this2, \"splitDirection\", _descriptor, _this2);\n    _initializerDefineProperty(_this2, \"splitPosition\", _descriptor2, _this2);\n    (0, _mobx.makeObservable)(_this2);\n    _this2.imageryProvider = imageryProvider;\n\n    // Handle splitter rection (and disposing reaction)\n    var disposeSplitterReaction;\n    _this2.on(\"add\", function () {\n      if (!disposeSplitterReaction) {\n        disposeSplitterReaction = _this2._reactToSplitterChange();\n      }\n    });\n    _this2.on(\"remove\", function () {\n      if (disposeSplitterReaction) {\n        disposeSplitterReaction();\n        disposeSplitterReaction = undefined;\n      }\n    });\n    _this2._leafletUpdateInterval = (0, _defined[\"default\"])(imageryProvider._leafletUpdateInterval) ? imageryProvider._leafletUpdateInterval : 100;\n\n    // Hack to fix \"Space between tiles on fractional zoom levels in Webkit browsers\" (https://github.com/Leaflet/Leaflet/issues/3575#issuecomment-688644225)\n    _this2.on(\"tileloadstart\", function (event) {\n      event.tile.style.width = _this2.getTileSize().x + 0.5 + \"px\";\n      event.tile.style.height = _this2.getTileSize().y + 0.5 + \"px\";\n    });\n    return _this2;\n  }\n  _inherits(ImageryProviderLeafletTileLayer, _L$TileLayer);\n  return _createClass(ImageryProviderLeafletTileLayer, [{\n    key: \"_reactToSplitterChange\",\n    value: function _reactToSplitterChange() {\n      var _this3 = this;\n      return (0, _mobx.autorun)(function () {\n        var container = _this3.getContainer();\n        if (container === null) {\n          return;\n        }\n        if (_this3.splitDirection === _SplitDirection[\"default\"].LEFT) {\n          var clipLeft = _this3._clipsForSplitter.left;\n          container.style.clip = clipLeft;\n        } else if (_this3.splitDirection === _SplitDirection[\"default\"].RIGHT) {\n          var clipRight = _this3._clipsForSplitter.right;\n          container.style.clip = clipRight;\n        } else {\n          container.style.clip = \"auto\";\n        }\n      });\n    }\n  }, {\n    key: \"_clipsForSplitter\",\n    get: function get() {\n      var clipLeft = \"\";\n      var clipRight = \"\";\n      var clipPositionWithinMap;\n      var clipX;\n      if (this.leaflet.size && this.leaflet.nw && this.leaflet.se) {\n        clipPositionWithinMap = this.leaflet.size.x * this.splitPosition;\n        clipX = Math.round(this.leaflet.nw.x + clipPositionWithinMap);\n        clipLeft = \"rect(\" + [this.leaflet.nw.y, clipX, this.leaflet.se.y, this.leaflet.nw.x].join(\"px,\") + \"px)\";\n        clipRight = \"rect(\" + [this.leaflet.nw.y, this.leaflet.se.x, this.leaflet.se.y, clipX].join(\"px,\") + \"px)\";\n      }\n      return {\n        left: clipLeft,\n        right: clipRight,\n        clipPositionWithinMap: clipPositionWithinMap,\n        clipX: clipX\n      };\n    }\n  }, {\n    key: \"_tileOnError\",\n    value: function _tileOnError(_done, _tile, _e) {\n      // Do nothing, we'll handle tile errors separately.\n    }\n  }, {\n    key: \"createTile\",\n    value: function createTile(coords, done) {\n      var _this4 = this;\n      // Create a tile (Image) as normal.\n      var tile = _superPropGet(ImageryProviderLeafletTileLayer, \"createTile\", this, 3)([coords, done]);\n\n      // By default, Leaflet handles tile load errors by setting the Image to the error URL and raising\n      // an error event.  We want to first raise an error event that optionally returns a promise and\n      // retries after the promise resolves.\n\n      var _doRequest2 = function _doRequest(waitPromise) {\n        if (waitPromise) {\n          waitPromise.then(function () {\n            _doRequest2();\n          })[\"catch\"](function (e) {\n            // The tile has failed irrecoverably, so invoke Leaflet's standard\n            // tile error handler.\n            _leaflet[\"default\"].TileLayer.prototype._tileOnError.call(_this4, done, tile, e);\n          });\n          return;\n        }\n\n        // Setting src will trigger a new load or error event, even if the\n        // new src is the same as the old one.\n        var tileUrl = _this4.getTileUrl(coords);\n        if ((0, _isDefined[\"default\"])(tileUrl)) {\n          tile.src = tileUrl;\n        }\n      };\n      _leaflet[\"default\"].DomEvent.on(tile, \"error\", function (e) {\n        var level = _this4._getLevelFromZ(coords);\n        var message = _i18next[\"default\"].t(\"map.cesium.failedToObtain\", {\n          x: coords.x,\n          y: coords.y,\n          level: level\n        });\n        _this4._requestImageError = _TileProviderError[\"default\"].reportError(_this4._requestImageError,\n        // TODO: Cesium type definitions incorrectly forbid undefined\n        _this4.imageryProvider, _this4.imageryProvider.errorEvent, message, coords.x, coords.y, level, e\n        // TODO: bring terriajs-cesium retry logic to cesium\n        //doRequest\n        );\n      });\n      return tile;\n    }\n  }, {\n    key: \"getTileUrl\",\n    value: function getTileUrl(tilePoint) {\n      var level = this._getLevelFromZ(tilePoint);\n      var errorTileUrl = this.options.errorTileUrl || \"\";\n      if (level < 0) {\n        return errorTileUrl;\n      }\n      return (0, _getUrlForImageryTile[\"default\"])(this.imageryProvider, tilePoint.x, tilePoint.y, level) || errorTileUrl;\n    }\n  }, {\n    key: \"_getLevelFromZ\",\n    value: function _getLevelFromZ(tilePoint) {\n      return tilePoint.z - this._zSubtract;\n    }\n  }, {\n    key: \"_update\",\n    value: function _update() {\n      var _this5 = this;\n      if (!this.initialized) {\n        this.initialized = true;\n\n        // Cancel the existing delayed update, if any.\n        if (this._delayedUpdate) {\n          clearTimeout(this._delayedUpdate);\n          this._delayedUpdate = undefined;\n        }\n        this._delayedUpdate = setTimeout(function () {\n          _this5._delayedUpdate = undefined;\n\n          // If we're no longer attached to a map, do nothing.\n          if (!_this5._map) {\n            return;\n          }\n          var tilingScheme = _this5.imageryProvider.tilingScheme;\n          if (!(tilingScheme instanceof _WebMercatorTilingScheme[\"default\"])) {\n            _this5.errorEvent.raiseEvent(_this5, _i18next[\"default\"].t(\"map.cesium.notWebMercatorTilingScheme\"));\n            return;\n          }\n          if (tilingScheme.getNumberOfXTilesAtLevel(0) === 2 && tilingScheme.getNumberOfYTilesAtLevel(0) === 2) {\n            _this5._zSubtract = 1;\n          } else if (tilingScheme.getNumberOfXTilesAtLevel(0) !== 1 || tilingScheme.getNumberOfYTilesAtLevel(0) !== 1) {\n            _this5.errorEvent.raiseEvent(_this5, _i18next[\"default\"].t(\"map.cesium.unusalTilingScheme\"));\n            return;\n          }\n          if ((0, _isDefined[\"default\"])(_this5.imageryProvider.maximumLevel)) {\n            _this5.options.maxNativeZoom = _this5.imageryProvider.maximumLevel;\n          }\n          if ((0, _defined[\"default\"])(_this5.imageryProvider.minimumLevel)) {\n            _this5.options.minNativeZoom = _this5.imageryProvider.minimumLevel;\n          }\n          if ((0, _isDefined[\"default\"])(_this5.imageryProvider.credit)) {\n            _this5._map.attributionControl.addAttribution(getCreditHtml(_this5.imageryProvider.credit));\n          }\n          _this5._usable = true;\n          _this5._update();\n        }, this._leafletUpdateInterval);\n      }\n      if (this._usable) {\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n          args[_key2] = arguments[_key2];\n        }\n        _leaflet[\"default\"].TileLayer.prototype._update.apply(this, args);\n        this._updateAttribution();\n      }\n    }\n  }, {\n    key: \"_updateAttribution\",\n    value: function _updateAttribution() {\n      if (!this._usable || !(0, _isDefined[\"default\"])(this.imageryProvider.getTileCredits)) {\n        return;\n      }\n      for (var i = 0; i < this._previousCredits.length; ++i) {\n        this._previousCredits[i]._shownInLeafletLastUpdate = this._previousCredits[i]._shownInLeaflet;\n        this._previousCredits[i]._shownInLeaflet = false;\n      }\n      var bounds = this._map.getBounds();\n      var zoom = this._map.getZoom() - this._zSubtract;\n      var tilingScheme = this.imageryProvider.tilingScheme;\n      swScratch.longitude = Math.max(_Math[\"default\"].negativePiToPi(_Math[\"default\"].toRadians(bounds.getWest())), tilingScheme.rectangle.west);\n      swScratch.latitude = Math.max(_Math[\"default\"].toRadians(bounds.getSouth()), tilingScheme.rectangle.south);\n      var sw = tilingScheme.positionToTileXY(swScratch, zoom, swTileCoordinatesScratch);\n      if (!(0, _isDefined[\"default\"])(sw)) {\n        sw = swTileCoordinatesScratch;\n        sw.x = 0;\n        sw.y = tilingScheme.getNumberOfYTilesAtLevel(zoom) - 1;\n      }\n      neScratch.longitude = Math.min(_Math[\"default\"].negativePiToPi(_Math[\"default\"].toRadians(bounds.getEast())), tilingScheme.rectangle.east);\n      neScratch.latitude = Math.min(_Math[\"default\"].toRadians(bounds.getNorth()), tilingScheme.rectangle.north);\n      var ne = tilingScheme.positionToTileXY(neScratch, zoom, neTileCoordinatesScratch);\n      if (!(0, _isDefined[\"default\"])(ne)) {\n        ne = neTileCoordinatesScratch;\n        ne.x = tilingScheme.getNumberOfXTilesAtLevel(zoom) - 1;\n        ne.y = 0;\n      }\n      var nextCredits = [];\n      for (var j = ne.y; j < sw.y; ++j) {\n        for (var _i = sw.x; _i < ne.x; ++_i) {\n          var credits = this.imageryProvider.getTileCredits(_i, j, zoom);\n          if (!(0, _defined[\"default\"])(credits)) {\n            continue;\n          }\n          for (var k = 0; k < credits.length; ++k) {\n            var credit = credits[k];\n            if (credit._shownInLeaflet) {\n              continue;\n            }\n            credit._shownInLeaflet = true;\n            nextCredits.push(credit);\n            if (!credit._shownInLeafletLastUpdate) {\n              this._map.attributionControl.addAttribution(getCreditHtml(credit));\n            }\n          }\n        }\n      }\n\n      // Remove attributions that applied last update but not this one.\n      for (var _i2 = 0; _i2 < this._previousCredits.length; ++_i2) {\n        if (!this._previousCredits[_i2]._shownInLeaflet) {\n          this._map.attributionControl.removeAttribution(getCreditHtml(this._previousCredits[_i2]));\n          this._previousCredits[_i2]._shownInLeafletLastUpdate = false;\n        }\n      }\n      this._previousCredits = nextCredits;\n    }\n  }, {\n    key: \"getFeaturePickingCoords\",\n    value: function () {\n      var _getFeaturePickingCoords = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(map, longitudeRadians, latitudeRadians) {\n        var ll, level, tilingScheme, coords;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              ll = new _Cartographic[\"default\"](_Math[\"default\"].negativePiToPi(longitudeRadians), latitudeRadians, 0.0);\n              level = Math.round(map.getZoom());\n              tilingScheme = this.imageryProvider.tilingScheme;\n              coords = tilingScheme.positionToTileXY(ll, level);\n              return _context.abrupt(\"return\", {\n                x: coords.x,\n                y: coords.y,\n                level: level\n              });\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function getFeaturePickingCoords(_x, _x2, _x3) {\n        return _getFeaturePickingCoords.apply(this, arguments);\n      }\n      return getFeaturePickingCoords;\n    }()\n  }, {\n    key: \"pickFeatures\",\n    value: function () {\n      var _pickFeatures = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(x, y, level, longitudeRadians, latitudeRadians) {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return this.imageryProvider.pickFeatures(x, y, level, longitudeRadians, latitudeRadians);\n            case 3:\n              return _context2.abrupt(\"return\", _context2.sent);\n            case 6:\n              _context2.prev = 6;\n              _context2.t0 = _context2[\"catch\"](0);\n              _TerriaError[\"default\"].from(_context2.t0, \"An error ocurred while calling `ImageryProvider#.pickFeatures`. `ImageryProvider.url = \".concat(this.imageryProvider.url, \"`\")).log();\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 6]]);\n      }));\n      function pickFeatures(_x4, _x5, _x6, _x7, _x8) {\n        return _pickFeatures.apply(this, arguments);\n      }\n      return pickFeatures;\n    }()\n  }, {\n    key: \"onRemove\",\n    value: function onRemove(map) {\n      if (this._delayedUpdate) {\n        clearTimeout(this._delayedUpdate);\n        this._delayedUpdate = undefined;\n      }\n      for (var i = 0; i < this._previousCredits.length; ++i) {\n        this._previousCredits[i]._shownInLeafletLastUpdate = false;\n        this._previousCredits[i]._shownInLeaflet = false;\n        map.attributionControl.removeAttribution(getCreditHtml(this._previousCredits[i]));\n      }\n      if (this._usable && (0, _defined[\"default\"])(this.imageryProvider.credit)) {\n        map.attributionControl.removeAttribution(getCreditHtml(this.imageryProvider.credit));\n      }\n      _leaflet[\"default\"].TileLayer.prototype.onRemove.apply(this, [map]);\n\n      // Check that this cancels tile requests when dragging the time slider and rapidly creating\n      // and destroying layers.  If the image requests for previous times/layers are allowed to hang\n      // around, they clog up the pipeline and it takes approximately forever for the browser\n      // to get around to downloading the tiles that are actually needed.\n      this._abortLoading();\n      return this;\n    }\n  }]);\n}(_leaflet[\"default\"].TileLayer), _descriptor = _applyDecoratedDescriptor(_class.prototype, \"splitDirection\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return _SplitDirection[\"default\"].NONE;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"splitPosition\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return 0.5;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"_clipsForSplitter\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"_clipsForSplitter\"), _class.prototype), _class);\nfunction getCreditHtml(credit) {\n  return credit.element.outerHTML;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldC9JbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyLnRzP2UwYTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGkxOG5leHQgZnJvbSBcImkxOG5leHRcIjtcclxuaW1wb3J0IEwsIHsgVGlsZUV2ZW50IH0gZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0IHtcclxuICBhdXRvcnVuLFxyXG4gIGNvbXB1dGVkLFxyXG4gIElSZWFjdGlvbkRpc3Bvc2VyLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgbWFrZU9ic2VydmFibGVcclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgQ2FydGVzaWFuMiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRlc2lhbjJcIjtcclxuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRvZ3JhcGhpY1wiO1xyXG5pbXBvcnQgQ2VzaXVtQ3JlZGl0IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ3JlZGl0XCI7XHJcbmltcG9ydCBkZWZpbmVkIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvZGVmaW5lZFwiO1xyXG5pbXBvcnQgQ2VzaXVtRXZlbnQgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9FdmVudFwiO1xyXG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcclxuaW1wb3J0IFRpbGVQcm92aWRlckVycm9yIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvVGlsZVByb3ZpZGVyRXJyb3JcIjtcclxuaW1wb3J0IFdlYk1lcmNhdG9yVGlsaW5nU2NoZW1lIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvV2ViTWVyY2F0b3JUaWxpbmdTY2hlbWVcIjtcclxuaW1wb3J0IEltYWdlcnlMYXllckZlYXR1cmVJbmZvIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL1NjZW5lL0ltYWdlcnlMYXllckZlYXR1cmVJbmZvXCI7XHJcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XHJcbmltcG9ydCBTcGxpdERpcmVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9TY2VuZS9TcGxpdERpcmVjdGlvblwiO1xyXG5pbXBvcnQgaXNEZWZpbmVkIGZyb20gXCIuLi8uLi9Db3JlL2lzRGVmaW5lZFwiO1xyXG5pbXBvcnQgVGVycmlhRXJyb3IgZnJvbSBcIi4uLy4uL0NvcmUvVGVycmlhRXJyb3JcIjtcclxuaW1wb3J0IExlYWZsZXQgZnJvbSBcIi4uLy4uL01vZGVscy9MZWFmbGV0XCI7XHJcbmltcG9ydCBnZXRVcmxGb3JJbWFnZXJ5VGlsZSBmcm9tIFwiLi4vSW1hZ2VyeVByb3ZpZGVyL2dldFVybEZvckltYWdlcnlUaWxlXCI7XHJcbmltcG9ydCB7IFByb3ZpZGVyQ29vcmRzIH0gZnJvbSBcIi4uL1BpY2tlZEZlYXR1cmVzL1BpY2tlZEZlYXR1cmVzXCI7XHJcblxyXG5jb25zdCBzd1NjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XHJcbmNvbnN0IG5lU2NyYXRjaCA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcclxuY29uc3Qgc3dUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoID0gbmV3IENhcnRlc2lhbjIoKTtcclxuY29uc3QgbmVUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoID0gbmV3IENhcnRlc2lhbjIoKTtcclxuXHJcbmNsYXNzIENyZWRpdCBleHRlbmRzIENlc2l1bUNyZWRpdCB7XHJcbiAgX3Nob3duSW5MZWFmbGV0PzogYm9vbGVhbjtcclxuICBfc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlPzogYm9vbGVhbjtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciBleHRlbmRzIEwuVGlsZUxheWVyIHtcclxuICByZWFkb25seSB0aWxlU2l6ZSA9IDI1NjtcclxuICByZWFkb25seSBlcnJvckV2ZW50ID0gbmV3IENlc2l1bUV2ZW50KCk7XHJcblxyXG4gIHByaXZhdGUgaW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICBwcml2YXRlIF91c2FibGUgPSBmYWxzZTtcclxuICBwcml2YXRlIF9kZWxheWVkVXBkYXRlPzogbnVtYmVyO1xyXG4gIHByaXZhdGUgX3pTdWJ0cmFjdCA9IDA7XHJcbiAgcHJpdmF0ZSBfcmVxdWVzdEltYWdlRXJyb3I6IFRpbGVQcm92aWRlckVycm9yIHwgdW5kZWZpbmVkO1xyXG4gIHByaXZhdGUgX3ByZXZpb3VzQ3JlZGl0czogQ3JlZGl0W10gPSBbXTtcclxuICBwcml2YXRlIF9sZWFmbGV0VXBkYXRlSW50ZXJ2YWw6IG51bWJlcjtcclxuXHJcbiAgQG9ic2VydmFibGUgc3BsaXREaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5OT05FO1xyXG4gIEBvYnNlcnZhYmxlIHNwbGl0UG9zaXRpb246IG51bWJlciA9IDAuNTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxlYWZsZXQ6IExlYWZsZXQsXHJcbiAgICByZWFkb25seSBpbWFnZXJ5UHJvdmlkZXI6IEltYWdlcnlQcm92aWRlcixcclxuICAgIG9wdGlvbnM6IEwuVGlsZUxheWVyT3B0aW9ucyA9IHt9XHJcbiAgKSB7XHJcbiAgICBzdXBlcih1bmRlZmluZWQgYXMgYW55LCB7XHJcbiAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICAgIHVwZGF0ZUludGVydmFsOiBkZWZpbmVkKChpbWFnZXJ5UHJvdmlkZXIgYXMgYW55KS5fbGVhZmxldFVwZGF0ZUludGVydmFsKVxyXG4gICAgICAgID8gKGltYWdlcnlQcm92aWRlciBhcyBhbnkpLl9sZWFmbGV0VXBkYXRlSW50ZXJ2YWxcclxuICAgICAgICA6IDEwMFxyXG4gICAgfSk7XHJcbiAgICBtYWtlT2JzZXJ2YWJsZSh0aGlzKTtcclxuICAgIHRoaXMuaW1hZ2VyeVByb3ZpZGVyID0gaW1hZ2VyeVByb3ZpZGVyO1xyXG5cclxuICAgIC8vIEhhbmRsZSBzcGxpdHRlciByZWN0aW9uIChhbmQgZGlzcG9zaW5nIHJlYWN0aW9uKVxyXG4gICAgbGV0IGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uOiBJUmVhY3Rpb25EaXNwb3NlciB8IHVuZGVmaW5lZDtcclxuICAgIHRoaXMub24oXCJhZGRcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAoIWRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKSB7XHJcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24gPSB0aGlzLl9yZWFjdFRvU3BsaXR0ZXJDaGFuZ2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLm9uKFwicmVtb3ZlXCIsICgpID0+IHtcclxuICAgICAgaWYgKGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKSB7XHJcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24oKTtcclxuICAgICAgICBkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5fbGVhZmxldFVwZGF0ZUludGVydmFsID0gZGVmaW5lZChcclxuICAgICAgKGltYWdlcnlQcm92aWRlciBhcyBhbnkpLl9sZWFmbGV0VXBkYXRlSW50ZXJ2YWxcclxuICAgIClcclxuICAgICAgPyAoaW1hZ2VyeVByb3ZpZGVyIGFzIGFueSkuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbFxyXG4gICAgICA6IDEwMDtcclxuXHJcbiAgICAvLyBIYWNrIHRvIGZpeCBcIlNwYWNlIGJldHdlZW4gdGlsZXMgb24gZnJhY3Rpb25hbCB6b29tIGxldmVscyBpbiBXZWJraXQgYnJvd3NlcnNcIiAoaHR0cHM6Ly9naXRodWIuY29tL0xlYWZsZXQvTGVhZmxldC9pc3N1ZXMvMzU3NSNpc3N1ZWNvbW1lbnQtNjg4NjQ0MjI1KVxyXG4gICAgdGhpcy5vbihcInRpbGVsb2Fkc3RhcnRcIiwgKGV2ZW50OiBUaWxlRXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQudGlsZS5zdHlsZS53aWR0aCA9IHRoaXMuZ2V0VGlsZVNpemUoKS54ICsgMC41ICsgXCJweFwiO1xyXG4gICAgICBldmVudC50aWxlLnN0eWxlLmhlaWdodCA9IHRoaXMuZ2V0VGlsZVNpemUoKS55ICsgMC41ICsgXCJweFwiO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfcmVhY3RUb1NwbGl0dGVyQ2hhbmdlKCkge1xyXG4gICAgcmV0dXJuIGF1dG9ydW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lcigpO1xyXG4gICAgICBpZiAoY29udGFpbmVyID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5zcGxpdERpcmVjdGlvbiA9PT0gU3BsaXREaXJlY3Rpb24uTEVGVCkge1xyXG4gICAgICAgIGNvbnN0IHsgbGVmdDogY2xpcExlZnQgfSA9IHRoaXMuX2NsaXBzRm9yU3BsaXR0ZXI7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmNsaXAgPSBjbGlwTGVmdDtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLnNwbGl0RGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5SSUdIVCkge1xyXG4gICAgICAgIGNvbnN0IHsgcmlnaHQ6IGNsaXBSaWdodCB9ID0gdGhpcy5fY2xpcHNGb3JTcGxpdHRlcjtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IGNsaXBSaWdodDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IFwiYXV0b1wiO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIEBjb21wdXRlZFxyXG4gIGdldCBfY2xpcHNGb3JTcGxpdHRlcigpIHtcclxuICAgIGxldCBjbGlwTGVmdCA9IFwiXCI7XHJcbiAgICBsZXQgY2xpcFJpZ2h0ID0gXCJcIjtcclxuICAgIGxldCBjbGlwUG9zaXRpb25XaXRoaW5NYXA7XHJcbiAgICBsZXQgY2xpcFg7XHJcblxyXG4gICAgaWYgKHRoaXMubGVhZmxldC5zaXplICYmIHRoaXMubGVhZmxldC5udyAmJiB0aGlzLmxlYWZsZXQuc2UpIHtcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwID0gdGhpcy5sZWFmbGV0LnNpemUueCAqIHRoaXMuc3BsaXRQb3NpdGlvbjtcclxuICAgICAgY2xpcFggPSBNYXRoLnJvdW5kKHRoaXMubGVhZmxldC5udy54ICsgY2xpcFBvc2l0aW9uV2l0aGluTWFwKTtcclxuICAgICAgY2xpcExlZnQgPVxyXG4gICAgICAgIFwicmVjdChcIiArXHJcbiAgICAgICAgW3RoaXMubGVhZmxldC5udy55LCBjbGlwWCwgdGhpcy5sZWFmbGV0LnNlLnksIHRoaXMubGVhZmxldC5udy54XS5qb2luKFxyXG4gICAgICAgICAgXCJweCxcIlxyXG4gICAgICAgICkgK1xyXG4gICAgICAgIFwicHgpXCI7XHJcbiAgICAgIGNsaXBSaWdodCA9XHJcbiAgICAgICAgXCJyZWN0KFwiICtcclxuICAgICAgICBbdGhpcy5sZWFmbGV0Lm53LnksIHRoaXMubGVhZmxldC5zZS54LCB0aGlzLmxlYWZsZXQuc2UueSwgY2xpcFhdLmpvaW4oXHJcbiAgICAgICAgICBcInB4LFwiXHJcbiAgICAgICAgKSArXHJcbiAgICAgICAgXCJweClcIjtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGxlZnQ6IGNsaXBMZWZ0LFxyXG4gICAgICByaWdodDogY2xpcFJpZ2h0LFxyXG4gICAgICBjbGlwUG9zaXRpb25XaXRoaW5NYXA6IGNsaXBQb3NpdGlvbldpdGhpbk1hcCxcclxuICAgICAgY2xpcFg6IGNsaXBYXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgX3RpbGVPbkVycm9yKF9kb25lOiB1bmtub3duLCBfdGlsZTogdW5rbm93biwgX2U6IHVua25vd24pIHtcclxuICAgIC8vIERvIG5vdGhpbmcsIHdlJ2xsIGhhbmRsZSB0aWxlIGVycm9ycyBzZXBhcmF0ZWx5LlxyXG4gIH1cclxuXHJcbiAgY3JlYXRlVGlsZShjb29yZHM6IEwuQ29vcmRzLCBkb25lOiBMLkRvbmVDYWxsYmFjaykge1xyXG4gICAgLy8gQ3JlYXRlIGEgdGlsZSAoSW1hZ2UpIGFzIG5vcm1hbC5cclxuICAgIGNvbnN0IHRpbGUgPSBzdXBlci5jcmVhdGVUaWxlKGNvb3JkcywgZG9uZSkgYXMgSFRNTEltYWdlRWxlbWVudDtcclxuXHJcbiAgICAvLyBCeSBkZWZhdWx0LCBMZWFmbGV0IGhhbmRsZXMgdGlsZSBsb2FkIGVycm9ycyBieSBzZXR0aW5nIHRoZSBJbWFnZSB0byB0aGUgZXJyb3IgVVJMIGFuZCByYWlzaW5nXHJcbiAgICAvLyBhbiBlcnJvciBldmVudC4gIFdlIHdhbnQgdG8gZmlyc3QgcmFpc2UgYW4gZXJyb3IgZXZlbnQgdGhhdCBvcHRpb25hbGx5IHJldHVybnMgYSBwcm9taXNlIGFuZFxyXG4gICAgLy8gcmV0cmllcyBhZnRlciB0aGUgcHJvbWlzZSByZXNvbHZlcy5cclxuXHJcbiAgICBjb25zdCBfZG9SZXF1ZXN0ID0gKHdhaXRQcm9taXNlPzogYW55KSA9PiB7XHJcbiAgICAgIGlmICh3YWl0UHJvbWlzZSkge1xyXG4gICAgICAgIHdhaXRQcm9taXNlXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF9kb1JlcXVlc3QoKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goKGU6IHVua25vd24pID0+IHtcclxuICAgICAgICAgICAgLy8gVGhlIHRpbGUgaGFzIGZhaWxlZCBpcnJlY292ZXJhYmx5LCBzbyBpbnZva2UgTGVhZmxldCdzIHN0YW5kYXJkXHJcbiAgICAgICAgICAgIC8vIHRpbGUgZXJyb3IgaGFuZGxlci5cclxuICAgICAgICAgICAgKEwuVGlsZUxheWVyIGFzIGFueSkucHJvdG90eXBlLl90aWxlT25FcnJvci5jYWxsKFxyXG4gICAgICAgICAgICAgIHRoaXMsXHJcbiAgICAgICAgICAgICAgZG9uZSxcclxuICAgICAgICAgICAgICB0aWxlLFxyXG4gICAgICAgICAgICAgIGVcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU2V0dGluZyBzcmMgd2lsbCB0cmlnZ2VyIGEgbmV3IGxvYWQgb3IgZXJyb3IgZXZlbnQsIGV2ZW4gaWYgdGhlXHJcbiAgICAgIC8vIG5ldyBzcmMgaXMgdGhlIHNhbWUgYXMgdGhlIG9sZCBvbmUuXHJcbiAgICAgIGNvbnN0IHRpbGVVcmwgPSB0aGlzLmdldFRpbGVVcmwoY29vcmRzKTtcclxuICAgICAgaWYgKGlzRGVmaW5lZCh0aWxlVXJsKSkge1xyXG4gICAgICAgIHRpbGUuc3JjID0gdGlsZVVybDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBMLkRvbUV2ZW50Lm9uKHRpbGUsIFwiZXJyb3JcIiwgKGUpID0+IHtcclxuICAgICAgY29uc3QgbGV2ZWwgPSAodGhpcyBhcyBhbnkpLl9nZXRMZXZlbEZyb21aKGNvb3Jkcyk7XHJcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBpMThuZXh0LnQoXCJtYXAuY2VzaXVtLmZhaWxlZFRvT2J0YWluXCIsIHtcclxuICAgICAgICB4OiBjb29yZHMueCxcclxuICAgICAgICB5OiBjb29yZHMueSxcclxuICAgICAgICBsZXZlbDogbGV2ZWxcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuX3JlcXVlc3RJbWFnZUVycm9yID0gVGlsZVByb3ZpZGVyRXJyb3IucmVwb3J0RXJyb3IoXHJcbiAgICAgICAgdGhpcy5fcmVxdWVzdEltYWdlRXJyb3IhLCAvLyBUT0RPOiBDZXNpdW0gdHlwZSBkZWZpbml0aW9ucyBpbmNvcnJlY3RseSBmb3JiaWQgdW5kZWZpbmVkXHJcbiAgICAgICAgdGhpcy5pbWFnZXJ5UHJvdmlkZXIsXHJcbiAgICAgICAgdGhpcy5pbWFnZXJ5UHJvdmlkZXIuZXJyb3JFdmVudCxcclxuICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgIGNvb3Jkcy54LFxyXG4gICAgICAgIGNvb3Jkcy55LFxyXG4gICAgICAgIGxldmVsLFxyXG4gICAgICAgIGUgYXMgYW55XHJcbiAgICAgICAgLy8gVE9ETzogYnJpbmcgdGVycmlhanMtY2VzaXVtIHJldHJ5IGxvZ2ljIHRvIGNlc2l1bVxyXG4gICAgICAgIC8vZG9SZXF1ZXN0XHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGlsZTtcclxuICB9XHJcblxyXG4gIGdldFRpbGVVcmwodGlsZVBvaW50OiBMLkNvb3Jkcyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBsZXZlbCA9IHRoaXMuX2dldExldmVsRnJvbVoodGlsZVBvaW50KTtcclxuICAgIGNvbnN0IGVycm9yVGlsZVVybCA9IHRoaXMub3B0aW9ucy5lcnJvclRpbGVVcmwgfHwgXCJcIjtcclxuICAgIGlmIChsZXZlbCA8IDApIHtcclxuICAgICAgcmV0dXJuIGVycm9yVGlsZVVybDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBnZXRVcmxGb3JJbWFnZXJ5VGlsZShcclxuICAgICAgICB0aGlzLmltYWdlcnlQcm92aWRlcixcclxuICAgICAgICB0aWxlUG9pbnQueCxcclxuICAgICAgICB0aWxlUG9pbnQueSxcclxuICAgICAgICBsZXZlbFxyXG4gICAgICApIHx8IGVycm9yVGlsZVVybFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIF9nZXRMZXZlbEZyb21aKHRpbGVQb2ludDogTC5Db29yZHMpIHtcclxuICAgIHJldHVybiB0aWxlUG9pbnQueiAtIHRoaXMuX3pTdWJ0cmFjdDtcclxuICB9XHJcblxyXG4gIF91cGRhdGUoLi4uYXJnczogdW5rbm93bltdKSB7XHJcbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcclxuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XHJcblxyXG4gICAgICAvLyBDYW5jZWwgdGhlIGV4aXN0aW5nIGRlbGF5ZWQgdXBkYXRlLCBpZiBhbnkuXHJcbiAgICAgIGlmICh0aGlzLl9kZWxheWVkVXBkYXRlKSB7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2RlbGF5ZWRVcGRhdGUpO1xyXG4gICAgICAgIHRoaXMuX2RlbGF5ZWRVcGRhdGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuX2RlbGF5ZWRVcGRhdGUgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLl9kZWxheWVkVXBkYXRlID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAvLyBJZiB3ZSdyZSBubyBsb25nZXIgYXR0YWNoZWQgdG8gYSBtYXAsIGRvIG5vdGhpbmcuXHJcbiAgICAgICAgaWYgKCF0aGlzLl9tYXApIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHRpbGluZ1NjaGVtZSA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnRpbGluZ1NjaGVtZTtcclxuICAgICAgICBpZiAoISh0aWxpbmdTY2hlbWUgaW5zdGFuY2VvZiBXZWJNZXJjYXRvclRpbGluZ1NjaGVtZSkpIHtcclxuICAgICAgICAgIHRoaXMuZXJyb3JFdmVudC5yYWlzZUV2ZW50KFxyXG4gICAgICAgICAgICB0aGlzLFxyXG4gICAgICAgICAgICBpMThuZXh0LnQoXCJtYXAuY2VzaXVtLm5vdFdlYk1lcmNhdG9yVGlsaW5nU2NoZW1lXCIpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGlsaW5nU2NoZW1lLmdldE51bWJlck9mWFRpbGVzQXRMZXZlbCgwKSA9PT0gMiAmJlxyXG4gICAgICAgICAgdGlsaW5nU2NoZW1lLmdldE51bWJlck9mWVRpbGVzQXRMZXZlbCgwKSA9PT0gMlxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgdGhpcy5felN1YnRyYWN0ID0gMTtcclxuICAgICAgICB9IGVsc2UgaWYgKFxyXG4gICAgICAgICAgdGlsaW5nU2NoZW1lLmdldE51bWJlck9mWFRpbGVzQXRMZXZlbCgwKSAhPT0gMSB8fFxyXG4gICAgICAgICAgdGlsaW5nU2NoZW1lLmdldE51bWJlck9mWVRpbGVzQXRMZXZlbCgwKSAhPT0gMVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgdGhpcy5lcnJvckV2ZW50LnJhaXNlRXZlbnQoXHJcbiAgICAgICAgICAgIHRoaXMsXHJcbiAgICAgICAgICAgIGkxOG5leHQudChcIm1hcC5jZXNpdW0udW51c2FsVGlsaW5nU2NoZW1lXCIpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGlzRGVmaW5lZCh0aGlzLmltYWdlcnlQcm92aWRlci5tYXhpbXVtTGV2ZWwpKSB7XHJcbiAgICAgICAgICB0aGlzLm9wdGlvbnMubWF4TmF0aXZlWm9vbSA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLm1heGltdW1MZXZlbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLm1pbmltdW1MZXZlbCkpIHtcclxuICAgICAgICAgIHRoaXMub3B0aW9ucy5taW5OYXRpdmVab29tID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIubWluaW11bUxldmVsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGlzRGVmaW5lZCh0aGlzLmltYWdlcnlQcm92aWRlci5jcmVkaXQpKSB7XHJcbiAgICAgICAgICAodGhpcy5fbWFwIGFzIGFueSkuYXR0cmlidXRpb25Db250cm9sLmFkZEF0dHJpYnV0aW9uKFxyXG4gICAgICAgICAgICBnZXRDcmVkaXRIdG1sKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLmNyZWRpdClcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl91c2FibGUgPSB0cnVlO1xyXG5cclxuICAgICAgICB0aGlzLl91cGRhdGUoKTtcclxuICAgICAgfSwgdGhpcy5fbGVhZmxldFVwZGF0ZUludGVydmFsKSBhcyBhbnk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX3VzYWJsZSkge1xyXG4gICAgICAoTC5UaWxlTGF5ZXIgYXMgYW55KS5wcm90b3R5cGUuX3VwZGF0ZS5hcHBseSh0aGlzLCBhcmdzKTtcclxuXHJcbiAgICAgIHRoaXMuX3VwZGF0ZUF0dHJpYnV0aW9uKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfdXBkYXRlQXR0cmlidXRpb24oKSB7XHJcbiAgICBpZiAoIXRoaXMuX3VzYWJsZSB8fCAhaXNEZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLmdldFRpbGVDcmVkaXRzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9wcmV2aW91c0NyZWRpdHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldExhc3RVcGRhdGUgPVxyXG4gICAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXQ7XHJcbiAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBib3VuZHMgPSB0aGlzLl9tYXAuZ2V0Qm91bmRzKCk7XHJcbiAgICBjb25zdCB6b29tID0gdGhpcy5fbWFwLmdldFpvb20oKSAtIHRoaXMuX3pTdWJ0cmFjdDtcclxuXHJcbiAgICBjb25zdCB0aWxpbmdTY2hlbWUgPSB0aGlzLmltYWdlcnlQcm92aWRlci50aWxpbmdTY2hlbWU7XHJcblxyXG4gICAgc3dTY3JhdGNoLmxvbmdpdHVkZSA9IE1hdGgubWF4KFxyXG4gICAgICBDZXNpdW1NYXRoLm5lZ2F0aXZlUGlUb1BpKENlc2l1bU1hdGgudG9SYWRpYW5zKGJvdW5kcy5nZXRXZXN0KCkpKSxcclxuICAgICAgdGlsaW5nU2NoZW1lLnJlY3RhbmdsZS53ZXN0XHJcbiAgICApO1xyXG4gICAgc3dTY3JhdGNoLmxhdGl0dWRlID0gTWF0aC5tYXgoXHJcbiAgICAgIENlc2l1bU1hdGgudG9SYWRpYW5zKGJvdW5kcy5nZXRTb3V0aCgpKSxcclxuICAgICAgdGlsaW5nU2NoZW1lLnJlY3RhbmdsZS5zb3V0aFxyXG4gICAgKTtcclxuICAgIGxldCBzdyA9IHRpbGluZ1NjaGVtZS5wb3NpdGlvblRvVGlsZVhZKFxyXG4gICAgICBzd1NjcmF0Y2gsXHJcbiAgICAgIHpvb20sXHJcbiAgICAgIHN3VGlsZUNvb3JkaW5hdGVzU2NyYXRjaFxyXG4gICAgKTtcclxuICAgIGlmICghaXNEZWZpbmVkKHN3KSkge1xyXG4gICAgICBzdyA9IHN3VGlsZUNvb3JkaW5hdGVzU2NyYXRjaDtcclxuICAgICAgc3cueCA9IDA7XHJcbiAgICAgIHN3LnkgPSB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZZVGlsZXNBdExldmVsKHpvb20pIC0gMTtcclxuICAgIH1cclxuXHJcbiAgICBuZVNjcmF0Y2gubG9uZ2l0dWRlID0gTWF0aC5taW4oXHJcbiAgICAgIENlc2l1bU1hdGgubmVnYXRpdmVQaVRvUGkoQ2VzaXVtTWF0aC50b1JhZGlhbnMoYm91bmRzLmdldEVhc3QoKSkpLFxyXG4gICAgICB0aWxpbmdTY2hlbWUucmVjdGFuZ2xlLmVhc3RcclxuICAgICk7XHJcbiAgICBuZVNjcmF0Y2gubGF0aXR1ZGUgPSBNYXRoLm1pbihcclxuICAgICAgQ2VzaXVtTWF0aC50b1JhZGlhbnMoYm91bmRzLmdldE5vcnRoKCkpLFxyXG4gICAgICB0aWxpbmdTY2hlbWUucmVjdGFuZ2xlLm5vcnRoXHJcbiAgICApO1xyXG4gICAgbGV0IG5lID0gdGlsaW5nU2NoZW1lLnBvc2l0aW9uVG9UaWxlWFkoXHJcbiAgICAgIG5lU2NyYXRjaCxcclxuICAgICAgem9vbSxcclxuICAgICAgbmVUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoXHJcbiAgICApO1xyXG4gICAgaWYgKCFpc0RlZmluZWQobmUpKSB7XHJcbiAgICAgIG5lID0gbmVUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoO1xyXG4gICAgICBuZS54ID0gdGlsaW5nU2NoZW1lLmdldE51bWJlck9mWFRpbGVzQXRMZXZlbCh6b29tKSAtIDE7XHJcbiAgICAgIG5lLnkgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG5leHRDcmVkaXRzID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgaiA9IG5lLnk7IGogPCBzdy55OyArK2opIHtcclxuICAgICAgZm9yIChsZXQgaSA9IHN3Lng7IGkgPCBuZS54OyArK2kpIHtcclxuICAgICAgICBjb25zdCBjcmVkaXRzID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIuZ2V0VGlsZUNyZWRpdHMoXHJcbiAgICAgICAgICBpLFxyXG4gICAgICAgICAgaixcclxuICAgICAgICAgIHpvb21cclxuICAgICAgICApIGFzIENyZWRpdFtdO1xyXG4gICAgICAgIGlmICghZGVmaW5lZChjcmVkaXRzKSkge1xyXG4gICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGNyZWRpdHMubGVuZ3RoOyArK2spIHtcclxuICAgICAgICAgIGNvbnN0IGNyZWRpdCA9IGNyZWRpdHNba107XHJcbiAgICAgICAgICBpZiAoY3JlZGl0Ll9zaG93bkluTGVhZmxldCkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBjcmVkaXQuX3Nob3duSW5MZWFmbGV0ID0gdHJ1ZTtcclxuICAgICAgICAgIG5leHRDcmVkaXRzLnB1c2goY3JlZGl0KTtcclxuXHJcbiAgICAgICAgICBpZiAoIWNyZWRpdC5fc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlKSB7XHJcbiAgICAgICAgICAgICh0aGlzLl9tYXAgYXMgYW55KS5hdHRyaWJ1dGlvbkNvbnRyb2wuYWRkQXR0cmlidXRpb24oXHJcbiAgICAgICAgICAgICAgZ2V0Q3JlZGl0SHRtbChjcmVkaXQpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVtb3ZlIGF0dHJpYnV0aW9ucyB0aGF0IGFwcGxpZWQgbGFzdCB1cGRhdGUgYnV0IG5vdCB0aGlzIG9uZS5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcHJldmlvdXNDcmVkaXRzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgIGlmICghdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldCkge1xyXG4gICAgICAgICh0aGlzLl9tYXAgYXMgYW55KS5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oXHJcbiAgICAgICAgICBnZXRDcmVkaXRIdG1sKHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXSlcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9wcmV2aW91c0NyZWRpdHMgPSBuZXh0Q3JlZGl0cztcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEZlYXR1cmVQaWNraW5nQ29vcmRzKFxyXG4gICAgbWFwOiBMLk1hcCxcclxuICAgIGxvbmdpdHVkZVJhZGlhbnM6IG51bWJlcixcclxuICAgIGxhdGl0dWRlUmFkaWFuczogbnVtYmVyXHJcbiAgKTogUHJvbWlzZTxQcm92aWRlckNvb3Jkcz4ge1xyXG4gICAgY29uc3QgbGwgPSBuZXcgQ2FydG9ncmFwaGljKFxyXG4gICAgICBDZXNpdW1NYXRoLm5lZ2F0aXZlUGlUb1BpKGxvbmdpdHVkZVJhZGlhbnMpLFxyXG4gICAgICBsYXRpdHVkZVJhZGlhbnMsXHJcbiAgICAgIDAuMFxyXG4gICAgKTtcclxuICAgIGNvbnN0IGxldmVsID0gTWF0aC5yb3VuZChtYXAuZ2V0Wm9vbSgpKTtcclxuXHJcbiAgICBjb25zdCB0aWxpbmdTY2hlbWUgPSB0aGlzLmltYWdlcnlQcm92aWRlci50aWxpbmdTY2hlbWU7XHJcbiAgICBjb25zdCBjb29yZHMgPSB0aWxpbmdTY2hlbWUucG9zaXRpb25Ub1RpbGVYWShsbCwgbGV2ZWwpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogY29vcmRzLngsXHJcbiAgICAgIHk6IGNvb3Jkcy55LFxyXG4gICAgICBsZXZlbDogbGV2ZWxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBwaWNrRmVhdHVyZXMoXHJcbiAgICB4OiBudW1iZXIsXHJcbiAgICB5OiBudW1iZXIsXHJcbiAgICBsZXZlbDogbnVtYmVyLFxyXG4gICAgbG9uZ2l0dWRlUmFkaWFuczogbnVtYmVyLFxyXG4gICAgbGF0aXR1ZGVSYWRpYW5zOiBudW1iZXJcclxuICApOiBQcm9taXNlPEltYWdlcnlMYXllckZlYXR1cmVJbmZvW10gfCB1bmRlZmluZWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmltYWdlcnlQcm92aWRlci5waWNrRmVhdHVyZXMoXHJcbiAgICAgICAgeCxcclxuICAgICAgICB5LFxyXG4gICAgICAgIGxldmVsLFxyXG4gICAgICAgIGxvbmdpdHVkZVJhZGlhbnMsXHJcbiAgICAgICAgbGF0aXR1ZGVSYWRpYW5zXHJcbiAgICAgICk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIFRlcnJpYUVycm9yLmZyb20oXHJcbiAgICAgICAgZSxcclxuICAgICAgICBgQW4gZXJyb3Igb2N1cnJlZCB3aGlsZSBjYWxsaW5nIFxcYEltYWdlcnlQcm92aWRlciMucGlja0ZlYXR1cmVzXFxgLiBcXGBJbWFnZXJ5UHJvdmlkZXIudXJsID0gJHtcclxuICAgICAgICAgICh0aGlzLmltYWdlcnlQcm92aWRlciBhcyBhbnkpLnVybFxyXG4gICAgICAgIH1cXGBgXHJcbiAgICAgICkubG9nKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvblJlbW92ZShtYXA6IEwuTWFwKSB7XHJcbiAgICBpZiAodGhpcy5fZGVsYXllZFVwZGF0ZSkge1xyXG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5fZGVsYXllZFVwZGF0ZSk7XHJcbiAgICAgIHRoaXMuX2RlbGF5ZWRVcGRhdGUgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9wcmV2aW91c0NyZWRpdHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldExhc3RVcGRhdGUgPSBmYWxzZTtcclxuICAgICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldCA9IGZhbHNlO1xyXG4gICAgICAobWFwIGFzIGFueSkuYXR0cmlidXRpb25Db250cm9sLnJlbW92ZUF0dHJpYnV0aW9uKFxyXG4gICAgICAgIGdldENyZWRpdEh0bWwodGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldKVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl91c2FibGUgJiYgZGVmaW5lZCh0aGlzLmltYWdlcnlQcm92aWRlci5jcmVkaXQpKSB7XHJcbiAgICAgIChtYXAgYXMgYW55KS5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oXHJcbiAgICAgICAgZ2V0Q3JlZGl0SHRtbCh0aGlzLmltYWdlcnlQcm92aWRlci5jcmVkaXQpXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgTC5UaWxlTGF5ZXIucHJvdG90eXBlLm9uUmVtb3ZlLmFwcGx5KHRoaXMsIFttYXBdKTtcclxuXHJcbiAgICAvLyBDaGVjayB0aGF0IHRoaXMgY2FuY2VscyB0aWxlIHJlcXVlc3RzIHdoZW4gZHJhZ2dpbmcgdGhlIHRpbWUgc2xpZGVyIGFuZCByYXBpZGx5IGNyZWF0aW5nXHJcbiAgICAvLyBhbmQgZGVzdHJveWluZyBsYXllcnMuICBJZiB0aGUgaW1hZ2UgcmVxdWVzdHMgZm9yIHByZXZpb3VzIHRpbWVzL2xheWVycyBhcmUgYWxsb3dlZCB0byBoYW5nXHJcbiAgICAvLyBhcm91bmQsIHRoZXkgY2xvZyB1cCB0aGUgcGlwZWxpbmUgYW5kIGl0IHRha2VzIGFwcHJveGltYXRlbHkgZm9yZXZlciBmb3IgdGhlIGJyb3dzZXJcclxuICAgIC8vIHRvIGdldCBhcm91bmQgdG8gZG93bmxvYWRpbmcgdGhlIHRpbGVzIHRoYXQgYXJlIGFjdHVhbGx5IG5lZWRlZC5cclxuICAgIHRoaXMuX2Fib3J0TG9hZGluZygpO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRDcmVkaXRIdG1sKGNyZWRpdDogQ3JlZGl0KSB7XHJcbiAgcmV0dXJuIGNyZWRpdC5lbGVtZW50Lm91dGVySFRNTDtcclxufVxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQXRCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF5QkE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQW9CQTtBQUlBO0FBQUE7QUFEQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBVEE7QUFDQTtBQWhCQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQWlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFJQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUEvREE7QUFBQTtBQWdFQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBRUE7QUFJQTtBQUlBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFJQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFLQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFuQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQTBCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFTQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXZCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQTBCQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBcGFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFzYUE7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts":
/*!***********************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.index-of.js */ \"./node_modules/core-js/modules/es.array.index-of.js\");\n__webpack_require__(/*! core-js/modules/es.array.splice.js */ \"./node_modules/core-js/modules/es.array.splice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _BoundingSphere = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/BoundingSphere */ \"./node_modules/terriajs-cesium/Source/Core/BoundingSphere.js\"));\nvar _EventHelper = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/EventHelper */ \"./node_modules/terriajs-cesium/Source/Core/EventHelper.js\"));\nvar _JulianDate = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/JulianDate */ \"./node_modules/terriajs-cesium/Source/Core/JulianDate.js\"));\nvar _createGuid = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/createGuid */ \"./node_modules/terriajs-cesium/Source/Core/createGuid.js\"));\nvar _defaultValue = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/defaultValue */ \"./node_modules/terriajs-cesium/Source/Core/defaultValue.js\"));\nvar _destroyObject = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/destroyObject */ \"./node_modules/terriajs-cesium/Source/Core/destroyObject.js\"));\nvar _BoundingSphereState = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/BoundingSphereState */ \"./node_modules/terriajs-cesium/Source/DataSources/BoundingSphereState.js\"));\nvar _CustomDataSource = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/CustomDataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/CustomDataSource.js\"));\nvar _DataSource2 = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSource.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(t, e) { if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e; if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\"); return _assertThisInitialized(t); }\nfunction _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); return e; }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }\nfunction _inherits(t, e) { if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, \"prototype\", { writable: !1 }), e && _setPrototypeOf(t, e); }\nfunction _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar LeafletDataSource = /*#__PURE__*/function (_DataSource) {\n  function LeafletDataSource() {\n    var _this;\n    _classCallCheck(this, LeafletDataSource);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, LeafletDataSource, [].concat(args));\n    _defineProperty(_this, \"visualizersByDisplayID\", void 0);\n    _defineProperty(_this, \"visualizers\", void 0);\n    return _this;\n  }\n  _inherits(LeafletDataSource, _DataSource);\n  return _createClass(LeafletDataSource);\n}(_DataSource2[\"default\"]);\n/**\r\n * Visualizes a collection of {@link DataSource} instances in Leaflet.\r\n */\nvar LeafletDataSourceDisplay = exports[\"default\"] = /*#__PURE__*/function () {\n  function LeafletDataSourceDisplay(options) {\n    _classCallCheck(this, LeafletDataSourceDisplay);\n    _defineProperty(this, \"_displayID\", void 0);\n    // Gets the scene associated with this display.\n    _defineProperty(this, \"_scene\", void 0);\n    /**\r\n     * Gets the default data source instance which can be used to\r\n     * manually create and visualize entities not tied to\r\n     * a specific data source. This instance is always available\r\n     * and does not appear in the list dataSources collection.\r\n     */\n    _defineProperty(this, \"_defaultDataSource\", void 0);\n    // Gets the collection of data sources to display.\n    _defineProperty(this, \"_dataSourceCollection\", void 0);\n    _defineProperty(this, \"_visualizersCallback\", void 0);\n    _defineProperty(this, \"_eventHelper\", void 0);\n    // Gets a value indicating whether or not all entities in the data source are ready\n    _defineProperty(this, \"_ready\", void 0);\n    _defineProperty(this, \"_lastTime\", void 0);\n    this._displayID = (0, _createGuid[\"default\"])();\n    this._scene = options.scene;\n    this._dataSourceCollection = options.dataSourceCollection;\n    this._visualizersCallback = (0, _defaultValue[\"default\"])(options.visualizersCallback, LeafletDataSourceDisplay.defaultVisualizersCallback);\n    this._eventHelper = new _EventHelper[\"default\"]();\n    this._eventHelper.add(this._dataSourceCollection.dataSourceAdded, this._onDataSourceAdded, this);\n    this._eventHelper.add(this._dataSourceCollection.dataSourceRemoved, this._onDataSourceRemoved, this);\n    for (var i = 0, len = this._dataSourceCollection.length; i < len; i++) {\n      this._onDataSourceAdded(this._dataSourceCollection, this._dataSourceCollection.get(i));\n    }\n    var defaultDataSource = new _CustomDataSource[\"default\"]();\n    this._onDataSourceAdded(undefined, defaultDataSource);\n    this._defaultDataSource = defaultDataSource;\n    this._ready = false;\n    this._lastTime = _JulianDate[\"default\"].now();\n  }\n\n  /**\r\n   * Gets or sets the default function which creates an array of visualizers used for visualization.\r\n   * By default, this function uses all standard visualizers.\r\n   *\r\n   */\n  return _createClass(LeafletDataSourceDisplay, [{\n    key: \"update\",\n    value:\n    /**\r\n     * Updates the display to the provided time.\r\n     *\r\n     */\n    function update(time) {\n      var result = true;\n      var x;\n      var visualizers;\n      var vLength;\n      var dataSources = this._dataSourceCollection;\n      var length = dataSources.length;\n      for (var i = 0; i < length; i++) {\n        var _dataSource2 = dataSources.get(i);\n        if ((0, _isDefined[\"default\"])(_dataSource2.update)) {\n          result = _dataSource2.update(time) && result;\n        }\n        visualizers = this._getVisualizersForDataSource(_dataSource2);\n        if ((0, _isDefined[\"default\"])(visualizers)) {\n          vLength = visualizers.length;\n          for (x = 0; x < vLength; x++) {\n            result = visualizers[x].update(time) && result;\n          }\n        }\n      }\n      visualizers = this._getVisualizersForDataSource(this._defaultDataSource);\n      if ((0, _isDefined[\"default\"])(visualizers)) {\n        vLength = visualizers.length;\n        for (x = 0; x < vLength; x++) {\n          result = visualizers[x].update(time) && result;\n        }\n      }\n      this._ready = result;\n      this._lastTime = _JulianDate[\"default\"].clone(time, this._lastTime);\n      return result;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this._eventHelper.removeAll();\n      var dataSourceCollection = this._dataSourceCollection;\n      for (var i = 0, length = dataSourceCollection.length; i < length; ++i) {\n        this._onDataSourceRemoved(this._dataSourceCollection, dataSourceCollection.get(i));\n      }\n      this._onDataSourceRemoved(undefined, this._defaultDataSource);\n      return (0, _destroyObject[\"default\"])(this);\n    }\n  }, {\n    key: \"_onDataSourceAdded\",\n    value: function _onDataSourceAdded(_dataSourceCollection, dataSource) {\n      var visualizers = this._visualizersCallback(this._scene, undefined, dataSource);\n      dataSource.visualizersByDisplayID = dataSource.visualizersByDisplayID || {};\n      dataSource.visualizersByDisplayID[this._displayID] = visualizers;\n      dataSource.visualizers = dataSource.visualizers || [];\n      dataSource.visualizers = dataSource.visualizers.concat(visualizers);\n    }\n  }, {\n    key: \"_onDataSourceRemoved\",\n    value: function _onDataSourceRemoved(_dataSourceCollection, dataSource) {\n      var visualizers = this._getVisualizersForDataSource(dataSource);\n      if (!(0, _isDefined[\"default\"])(visualizers)) {\n        return;\n      }\n      var length = visualizers.length;\n      for (var i = 0; i < length; i++) {\n        var visualizer = visualizers[i];\n        visualizer.destroy();\n        if ((0, _isDefined[\"default\"])(dataSource.visualizers)) {\n          var index = dataSource.visualizers.indexOf(visualizer);\n          dataSource.visualizers.splice(index, 1);\n        }\n      }\n      if ((0, _isDefined[\"default\"])(dataSource.visualizersByDisplayID)) {\n        delete dataSource.visualizersByDisplayID[this._displayID];\n      }\n    }\n  }, {\n    key: \"_getVisualizersForDataSource\",\n    value: function _getVisualizersForDataSource(dataSource) {\n      var visualizersByDisplayID = dataSource.visualizersByDisplayID;\n      if ((0, _isDefined[\"default\"])(visualizersByDisplayID) && (0, _isDefined[\"default\"])(visualizersByDisplayID[this._displayID])) {\n        return visualizersByDisplayID[this._displayID];\n      }\n    }\n\n    /**\r\n     * Computes the rectangular bounds which encloses the visualization\r\n     * produced for the given entities.\r\n     */\n  }, {\n    key: \"getLatLngBounds\",\n    value: function getLatLngBounds(dataSource) {\n      this.update(this._lastTime);\n      var visualizers = this._getVisualizersForDataSource(dataSource);\n      if (!(0, _isDefined[\"default\"])(visualizers)) {\n        return;\n      }\n      var result;\n      for (var j = 0, vLength = visualizers.length; j < vLength; j++) {\n        var visualizer = visualizers[j];\n        var bounds = visualizer.getLatLngBounds();\n        if (bounds === undefined) {\n          continue;\n        }\n        result = result === undefined ? _leaflet[\"default\"].latLngBounds(bounds.getSouthWest(), bounds.getNorthEast()) : result.extend(bounds);\n      }\n      return result;\n    }\n\n    /**\r\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\r\n     * The bounding sphere is in the fixed frame of the scene's globe.\r\n     */\n  }, {\n    key: \"getBoundingSphere\",\n    value: function getBoundingSphere(entity, allowPartial, result) {\n      if (!this._ready) {\n        return _BoundingSphereState[\"default\"].PENDING;\n      }\n      var length;\n      var dataSource = this._defaultDataSource;\n      if (!dataSource.entities.contains(entity)) {\n        dataSource = undefined;\n        var dataSources = this._dataSourceCollection;\n        length = dataSources.length;\n        for (var i = 0; i < length; i++) {\n          var d = dataSources.get(i);\n          if (d.entities.contains(entity)) {\n            dataSource = d;\n            break;\n          }\n        }\n      }\n      if (!(0, _isDefined[\"default\"])(dataSource) || !(0, _isDefined[\"default\"])(dataSource.visualizers)) {\n        return _BoundingSphereState[\"default\"].FAILED;\n      }\n      var boundingSpheres = [];\n      var tmp = new _BoundingSphere[\"default\"]();\n      var count = 0;\n      var state = _BoundingSphereState[\"default\"].DONE;\n      var visualizers = dataSource.visualizers;\n      var visualizersLength = visualizers.length;\n      for (var _i = 0; _i < visualizersLength; _i++) {\n        var visualizer = visualizers[_i];\n        if ((0, _isDefined[\"default\"])(visualizer.getBoundingSphere)) {\n          state = visualizer.getBoundingSphere(entity, tmp);\n          if (!allowPartial && state === _BoundingSphereState[\"default\"].PENDING) {\n            return _BoundingSphereState[\"default\"].PENDING;\n          } else if (state === _BoundingSphereState[\"default\"].DONE) {\n            boundingSpheres[count] = _BoundingSphere[\"default\"].clone(tmp, boundingSpheres[count]);\n            count++;\n          }\n        }\n      }\n      if (count === 0) {\n        return _BoundingSphereState[\"default\"].FAILED;\n      }\n      boundingSpheres.length = count;\n      _BoundingSphere[\"default\"].fromBoundingSpheres(boundingSpheres, result);\n      return _BoundingSphereState[\"default\"].DONE;\n    }\n  }], [{\n    key: \"defaultVisualizersCallback\",\n    value: function defaultVisualizersCallback(_leafletScene, _entityCluster, _dataSource) {\n      return [];\n    }\n  }]);\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0xlYWZsZXREYXRhU291cmNlRGlzcGxheS50cz81M2I2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMIGZyb20gXCJsZWFmbGV0XCI7XHJcbmltcG9ydCBCb3VuZGluZ1NwaGVyZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0JvdW5kaW5nU3BoZXJlXCI7XHJcbmltcG9ydCBFdmVudEhlbHBlciBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0V2ZW50SGVscGVyXCI7XHJcbmltcG9ydCBKdWxpYW5EYXRlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvSnVsaWFuRGF0ZVwiO1xyXG5pbXBvcnQgY3JlYXRlR3VpZCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL2NyZWF0ZUd1aWRcIjtcclxuaW1wb3J0IGRlZmF1bHRWYWx1ZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL2RlZmF1bHRWYWx1ZVwiO1xyXG5pbXBvcnQgZGVzdHJveU9iamVjdCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL2Rlc3Ryb3lPYmplY3RcIjtcclxuaW1wb3J0IEJvdW5kaW5nU3BoZXJlU3RhdGUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvQm91bmRpbmdTcGhlcmVTdGF0ZVwiO1xyXG5pbXBvcnQgQ3VzdG9tRGF0YVNvdXJjZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9DdXN0b21EYXRhU291cmNlXCI7XHJcbmltcG9ydCBEYXRhU291cmNlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0RhdGFTb3VyY2VcIjtcclxuaW1wb3J0IERhdGFTb3VyY2VDb2xsZWN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0RhdGFTb3VyY2VDb2xsZWN0aW9uXCI7XHJcbmltcG9ydCBFbnRpdHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRW50aXR5XCI7XHJcbmltcG9ydCBFbnRpdHlDbHVzdGVyIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eUNsdXN0ZXJcIjtcclxuaW1wb3J0IGlzRGVmaW5lZCBmcm9tIFwiLi4vLi4vQ29yZS9pc0RlZmluZWRcIjtcclxuaW1wb3J0IExlYWZsZXRTY2VuZSBmcm9tIFwiLi9MZWFmbGV0U2NlbmVcIjtcclxuXHJcbmludGVyZmFjZSBWaXN1YWxpemVyIHtcclxuICB1cGRhdGUodGltZTogSnVsaWFuRGF0ZSk6IGJvb2xlYW47XHJcbiAgZGVzdHJveSgpOiB2b2lkO1xyXG4gIGdldExhdExuZ0JvdW5kcygpOiBMLkxhdExuZ0JvdW5kcyB8IHVuZGVmaW5lZDtcclxuICBnZXRCb3VuZGluZ1NwaGVyZT86IChcclxuICAgIGVudGl0eTogRW50aXR5LFxyXG4gICAgdG1wOiBCb3VuZGluZ1NwaGVyZVxyXG4gICkgPT4gQm91bmRpbmdTcGhlcmVTdGF0ZTtcclxufVxyXG5cclxuY2xhc3MgTGVhZmxldERhdGFTb3VyY2UgZXh0ZW5kcyBEYXRhU291cmNlIHtcclxuICB2aXN1YWxpemVyc0J5RGlzcGxheUlEPzogeyBbaW5kZXg6IHN0cmluZ106IFZpc3VhbGl6ZXJbXSB9O1xyXG4gIHZpc3VhbGl6ZXJzPzogVmlzdWFsaXplcltdO1xyXG59XHJcblxyXG50eXBlIFZpc3VhbGl6ZXJzQ2FsbGJhY2sgPSAoXHJcbiAgc2NlbmU6IExlYWZsZXRTY2VuZSxcclxuICBlbnRpdHlDbHVzdGVyOiBFbnRpdHlDbHVzdGVyIHwgdW5kZWZpbmVkLFxyXG4gIGRhdGFTb3VyY2U6IERhdGFTb3VyY2VcclxuKSA9PiBWaXN1YWxpemVyW107XHJcblxyXG5pbnRlcmZhY2UgTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5T3B0aW9ucyB7XHJcbiAgc2NlbmU6IExlYWZsZXRTY2VuZTtcclxuICBkYXRhU291cmNlQ29sbGVjdGlvbjogRGF0YVNvdXJjZUNvbGxlY3Rpb247XHJcbiAgdmlzdWFsaXplcnNDYWxsYmFjazogVmlzdWFsaXplcnNDYWxsYmFjaztcclxufVxyXG5cclxuLyoqXHJcbiAqIFZpc3VhbGl6ZXMgYSBjb2xsZWN0aW9uIG9mIHtAbGluayBEYXRhU291cmNlfSBpbnN0YW5jZXMgaW4gTGVhZmxldC5cclxuICovXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExlYWZsZXREYXRhU291cmNlRGlzcGxheSB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZGlzcGxheUlEOiBzdHJpbmc7XHJcblxyXG4gIC8vIEdldHMgdGhlIHNjZW5lIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRpc3BsYXkuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBfc2NlbmU6IExlYWZsZXRTY2VuZTtcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyB0aGUgZGVmYXVsdCBkYXRhIHNvdXJjZSBpbnN0YW5jZSB3aGljaCBjYW4gYmUgdXNlZCB0b1xyXG4gICAqIG1hbnVhbGx5IGNyZWF0ZSBhbmQgdmlzdWFsaXplIGVudGl0aWVzIG5vdCB0aWVkIHRvXHJcbiAgICogYSBzcGVjaWZpYyBkYXRhIHNvdXJjZS4gVGhpcyBpbnN0YW5jZSBpcyBhbHdheXMgYXZhaWxhYmxlXHJcbiAgICogYW5kIGRvZXMgbm90IGFwcGVhciBpbiB0aGUgbGlzdCBkYXRhU291cmNlcyBjb2xsZWN0aW9uLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2RlZmF1bHREYXRhU291cmNlOiBMZWFmbGV0RGF0YVNvdXJjZTtcclxuXHJcbiAgLy8gR2V0cyB0aGUgY29sbGVjdGlvbiBvZiBkYXRhIHNvdXJjZXMgdG8gZGlzcGxheS5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9kYXRhU291cmNlQ29sbGVjdGlvbjogRGF0YVNvdXJjZUNvbGxlY3Rpb247XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgX3Zpc3VhbGl6ZXJzQ2FsbGJhY2s6IFZpc3VhbGl6ZXJzQ2FsbGJhY2s7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZXZlbnRIZWxwZXI6IEV2ZW50SGVscGVyO1xyXG5cclxuICAvLyBHZXRzIGEgdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIG9yIG5vdCBhbGwgZW50aXRpZXMgaW4gdGhlIGRhdGEgc291cmNlIGFyZSByZWFkeVxyXG4gIHByaXZhdGUgX3JlYWR5OiBib29sZWFuO1xyXG5cclxuICBwcml2YXRlIF9sYXN0VGltZTogSnVsaWFuRGF0ZTtcclxuXHJcbiAgY29uc3RydWN0b3Iob3B0aW9uczogTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5T3B0aW9ucykge1xyXG4gICAgdGhpcy5fZGlzcGxheUlEID0gY3JlYXRlR3VpZCgpO1xyXG4gICAgdGhpcy5fc2NlbmUgPSBvcHRpb25zLnNjZW5lO1xyXG4gICAgdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb24gPSBvcHRpb25zLmRhdGFTb3VyY2VDb2xsZWN0aW9uO1xyXG4gICAgdGhpcy5fdmlzdWFsaXplcnNDYWxsYmFjayA9IGRlZmF1bHRWYWx1ZShcclxuICAgICAgb3B0aW9ucy52aXN1YWxpemVyc0NhbGxiYWNrLFxyXG4gICAgICBMZWFmbGV0RGF0YVNvdXJjZURpc3BsYXkuZGVmYXVsdFZpc3VhbGl6ZXJzQ2FsbGJhY2tcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5fZXZlbnRIZWxwZXIgPSBuZXcgRXZlbnRIZWxwZXIoKTtcclxuICAgIHRoaXMuX2V2ZW50SGVscGVyLmFkZChcclxuICAgICAgdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb24uZGF0YVNvdXJjZUFkZGVkLFxyXG4gICAgICB0aGlzLl9vbkRhdGFTb3VyY2VBZGRlZCBhcyAoKSA9PiB2b2lkLFxyXG4gICAgICB0aGlzXHJcbiAgICApO1xyXG4gICAgdGhpcy5fZXZlbnRIZWxwZXIuYWRkKFxyXG4gICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbi5kYXRhU291cmNlUmVtb3ZlZCxcclxuICAgICAgdGhpcy5fb25EYXRhU291cmNlUmVtb3ZlZCBhcyAoKSA9PiB2b2lkLFxyXG4gICAgICB0aGlzXHJcbiAgICApO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbi5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICB0aGlzLl9vbkRhdGFTb3VyY2VBZGRlZChcclxuICAgICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbixcclxuICAgICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbi5nZXQoaSlcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkZWZhdWx0RGF0YVNvdXJjZSA9IG5ldyBDdXN0b21EYXRhU291cmNlKCk7XHJcbiAgICB0aGlzLl9vbkRhdGFTb3VyY2VBZGRlZCh1bmRlZmluZWQsIGRlZmF1bHREYXRhU291cmNlKTtcclxuICAgIHRoaXMuX2RlZmF1bHREYXRhU291cmNlID0gZGVmYXVsdERhdGFTb3VyY2U7XHJcblxyXG4gICAgdGhpcy5fcmVhZHkgPSBmYWxzZTtcclxuICAgIHRoaXMuX2xhc3RUaW1lID0gSnVsaWFuRGF0ZS5ub3coKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldHMgb3Igc2V0cyB0aGUgZGVmYXVsdCBmdW5jdGlvbiB3aGljaCBjcmVhdGVzIGFuIGFycmF5IG9mIHZpc3VhbGl6ZXJzIHVzZWQgZm9yIHZpc3VhbGl6YXRpb24uXHJcbiAgICogQnkgZGVmYXVsdCwgdGhpcyBmdW5jdGlvbiB1c2VzIGFsbCBzdGFuZGFyZCB2aXN1YWxpemVycy5cclxuICAgKlxyXG4gICAqL1xyXG4gIHN0YXRpYyBkZWZhdWx0VmlzdWFsaXplcnNDYWxsYmFjayhcclxuICAgIF9sZWFmbGV0U2NlbmU6IExlYWZsZXRTY2VuZSxcclxuICAgIF9lbnRpdHlDbHVzdGVyOiBFbnRpdHlDbHVzdGVyLFxyXG4gICAgX2RhdGFTb3VyY2U6IERhdGFTb3VyY2VcclxuICApIHtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZXMgdGhlIGRpc3BsYXkgdG8gdGhlIHByb3ZpZGVkIHRpbWUuXHJcbiAgICpcclxuICAgKi9cclxuICB1cGRhdGUodGltZTogSnVsaWFuRGF0ZSkge1xyXG4gICAgbGV0IHJlc3VsdCA9IHRydWU7XHJcblxyXG4gICAgbGV0IHg7XHJcbiAgICBsZXQgdmlzdWFsaXplcnM7XHJcbiAgICBsZXQgdkxlbmd0aDtcclxuICAgIGNvbnN0IGRhdGFTb3VyY2VzID0gdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb247XHJcbiAgICBjb25zdCBsZW5ndGggPSBkYXRhU291cmNlcy5sZW5ndGg7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGRhdGFTb3VyY2UgPSBkYXRhU291cmNlcy5nZXQoaSkgYXMgTGVhZmxldERhdGFTb3VyY2U7XHJcbiAgICAgIGlmIChpc0RlZmluZWQoZGF0YVNvdXJjZS51cGRhdGUpKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gZGF0YVNvdXJjZS51cGRhdGUodGltZSkgJiYgcmVzdWx0O1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2aXN1YWxpemVycyA9IHRoaXMuX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZShkYXRhU291cmNlKTtcclxuICAgICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVycykpIHtcclxuICAgICAgICB2TGVuZ3RoID0gdmlzdWFsaXplcnMubGVuZ3RoO1xyXG4gICAgICAgIGZvciAoeCA9IDA7IHggPCB2TGVuZ3RoOyB4KyspIHtcclxuICAgICAgICAgIHJlc3VsdCA9IHZpc3VhbGl6ZXJzW3hdLnVwZGF0ZSh0aW1lKSAmJiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmlzdWFsaXplcnMgPSB0aGlzLl9nZXRWaXN1YWxpemVyc0ZvckRhdGFTb3VyY2UodGhpcy5fZGVmYXVsdERhdGFTb3VyY2UpO1xyXG4gICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVycykpIHtcclxuICAgICAgdkxlbmd0aCA9IHZpc3VhbGl6ZXJzLmxlbmd0aDtcclxuICAgICAgZm9yICh4ID0gMDsgeCA8IHZMZW5ndGg7IHgrKykge1xyXG4gICAgICAgIHJlc3VsdCA9IHZpc3VhbGl6ZXJzW3hdLnVwZGF0ZSh0aW1lKSAmJiByZXN1bHQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9yZWFkeSA9IHJlc3VsdDtcclxuICAgIHRoaXMuX2xhc3RUaW1lID0gSnVsaWFuRGF0ZS5jbG9uZSh0aW1lLCB0aGlzLl9sYXN0VGltZSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIHRoaXMuX2V2ZW50SGVscGVyLnJlbW92ZUFsbCgpO1xyXG5cclxuICAgIGNvbnN0IGRhdGFTb3VyY2VDb2xsZWN0aW9uID0gdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb247XHJcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YVNvdXJjZUNvbGxlY3Rpb24ubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcclxuICAgICAgdGhpcy5fb25EYXRhU291cmNlUmVtb3ZlZChcclxuICAgICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbixcclxuICAgICAgICBkYXRhU291cmNlQ29sbGVjdGlvbi5nZXQoaSlcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIHRoaXMuX29uRGF0YVNvdXJjZVJlbW92ZWQodW5kZWZpbmVkLCB0aGlzLl9kZWZhdWx0RGF0YVNvdXJjZSk7XHJcbiAgICByZXR1cm4gZGVzdHJveU9iamVjdCh0aGlzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX29uRGF0YVNvdXJjZUFkZGVkKFxyXG4gICAgX2RhdGFTb3VyY2VDb2xsZWN0aW9uOiBEYXRhU291cmNlQ29sbGVjdGlvbiB8IHVuZGVmaW5lZCxcclxuICAgIGRhdGFTb3VyY2U6IExlYWZsZXREYXRhU291cmNlXHJcbiAgKSB7XHJcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IHRoaXMuX3Zpc3VhbGl6ZXJzQ2FsbGJhY2soXHJcbiAgICAgIHRoaXMuX3NjZW5lLFxyXG4gICAgICB1bmRlZmluZWQsXHJcbiAgICAgIGRhdGFTb3VyY2VcclxuICAgICk7XHJcblxyXG4gICAgZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEID0gZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEIHx8IHt9O1xyXG4gICAgZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEW3RoaXMuX2Rpc3BsYXlJRF0gPSB2aXN1YWxpemVycztcclxuXHJcbiAgICBkYXRhU291cmNlLnZpc3VhbGl6ZXJzID0gZGF0YVNvdXJjZS52aXN1YWxpemVycyB8fCBbXTtcclxuICAgIGRhdGFTb3VyY2UudmlzdWFsaXplcnMgPSBkYXRhU291cmNlLnZpc3VhbGl6ZXJzLmNvbmNhdCh2aXN1YWxpemVycyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9vbkRhdGFTb3VyY2VSZW1vdmVkKFxyXG4gICAgX2RhdGFTb3VyY2VDb2xsZWN0aW9uOiBEYXRhU291cmNlQ29sbGVjdGlvbiB8IHVuZGVmaW5lZCxcclxuICAgIGRhdGFTb3VyY2U6IExlYWZsZXREYXRhU291cmNlXHJcbiAgKSB7XHJcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IHRoaXMuX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZShkYXRhU291cmNlKTtcclxuICAgIGlmICghaXNEZWZpbmVkKHZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGVuZ3RoID0gdmlzdWFsaXplcnMubGVuZ3RoO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCB2aXN1YWxpemVyID0gdmlzdWFsaXplcnNbaV07XHJcbiAgICAgIHZpc3VhbGl6ZXIuZGVzdHJveSgpO1xyXG5cclxuICAgICAgaWYgKGlzRGVmaW5lZChkYXRhU291cmNlLnZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gZGF0YVNvdXJjZS52aXN1YWxpemVycy5pbmRleE9mKHZpc3VhbGl6ZXIpO1xyXG4gICAgICAgIGRhdGFTb3VyY2UudmlzdWFsaXplcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChpc0RlZmluZWQoZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEKSkge1xyXG4gICAgICBkZWxldGUgZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEW3RoaXMuX2Rpc3BsYXlJRF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9nZXRWaXN1YWxpemVyc0ZvckRhdGFTb3VyY2UoZGF0YVNvdXJjZTogTGVhZmxldERhdGFTb3VyY2UpIHtcclxuICAgIGNvbnN0IHZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQgPSBkYXRhU291cmNlLnZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQ7XHJcbiAgICBpZiAoXHJcbiAgICAgIGlzRGVmaW5lZCh2aXN1YWxpemVyc0J5RGlzcGxheUlEKSAmJlxyXG4gICAgICBpc0RlZmluZWQodmlzdWFsaXplcnNCeURpc3BsYXlJRFt0aGlzLl9kaXNwbGF5SURdKVxyXG4gICAgKSB7XHJcbiAgICAgIHJldHVybiB2aXN1YWxpemVyc0J5RGlzcGxheUlEW3RoaXMuX2Rpc3BsYXlJRF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21wdXRlcyB0aGUgcmVjdGFuZ3VsYXIgYm91bmRzIHdoaWNoIGVuY2xvc2VzIHRoZSB2aXN1YWxpemF0aW9uXHJcbiAgICogcHJvZHVjZWQgZm9yIHRoZSBnaXZlbiBlbnRpdGllcy5cclxuICAgKi9cclxuICBnZXRMYXRMbmdCb3VuZHMoZGF0YVNvdXJjZTogTGVhZmxldERhdGFTb3VyY2UpIHtcclxuICAgIHRoaXMudXBkYXRlKHRoaXMuX2xhc3RUaW1lKTtcclxuXHJcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IHRoaXMuX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZShkYXRhU291cmNlKTtcclxuICAgIGlmICghaXNEZWZpbmVkKHZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuXHJcbiAgICBmb3IgKGxldCBqID0gMCwgdkxlbmd0aCA9IHZpc3VhbGl6ZXJzLmxlbmd0aDsgaiA8IHZMZW5ndGg7IGorKykge1xyXG4gICAgICBjb25zdCB2aXN1YWxpemVyID0gdmlzdWFsaXplcnNbal07XHJcbiAgICAgIGNvbnN0IGJvdW5kcyA9IHZpc3VhbGl6ZXIuZ2V0TGF0TG5nQm91bmRzKCk7XHJcbiAgICAgIGlmIChib3VuZHMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXN1bHQgPVxyXG4gICAgICAgIHJlc3VsdCA9PT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICA/IEwubGF0TG5nQm91bmRzKGJvdW5kcy5nZXRTb3V0aFdlc3QoKSwgYm91bmRzLmdldE5vcnRoRWFzdCgpKVxyXG4gICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGJvdW5kcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXB1dGVzIGEgYm91bmRpbmcgc3BoZXJlIHdoaWNoIGVuY2xvc2VzIHRoZSB2aXN1YWxpemF0aW9uIHByb2R1Y2VkIGZvciB0aGUgc3BlY2lmaWVkIGVudGl0eS5cclxuICAgKiBUaGUgYm91bmRpbmcgc3BoZXJlIGlzIGluIHRoZSBmaXhlZCBmcmFtZSBvZiB0aGUgc2NlbmUncyBnbG9iZS5cclxuICAgKi9cclxuICBnZXRCb3VuZGluZ1NwaGVyZShcclxuICAgIGVudGl0eTogRW50aXR5LFxyXG4gICAgYWxsb3dQYXJ0aWFsOiBib29sZWFuLFxyXG4gICAgcmVzdWx0OiBCb3VuZGluZ1NwaGVyZVxyXG4gICkge1xyXG4gICAgaWYgKCF0aGlzLl9yZWFkeSkge1xyXG4gICAgICByZXR1cm4gQm91bmRpbmdTcGhlcmVTdGF0ZS5QRU5ESU5HO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBsZW5ndGg7XHJcbiAgICBsZXQgZGF0YVNvdXJjZTogTGVhZmxldERhdGFTb3VyY2UgfCB1bmRlZmluZWQgPSB0aGlzLl9kZWZhdWx0RGF0YVNvdXJjZTtcclxuICAgIGlmICghZGF0YVNvdXJjZS5lbnRpdGllcy5jb250YWlucyhlbnRpdHkpKSB7XHJcbiAgICAgIGRhdGFTb3VyY2UgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICBjb25zdCBkYXRhU291cmNlcyA9IHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uO1xyXG4gICAgICBsZW5ndGggPSBkYXRhU291cmNlcy5sZW5ndGg7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb25zdCBkID0gZGF0YVNvdXJjZXMuZ2V0KGkpO1xyXG4gICAgICAgIGlmIChkLmVudGl0aWVzLmNvbnRhaW5zKGVudGl0eSkpIHtcclxuICAgICAgICAgIGRhdGFTb3VyY2UgPSBkO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFpc0RlZmluZWQoZGF0YVNvdXJjZSkgfHwgIWlzRGVmaW5lZChkYXRhU291cmNlLnZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICByZXR1cm4gQm91bmRpbmdTcGhlcmVTdGF0ZS5GQUlMRUQ7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYm91bmRpbmdTcGhlcmVzOiBCb3VuZGluZ1NwaGVyZVtdID0gW107XHJcbiAgICBjb25zdCB0bXAgPSBuZXcgQm91bmRpbmdTcGhlcmUoKTtcclxuXHJcbiAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgbGV0IHN0YXRlID0gQm91bmRpbmdTcGhlcmVTdGF0ZS5ET05FO1xyXG4gICAgY29uc3QgdmlzdWFsaXplcnMgPSBkYXRhU291cmNlLnZpc3VhbGl6ZXJzO1xyXG4gICAgY29uc3QgdmlzdWFsaXplcnNMZW5ndGggPSB2aXN1YWxpemVycy5sZW5ndGg7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2aXN1YWxpemVyc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHZpc3VhbGl6ZXIgPSB2aXN1YWxpemVyc1tpXTtcclxuICAgICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVyLmdldEJvdW5kaW5nU3BoZXJlKSkge1xyXG4gICAgICAgIHN0YXRlID0gdmlzdWFsaXplci5nZXRCb3VuZGluZ1NwaGVyZShlbnRpdHksIHRtcCk7XHJcbiAgICAgICAgaWYgKCFhbGxvd1BhcnRpYWwgJiYgc3RhdGUgPT09IEJvdW5kaW5nU3BoZXJlU3RhdGUuUEVORElORykge1xyXG4gICAgICAgICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuUEVORElORztcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSBCb3VuZGluZ1NwaGVyZVN0YXRlLkRPTkUpIHtcclxuICAgICAgICAgIGJvdW5kaW5nU3BoZXJlc1tjb3VudF0gPSBCb3VuZGluZ1NwaGVyZS5jbG9uZShcclxuICAgICAgICAgICAgdG1wLFxyXG4gICAgICAgICAgICBib3VuZGluZ1NwaGVyZXNbY291bnRdXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgY291bnQrKztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoY291bnQgPT09IDApIHtcclxuICAgICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuRkFJTEVEO1xyXG4gICAgfVxyXG5cclxuICAgIGJvdW5kaW5nU3BoZXJlcy5sZW5ndGggPSBjb3VudDtcclxuICAgIEJvdW5kaW5nU3BoZXJlLmZyb21Cb3VuZGluZ1NwaGVyZXMoYm91bmRpbmdTcGhlcmVzLCByZXN1bHQpO1xyXG4gICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuRE9ORTtcclxuICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBYUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWlCQTtBQUNBO0FBQ0E7QUFGQTtBQTRCQTtBQUFBO0FBQUE7QUF0QkE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUFBO0FBQUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFLQTtBQU1BO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQUE7QUFBQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFNQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBU0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBM01BO0FBQ0E7QUFBQTtBQUFBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts":
/*!***********************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\nvar _Event = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\"));\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar LeafletScene = exports[\"default\"] = /*#__PURE__*/_createClass(function LeafletScene(map) {\n  _classCallCheck(this, LeafletScene);\n  _defineProperty(this, \"map\", void 0);\n  _defineProperty(this, \"featureClicked\", new _Event[\"default\"]());\n  _defineProperty(this, \"featureMousedown\", new _Event[\"default\"]());\n  this.map = map;\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFNjZW5lLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0xlYWZsZXRTY2VuZS50cz84ODM2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDZXNpdW1FdmVudCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0V2ZW50XCI7XHJcbmltcG9ydCBMIGZyb20gXCJsZWFmbGV0XCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0U2NlbmUge1xyXG4gIHJlYWRvbmx5IG1hcDogTC5NYXA7XHJcbiAgcmVhZG9ubHkgZmVhdHVyZUNsaWNrZWQgPSBuZXcgQ2VzaXVtRXZlbnQoKTtcclxuICByZWFkb25seSBmZWF0dXJlTW91c2Vkb3duID0gbmV3IENlc2l1bUV2ZW50KCk7XHJcbiAgY29uc3RydWN0b3IobWFwOiBMLk1hcCkge1xyXG4gICAgdGhpcy5tYXAgPSBtYXA7XHJcbiAgfVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUFBO0FBQUE7QUFGQTtBQUdBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts":
/*!************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _EasingFunction = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/EasingFunction */ \"./node_modules/terriajs-cesium/Source/Core/EasingFunction.js\"));\nvar _Ellipsoid = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _TweenCollection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Scene/TweenCollection */ \"./node_modules/terriajs-cesium/Source/Scene/TweenCollection.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar selectionIndicatorUrl = __webpack_require__(/*! ../../../wwwroot/images/NM-LocationTarget.svg */ \"./packages/terriajs/wwwroot/images/NM-LocationTarget.svg\");\nvar cartographicScratch = new _Cartographic[\"default\"]();\nvar LeafletSelectionIndicator = exports[\"default\"] = /*#__PURE__*/function () {\n  function LeafletSelectionIndicator(leaflet) {\n    _classCallCheck(this, LeafletSelectionIndicator);\n    _defineProperty(this, \"_leaflet\", void 0);\n    _defineProperty(this, \"_marker\", void 0);\n    _defineProperty(this, \"_tweens\", new _TweenCollection[\"default\"]());\n    _defineProperty(this, \"_selectionIndicatorTween\", void 0);\n    _defineProperty(this, \"_selectionIndicatorIsAppearing\", false);\n    _defineProperty(this, \"_selectionIndicatorDomElement\", void 0);\n    _defineProperty(this, \"_tweensAreRunning\", false);\n    this._leaflet = leaflet;\n    this._marker = _leaflet[\"default\"].marker([0, 0], {\n      icon: _leaflet[\"default\"].divIcon({\n        className: \"\",\n        html: '<img src=\"' + selectionIndicatorUrl + '\" width=\"50\" height=\"50\" alt=\"\" />',\n        iconSize: _leaflet[\"default\"].point(50, 50)\n      }),\n      zIndexOffset: 1,\n      // We increment the z index so that the selection marker appears above the item.\n      interactive: false,\n      keyboard: false\n    });\n    this._marker.addTo(this._leaflet.map);\n    this._selectionIndicatorDomElement = this._marker._icon.children[0];\n  }\n  return _createClass(LeafletSelectionIndicator, [{\n    key: \"setLatLng\",\n    value: function setLatLng(latlng) {\n      this._marker.setLatLng(latlng);\n    }\n  }, {\n    key: \"animateSelectionIndicatorAppear\",\n    value: function animateSelectionIndicatorAppear() {\n      if ((0, _isDefined[\"default\"])(this._selectionIndicatorTween)) {\n        if (this._selectionIndicatorIsAppearing) {\n          // Already appearing; don't restart the animation.\n          return;\n        }\n        this._selectionIndicatorTween.cancelTween();\n        this._selectionIndicatorTween = undefined;\n      }\n      var style = this._selectionIndicatorDomElement.style;\n      this._selectionIndicatorIsAppearing = true;\n      var that = this;\n      this._selectionIndicatorTween = this._tweens.add({\n        startObject: {\n          scale: 2.0,\n          opacity: 0.0,\n          rotate: -180\n        },\n        stopObject: {\n          scale: 1.0,\n          opacity: 1.0,\n          rotate: 0\n        },\n        duration: 0.8,\n        easingFunction: _EasingFunction[\"default\"].EXPONENTIAL_OUT,\n        update: function update(value) {\n          style.opacity = value.opacity;\n          style.transform = \"scale(\" + value.scale + \") rotate(\" + value.rotate + \"deg)\";\n        },\n        complete: function complete() {\n          that._selectionIndicatorTween = undefined;\n        },\n        cancel: function cancel() {\n          that._selectionIndicatorTween = undefined;\n        }\n      });\n      this._startTweens();\n    }\n  }, {\n    key: \"animateSelectionIndicatorDepart\",\n    value: function animateSelectionIndicatorDepart() {\n      if ((0, _isDefined[\"default\"])(this._selectionIndicatorTween)) {\n        if (!this._selectionIndicatorIsAppearing) {\n          // Already disappearing, dont' restart the animation.\n          return;\n        }\n        this._selectionIndicatorTween.cancelTween();\n        this._selectionIndicatorTween = undefined;\n      }\n      var style = this._selectionIndicatorDomElement.style;\n      this._selectionIndicatorIsAppearing = false;\n      var that = this;\n      this._selectionIndicatorTween = this._tweens.add({\n        startObject: {\n          scale: 1.0,\n          opacity: 1.0\n        },\n        stopObject: {\n          scale: 1.5,\n          opacity: 0.0\n        },\n        duration: 0.8,\n        easingFunction: _EasingFunction[\"default\"].EXPONENTIAL_OUT,\n        update: function update(value) {\n          style.opacity = value.opacity;\n          style.transform = \"scale(\" + value.scale + \") rotate(0deg)\";\n        },\n        complete: function complete() {\n          that._selectionIndicatorTween = undefined;\n        },\n        cancel: function cancel() {\n          that._selectionIndicatorTween = undefined;\n        }\n      });\n      this._startTweens();\n    }\n  }, {\n    key: \"_startTweens\",\n    value: function _startTweens() {\n      var _this = this;\n      if (this._tweensAreRunning) {\n        return;\n      }\n      var feature = this._leaflet.terria.selectedFeature;\n      if ((0, _isDefined[\"default\"])(feature) && (0, _isDefined[\"default\"])(feature.position)) {\n        var positionValue = feature.position.getValue(this._leaflet.terria.timelineClock.currentTime);\n        if ((0, _isDefined[\"default\"])(positionValue)) {\n          var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(positionValue, cartographicScratch);\n          this._marker.setLatLng([_Math[\"default\"].toDegrees(cartographic.latitude), _Math[\"default\"].toDegrees(cartographic.longitude)]);\n        }\n      }\n      if (this._tweens.length > 0) {\n        this._tweens.update();\n      }\n      if (this._tweens.length !== 0 || (0, _isDefined[\"default\"])(feature) && (0, _isDefined[\"default\"])(feature.position)) {\n        requestAnimationFrame(function () {\n          _this._startTweens();\n        });\n      }\n    }\n  }]);\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFNlbGVjdGlvbkluZGljYXRvci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldC9MZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yLnRzPzM1M2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEwgZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRvZ3JhcGhpY1wiO1xyXG5pbXBvcnQgRWFzaW5nRnVuY3Rpb24gZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9FYXNpbmdGdW5jdGlvblwiO1xyXG5pbXBvcnQgRWxsaXBzb2lkIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRWxsaXBzb2lkXCI7XHJcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xyXG5pbXBvcnQgVHdlZW5Db2xsZWN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL1NjZW5lL1R3ZWVuQ29sbGVjdGlvblwiO1xyXG5pbXBvcnQgaXNEZWZpbmVkIGZyb20gXCIuLi8uLi9Db3JlL2lzRGVmaW5lZFwiO1xyXG5pbXBvcnQgTGVhZmxldCBmcm9tIFwiLi4vLi4vTW9kZWxzL0xlYWZsZXRcIjtcclxuXHJcbmNvbnN0IHNlbGVjdGlvbkluZGljYXRvclVybCA9IHJlcXVpcmUoXCIuLi8uLi8uLi93d3dyb290L2ltYWdlcy9OTS1Mb2NhdGlvblRhcmdldC5zdmdcIik7XHJcblxyXG5pbnRlcmZhY2UgVHdlZW4ge1xyXG4gIGNhbmNlbFR3ZWVuKCk6IHZvaWQ7XHJcbn1cclxuXHJcbmNvbnN0IGNhcnRvZ3JhcGhpY1NjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9sZWFmbGV0OiBMZWFmbGV0O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX21hcmtlcjogTC5NYXJrZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfdHdlZW5zOiBUd2VlbkNvbGxlY3Rpb24gPSBuZXcgVHdlZW5Db2xsZWN0aW9uKCk7XHJcbiAgcHJpdmF0ZSBfc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4/OiBUd2VlbjtcclxuICBwcml2YXRlIF9zZWxlY3Rpb25JbmRpY2F0b3JJc0FwcGVhcmluZzogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX3NlbGVjdGlvbkluZGljYXRvckRvbUVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gIHByaXZhdGUgX3R3ZWVuc0FyZVJ1bm5pbmc6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgY29uc3RydWN0b3IobGVhZmxldDogTGVhZmxldCkge1xyXG4gICAgdGhpcy5fbGVhZmxldCA9IGxlYWZsZXQ7XHJcbiAgICB0aGlzLl9tYXJrZXIgPSBMLm1hcmtlcihbMCwgMF0sIHtcclxuICAgICAgaWNvbjogTC5kaXZJY29uKHtcclxuICAgICAgICBjbGFzc05hbWU6IFwiXCIsXHJcbiAgICAgICAgaHRtbDpcclxuICAgICAgICAgICc8aW1nIHNyYz1cIicgK1xyXG4gICAgICAgICAgc2VsZWN0aW9uSW5kaWNhdG9yVXJsICtcclxuICAgICAgICAgICdcIiB3aWR0aD1cIjUwXCIgaGVpZ2h0PVwiNTBcIiBhbHQ9XCJcIiAvPicsXHJcbiAgICAgICAgaWNvblNpemU6IEwucG9pbnQoNTAsIDUwKVxyXG4gICAgICB9KSxcclxuICAgICAgekluZGV4T2Zmc2V0OiAxLCAvLyBXZSBpbmNyZW1lbnQgdGhlIHogaW5kZXggc28gdGhhdCB0aGUgc2VsZWN0aW9uIG1hcmtlciBhcHBlYXJzIGFib3ZlIHRoZSBpdGVtLlxyXG4gICAgICBpbnRlcmFjdGl2ZTogZmFsc2UsXHJcbiAgICAgIGtleWJvYXJkOiBmYWxzZVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5fbWFya2VyLmFkZFRvKHRoaXMuX2xlYWZsZXQubWFwKTtcclxuICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvckRvbUVsZW1lbnQgPSAoXHJcbiAgICAgIHRoaXMuX21hcmtlciBhcyBhbnlcclxuICAgICkuX2ljb24uY2hpbGRyZW5bMF07XHJcbiAgfVxyXG5cclxuICBzZXRMYXRMbmcobGF0bG5nOiBMLkxhdExuZykge1xyXG4gICAgdGhpcy5fbWFya2VyLnNldExhdExuZyhsYXRsbmcpO1xyXG4gIH1cclxuXHJcbiAgYW5pbWF0ZVNlbGVjdGlvbkluZGljYXRvckFwcGVhcigpIHtcclxuICAgIGlmIChpc0RlZmluZWQodGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4pKSB7XHJcbiAgICAgIGlmICh0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JJc0FwcGVhcmluZykge1xyXG4gICAgICAgIC8vIEFscmVhZHkgYXBwZWFyaW5nOyBkb24ndCByZXN0YXJ0IHRoZSBhbmltYXRpb24uXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuLmNhbmNlbFR3ZWVuKCk7XHJcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0eWxlID0gdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yRG9tRWxlbWVudC5zdHlsZTtcclxuXHJcbiAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JJc0FwcGVhcmluZyA9IHRydWU7XHJcblxyXG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XHJcbiAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbiA9IHRoaXMuX3R3ZWVucy5hZGQoe1xyXG4gICAgICBzdGFydE9iamVjdDoge1xyXG4gICAgICAgIHNjYWxlOiAyLjAsXHJcbiAgICAgICAgb3BhY2l0eTogMC4wLFxyXG4gICAgICAgIHJvdGF0ZTogLTE4MFxyXG4gICAgICB9LFxyXG4gICAgICBzdG9wT2JqZWN0OiB7XHJcbiAgICAgICAgc2NhbGU6IDEuMCxcclxuICAgICAgICBvcGFjaXR5OiAxLjAsXHJcbiAgICAgICAgcm90YXRlOiAwXHJcbiAgICAgIH0sXHJcbiAgICAgIGR1cmF0aW9uOiAwLjgsXHJcbiAgICAgIGVhc2luZ0Z1bmN0aW9uOiBFYXNpbmdGdW5jdGlvbi5FWFBPTkVOVElBTF9PVVQsXHJcbiAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBzdHlsZS5vcGFjaXR5ID0gdmFsdWUub3BhY2l0eTtcclxuICAgICAgICBzdHlsZS50cmFuc2Zvcm0gPVxyXG4gICAgICAgICAgXCJzY2FsZShcIiArIHZhbHVlLnNjYWxlICsgXCIpIHJvdGF0ZShcIiArIHZhbHVlLnJvdGF0ZSArIFwiZGVnKVwiO1xyXG4gICAgICB9LFxyXG4gICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoYXQuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xyXG4gICAgICB9LFxyXG4gICAgICBjYW5jZWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGF0Ll9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbiA9IHVuZGVmaW5lZDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5fc3RhcnRUd2VlbnMoKTtcclxuICB9XHJcblxyXG4gIGFuaW1hdGVTZWxlY3Rpb25JbmRpY2F0b3JEZXBhcnQoKSB7XHJcbiAgICBpZiAoaXNEZWZpbmVkKHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuKSkge1xyXG4gICAgICBpZiAoIXRoaXMuX3NlbGVjdGlvbkluZGljYXRvcklzQXBwZWFyaW5nKSB7XHJcbiAgICAgICAgLy8gQWxyZWFkeSBkaXNhcHBlYXJpbmcsIGRvbnQnIHJlc3RhcnQgdGhlIGFuaW1hdGlvbi5cclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4uY2FuY2VsVHdlZW4oKTtcclxuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4gPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3R5bGUgPSB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JEb21FbGVtZW50LnN0eWxlO1xyXG5cclxuICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvcklzQXBwZWFyaW5nID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3QgdGhhdCA9IHRoaXM7XHJcbiAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbiA9IHRoaXMuX3R3ZWVucy5hZGQoe1xyXG4gICAgICBzdGFydE9iamVjdDoge1xyXG4gICAgICAgIHNjYWxlOiAxLjAsXHJcbiAgICAgICAgb3BhY2l0eTogMS4wXHJcbiAgICAgIH0sXHJcbiAgICAgIHN0b3BPYmplY3Q6IHtcclxuICAgICAgICBzY2FsZTogMS41LFxyXG4gICAgICAgIG9wYWNpdHk6IDAuMFxyXG4gICAgICB9LFxyXG4gICAgICBkdXJhdGlvbjogMC44LFxyXG4gICAgICBlYXNpbmdGdW5jdGlvbjogRWFzaW5nRnVuY3Rpb24uRVhQT05FTlRJQUxfT1VULFxyXG4gICAgICB1cGRhdGU6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgc3R5bGUub3BhY2l0eSA9IHZhbHVlLm9wYWNpdHk7XHJcbiAgICAgICAgc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZShcIiArIHZhbHVlLnNjYWxlICsgXCIpIHJvdGF0ZSgwZGVnKVwiO1xyXG4gICAgICB9LFxyXG4gICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoYXQuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xyXG4gICAgICB9LFxyXG4gICAgICBjYW5jZWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGF0Ll9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbiA9IHVuZGVmaW5lZDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5fc3RhcnRUd2VlbnMoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3N0YXJ0VHdlZW5zKCkge1xyXG4gICAgaWYgKHRoaXMuX3R3ZWVuc0FyZVJ1bm5pbmcpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZlYXR1cmUgPSB0aGlzLl9sZWFmbGV0LnRlcnJpYS5zZWxlY3RlZEZlYXR1cmU7XHJcbiAgICBpZiAoaXNEZWZpbmVkKGZlYXR1cmUpICYmIGlzRGVmaW5lZChmZWF0dXJlLnBvc2l0aW9uKSkge1xyXG4gICAgICBjb25zdCBwb3NpdGlvblZhbHVlID0gZmVhdHVyZS5wb3NpdGlvbi5nZXRWYWx1ZShcclxuICAgICAgICB0aGlzLl9sZWFmbGV0LnRlcnJpYS50aW1lbGluZUNsb2NrLmN1cnJlbnRUaW1lXHJcbiAgICAgICk7XHJcbiAgICAgIGlmIChpc0RlZmluZWQocG9zaXRpb25WYWx1ZSkpIHtcclxuICAgICAgICBjb25zdCBjYXJ0b2dyYXBoaWMgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMoXHJcbiAgICAgICAgICBwb3NpdGlvblZhbHVlLFxyXG4gICAgICAgICAgY2FydG9ncmFwaGljU2NyYXRjaFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5fbWFya2VyLnNldExhdExuZyhbXHJcbiAgICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubGF0aXR1ZGUpLFxyXG4gICAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxvbmdpdHVkZSlcclxuICAgICAgICBdKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl90d2VlbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICB0aGlzLl90d2VlbnMudXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKFxyXG4gICAgICB0aGlzLl90d2VlbnMubGVuZ3RoICE9PSAwIHx8XHJcbiAgICAgIChpc0RlZmluZWQoZmVhdHVyZSkgJiYgaXNEZWZpbmVkKGZlYXR1cmUucG9zaXRpb24pKVxyXG4gICAgKSB7XHJcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fc3RhcnRUd2VlbnMoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFNQTtBQUFBO0FBV0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU5BO0FBQUE7QUFFQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUlBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts":
/*!****************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.fill.js */ \"./node_modules/core-js/modules/es.array.fill.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.is-array.js */ \"./node_modules/core-js/modules/es.array.is-array.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _AssociativeArray = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/AssociativeArray */ \"./node_modules/terriajs-cesium/Source/Core/AssociativeArray.js\"));\nvar _Cartesian = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\"));\nvar _Cartesian2 = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian3 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian3.js\"));\nvar _Color = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Color */ \"./node_modules/terriajs-cesium/Source/Core/Color.js\"));\nvar _destroyObject = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/destroyObject */ \"./node_modules/terriajs-cesium/Source/Core/destroyObject.js\"));\nvar _Ellipsoid = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _writeTextToCanvas = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/writeTextToCanvas */ \"./node_modules/terriajs-cesium/Source/Core/writeTextToCanvas.js\"));\nvar _PolylineDashMaterialProperty = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/PolylineDashMaterialProperty */ \"./node_modules/terriajs-cesium/Source/DataSources/PolylineDashMaterialProperty.js\"));\nvar _PolylineGlowMaterialProperty = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/PolylineGlowMaterialProperty */ \"./node_modules/terriajs-cesium/Source/DataSources/PolylineGlowMaterialProperty.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nvar _esriLineStyle = __webpack_require__(/*! ../../Models/Catalog/Esri/esriLineStyle */ \"./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts\");\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar defaultColor = _Color[\"default\"].WHITE;\nvar defaultOutlineColor = _Color[\"default\"].BLACK;\nvar defaultOutlineWidth = 1.0;\nvar defaultPixelSize = 5.0;\nvar defaultWidth = 5.0;\n\n//Single pixel black dot\nvar tmpImage = \"data:image/gif;base64,R0lGODlhAQABAPAAAAAAAP///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\";\n\n//NOT IMPLEMENTED\n// Path primitive - no need identified\n// Ellipse primitive - no need identified\n// Ellipsoid primitive - 3d prim - no plans for this\n// Model primitive - 3d prim - no plans for this\n\n/**\r\n * A variable to store what sort of bounds our leaflet map has been looking at\r\n * 0 = a normal extent\r\n * 1 = zoomed in close to the east/left of anti-meridian\r\n * 2 = zoomed in close to the west/right of the anti-meridian\r\n * When this value changes we'll need to recompute the location of our points\r\n * to help them wrap around the anti-meridian\r\n */\nvar prevBoundsType = 0;\n\n/**\r\n * A {@link Visualizer} which maps {@link Entity#point} to Leaflet primitives.\r\n **/\nvar LeafletGeomVisualizer = /*#__PURE__*/function () {\n  function LeafletGeomVisualizer(leafletScene, entityCollection) {\n    _classCallCheck(this, LeafletGeomVisualizer);\n    this.leafletScene = leafletScene;\n    this.entityCollection = entityCollection;\n    _defineProperty(this, \"_featureGroup\", void 0);\n    _defineProperty(this, \"_entitiesToVisualize\", void 0);\n    _defineProperty(this, \"_entityHash\", void 0);\n    entityCollection.collectionChanged.addEventListener(this._onCollectionChanged, this);\n    this._featureGroup = _leaflet[\"default\"].featureGroup().addTo(leafletScene.map);\n    this._entitiesToVisualize = new _AssociativeArray[\"default\"]();\n    this._entityHash = {};\n    this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n  }\n  return _createClass(LeafletGeomVisualizer, [{\n    key: \"_onCollectionChanged\",\n    value: function _onCollectionChanged(_entityCollection, added, removed, changed) {\n      var entity;\n      var featureGroup = this._featureGroup;\n      var entities = this._entitiesToVisualize;\n      var entityHash = this._entityHash;\n      for (var i = added.length - 1; i > -1; i--) {\n        entity = added[i];\n        if (((0, _isDefined[\"default\"])(entity.point) || (0, _isDefined[\"default\"])(entity.billboard) || (0, _isDefined[\"default\"])(entity.label)) && (0, _isDefined[\"default\"])(entity.position) || (0, _isDefined[\"default\"])(entity.polyline) || (0, _isDefined[\"default\"])(entity.polygon) || (0, _isDefined[\"default\"])(entity.rectangle)) {\n          entities.set(entity.id, entity);\n          entityHash[entity.id] = {};\n        }\n      }\n      for (var _i = changed.length - 1; _i > -1; _i--) {\n        entity = changed[_i];\n        if (((0, _isDefined[\"default\"])(entity.point) || (0, _isDefined[\"default\"])(entity.billboard) || (0, _isDefined[\"default\"])(entity.label)) && (0, _isDefined[\"default\"])(entity.position) || (0, _isDefined[\"default\"])(entity.polyline) || (0, _isDefined[\"default\"])(entity.polygon) || (0, _isDefined[\"default\"])(entity.rectangle)) {\n          entities.set(entity.id, entity);\n          entityHash[entity.id] = entityHash[entity.id] || {};\n        } else {\n          cleanEntity(entity, featureGroup, entityHash);\n          entities.remove(entity.id);\n        }\n      }\n      for (var _i2 = removed.length - 1; _i2 > -1; _i2--) {\n        entity = removed[_i2];\n        cleanEntity(entity, featureGroup, entityHash);\n        entities.remove(entity.id);\n      }\n    }\n\n    /**\r\n     * Updates the primitives created by this visualizer to match their\r\n     * Entity counterpart at the given time.\r\n     *\r\n     */\n  }, {\n    key: \"update\",\n    value: function update(time) {\n      var entities = this._entitiesToVisualize.values;\n      var entityHash = this._entityHash;\n      var bounds = this.leafletScene.map.getBounds();\n      var applyLocalisedAntiMeridianFix = false;\n      var currentBoundsType = 0;\n      if (_isCloseToEasternAntiMeridian(bounds)) {\n        applyLocalisedAntiMeridianFix = true;\n        currentBoundsType = 1;\n      } else if (_isCloseToWesternAntiMeridian(bounds)) {\n        applyLocalisedAntiMeridianFix = true;\n        currentBoundsType = 2;\n      }\n      for (var i = 0, len = entities.length; i < len; i++) {\n        var entity = entities[i];\n        var entityDetails = entityHash[entity.id];\n        if ((0, _isDefined[\"default\"])(entity._point)) {\n          this._updatePoint(entity, time, entityHash, entityDetails, applyLocalisedAntiMeridianFix === true ? bounds : undefined, prevBoundsType !== currentBoundsType);\n        }\n        if ((0, _isDefined[\"default\"])(entity.billboard)) {\n          this._updateBillboard(entity, time, entityHash, entityDetails, applyLocalisedAntiMeridianFix === true ? bounds : undefined);\n        }\n        if ((0, _isDefined[\"default\"])(entity.label)) {\n          this._updateLabel(entity, time, entityHash, entityDetails);\n        }\n        if ((0, _isDefined[\"default\"])(entity.polyline)) {\n          this._updatePolyline(entity, time, entityHash, entityDetails);\n        }\n        if ((0, _isDefined[\"default\"])(entity.polygon)) {\n          this._updatePolygon(entity, time, entityHash, entityDetails);\n        }\n        if ((0, _isDefined[\"default\"])(entity.rectangle)) {\n          this._updateRectangle(entity, time, entityHash, entityDetails);\n        }\n      }\n      prevBoundsType = currentBoundsType;\n      return true;\n    }\n  }, {\n    key: \"_updatePoint\",\n    value: function _updatePoint(entity, time, _entityHash, entityDetails, bounds, boundsJustChanged) {\n      var featureGroup = this._featureGroup;\n      var pointGraphics = entity.point;\n      var show = entity.isAvailable(time) && getValueOrDefault(pointGraphics.show, time, true);\n      if (!show) {\n        cleanPoint(entity, featureGroup, entityDetails);\n        return;\n      }\n      var details = entityDetails.point;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.point = {\n          layer: undefined,\n          lastPosition: new _Cartesian2[\"default\"](),\n          lastPixelSize: 1,\n          lastColor: new _Color[\"default\"](),\n          lastOutlineColor: new _Color[\"default\"](),\n          lastOutlineWidth: 1\n        };\n      }\n      var position = getValueOrUndefined(entity.position, time);\n      if (!(0, _isDefined[\"default\"])(position)) {\n        cleanPoint(entity, featureGroup, entityDetails);\n        return;\n      }\n      var pixelSize = getValueOrDefault(pointGraphics.pixelSize, time, defaultPixelSize);\n      var color = getValueOrDefault(pointGraphics.color, time, defaultColor);\n      var outlineColor = getValueOrDefault(pointGraphics.outlineColor, time, defaultOutlineColor);\n      var outlineWidth = getValueOrDefault(pointGraphics.outlineWidth, time, defaultOutlineWidth);\n      var layer = details.layer;\n      if (!(0, _isDefined[\"default\"])(layer)) {\n        var pointOptions = {\n          radius: pixelSize / 2.0,\n          fillColor: color.toCssColorString(),\n          fillOpacity: color.alpha,\n          color: outlineColor.toCssColorString(),\n          weight: outlineWidth,\n          opacity: outlineColor.alpha\n        };\n        layer = details.layer = _leaflet[\"default\"].circleMarker(positionToLatLng(position, bounds), pointOptions);\n        layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n        layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(layer);\n        _Cartesian2[\"default\"].clone(position, details.lastPosition);\n        details.lastPixelSize = pixelSize;\n        _Color[\"default\"].clone(color, details.lastColor);\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        details.lastOutlineWidth = outlineWidth;\n        return layer;\n      }\n      if (!_Cartesian2[\"default\"].equals(position, details.lastPosition) || boundsJustChanged) {\n        layer.setLatLng(positionToLatLng(position, bounds));\n        _Cartesian2[\"default\"].clone(position, details.lastPosition);\n      }\n      if (pixelSize !== details.lastPixelSize) {\n        layer.setRadius(pixelSize / 2.0);\n        details.lastPixelSize = pixelSize;\n      }\n      var options = layer.options;\n      var applyStyle = false;\n      if (!_Color[\"default\"].equals(color, details.lastColor)) {\n        options.fillColor = color.toCssColorString();\n        options.fillOpacity = color.alpha;\n        _Color[\"default\"].clone(color, details.lastColor);\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n        options.color = outlineColor.toCssColorString();\n        options.opacity = outlineColor.alpha;\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        applyStyle = true;\n      }\n      if (outlineWidth !== details.lastOutlineWidth) {\n        options.weight = outlineWidth;\n        details.lastOutlineWidth = outlineWidth;\n        applyStyle = true;\n      }\n      if (applyStyle) {\n        layer.setStyle(options);\n      }\n    }\n  }, {\n    key: \"_updateBillboard\",\n    value: function _updateBillboard(entity, time, _entityHash, entityDetails, bounds) {\n      var markerGraphics = entity.billboard;\n      var featureGroup = this._featureGroup;\n      var position;\n      var marker;\n      var details = entityDetails.billboard;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.billboard = {\n          layer: undefined\n        };\n      }\n      var geomLayer = details.layer;\n      var show = entity.isAvailable(time) && getValueOrDefault(markerGraphics.show, time, true);\n      if (show) {\n        position = getValueOrUndefined(entity.position, time);\n        show = (0, _isDefined[\"default\"])(position);\n      }\n      if (!show) {\n        cleanBillboard(entity, featureGroup, entityDetails);\n        return;\n      }\n      var latlng = positionToLatLng(position, bounds);\n      var image = getValue(markerGraphics.image, time);\n      var height = getValue(markerGraphics.height, time);\n      var width = getValue(markerGraphics.width, time);\n      var color = getValueOrDefault(markerGraphics.color, time, defaultColor);\n      var scale = getValueOrDefault(markerGraphics.scale, time, 1.0);\n      var verticalOrigin = getValueOrDefault(markerGraphics.verticalOrigin, time, 0);\n      var horizontalOrigin = getValueOrDefault(markerGraphics.horizontalOrigin, time, 0);\n      var pixelOffset = getValueOrDefault(markerGraphics.pixelOffset, time, _Cartesian[\"default\"].ZERO);\n      var imageUrl;\n      if ((0, _isDefined[\"default\"])(image)) {\n        if (typeof image === \"string\") {\n          imageUrl = image;\n        } else if ((0, _isDefined[\"default\"])(image.toDataURL)) {\n          imageUrl = image.toDataURL();\n        } else if ((0, _isDefined[\"default\"])(image.url)) {\n          imageUrl = image.url;\n        } else {\n          imageUrl = image.src;\n        }\n      }\n      var iconOptions = {\n        color: color.toCssColorString(),\n        origUrl: imageUrl,\n        scale: scale,\n        horizontalOrigin: horizontalOrigin,\n        //value: left, center, right\n        verticalOrigin: verticalOrigin //value: bottom, center, top\n      };\n      if ((0, _isDefined[\"default\"])(height) || (0, _isDefined[\"default\"])(width)) {\n        iconOptions.iconSize = [width, height];\n      }\n      var redrawIcon = false;\n      if (!(0, _isDefined[\"default\"])(geomLayer)) {\n        var markerOptions = {\n          icon: _leaflet[\"default\"].icon({\n            iconUrl: tmpImage\n          })\n        };\n        marker = _leaflet[\"default\"].marker(latlng, markerOptions);\n        marker.on(\"click\", featureClicked.bind(undefined, this, entity));\n        marker.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(marker);\n        details.layer = marker;\n        redrawIcon = true;\n      } else {\n        marker = geomLayer;\n        if (!marker.getLatLng().equals(latlng)) {\n          marker.setLatLng(latlng);\n        }\n        for (var prop in iconOptions) {\n          if ((0, _isDefined[\"default\"])(marker.options.icon) && iconOptions[prop] !== marker.options.icon.options[prop]) {\n            redrawIcon = true;\n            break;\n          }\n        }\n      }\n      if (redrawIcon) {\n        var recolorNeeded = !color.equals(defaultColor);\n        var drawBillboard = function drawBillboard(image, dataurl) {\n          iconOptions.iconUrl = dataurl || image;\n          if (!(0, _isDefined[\"default\"])(iconOptions.iconSize)) {\n            iconOptions.iconSize = [image.width * scale, image.height * scale];\n          }\n          var w = iconOptions.iconSize[0],\n            h = iconOptions.iconSize[1];\n          var xOff = w / 2 * (1 - horizontalOrigin) - pixelOffset.x;\n          var yOff = h / 2 * (1 + verticalOrigin) - pixelOffset.y;\n          iconOptions.iconAnchor = [xOff, yOff];\n          if (recolorNeeded) {\n            iconOptions.iconUrl = recolorBillboard(image, color);\n          }\n          marker.setIcon(_leaflet[\"default\"].icon(iconOptions));\n        };\n        var img = new Image();\n        img.onload = function () {\n          drawBillboard(img, imageUrl);\n        };\n        if ((0, _isDefined[\"default\"])(imageUrl)) {\n          img.src = imageUrl;\n          if (recolorNeeded) {\n            img.crossOrigin = \"anonymous\";\n          }\n        }\n      }\n    }\n  }, {\n    key: \"_updateLabel\",\n    value: function _updateLabel(entity, time, _entityHash, entityDetails) {\n      var labelGraphics = entity.label;\n      var featureGroup = this._featureGroup;\n      var position;\n      var marker;\n      var details = entityDetails.label;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.label = {\n          layer: undefined\n        };\n      }\n      var geomLayer = details.layer;\n      var show = entity.isAvailable(time) && getValueOrDefault(labelGraphics.show, time, true);\n      if (show) {\n        position = getValueOrUndefined(entity.position, time);\n        show = (0, _isDefined[\"default\"])(position);\n      }\n      if (!show) {\n        cleanLabel(entity, featureGroup, entityDetails);\n        return;\n      }\n      var cart = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(position);\n      var latlng = _leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(cart.latitude), _Math[\"default\"].toDegrees(cart.longitude));\n      var text = getValue(labelGraphics.text, time);\n      var font = getValue(labelGraphics.font, time);\n      var scale = getValueOrDefault(labelGraphics.scale, time, 1.0);\n      var fillColor = getValueOrDefault(labelGraphics.fillColor, time, defaultColor);\n      var verticalOrigin = getValueOrDefault(labelGraphics.verticalOrigin, time, 0);\n      var horizontalOrigin = getValueOrDefault(labelGraphics.horizontalOrigin, time, 0);\n      var pixelOffset = getValueOrDefault(labelGraphics.pixelOffset, time, _Cartesian[\"default\"].ZERO);\n      var iconOptions = {\n        text: text,\n        font: font,\n        color: fillColor.toCssColorString(),\n        scale: scale,\n        horizontalOrigin: horizontalOrigin,\n        //value: left, center, right\n        verticalOrigin: verticalOrigin //value: bottom, center, top\n      };\n      var redrawLabel = false;\n      if (!(0, _isDefined[\"default\"])(geomLayer)) {\n        var markerOptions = {\n          icon: _leaflet[\"default\"].icon({\n            iconUrl: tmpImage\n          })\n        };\n        marker = _leaflet[\"default\"].marker(latlng, markerOptions);\n        marker.on(\"click\", featureClicked.bind(undefined, this, entity));\n        marker.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(marker);\n        details.layer = marker;\n        redrawLabel = true;\n      } else {\n        marker = geomLayer;\n        if (!marker.getLatLng().equals(latlng)) {\n          marker.setLatLng(latlng);\n        }\n        for (var prop in iconOptions) {\n          if ((0, _isDefined[\"default\"])(marker.options.icon) && iconOptions[prop] !== marker.options.icon.options[prop]) {\n            redrawLabel = true;\n            break;\n          }\n        }\n      }\n      if (redrawLabel && (0, _isDefined[\"default\"])(text)) {\n        var drawBillboard = function drawBillboard(image, dataurl) {\n          iconOptions.iconUrl = dataurl || image;\n          if (!(0, _isDefined[\"default\"])(iconOptions.iconSize)) {\n            iconOptions.iconSize = [image.width * scale, image.height * scale];\n          }\n          var w = iconOptions.iconSize[0],\n            h = iconOptions.iconSize[1];\n          var xOff = w / 2 * (1 - horizontalOrigin) - pixelOffset.x;\n          var yOff = h / 2 * (1 + verticalOrigin) - pixelOffset.y;\n          iconOptions.iconAnchor = [xOff, yOff];\n          marker.setIcon(_leaflet[\"default\"].icon(iconOptions));\n        };\n        var canvas = (0, _writeTextToCanvas[\"default\"])(text, {\n          fillColor: fillColor,\n          font: font\n        });\n        if ((0, _isDefined[\"default\"])(canvas)) {\n          var imageUrl = canvas.toDataURL();\n          var img = new Image();\n          img.onload = function () {\n            drawBillboard(img, imageUrl);\n          };\n          img.src = imageUrl;\n        }\n      }\n    }\n  }, {\n    key: \"_updateRectangle\",\n    value: function _updateRectangle(entity, time, _entityHash, entityDetails) {\n      var _rectangleGraphics$co;\n      var featureGroup = this._featureGroup;\n      var rectangleGraphics = entity.rectangle;\n      if (!(0, _isDefined[\"default\"])(rectangleGraphics)) {\n        return;\n      }\n      var show = entity.isAvailable(time) && getValueOrDefault(rectangleGraphics.show, time, true);\n      var rectangleCoordinates = (_rectangleGraphics$co = rectangleGraphics.coordinates) === null || _rectangleGraphics$co === void 0 ? void 0 : _rectangleGraphics$co.getValue(time);\n      if (!show || !(0, _isDefined[\"default\"])(rectangleCoordinates)) {\n        cleanRectangle(entity, featureGroup, entityDetails);\n        return;\n      }\n      var rectangleBounds = [[_Math[\"default\"].toDegrees(rectangleCoordinates.south), _Math[\"default\"].toDegrees(rectangleCoordinates.west)], [_Math[\"default\"].toDegrees(rectangleCoordinates.north), _Math[\"default\"].toDegrees(rectangleCoordinates.east)]];\n      var details = entityDetails.rectangle;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.rectangle = {\n          layer: undefined,\n          lastFill: undefined,\n          lastFillColor: new _Color[\"default\"](),\n          lastOutline: undefined,\n          lastOutlineColor: new _Color[\"default\"]()\n        };\n      }\n      var fill = getValueOrDefault(rectangleGraphics.fill, time, true);\n      var outline = getValueOrDefault(rectangleGraphics.outline, time, true);\n      var dashArray;\n      if (rectangleGraphics.outline instanceof _PolylineDashMaterialProperty[\"default\"]) {\n        dashArray = getDashArray(rectangleGraphics.outline, time);\n      }\n      var outlineWidth = getValueOrDefault(rectangleGraphics.outlineWidth, time, defaultOutlineWidth);\n      var outlineColor = getValueOrDefault(rectangleGraphics.outlineColor, time, defaultOutlineColor);\n      var material = getValueOrUndefined(rectangleGraphics.material, time);\n      var fillColor;\n      if ((0, _isDefined[\"default\"])(material) && (0, _isDefined[\"default\"])(material.color)) {\n        fillColor = material.color;\n      } else {\n        fillColor = defaultColor;\n      }\n      var layer = details.layer;\n      if (!(0, _isDefined[\"default\"])(layer)) {\n        var polygonOptions = {\n          fill: fill,\n          fillColor: fillColor.toCssColorString(),\n          fillOpacity: fillColor.alpha,\n          weight: outline ? outlineWidth : 0.0,\n          color: outlineColor.toCssColorString(),\n          opacity: outlineColor.alpha\n        };\n        if (outline && dashArray) {\n          polygonOptions.dashArray = dashArray.map(function (x) {\n            return x * outlineWidth;\n          }).join(\",\");\n        }\n        layer = details.layer = _leaflet[\"default\"].rectangle(rectangleBounds, polygonOptions);\n        layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n        layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(layer);\n        details.lastFill = fill;\n        details.lastOutline = outline;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        return;\n      }\n      var options = layer.options;\n      var applyStyle = false;\n      if (fill !== details.lastFill) {\n        options.fill = fill;\n        details.lastFill = fill;\n        applyStyle = true;\n      }\n      if (outline !== details.lastOutline) {\n        options.weight = outline ? outlineWidth : 0.0;\n        details.lastOutline = outline;\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(fillColor, details.lastFillColor)) {\n        options.fillColor = fillColor.toCssColorString();\n        options.fillOpacity = fillColor.alpha;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n        options.color = outlineColor.toCssColorString();\n        options.opacity = outlineColor.alpha;\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        applyStyle = true;\n      }\n      if (!layer.getBounds().equals(rectangleBounds)) {\n        layer.setBounds(rectangleBounds);\n      }\n      if (applyStyle) {\n        layer.setStyle(options);\n      }\n    }\n  }, {\n    key: \"_updatePolygon\",\n    value: function _updatePolygon(entity, time, _entityHash, entityDetails) {\n      var featureGroup = this._featureGroup;\n      var polygonGraphics = entity.polygon;\n      var show = entity.isAvailable(time) && getValueOrDefault(polygonGraphics.show, time, true);\n      if (!show) {\n        cleanPolygon(entity, featureGroup, entityDetails);\n        return;\n      }\n      var details = entityDetails.polygon;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.polygon = {\n          layer: undefined,\n          lastHierarchy: undefined,\n          lastFill: undefined,\n          lastFillColor: new _Color[\"default\"](),\n          lastOutline: undefined,\n          lastOutlineColor: new _Color[\"default\"]()\n        };\n      }\n      var hierarchy = getValueOrUndefined(polygonGraphics.hierarchy, time);\n      if (!(0, _isDefined[\"default\"])(hierarchy)) {\n        cleanPolygon(entity, featureGroup, entityDetails);\n        return;\n      }\n      var fill = getValueOrDefault(polygonGraphics.fill, time, true);\n      var outline = getValueOrDefault(polygonGraphics.outline, time, true);\n      var dashArray;\n      if (polygonGraphics.outline instanceof _PolylineDashMaterialProperty[\"default\"]) {\n        dashArray = getDashArray(polygonGraphics.outline, time);\n      }\n      var outlineWidth = getValueOrDefault(polygonGraphics.outlineWidth, time, defaultOutlineWidth);\n      var outlineColor = getValueOrDefault(polygonGraphics.outlineColor, time, defaultOutlineColor);\n      var material = getValueOrUndefined(polygonGraphics.material, time);\n      var fillColor;\n      if ((0, _isDefined[\"default\"])(material) && (0, _isDefined[\"default\"])(material.color)) {\n        fillColor = material.color;\n      } else {\n        fillColor = defaultColor;\n      }\n      var layer = details.layer;\n      if (!(0, _isDefined[\"default\"])(layer)) {\n        var polygonOptions = {\n          fill: fill,\n          fillColor: fillColor.toCssColorString(),\n          fillOpacity: fillColor.alpha,\n          weight: outline ? outlineWidth : 0.0,\n          color: outlineColor.toCssColorString(),\n          opacity: outlineColor.alpha\n        };\n        if (outline && dashArray) {\n          polygonOptions.dashArray = dashArray.map(function (x) {\n            return x * outlineWidth;\n          }).join(\",\");\n        }\n        layer = details.layer = _leaflet[\"default\"].polygon(hierarchyToLatLngs(hierarchy), polygonOptions);\n        layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n        layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(layer);\n        details.lastHierarchy = hierarchy;\n        details.lastFill = fill;\n        details.lastOutline = outline;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        return;\n      }\n      if (hierarchy !== details.lastHierarchy) {\n        layer.setLatLngs(hierarchyToLatLngs(hierarchy));\n        details.lastHierarchy = hierarchy;\n      }\n      var options = layer.options;\n      var applyStyle = false;\n      if (fill !== details.lastFill) {\n        options.fill = fill;\n        details.lastFill = fill;\n        applyStyle = true;\n      }\n      if (outline !== details.lastOutline) {\n        options.weight = outline ? outlineWidth : 0.0;\n        details.lastOutline = outline;\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(fillColor, details.lastFillColor)) {\n        options.fillColor = fillColor.toCssColorString();\n        options.fillOpacity = fillColor.alpha;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n        options.color = outlineColor.toCssColorString();\n        options.opacity = outlineColor.alpha;\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        applyStyle = true;\n      }\n      if (applyStyle) {\n        layer.setStyle(options);\n      }\n    }\n  }, {\n    key: \"_updatePolyline\",\n    value: function _updatePolyline(entity, time, _entityHash, entityDetails) {\n      var polylineGraphics = entity.polyline;\n      var featureGroup = this._featureGroup;\n      var positions, polyline;\n      var details = entityDetails.polyline;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.polyline = {\n          layer: undefined\n        };\n      }\n      var geomLayer = details.layer;\n      var show = entity.isAvailable(time) && getValueOrDefault(polylineGraphics.show, time, true);\n      if (show) {\n        positions = getValueOrUndefined(polylineGraphics.positions, time);\n        show = (0, _isDefined[\"default\"])(positions);\n      }\n      if (!show) {\n        cleanPolyline(entity, featureGroup, entityDetails);\n        return;\n      }\n      var carts = _Ellipsoid[\"default\"].WGS84.cartesianArrayToCartographicArray(positions);\n      var latlngs = [];\n      for (var p = 0; p < carts.length; p++) {\n        latlngs.push(_leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(carts[p].latitude), _Math[\"default\"].toDegrees(carts[p].longitude)));\n      }\n      var color;\n      var dashArray;\n      var width;\n      if (polylineGraphics.material instanceof _PolylineGlowMaterialProperty[\"default\"]) {\n        color = defaultColor;\n        width = defaultWidth;\n      } else {\n        var material = polylineGraphics.material.getValue(time);\n        if ((0, _isDefined[\"default\"])(material)) {\n          color = material.color;\n        }\n        color = color || defaultColor;\n        width = getValueOrDefault(polylineGraphics.width, time, defaultWidth);\n      }\n      if (polylineGraphics.material instanceof _PolylineDashMaterialProperty[\"default\"]) {\n        dashArray = getDashArray(polylineGraphics.material, time);\n      }\n      var polylineOptions = {\n        color: color.toCssColorString(),\n        weight: width,\n        opacity: color.alpha\n      };\n      if (dashArray) {\n        polylineOptions.dashArray = dashArray.map(function (x) {\n          return x * width;\n        }).join(\",\");\n      }\n      if (!(0, _isDefined[\"default\"])(geomLayer)) {\n        if (latlngs.length > 0) {\n          polyline = _leaflet[\"default\"].polyline(latlngs, polylineOptions);\n          polyline.on(\"click\", featureClicked.bind(undefined, this, entity));\n          polyline.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n          featureGroup.addLayer(polyline);\n          details.layer = polyline;\n        }\n      } else {\n        polyline = geomLayer;\n        var curLatLngs = polyline.getLatLngs();\n        var bPosChange = latlngs.length !== curLatLngs.length;\n        for (var i = 0; i < curLatLngs.length && !bPosChange; i++) {\n          var latlng = curLatLngs[i];\n          if (latlng instanceof _leaflet[\"default\"].LatLng && !latlng.equals(latlngs[i])) {\n            bPosChange = true;\n          }\n        }\n        if (bPosChange) {\n          polyline.setLatLngs(latlngs);\n        }\n        for (var prop in polylineOptions) {\n          if (polylineOptions[prop] !== polyline.options[prop]) {\n            polyline.setStyle(polylineOptions);\n            break;\n          }\n        }\n      }\n    }\n\n    /**\r\n     * Returns true if this object was destroyed; otherwise, false.\r\n     *\r\n     */\n  }, {\n    key: \"isDestroyed\",\n    value: function isDestroyed() {\n      return false;\n    }\n\n    /**\r\n     * Removes and destroys all primitives created by this instance.\r\n     */\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var entities = this._entitiesToVisualize.values;\n      var entityHash = this._entityHash;\n      for (var i = entities.length - 1; i > -1; i--) {\n        cleanEntity(entities[i], this._featureGroup, entityHash);\n      }\n      this.entityCollection.collectionChanged.removeEventListener(this._onCollectionChanged, this);\n      this.leafletScene.map.removeLayer(this._featureGroup);\n      return (0, _destroyObject[\"default\"])(this);\n    }\n\n    /**\r\n     * Computes the rectangular bounds which encloses the collection of\r\n     * entities to be visualized.\r\n     */\n  }, {\n    key: \"getLatLngBounds\",\n    value: function getLatLngBounds() {\n      var _this = this;\n      var result;\n      Object.keys(this._entityHash).forEach(function (entityId) {\n        var entityDetails = _this._entityHash[entityId];\n        Object.keys(entityDetails).forEach(function (primitiveId) {\n          var primitive = entityDetails[primitiveId];\n          if ((0, _isDefined[\"default\"])(primitive.layer)) {\n            if ((0, _isDefined[\"default\"])(primitive.layer.getBounds)) {\n              var bounds = primitive.layer.getBounds();\n              if ((0, _isDefined[\"default\"])(bounds)) {\n                result = result === undefined ? _leaflet[\"default\"].latLngBounds(bounds.getSouthWest(), bounds.getNorthEast()) : result.extend(bounds);\n              }\n            }\n            if ((0, _isDefined[\"default\"])(primitive.layer.getLatLng)) {\n              var latLng = primitive.layer.getLatLng();\n              if ((0, _isDefined[\"default\"])(latLng)) {\n                result = result === undefined ? _leaflet[\"default\"].latLngBounds([latLng]) : result.extend(latLng);\n              }\n            }\n          }\n        });\n      });\n      return result;\n    }\n  }]);\n}();\nfunction getDashArray(material, time) {\n  var dashPattern = material.dashPattern ? material.dashPattern.getValue(time) : undefined;\n  return (0, _esriLineStyle.getLineStyleLeaflet)(dashPattern);\n}\nfunction cleanEntity(entity, group, entityHash) {\n  var details = entityHash[entity.id];\n  cleanPoint(entity, group, details);\n  cleanPolygon(entity, group, details);\n  cleanBillboard(entity, group, details);\n  cleanLabel(entity, group, details);\n  cleanPolyline(entity, group, details);\n  delete entityHash[entity.id];\n}\nfunction cleanPoint(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.point) && (0, _isDefined[\"default\"])(details.point.layer)) {\n    group.removeLayer(details.point.layer);\n    details.point = undefined;\n  }\n}\nfunction cleanPolygon(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.polygon) && (0, _isDefined[\"default\"])(details.polygon.layer)) {\n    group.removeLayer(details.polygon.layer);\n    details.polygon = undefined;\n  }\n}\nfunction cleanBillboard(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.billboard) && (0, _isDefined[\"default\"])(details.billboard.layer)) {\n    group.removeLayer(details.billboard.layer);\n    details.billboard = undefined;\n  }\n}\nfunction cleanLabel(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.label) && (0, _isDefined[\"default\"])(details.label.layer)) {\n    group.removeLayer(details.label.layer);\n    details.label = undefined;\n  }\n}\nfunction cleanPolyline(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.polyline) && (0, _isDefined[\"default\"])(details.polyline.layer)) {\n    group.removeLayer(details.polyline.layer);\n    details.polyline = undefined;\n  }\n}\nfunction cleanRectangle(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.rectangle) && (0, _isDefined[\"default\"])(details.rectangle.layer)) {\n    group.removeLayer(details.rectangle.layer);\n    details.rectangle = undefined;\n  }\n}\nfunction _isCloseToEasternAntiMeridian(bounds) {\n  var w = bounds.getWest();\n  var e = bounds.getEast();\n  if (w > 140 && (e < -140 || e > 180)) {\n    return true;\n  }\n  return false;\n}\nfunction _isCloseToWesternAntiMeridian(bounds) {\n  var w = bounds.getWest();\n  var e = bounds.getEast();\n  if ((w > 180 || w < -140) && e < -140) {\n    return true;\n  }\n  return false;\n}\nfunction positionToLatLng(position, bounds) {\n  var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(position);\n  var lon = _Math[\"default\"].toDegrees(cartographic.longitude);\n  if (bounds !== undefined) {\n    if (_isCloseToEasternAntiMeridian(bounds)) {\n      if (lon < -140) {\n        lon = lon + 360;\n      }\n    } else if (_isCloseToWesternAntiMeridian(bounds)) {\n      if (lon > 140) {\n        lon = lon - 360;\n      }\n    }\n  }\n  return _leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(cartographic.latitude), lon);\n}\nfunction hierarchyToLatLngs(hierarchy) {\n  var holes = [];\n  var positions = Array.isArray(hierarchy) ? hierarchy : hierarchy.positions;\n  if (hierarchy.holes.length > 0) {\n    hierarchy.holes.forEach(function (hole) {\n      holes.push(convertEntityPositionsToLatLons(hole.positions));\n    });\n    return [convertEntityPositionsToLatLons(positions)].concat(holes);\n  } else {\n    return convertEntityPositionsToLatLons(positions);\n  }\n}\n\n//Recolor an image using 2d canvas\nfunction recolorBillboard(img, color) {\n  var canvas = document.createElement(\"canvas\");\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  // Copy the image contents to the canvas\n  var context = canvas.getContext(\"2d\");\n  if (context === null) {\n    return;\n  }\n  context.drawImage(img, 0, 0);\n  var image = context.getImageData(0, 0, canvas.width, canvas.height);\n  var normClr = [color.red, color.green, color.blue, color.alpha];\n  var length = image.data.length; //pixel count * 4\n  for (var i = 0; i < length; i += 4) {\n    for (var j = 0; j < 4; j++) {\n      image.data[j + i] *= normClr[j];\n    }\n  }\n  context.putImageData(image, 0, 0);\n  return canvas.toDataURL();\n}\nfunction featureClicked(visualizer, entity, event) {\n  visualizer.leafletScene.featureClicked.raiseEvent(entity, event);\n}\nfunction featureMousedown(visualizer, entity, event) {\n  visualizer.leafletScene.featureMousedown.raiseEvent(entity, event);\n}\nfunction getValue(property, time) {\n  if ((0, _isDefined[\"default\"])(property)) {\n    return property.getValue(time);\n  }\n}\nfunction getValueOrDefault(property, time, defaultValue) {\n  if ((0, _isDefined[\"default\"])(property)) {\n    var value = property.getValue(time);\n    if ((0, _isDefined[\"default\"])(value)) {\n      return value;\n    }\n  }\n  return defaultValue;\n}\nfunction getValueOrUndefined(property, time) {\n  if ((0, _isDefined[\"default\"])(property)) {\n    return property.getValue(time);\n  }\n}\nfunction convertEntityPositionsToLatLons(positions) {\n  var carts = _Ellipsoid[\"default\"].WGS84.cartesianArrayToCartographicArray(positions);\n  var latlngs = [];\n  var lastLongitude;\n  for (var p = 0; p < carts.length; p++) {\n    var lon = _Math[\"default\"].toDegrees(carts[p].longitude);\n    if (lastLongitude !== undefined) {\n      if (lastLongitude - lon > 180) {\n        lon = lon + 360;\n      } else if (lastLongitude - lon < -180) {\n        lon = lon - 360;\n      }\n    }\n    latlngs.push(_leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(carts[p].latitude), lon));\n    lastLongitude = lon;\n  }\n  return latlngs;\n}\nvar LeafletVisualizer = exports[\"default\"] = /*#__PURE__*/function () {\n  function LeafletVisualizer() {\n    _classCallCheck(this, LeafletVisualizer);\n  }\n  return _createClass(LeafletVisualizer, [{\n    key: \"visualizersCallback\",\n    value: function visualizersCallback(leafletScene, _entityCluster, dataSource) {\n      var entities = dataSource.entities;\n      return [new LeafletGeomVisualizer(leafletScene, entities)];\n    }\n  }]);\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFZpc3VhbGl6ZXIudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFZpc3VhbGl6ZXIudHM/ZmRlOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTCwgeyBMYXRMbmdCb3VuZHMsIExhdExuZ0JvdW5kc0xpdGVyYWwsIFBvbHlsaW5lT3B0aW9ucyB9IGZyb20gXCJsZWFmbGV0XCI7XHJcbmltcG9ydCBBc3NvY2lhdGl2ZUFycmF5IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQXNzb2NpYXRpdmVBcnJheVwiO1xyXG5pbXBvcnQgQ2FydGVzaWFuMiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRlc2lhbjJcIjtcclxuaW1wb3J0IENhcnRlc2lhbjMgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9DYXJ0ZXNpYW4zXCI7XHJcbmltcG9ydCBDb2xvciBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NvbG9yXCI7XHJcbmltcG9ydCBkZXN0cm95T2JqZWN0IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvZGVzdHJveU9iamVjdFwiO1xyXG5pbXBvcnQgRWxsaXBzb2lkIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRWxsaXBzb2lkXCI7XHJcbmltcG9ydCBKdWxpYW5EYXRlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvSnVsaWFuRGF0ZVwiO1xyXG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcclxuaW1wb3J0IFBvbHlnb25IaWVyYXJjaHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9Qb2x5Z29uSGllcmFyY2h5XCI7XHJcbmltcG9ydCBSZWN0YW5nbGUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9SZWN0YW5nbGVcIjtcclxuaW1wb3J0IHdyaXRlVGV4dFRvQ2FudmFzIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvd3JpdGVUZXh0VG9DYW52YXNcIjtcclxuaW1wb3J0IERhdGFTb3VyY2UgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRGF0YVNvdXJjZVwiO1xyXG5pbXBvcnQgRW50aXR5IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eVwiO1xyXG5pbXBvcnQgRW50aXR5Q2x1c3RlciBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9FbnRpdHlDbHVzdGVyXCI7XHJcbmltcG9ydCBFbnRpdHlDb2xsZWN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eUNvbGxlY3Rpb25cIjtcclxuaW1wb3J0IFBvbHlsaW5lRGFzaE1hdGVyaWFsUHJvcGVydHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgUG9seWxpbmVHbG93TWF0ZXJpYWxQcm9wZXJ0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9Qb2x5bGluZUdsb3dNYXRlcmlhbFByb3BlcnR5XCI7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9Qcm9wZXJ0eVwiO1xyXG5pbXBvcnQgaXNEZWZpbmVkIGZyb20gXCIuLi8uLi9Db3JlL2lzRGVmaW5lZFwiO1xyXG5pbXBvcnQgeyBnZXRMaW5lU3R5bGVMZWFmbGV0IH0gZnJvbSBcIi4uLy4uL01vZGVscy9DYXRhbG9nL0VzcmkvZXNyaUxpbmVTdHlsZVwiO1xyXG5pbXBvcnQgTGVhZmxldFNjZW5lIGZyb20gXCIuL0xlYWZsZXRTY2VuZVwiO1xyXG5cclxuaW50ZXJmYWNlIFBvaW50RGV0YWlscyB7XHJcbiAgbGF5ZXI/OiBMLkNpcmNsZU1hcmtlcjtcclxuICBsYXN0UG9zaXRpb246IENhcnRlc2lhbjM7XHJcbiAgbGFzdFBpeGVsU2l6ZTogbnVtYmVyO1xyXG4gIGxhc3RDb2xvcjogQ29sb3I7XHJcbiAgbGFzdE91dGxpbmVDb2xvcjogQ29sb3I7XHJcbiAgbGFzdE91dGxpbmVXaWR0aDogbnVtYmVyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUG9seWdvbkRldGFpbHMge1xyXG4gIGxheWVyPzogTC5Qb2x5Z29uO1xyXG4gIGxhc3RIaWVyYXJjaHk/OiBQb2x5Z29uSGllcmFyY2h5O1xyXG4gIGxhc3RGaWxsPzogYm9vbGVhbjtcclxuICBsYXN0RmlsbENvbG9yOiBDb2xvcjtcclxuICBsYXN0T3V0bGluZT86IGJvb2xlYW47XHJcbiAgbGFzdE91dGxpbmVDb2xvcjogQ29sb3I7XHJcbn1cclxuXHJcbmludGVyZmFjZSBSZWN0YW5nbGVEZXRhaWxzIHtcclxuICBsYXllcj86IEwuUmVjdGFuZ2xlO1xyXG4gIGxhc3RGaWxsPzogYm9vbGVhbjtcclxuICBsYXN0RmlsbENvbG9yOiBDb2xvcjtcclxuICBsYXN0T3V0bGluZT86IGJvb2xlYW47XHJcbiAgbGFzdE91dGxpbmVDb2xvcjogQ29sb3I7XHJcbn1cclxuXHJcbmludGVyZmFjZSBCaWxsYm9hcmREZXRhaWxzIHtcclxuICBsYXllcj86IEwuTWFya2VyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgTGFiZWxEZXRhaWxzIHtcclxuICBsYXllcj86IEwuTWFya2VyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUG9seWxpbmVEZXRhaWxzIHtcclxuICBsYXllcj86IEwuUG9seWxpbmU7XHJcbn1cclxuXHJcbmludGVyZmFjZSBFbnRpdHlEZXRhaWxzIHtcclxuICBwb2ludD86IFBvaW50RGV0YWlscztcclxuICBwb2x5Z29uPzogUG9seWdvbkRldGFpbHM7XHJcbiAgYmlsbGJvYXJkPzogQmlsbGJvYXJkRGV0YWlscztcclxuICBsYWJlbD86IExhYmVsRGV0YWlscztcclxuICBwb2x5bGluZT86IFBvbHlsaW5lRGV0YWlscztcclxuICByZWN0YW5nbGU/OiBSZWN0YW5nbGVEZXRhaWxzO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgRW50aXR5SGFzaCB7XHJcbiAgW2tleTogc3RyaW5nXTogRW50aXR5RGV0YWlscztcclxufVxyXG5cclxuY29uc3QgZGVmYXVsdENvbG9yID0gQ29sb3IuV0hJVEU7XHJcbmNvbnN0IGRlZmF1bHRPdXRsaW5lQ29sb3IgPSBDb2xvci5CTEFDSztcclxuY29uc3QgZGVmYXVsdE91dGxpbmVXaWR0aCA9IDEuMDtcclxuY29uc3QgZGVmYXVsdFBpeGVsU2l6ZSA9IDUuMDtcclxuY29uc3QgZGVmYXVsdFdpZHRoID0gNS4wO1xyXG5cclxuLy9TaW5nbGUgcGl4ZWwgYmxhY2sgZG90XHJcbmNvbnN0IHRtcEltYWdlID1cclxuICBcImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBUEFBQUFBQUFQLy8veUg1QkFBQUFBQUFMQUFBQUFBQkFBRUFBQUlDUkFFQU93PT1cIjtcclxuXHJcbi8vTk9UIElNUExFTUVOVEVEXHJcbi8vIFBhdGggcHJpbWl0aXZlIC0gbm8gbmVlZCBpZGVudGlmaWVkXHJcbi8vIEVsbGlwc2UgcHJpbWl0aXZlIC0gbm8gbmVlZCBpZGVudGlmaWVkXHJcbi8vIEVsbGlwc29pZCBwcmltaXRpdmUgLSAzZCBwcmltIC0gbm8gcGxhbnMgZm9yIHRoaXNcclxuLy8gTW9kZWwgcHJpbWl0aXZlIC0gM2QgcHJpbSAtIG5vIHBsYW5zIGZvciB0aGlzXHJcblxyXG4vKipcclxuICogQSB2YXJpYWJsZSB0byBzdG9yZSB3aGF0IHNvcnQgb2YgYm91bmRzIG91ciBsZWFmbGV0IG1hcCBoYXMgYmVlbiBsb29raW5nIGF0XHJcbiAqIDAgPSBhIG5vcm1hbCBleHRlbnRcclxuICogMSA9IHpvb21lZCBpbiBjbG9zZSB0byB0aGUgZWFzdC9sZWZ0IG9mIGFudGktbWVyaWRpYW5cclxuICogMiA9IHpvb21lZCBpbiBjbG9zZSB0byB0aGUgd2VzdC9yaWdodCBvZiB0aGUgYW50aS1tZXJpZGlhblxyXG4gKiBXaGVuIHRoaXMgdmFsdWUgY2hhbmdlcyB3ZSdsbCBuZWVkIHRvIHJlY29tcHV0ZSB0aGUgbG9jYXRpb24gb2Ygb3VyIHBvaW50c1xyXG4gKiB0byBoZWxwIHRoZW0gd3JhcCBhcm91bmQgdGhlIGFudGktbWVyaWRpYW5cclxuICovXHJcbmxldCBwcmV2Qm91bmRzVHlwZSA9IDA7XHJcblxyXG4vKipcclxuICogQSB7QGxpbmsgVmlzdWFsaXplcn0gd2hpY2ggbWFwcyB7QGxpbmsgRW50aXR5I3BvaW50fSB0byBMZWFmbGV0IHByaW1pdGl2ZXMuXHJcbiAqKi9cclxuY2xhc3MgTGVhZmxldEdlb21WaXN1YWxpemVyIHtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9mZWF0dXJlR3JvdXA6IEwuRmVhdHVyZUdyb3VwO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2VudGl0aWVzVG9WaXN1YWxpemU6IEFzc29jaWF0aXZlQXJyYXk7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZW50aXR5SGFzaDogRW50aXR5SGFzaDtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICByZWFkb25seSBsZWFmbGV0U2NlbmU6IExlYWZsZXRTY2VuZSxcclxuICAgIHJlYWRvbmx5IGVudGl0eUNvbGxlY3Rpb246IEVudGl0eUNvbGxlY3Rpb25cclxuICApIHtcclxuICAgIGVudGl0eUNvbGxlY3Rpb24uY29sbGVjdGlvbkNoYW5nZWQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgdGhpcy5fb25Db2xsZWN0aW9uQ2hhbmdlZCxcclxuICAgICAgdGhpc1xyXG4gICAgKTtcclxuICAgIHRoaXMuX2ZlYXR1cmVHcm91cCA9IEwuZmVhdHVyZUdyb3VwKCkuYWRkVG8obGVhZmxldFNjZW5lLm1hcCk7XHJcbiAgICB0aGlzLl9lbnRpdGllc1RvVmlzdWFsaXplID0gbmV3IEFzc29jaWF0aXZlQXJyYXkoKTtcclxuICAgIHRoaXMuX2VudGl0eUhhc2ggPSB7fTtcclxuXHJcbiAgICB0aGlzLl9vbkNvbGxlY3Rpb25DaGFuZ2VkKFxyXG4gICAgICBlbnRpdHlDb2xsZWN0aW9uLFxyXG4gICAgICBlbnRpdHlDb2xsZWN0aW9uLnZhbHVlcyxcclxuICAgICAgW10sXHJcbiAgICAgIFtdXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfb25Db2xsZWN0aW9uQ2hhbmdlZChcclxuICAgIF9lbnRpdHlDb2xsZWN0aW9uOiBFbnRpdHlDb2xsZWN0aW9uLFxyXG4gICAgYWRkZWQ6IEVudGl0eVtdLFxyXG4gICAgcmVtb3ZlZDogRW50aXR5W10sXHJcbiAgICBjaGFuZ2VkOiBFbnRpdHlbXVxyXG4gICkge1xyXG4gICAgbGV0IGVudGl0eTtcclxuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcclxuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5fZW50aXRpZXNUb1Zpc3VhbGl6ZTtcclxuICAgIGNvbnN0IGVudGl0eUhhc2ggPSB0aGlzLl9lbnRpdHlIYXNoO1xyXG5cclxuICAgIGZvciAobGV0IGkgPSBhZGRlZC5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkge1xyXG4gICAgICBlbnRpdHkgPSBhZGRlZFtpXTtcclxuICAgICAgaWYgKFxyXG4gICAgICAgICgoaXNEZWZpbmVkKGVudGl0eS5wb2ludCkgfHxcclxuICAgICAgICAgIGlzRGVmaW5lZChlbnRpdHkuYmlsbGJvYXJkKSB8fFxyXG4gICAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5sYWJlbCkpICYmXHJcbiAgICAgICAgICBpc0RlZmluZWQoZW50aXR5LnBvc2l0aW9uKSkgfHxcclxuICAgICAgICBpc0RlZmluZWQoZW50aXR5LnBvbHlsaW5lKSB8fFxyXG4gICAgICAgIGlzRGVmaW5lZChlbnRpdHkucG9seWdvbikgfHxcclxuICAgICAgICBpc0RlZmluZWQoZW50aXR5LnJlY3RhbmdsZSlcclxuICAgICAgKSB7XHJcbiAgICAgICAgZW50aXRpZXMuc2V0KGVudGl0eS5pZCwgZW50aXR5KTtcclxuICAgICAgICBlbnRpdHlIYXNoW2VudGl0eS5pZF0gPSB7fTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGkgPSBjaGFuZ2VkLmxlbmd0aCAtIDE7IGkgPiAtMTsgaS0tKSB7XHJcbiAgICAgIGVudGl0eSA9IGNoYW5nZWRbaV07XHJcbiAgICAgIGlmIChcclxuICAgICAgICAoKGlzRGVmaW5lZChlbnRpdHkucG9pbnQpIHx8XHJcbiAgICAgICAgICBpc0RlZmluZWQoZW50aXR5LmJpbGxib2FyZCkgfHxcclxuICAgICAgICAgIGlzRGVmaW5lZChlbnRpdHkubGFiZWwpKSAmJlxyXG4gICAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5wb3NpdGlvbikpIHx8XHJcbiAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5wb2x5bGluZSkgfHxcclxuICAgICAgICBpc0RlZmluZWQoZW50aXR5LnBvbHlnb24pIHx8XHJcbiAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5yZWN0YW5nbGUpXHJcbiAgICAgICkge1xyXG4gICAgICAgIGVudGl0aWVzLnNldChlbnRpdHkuaWQsIGVudGl0eSk7XHJcbiAgICAgICAgZW50aXR5SGFzaFtlbnRpdHkuaWRdID0gZW50aXR5SGFzaFtlbnRpdHkuaWRdIHx8IHt9O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNsZWFuRW50aXR5KGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlIYXNoKTtcclxuICAgICAgICBlbnRpdGllcy5yZW1vdmUoZW50aXR5LmlkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGkgPSByZW1vdmVkLmxlbmd0aCAtIDE7IGkgPiAtMTsgaS0tKSB7XHJcbiAgICAgIGVudGl0eSA9IHJlbW92ZWRbaV07XHJcbiAgICAgIGNsZWFuRW50aXR5KGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlIYXNoKTtcclxuICAgICAgZW50aXRpZXMucmVtb3ZlKGVudGl0eS5pZCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBwcmltaXRpdmVzIGNyZWF0ZWQgYnkgdGhpcyB2aXN1YWxpemVyIHRvIG1hdGNoIHRoZWlyXHJcbiAgICogRW50aXR5IGNvdW50ZXJwYXJ0IGF0IHRoZSBnaXZlbiB0aW1lLlxyXG4gICAqXHJcbiAgICovXHJcbiAgcHVibGljIHVwZGF0ZSh0aW1lOiBKdWxpYW5EYXRlKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMuX2VudGl0aWVzVG9WaXN1YWxpemUudmFsdWVzO1xyXG4gICAgY29uc3QgZW50aXR5SGFzaCA9IHRoaXMuX2VudGl0eUhhc2g7XHJcblxyXG4gICAgY29uc3QgYm91bmRzID0gdGhpcy5sZWFmbGV0U2NlbmUubWFwLmdldEJvdW5kcygpO1xyXG4gICAgbGV0IGFwcGx5TG9jYWxpc2VkQW50aU1lcmlkaWFuRml4ID0gZmFsc2U7XHJcbiAgICBsZXQgY3VycmVudEJvdW5kc1R5cGUgPSAwO1xyXG4gICAgaWYgKF9pc0Nsb3NlVG9FYXN0ZXJuQW50aU1lcmlkaWFuKGJvdW5kcykpIHtcclxuICAgICAgYXBwbHlMb2NhbGlzZWRBbnRpTWVyaWRpYW5GaXggPSB0cnVlO1xyXG4gICAgICBjdXJyZW50Qm91bmRzVHlwZSA9IDE7XHJcbiAgICB9IGVsc2UgaWYgKF9pc0Nsb3NlVG9XZXN0ZXJuQW50aU1lcmlkaWFuKGJvdW5kcykpIHtcclxuICAgICAgYXBwbHlMb2NhbGlzZWRBbnRpTWVyaWRpYW5GaXggPSB0cnVlO1xyXG4gICAgICBjdXJyZW50Qm91bmRzVHlwZSA9IDI7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGVudGl0aWVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGVudGl0eSA9IGVudGl0aWVzW2ldO1xyXG4gICAgICBjb25zdCBlbnRpdHlEZXRhaWxzID0gZW50aXR5SGFzaFtlbnRpdHkuaWRdO1xyXG5cclxuICAgICAgaWYgKGlzRGVmaW5lZChlbnRpdHkuX3BvaW50KSkge1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZVBvaW50KFxyXG4gICAgICAgICAgZW50aXR5LFxyXG4gICAgICAgICAgdGltZSxcclxuICAgICAgICAgIGVudGl0eUhhc2gsXHJcbiAgICAgICAgICBlbnRpdHlEZXRhaWxzLFxyXG4gICAgICAgICAgYXBwbHlMb2NhbGlzZWRBbnRpTWVyaWRpYW5GaXggPT09IHRydWUgPyBib3VuZHMgOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICBwcmV2Qm91bmRzVHlwZSAhPT0gY3VycmVudEJvdW5kc1R5cGVcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpc0RlZmluZWQoZW50aXR5LmJpbGxib2FyZCkpIHtcclxuICAgICAgICB0aGlzLl91cGRhdGVCaWxsYm9hcmQoXHJcbiAgICAgICAgICBlbnRpdHksXHJcbiAgICAgICAgICB0aW1lLFxyXG4gICAgICAgICAgZW50aXR5SGFzaCxcclxuICAgICAgICAgIGVudGl0eURldGFpbHMsXHJcbiAgICAgICAgICBhcHBseUxvY2FsaXNlZEFudGlNZXJpZGlhbkZpeCA9PT0gdHJ1ZSA/IGJvdW5kcyA6IHVuZGVmaW5lZFxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlzRGVmaW5lZChlbnRpdHkubGFiZWwpKSB7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlTGFiZWwoZW50aXR5LCB0aW1lLCBlbnRpdHlIYXNoLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaXNEZWZpbmVkKGVudGl0eS5wb2x5bGluZSkpIHtcclxuICAgICAgICB0aGlzLl91cGRhdGVQb2x5bGluZShlbnRpdHksIHRpbWUsIGVudGl0eUhhc2gsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpc0RlZmluZWQoZW50aXR5LnBvbHlnb24pKSB7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUG9seWdvbihlbnRpdHksIHRpbWUsIGVudGl0eUhhc2gsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpc0RlZmluZWQoZW50aXR5LnJlY3RhbmdsZSkpIHtcclxuICAgICAgICB0aGlzLl91cGRhdGVSZWN0YW5nbGUoZW50aXR5LCB0aW1lLCBlbnRpdHlIYXNoLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJldkJvdW5kc1R5cGUgPSBjdXJyZW50Qm91bmRzVHlwZTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdXBkYXRlUG9pbnQoXHJcbiAgICBlbnRpdHk6IEVudGl0eSxcclxuICAgIHRpbWU6IEp1bGlhbkRhdGUsXHJcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcclxuICAgIGVudGl0eURldGFpbHM6IEVudGl0eURldGFpbHMsXHJcbiAgICBib3VuZHM6IExhdExuZ0JvdW5kcyB8IHVuZGVmaW5lZCxcclxuICAgIGJvdW5kc0p1c3RDaGFuZ2VkOiBib29sZWFuXHJcbiAgKSB7XHJcbiAgICBjb25zdCBmZWF0dXJlR3JvdXAgPSB0aGlzLl9mZWF0dXJlR3JvdXA7XHJcbiAgICBjb25zdCBwb2ludEdyYXBoaWNzID0gZW50aXR5LnBvaW50ITtcclxuXHJcbiAgICBjb25zdCBzaG93ID1cclxuICAgICAgZW50aXR5LmlzQXZhaWxhYmxlKHRpbWUpICYmXHJcbiAgICAgIGdldFZhbHVlT3JEZWZhdWx0KHBvaW50R3JhcGhpY3Muc2hvdywgdGltZSwgdHJ1ZSk7XHJcbiAgICBpZiAoIXNob3cpIHtcclxuICAgICAgY2xlYW5Qb2ludChlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9pbnQ7XHJcbiAgICBpZiAoIWlzRGVmaW5lZChkZXRhaWxzKSkge1xyXG4gICAgICBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5wb2ludCA9IHtcclxuICAgICAgICBsYXllcjogdW5kZWZpbmVkLFxyXG4gICAgICAgIGxhc3RQb3NpdGlvbjogbmV3IENhcnRlc2lhbjMoKSxcclxuICAgICAgICBsYXN0UGl4ZWxTaXplOiAxLFxyXG4gICAgICAgIGxhc3RDb2xvcjogbmV3IENvbG9yKCksXHJcbiAgICAgICAgbGFzdE91dGxpbmVDb2xvcjogbmV3IENvbG9yKCksXHJcbiAgICAgICAgbGFzdE91dGxpbmVXaWR0aDogMVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uID0gZ2V0VmFsdWVPclVuZGVmaW5lZChlbnRpdHkucG9zaXRpb24sIHRpbWUpO1xyXG4gICAgaWYgKCFpc0RlZmluZWQocG9zaXRpb24pKSB7XHJcbiAgICAgIGNsZWFuUG9pbnQoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGl4ZWxTaXplID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIHBvaW50R3JhcGhpY3MucGl4ZWxTaXplLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkZWZhdWx0UGl4ZWxTaXplXHJcbiAgICApO1xyXG4gICAgY29uc3QgY29sb3IgPSBnZXRWYWx1ZU9yRGVmYXVsdChwb2ludEdyYXBoaWNzLmNvbG9yLCB0aW1lLCBkZWZhdWx0Q29sb3IpO1xyXG4gICAgY29uc3Qgb3V0bGluZUNvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIHBvaW50R3JhcGhpY3Mub3V0bGluZUNvbG9yLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkZWZhdWx0T3V0bGluZUNvbG9yXHJcbiAgICApO1xyXG4gICAgY29uc3Qgb3V0bGluZVdpZHRoID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIHBvaW50R3JhcGhpY3Mub3V0bGluZVdpZHRoLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkZWZhdWx0T3V0bGluZVdpZHRoXHJcbiAgICApO1xyXG5cclxuICAgIGxldCBsYXllciA9IGRldGFpbHMubGF5ZXI7XHJcblxyXG4gICAgaWYgKCFpc0RlZmluZWQobGF5ZXIpKSB7XHJcbiAgICAgIGNvbnN0IHBvaW50T3B0aW9ucyA9IHtcclxuICAgICAgICByYWRpdXM6IHBpeGVsU2l6ZSAvIDIuMCxcclxuICAgICAgICBmaWxsQ29sb3I6IGNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKSxcclxuICAgICAgICBmaWxsT3BhY2l0eTogY29sb3IuYWxwaGEsXHJcbiAgICAgICAgY29sb3I6IG91dGxpbmVDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXHJcbiAgICAgICAgd2VpZ2h0OiBvdXRsaW5lV2lkdGgsXHJcbiAgICAgICAgb3BhY2l0eTogb3V0bGluZUNvbG9yLmFscGhhXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBsYXllciA9IGRldGFpbHMubGF5ZXIgPSBMLmNpcmNsZU1hcmtlcihcclxuICAgICAgICBwb3NpdGlvblRvTGF0TG5nKHBvc2l0aW9uLCBib3VuZHMpLFxyXG4gICAgICAgIHBvaW50T3B0aW9uc1xyXG4gICAgICApO1xyXG4gICAgICBsYXllci5vbihcImNsaWNrXCIsIGZlYXR1cmVDbGlja2VkLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcclxuICAgICAgbGF5ZXIub24oXCJtb3VzZWRvd25cIiwgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIGZlYXR1cmVHcm91cC5hZGRMYXllcihsYXllcik7XHJcblxyXG4gICAgICBDYXJ0ZXNpYW4zLmNsb25lKHBvc2l0aW9uLCBkZXRhaWxzLmxhc3RQb3NpdGlvbik7XHJcbiAgICAgIGRldGFpbHMubGFzdFBpeGVsU2l6ZSA9IHBpeGVsU2l6ZTtcclxuICAgICAgQ29sb3IuY2xvbmUoY29sb3IsIGRldGFpbHMubGFzdENvbG9yKTtcclxuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xyXG4gICAgICBkZXRhaWxzLmxhc3RPdXRsaW5lV2lkdGggPSBvdXRsaW5lV2lkdGg7XHJcblxyXG4gICAgICByZXR1cm4gbGF5ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKFxyXG4gICAgICAhQ2FydGVzaWFuMy5lcXVhbHMocG9zaXRpb24sIGRldGFpbHMubGFzdFBvc2l0aW9uKSB8fFxyXG4gICAgICBib3VuZHNKdXN0Q2hhbmdlZFxyXG4gICAgKSB7XHJcbiAgICAgIGxheWVyLnNldExhdExuZyhwb3NpdGlvblRvTGF0TG5nKHBvc2l0aW9uLCBib3VuZHMpKTtcclxuICAgICAgQ2FydGVzaWFuMy5jbG9uZShwb3NpdGlvbiwgZGV0YWlscy5sYXN0UG9zaXRpb24pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChwaXhlbFNpemUgIT09IGRldGFpbHMubGFzdFBpeGVsU2l6ZSkge1xyXG4gICAgICBsYXllci5zZXRSYWRpdXMocGl4ZWxTaXplIC8gMi4wKTtcclxuICAgICAgZGV0YWlscy5sYXN0UGl4ZWxTaXplID0gcGl4ZWxTaXplO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBsYXllci5vcHRpb25zO1xyXG4gICAgbGV0IGFwcGx5U3R5bGUgPSBmYWxzZTtcclxuXHJcbiAgICBpZiAoIUNvbG9yLmVxdWFscyhjb2xvciwgZGV0YWlscy5sYXN0Q29sb3IpKSB7XHJcbiAgICAgIG9wdGlvbnMuZmlsbENvbG9yID0gY29sb3IudG9Dc3NDb2xvclN0cmluZygpO1xyXG4gICAgICBvcHRpb25zLmZpbGxPcGFjaXR5ID0gY29sb3IuYWxwaGE7XHJcbiAgICAgIENvbG9yLmNsb25lKGNvbG9yLCBkZXRhaWxzLmxhc3RDb2xvcik7XHJcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghQ29sb3IuZXF1YWxzKG91dGxpbmVDb2xvciwgZGV0YWlscy5sYXN0T3V0bGluZUNvbG9yKSkge1xyXG4gICAgICBvcHRpb25zLmNvbG9yID0gb3V0bGluZUNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcclxuICAgICAgb3B0aW9ucy5vcGFjaXR5ID0gb3V0bGluZUNvbG9yLmFscGhhO1xyXG4gICAgICBDb2xvci5jbG9uZShvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcik7XHJcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChvdXRsaW5lV2lkdGggIT09IGRldGFpbHMubGFzdE91dGxpbmVXaWR0aCkge1xyXG4gICAgICBvcHRpb25zLndlaWdodCA9IG91dGxpbmVXaWR0aDtcclxuICAgICAgZGV0YWlscy5sYXN0T3V0bGluZVdpZHRoID0gb3V0bGluZVdpZHRoO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYXBwbHlTdHlsZSkge1xyXG4gICAgICBsYXllci5zZXRTdHlsZShvcHRpb25zKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwZGF0ZUJpbGxib2FyZChcclxuICAgIGVudGl0eTogRW50aXR5LFxyXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcclxuICAgIF9lbnRpdHlIYXNoOiBFbnRpdHlIYXNoLFxyXG4gICAgZW50aXR5RGV0YWlsczogRW50aXR5RGV0YWlscyxcclxuICAgIGJvdW5kczogTGF0TG5nQm91bmRzIHwgdW5kZWZpbmVkXHJcbiAgKSB7XHJcbiAgICBjb25zdCBtYXJrZXJHcmFwaGljcyA9IGVudGl0eS5iaWxsYm9hcmQhO1xyXG4gICAgY29uc3QgZmVhdHVyZUdyb3VwID0gdGhpcy5fZmVhdHVyZUdyb3VwO1xyXG4gICAgbGV0IHBvc2l0aW9uO1xyXG4gICAgbGV0IG1hcmtlcjogTC5NYXJrZXI7XHJcblxyXG4gICAgbGV0IGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLmJpbGxib2FyZDtcclxuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XHJcbiAgICAgIGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLmJpbGxib2FyZCA9IHtcclxuICAgICAgICBsYXllcjogdW5kZWZpbmVkXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZ2VvbUxheWVyID0gZGV0YWlscy5sYXllcjtcclxuXHJcbiAgICBsZXQgc2hvdyA9XHJcbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxyXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChtYXJrZXJHcmFwaGljcy5zaG93LCB0aW1lLCB0cnVlKTtcclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgIHBvc2l0aW9uID0gZ2V0VmFsdWVPclVuZGVmaW5lZChlbnRpdHkucG9zaXRpb24sIHRpbWUpO1xyXG4gICAgICBzaG93ID0gaXNEZWZpbmVkKHBvc2l0aW9uKTtcclxuICAgIH1cclxuICAgIGlmICghc2hvdykge1xyXG4gICAgICBjbGVhbkJpbGxib2FyZChlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBsYXRsbmcgPSBwb3NpdGlvblRvTGF0TG5nKHBvc2l0aW9uLCBib3VuZHMpO1xyXG4gICAgY29uc3QgaW1hZ2U6IGFueSA9IGdldFZhbHVlKG1hcmtlckdyYXBoaWNzLmltYWdlLCB0aW1lKTtcclxuICAgIGNvbnN0IGhlaWdodDogbnVtYmVyIHwgdW5kZWZpbmVkID0gZ2V0VmFsdWUobWFya2VyR3JhcGhpY3MuaGVpZ2h0LCB0aW1lKTtcclxuICAgIGNvbnN0IHdpZHRoOiBudW1iZXIgfCB1bmRlZmluZWQgPSBnZXRWYWx1ZShtYXJrZXJHcmFwaGljcy53aWR0aCwgdGltZSk7XHJcbiAgICBjb25zdCBjb2xvciA9IGdldFZhbHVlT3JEZWZhdWx0KG1hcmtlckdyYXBoaWNzLmNvbG9yLCB0aW1lLCBkZWZhdWx0Q29sb3IpO1xyXG4gICAgY29uc3Qgc2NhbGUgPSBnZXRWYWx1ZU9yRGVmYXVsdChtYXJrZXJHcmFwaGljcy5zY2FsZSwgdGltZSwgMS4wKTtcclxuICAgIGNvbnN0IHZlcnRpY2FsT3JpZ2luID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIG1hcmtlckdyYXBoaWNzLnZlcnRpY2FsT3JpZ2luLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICAwXHJcbiAgICApO1xyXG4gICAgY29uc3QgaG9yaXpvbnRhbE9yaWdpbiA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBtYXJrZXJHcmFwaGljcy5ob3Jpem9udGFsT3JpZ2luLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICAwXHJcbiAgICApO1xyXG4gICAgY29uc3QgcGl4ZWxPZmZzZXQgPSBnZXRWYWx1ZU9yRGVmYXVsdChcclxuICAgICAgbWFya2VyR3JhcGhpY3MucGl4ZWxPZmZzZXQsXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIENhcnRlc2lhbjIuWkVST1xyXG4gICAgKTtcclxuXHJcbiAgICBsZXQgaW1hZ2VVcmw6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICAgIGlmIChpc0RlZmluZWQoaW1hZ2UpKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgaW1hZ2UgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICBpbWFnZVVybCA9IGltYWdlO1xyXG4gICAgICB9IGVsc2UgaWYgKGlzRGVmaW5lZChpbWFnZS50b0RhdGFVUkwpKSB7XHJcbiAgICAgICAgaW1hZ2VVcmwgPSBpbWFnZS50b0RhdGFVUkwoKTtcclxuICAgICAgfSBlbHNlIGlmIChpc0RlZmluZWQoaW1hZ2UudXJsKSkge1xyXG4gICAgICAgIGltYWdlVXJsID0gaW1hZ2UudXJsO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGltYWdlVXJsID0gaW1hZ2Uuc3JjO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaWNvbk9wdGlvbnM6IGFueSA9IHtcclxuICAgICAgY29sb3I6IGNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKSxcclxuICAgICAgb3JpZ1VybDogaW1hZ2VVcmwsXHJcbiAgICAgIHNjYWxlOiBzY2FsZSxcclxuICAgICAgaG9yaXpvbnRhbE9yaWdpbjogaG9yaXpvbnRhbE9yaWdpbiwgLy92YWx1ZTogbGVmdCwgY2VudGVyLCByaWdodFxyXG4gICAgICB2ZXJ0aWNhbE9yaWdpbjogdmVydGljYWxPcmlnaW4gLy92YWx1ZTogYm90dG9tLCBjZW50ZXIsIHRvcFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoaXNEZWZpbmVkKGhlaWdodCkgfHwgaXNEZWZpbmVkKHdpZHRoKSkge1xyXG4gICAgICBpY29uT3B0aW9ucy5pY29uU2l6ZSA9IFt3aWR0aCwgaGVpZ2h0XTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcmVkcmF3SWNvbiA9IGZhbHNlO1xyXG4gICAgaWYgKCFpc0RlZmluZWQoZ2VvbUxheWVyKSkge1xyXG4gICAgICBjb25zdCBtYXJrZXJPcHRpb25zID0geyBpY29uOiBMLmljb24oeyBpY29uVXJsOiB0bXBJbWFnZSB9KSB9O1xyXG4gICAgICBtYXJrZXIgPSBMLm1hcmtlcihsYXRsbmcsIG1hcmtlck9wdGlvbnMpO1xyXG4gICAgICBtYXJrZXIub24oXCJjbGlja1wiLCBmZWF0dXJlQ2xpY2tlZC5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIG1hcmtlci5vbihcIm1vdXNlZG93blwiLCBmZWF0dXJlTW91c2Vkb3duLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcclxuICAgICAgZmVhdHVyZUdyb3VwLmFkZExheWVyKG1hcmtlcik7XHJcbiAgICAgIGRldGFpbHMubGF5ZXIgPSBtYXJrZXI7XHJcbiAgICAgIHJlZHJhd0ljb24gPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbWFya2VyID0gZ2VvbUxheWVyO1xyXG4gICAgICBpZiAoIW1hcmtlci5nZXRMYXRMbmcoKS5lcXVhbHMobGF0bG5nKSkge1xyXG4gICAgICAgIG1hcmtlci5zZXRMYXRMbmcobGF0bG5nKTtcclxuICAgICAgfVxyXG4gICAgICBmb3IgKGNvbnN0IHByb3AgaW4gaWNvbk9wdGlvbnMpIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICBpc0RlZmluZWQobWFya2VyLm9wdGlvbnMuaWNvbikgJiZcclxuICAgICAgICAgIGljb25PcHRpb25zW3Byb3BdICE9PSAobWFya2VyLm9wdGlvbnMuaWNvbi5vcHRpb25zIGFzIGFueSlbcHJvcF1cclxuICAgICAgICApIHtcclxuICAgICAgICAgIHJlZHJhd0ljb24gPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZHJhd0ljb24pIHtcclxuICAgICAgY29uc3QgcmVjb2xvck5lZWRlZCA9ICFjb2xvci5lcXVhbHMoZGVmYXVsdENvbG9yKTtcclxuICAgICAgY29uc3QgZHJhd0JpbGxib2FyZCA9IGZ1bmN0aW9uIChcclxuICAgICAgICBpbWFnZTogSFRNTEltYWdlRWxlbWVudCxcclxuICAgICAgICBkYXRhdXJsOiBzdHJpbmcgfCB1bmRlZmluZWRcclxuICAgICAgKSB7XHJcbiAgICAgICAgaWNvbk9wdGlvbnMuaWNvblVybCA9IGRhdGF1cmwgfHwgaW1hZ2U7XHJcbiAgICAgICAgaWYgKCFpc0RlZmluZWQoaWNvbk9wdGlvbnMuaWNvblNpemUpKSB7XHJcbiAgICAgICAgICBpY29uT3B0aW9ucy5pY29uU2l6ZSA9IFtpbWFnZS53aWR0aCAqIHNjYWxlLCBpbWFnZS5oZWlnaHQgKiBzY2FsZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHcgPSBpY29uT3B0aW9ucy5pY29uU2l6ZVswXSxcclxuICAgICAgICAgIGggPSBpY29uT3B0aW9ucy5pY29uU2l6ZVsxXTtcclxuICAgICAgICBjb25zdCB4T2ZmID0gKHcgLyAyKSAqICgxIC0gaG9yaXpvbnRhbE9yaWdpbikgLSBwaXhlbE9mZnNldC54O1xyXG4gICAgICAgIGNvbnN0IHlPZmYgPSAoaCAvIDIpICogKDEgKyB2ZXJ0aWNhbE9yaWdpbikgLSBwaXhlbE9mZnNldC55O1xyXG4gICAgICAgIGljb25PcHRpb25zLmljb25BbmNob3IgPSBbeE9mZiwgeU9mZl07XHJcblxyXG4gICAgICAgIGlmIChyZWNvbG9yTmVlZGVkKSB7XHJcbiAgICAgICAgICBpY29uT3B0aW9ucy5pY29uVXJsID0gcmVjb2xvckJpbGxib2FyZChpbWFnZSwgY29sb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtYXJrZXIuc2V0SWNvbihMLmljb24oaWNvbk9wdGlvbnMpKTtcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZHJhd0JpbGxib2FyZChpbWcsIGltYWdlVXJsKTtcclxuICAgICAgfTtcclxuICAgICAgaWYgKGlzRGVmaW5lZChpbWFnZVVybCkpIHtcclxuICAgICAgICBpbWcuc3JjID0gaW1hZ2VVcmw7XHJcbiAgICAgICAgaWYgKHJlY29sb3JOZWVkZWQpIHtcclxuICAgICAgICAgIGltZy5jcm9zc09yaWdpbiA9IFwiYW5vbnltb3VzXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF91cGRhdGVMYWJlbChcclxuICAgIGVudGl0eTogRW50aXR5LFxyXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcclxuICAgIF9lbnRpdHlIYXNoOiBFbnRpdHlIYXNoLFxyXG4gICAgZW50aXR5RGV0YWlsczogRW50aXR5RGV0YWlsc1xyXG4gICkge1xyXG4gICAgY29uc3QgbGFiZWxHcmFwaGljcyA9IGVudGl0eS5sYWJlbCE7XHJcbiAgICBjb25zdCBmZWF0dXJlR3JvdXAgPSB0aGlzLl9mZWF0dXJlR3JvdXA7XHJcbiAgICBsZXQgcG9zaXRpb247XHJcbiAgICBsZXQgbWFya2VyOiBMLk1hcmtlcjtcclxuXHJcbiAgICBsZXQgZGV0YWlscyA9IGVudGl0eURldGFpbHMubGFiZWw7XHJcbiAgICBpZiAoIWlzRGVmaW5lZChkZXRhaWxzKSkge1xyXG4gICAgICBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5sYWJlbCA9IHtcclxuICAgICAgICBsYXllcjogdW5kZWZpbmVkXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZ2VvbUxheWVyID0gZGV0YWlscy5sYXllcjtcclxuXHJcbiAgICBsZXQgc2hvdyA9XHJcbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxyXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChsYWJlbEdyYXBoaWNzLnNob3csIHRpbWUsIHRydWUpO1xyXG4gICAgaWYgKHNob3cpIHtcclxuICAgICAgcG9zaXRpb24gPSBnZXRWYWx1ZU9yVW5kZWZpbmVkKGVudGl0eS5wb3NpdGlvbiwgdGltZSk7XHJcbiAgICAgIHNob3cgPSBpc0RlZmluZWQocG9zaXRpb24pO1xyXG4gICAgfVxyXG4gICAgaWYgKCFzaG93KSB7XHJcbiAgICAgIGNsZWFuTGFiZWwoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FydCA9IEVsbGlwc29pZC5XR1M4NC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhwb3NpdGlvbik7XHJcbiAgICBjb25zdCBsYXRsbmcgPSBMLmxhdExuZyhcclxuICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydC5sYXRpdHVkZSksXHJcbiAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnQubG9uZ2l0dWRlKVxyXG4gICAgKTtcclxuICAgIGNvbnN0IHRleHQgPSBnZXRWYWx1ZTxzdHJpbmc+KGxhYmVsR3JhcGhpY3MudGV4dCwgdGltZSk7XHJcbiAgICBjb25zdCBmb250ID0gZ2V0VmFsdWU8c3RyaW5nPihsYWJlbEdyYXBoaWNzLmZvbnQsIHRpbWUpO1xyXG4gICAgY29uc3Qgc2NhbGUgPSBnZXRWYWx1ZU9yRGVmYXVsdChsYWJlbEdyYXBoaWNzLnNjYWxlLCB0aW1lLCAxLjApO1xyXG4gICAgY29uc3QgZmlsbENvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIGxhYmVsR3JhcGhpY3MuZmlsbENvbG9yLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkZWZhdWx0Q29sb3JcclxuICAgICk7XHJcbiAgICBjb25zdCB2ZXJ0aWNhbE9yaWdpbiA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBsYWJlbEdyYXBoaWNzLnZlcnRpY2FsT3JpZ2luLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICAwXHJcbiAgICApO1xyXG4gICAgY29uc3QgaG9yaXpvbnRhbE9yaWdpbiA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBsYWJlbEdyYXBoaWNzLmhvcml6b250YWxPcmlnaW4sXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIDBcclxuICAgICk7XHJcbiAgICBjb25zdCBwaXhlbE9mZnNldCA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBsYWJlbEdyYXBoaWNzLnBpeGVsT2Zmc2V0LFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBDYXJ0ZXNpYW4yLlpFUk9cclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgaWNvbk9wdGlvbnM6IGFueSA9IHtcclxuICAgICAgdGV4dDogdGV4dCxcclxuICAgICAgZm9udDogZm9udCxcclxuICAgICAgY29sb3I6IGZpbGxDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXHJcbiAgICAgIHNjYWxlOiBzY2FsZSxcclxuICAgICAgaG9yaXpvbnRhbE9yaWdpbjogaG9yaXpvbnRhbE9yaWdpbiwgLy92YWx1ZTogbGVmdCwgY2VudGVyLCByaWdodFxyXG4gICAgICB2ZXJ0aWNhbE9yaWdpbjogdmVydGljYWxPcmlnaW4gLy92YWx1ZTogYm90dG9tLCBjZW50ZXIsIHRvcFxyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgcmVkcmF3TGFiZWwgPSBmYWxzZTtcclxuICAgIGlmICghaXNEZWZpbmVkKGdlb21MYXllcikpIHtcclxuICAgICAgY29uc3QgbWFya2VyT3B0aW9ucyA9IHsgaWNvbjogTC5pY29uKHsgaWNvblVybDogdG1wSW1hZ2UgfSkgfTtcclxuICAgICAgbWFya2VyID0gTC5tYXJrZXIobGF0bG5nLCBtYXJrZXJPcHRpb25zKTtcclxuICAgICAgbWFya2VyLm9uKFwiY2xpY2tcIiwgZmVhdHVyZUNsaWNrZWQuYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xyXG4gICAgICBtYXJrZXIub24oXCJtb3VzZWRvd25cIiwgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIGZlYXR1cmVHcm91cC5hZGRMYXllcihtYXJrZXIpO1xyXG4gICAgICBkZXRhaWxzLmxheWVyID0gbWFya2VyO1xyXG4gICAgICByZWRyYXdMYWJlbCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBtYXJrZXIgPSBnZW9tTGF5ZXI7XHJcbiAgICAgIGlmICghbWFya2VyLmdldExhdExuZygpLmVxdWFscyhsYXRsbmcpKSB7XHJcbiAgICAgICAgbWFya2VyLnNldExhdExuZyhsYXRsbmcpO1xyXG4gICAgICB9XHJcbiAgICAgIGZvciAoY29uc3QgcHJvcCBpbiBpY29uT3B0aW9ucykge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIGlzRGVmaW5lZChtYXJrZXIub3B0aW9ucy5pY29uKSAmJlxyXG4gICAgICAgICAgaWNvbk9wdGlvbnNbcHJvcF0gIT09IChtYXJrZXIub3B0aW9ucy5pY29uLm9wdGlvbnMgYXMgYW55KVtwcm9wXVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgcmVkcmF3TGFiZWwgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZHJhd0xhYmVsICYmIGlzRGVmaW5lZCh0ZXh0KSkge1xyXG4gICAgICBjb25zdCBkcmF3QmlsbGJvYXJkID0gZnVuY3Rpb24gKFxyXG4gICAgICAgIGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50LFxyXG4gICAgICAgIGRhdGF1cmw6IHN0cmluZ1xyXG4gICAgICApIHtcclxuICAgICAgICBpY29uT3B0aW9ucy5pY29uVXJsID0gZGF0YXVybCB8fCBpbWFnZTtcclxuICAgICAgICBpZiAoIWlzRGVmaW5lZChpY29uT3B0aW9ucy5pY29uU2l6ZSkpIHtcclxuICAgICAgICAgIGljb25PcHRpb25zLmljb25TaXplID0gW2ltYWdlLndpZHRoICogc2NhbGUsIGltYWdlLmhlaWdodCAqIHNjYWxlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdyA9IGljb25PcHRpb25zLmljb25TaXplWzBdLFxyXG4gICAgICAgICAgaCA9IGljb25PcHRpb25zLmljb25TaXplWzFdO1xyXG4gICAgICAgIGNvbnN0IHhPZmYgPSAodyAvIDIpICogKDEgLSBob3Jpem9udGFsT3JpZ2luKSAtIHBpeGVsT2Zmc2V0Lng7XHJcbiAgICAgICAgY29uc3QgeU9mZiA9IChoIC8gMikgKiAoMSArIHZlcnRpY2FsT3JpZ2luKSAtIHBpeGVsT2Zmc2V0Lnk7XHJcbiAgICAgICAgaWNvbk9wdGlvbnMuaWNvbkFuY2hvciA9IFt4T2ZmLCB5T2ZmXTtcclxuICAgICAgICBtYXJrZXIuc2V0SWNvbihMLmljb24oaWNvbk9wdGlvbnMpKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IGNhbnZhcyA9IHdyaXRlVGV4dFRvQ2FudmFzKHRleHQsIHtcclxuICAgICAgICBmaWxsQ29sb3I6IGZpbGxDb2xvcixcclxuICAgICAgICBmb250OiBmb250XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAoaXNEZWZpbmVkKGNhbnZhcykpIHtcclxuICAgICAgICBjb25zdCBpbWFnZVVybCA9IGNhbnZhcy50b0RhdGFVUkwoKTtcclxuXHJcbiAgICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIGRyYXdCaWxsYm9hcmQoaW1nLCBpbWFnZVVybCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpbWcuc3JjID0gaW1hZ2VVcmw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwZGF0ZVJlY3RhbmdsZShcclxuICAgIGVudGl0eTogRW50aXR5LFxyXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcclxuICAgIF9lbnRpdHlIYXNoOiBFbnRpdHlIYXNoLFxyXG4gICAgZW50aXR5RGV0YWlsczogRW50aXR5RGV0YWlsc1xyXG4gICkge1xyXG4gICAgY29uc3QgZmVhdHVyZUdyb3VwID0gdGhpcy5fZmVhdHVyZUdyb3VwO1xyXG4gICAgY29uc3QgcmVjdGFuZ2xlR3JhcGhpY3MgPSBlbnRpdHkucmVjdGFuZ2xlO1xyXG5cclxuICAgIGlmICghaXNEZWZpbmVkKHJlY3RhbmdsZUdyYXBoaWNzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc2hvdyA9XHJcbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxyXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChyZWN0YW5nbGVHcmFwaGljcy5zaG93LCB0aW1lLCB0cnVlKTtcclxuXHJcbiAgICBjb25zdCByZWN0YW5nbGVDb29yZGluYXRlcyA9IHJlY3RhbmdsZUdyYXBoaWNzLmNvb3JkaW5hdGVzPy5nZXRWYWx1ZShcclxuICAgICAgdGltZVxyXG4gICAgKSBhcyBSZWN0YW5nbGU7XHJcblxyXG4gICAgaWYgKCFzaG93IHx8ICFpc0RlZmluZWQocmVjdGFuZ2xlQ29vcmRpbmF0ZXMpKSB7XHJcbiAgICAgIGNsZWFuUmVjdGFuZ2xlKGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHJlY3RhbmdsZUJvdW5kczogTGF0TG5nQm91bmRzTGl0ZXJhbCA9IFtcclxuICAgICAgW1xyXG4gICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKHJlY3RhbmdsZUNvb3JkaW5hdGVzLnNvdXRoKSxcclxuICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhyZWN0YW5nbGVDb29yZGluYXRlcy53ZXN0KVxyXG4gICAgICBdLFxyXG4gICAgICBbXHJcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlQ29vcmRpbmF0ZXMubm9ydGgpLFxyXG4gICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKHJlY3RhbmdsZUNvb3JkaW5hdGVzLmVhc3QpXHJcbiAgICAgIF1cclxuICAgIF07XHJcblxyXG4gICAgbGV0IGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLnJlY3RhbmdsZTtcclxuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XHJcbiAgICAgIGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLnJlY3RhbmdsZSA9IHtcclxuICAgICAgICBsYXllcjogdW5kZWZpbmVkLFxyXG4gICAgICAgIGxhc3RGaWxsOiB1bmRlZmluZWQsXHJcbiAgICAgICAgbGFzdEZpbGxDb2xvcjogbmV3IENvbG9yKCksXHJcbiAgICAgICAgbGFzdE91dGxpbmU6IHVuZGVmaW5lZCxcclxuICAgICAgICBsYXN0T3V0bGluZUNvbG9yOiBuZXcgQ29sb3IoKVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gICAgY29uc3QgZmlsbCA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICByZWN0YW5nbGVHcmFwaGljcy5maWxsIGFzIHVua25vd24gYXMgUHJvcGVydHksXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIHRydWVcclxuICAgICk7XHJcbiAgICBjb25zdCBvdXRsaW5lID0gZ2V0VmFsdWVPckRlZmF1bHQocmVjdGFuZ2xlR3JhcGhpY3Mub3V0bGluZSwgdGltZSwgdHJ1ZSk7XHJcbiAgICBsZXQgZGFzaEFycmF5O1xyXG4gICAgaWYgKHJlY3RhbmdsZUdyYXBoaWNzLm91dGxpbmUgaW5zdGFuY2VvZiBQb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5KSB7XHJcbiAgICAgIGRhc2hBcnJheSA9IGdldERhc2hBcnJheShyZWN0YW5nbGVHcmFwaGljcy5vdXRsaW5lLCB0aW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvdXRsaW5lV2lkdGggPSBnZXRWYWx1ZU9yRGVmYXVsdChcclxuICAgICAgcmVjdGFuZ2xlR3JhcGhpY3Mub3V0bGluZVdpZHRoIGFzIHVua25vd24gYXMgUHJvcGVydHksXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIGRlZmF1bHRPdXRsaW5lV2lkdGhcclxuICAgICk7XHJcblxyXG4gICAgY29uc3Qgb3V0bGluZUNvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIHJlY3RhbmdsZUdyYXBoaWNzLm91dGxpbmVDb2xvciBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkZWZhdWx0T3V0bGluZUNvbG9yXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IG1hdGVyaWFsID0gZ2V0VmFsdWVPclVuZGVmaW5lZChcclxuICAgICAgcmVjdGFuZ2xlR3JhcGhpY3MubWF0ZXJpYWwgYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcclxuICAgICAgdGltZVxyXG4gICAgKTtcclxuICAgIGxldCBmaWxsQ29sb3I7XHJcbiAgICBpZiAoaXNEZWZpbmVkKG1hdGVyaWFsKSAmJiBpc0RlZmluZWQobWF0ZXJpYWwuY29sb3IpKSB7XHJcbiAgICAgIGZpbGxDb2xvciA9IG1hdGVyaWFsLmNvbG9yO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZmlsbENvbG9yID0gZGVmYXVsdENvbG9yO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBsYXllciA9IGRldGFpbHMubGF5ZXI7XHJcbiAgICBpZiAoIWlzRGVmaW5lZChsYXllcikpIHtcclxuICAgICAgY29uc3QgcG9seWdvbk9wdGlvbnM6IFBvbHlsaW5lT3B0aW9ucyA9IHtcclxuICAgICAgICBmaWxsOiBmaWxsLFxyXG4gICAgICAgIGZpbGxDb2xvcjogZmlsbENvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKSxcclxuICAgICAgICBmaWxsT3BhY2l0eTogZmlsbENvbG9yLmFscGhhLFxyXG4gICAgICAgIHdlaWdodDogb3V0bGluZSA/IG91dGxpbmVXaWR0aCA6IDAuMCxcclxuICAgICAgICBjb2xvcjogb3V0bGluZUNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKSxcclxuICAgICAgICBvcGFjaXR5OiBvdXRsaW5lQ29sb3IuYWxwaGFcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGlmIChvdXRsaW5lICYmIGRhc2hBcnJheSkge1xyXG4gICAgICAgIHBvbHlnb25PcHRpb25zLmRhc2hBcnJheSA9IGRhc2hBcnJheVxyXG4gICAgICAgICAgLm1hcCgoeCkgPT4geCAqIG91dGxpbmVXaWR0aClcclxuICAgICAgICAgIC5qb2luKFwiLFwiKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgbGF5ZXIgPSBkZXRhaWxzLmxheWVyID0gTC5yZWN0YW5nbGUocmVjdGFuZ2xlQm91bmRzLCBwb2x5Z29uT3B0aW9ucyk7XHJcblxyXG4gICAgICBsYXllci5vbihcImNsaWNrXCIsIGZlYXR1cmVDbGlja2VkLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcclxuICAgICAgbGF5ZXIub24oXCJtb3VzZWRvd25cIiwgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIGZlYXR1cmVHcm91cC5hZGRMYXllcihsYXllcik7XHJcblxyXG4gICAgICBkZXRhaWxzLmxhc3RGaWxsID0gZmlsbDtcclxuICAgICAgZGV0YWlscy5sYXN0T3V0bGluZSA9IG91dGxpbmU7XHJcbiAgICAgIENvbG9yLmNsb25lKGZpbGxDb2xvciwgZGV0YWlscy5sYXN0RmlsbENvbG9yKTtcclxuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xyXG5cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBsYXllci5vcHRpb25zO1xyXG4gICAgbGV0IGFwcGx5U3R5bGUgPSBmYWxzZTtcclxuXHJcbiAgICBpZiAoZmlsbCAhPT0gZGV0YWlscy5sYXN0RmlsbCkge1xyXG4gICAgICBvcHRpb25zLmZpbGwgPSBmaWxsO1xyXG4gICAgICBkZXRhaWxzLmxhc3RGaWxsID0gZmlsbDtcclxuICAgICAgYXBwbHlTdHlsZSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG91dGxpbmUgIT09IGRldGFpbHMubGFzdE91dGxpbmUpIHtcclxuICAgICAgb3B0aW9ucy53ZWlnaHQgPSBvdXRsaW5lID8gb3V0bGluZVdpZHRoIDogMC4wO1xyXG4gICAgICBkZXRhaWxzLmxhc3RPdXRsaW5lID0gb3V0bGluZTtcclxuICAgICAgYXBwbHlTdHlsZSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFDb2xvci5lcXVhbHMoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpKSB7XHJcbiAgICAgIG9wdGlvbnMuZmlsbENvbG9yID0gZmlsbENvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcclxuICAgICAgb3B0aW9ucy5maWxsT3BhY2l0eSA9IGZpbGxDb2xvci5hbHBoYTtcclxuICAgICAgQ29sb3IuY2xvbmUoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIUNvbG9yLmVxdWFscyhvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcikpIHtcclxuICAgICAgb3B0aW9ucy5jb2xvciA9IG91dGxpbmVDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCk7XHJcbiAgICAgIG9wdGlvbnMub3BhY2l0eSA9IG91dGxpbmVDb2xvci5hbHBoYTtcclxuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWxheWVyLmdldEJvdW5kcygpLmVxdWFscyhyZWN0YW5nbGVCb3VuZHMpKSB7XHJcbiAgICAgIGxheWVyLnNldEJvdW5kcyhyZWN0YW5nbGVCb3VuZHMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhcHBseVN0eWxlKSB7XHJcbiAgICAgIGxheWVyLnNldFN0eWxlKG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdXBkYXRlUG9seWdvbihcclxuICAgIGVudGl0eTogRW50aXR5LFxyXG4gICAgdGltZTogSnVsaWFuRGF0ZSxcclxuICAgIF9lbnRpdHlIYXNoOiBFbnRpdHlIYXNoLFxyXG4gICAgZW50aXR5RGV0YWlsczogRW50aXR5RGV0YWlsc1xyXG4gICkge1xyXG4gICAgY29uc3QgZmVhdHVyZUdyb3VwID0gdGhpcy5fZmVhdHVyZUdyb3VwO1xyXG4gICAgY29uc3QgcG9seWdvbkdyYXBoaWNzID0gZW50aXR5LnBvbHlnb24hO1xyXG5cclxuICAgIGNvbnN0IHNob3cgPVxyXG4gICAgICBlbnRpdHkuaXNBdmFpbGFibGUodGltZSkgJiZcclxuICAgICAgZ2V0VmFsdWVPckRlZmF1bHQocG9seWdvbkdyYXBoaWNzLnNob3csIHRpbWUsIHRydWUpO1xyXG4gICAgaWYgKCFzaG93KSB7XHJcbiAgICAgIGNsZWFuUG9seWdvbihlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9seWdvbjtcclxuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XHJcbiAgICAgIGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLnBvbHlnb24gPSB7XHJcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZCxcclxuICAgICAgICBsYXN0SGllcmFyY2h5OiB1bmRlZmluZWQsXHJcbiAgICAgICAgbGFzdEZpbGw6IHVuZGVmaW5lZCxcclxuICAgICAgICBsYXN0RmlsbENvbG9yOiBuZXcgQ29sb3IoKSxcclxuICAgICAgICBsYXN0T3V0bGluZTogdW5kZWZpbmVkLFxyXG4gICAgICAgIGxhc3RPdXRsaW5lQ29sb3I6IG5ldyBDb2xvcigpXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaGllcmFyY2h5ID0gZ2V0VmFsdWVPclVuZGVmaW5lZChwb2x5Z29uR3JhcGhpY3MuaGllcmFyY2h5LCB0aW1lKTtcclxuICAgIGlmICghaXNEZWZpbmVkKGhpZXJhcmNoeSkpIHtcclxuICAgICAgY2xlYW5Qb2x5Z29uKGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZpbGwgPSBnZXRWYWx1ZU9yRGVmYXVsdChcclxuICAgICAgcG9seWdvbkdyYXBoaWNzLmZpbGwgYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcclxuICAgICAgdGltZSxcclxuICAgICAgdHJ1ZVxyXG4gICAgKTtcclxuICAgIGNvbnN0IG91dGxpbmUgPSBnZXRWYWx1ZU9yRGVmYXVsdChwb2x5Z29uR3JhcGhpY3Mub3V0bGluZSwgdGltZSwgdHJ1ZSk7XHJcbiAgICBsZXQgZGFzaEFycmF5O1xyXG4gICAgaWYgKHBvbHlnb25HcmFwaGljcy5vdXRsaW5lIGluc3RhbmNlb2YgUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSkge1xyXG4gICAgICBkYXNoQXJyYXkgPSBnZXREYXNoQXJyYXkocG9seWdvbkdyYXBoaWNzLm91dGxpbmUsIHRpbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG91dGxpbmVXaWR0aCA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBwb2x5Z29uR3JhcGhpY3Mub3V0bGluZVdpZHRoIGFzIHVua25vd24gYXMgUHJvcGVydHksXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIGRlZmF1bHRPdXRsaW5lV2lkdGhcclxuICAgICk7XHJcblxyXG4gICAgY29uc3Qgb3V0bGluZUNvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIHBvbHlnb25HcmFwaGljcy5vdXRsaW5lQ29sb3IgYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcclxuICAgICAgdGltZSxcclxuICAgICAgZGVmYXVsdE91dGxpbmVDb2xvclxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBtYXRlcmlhbCA9IGdldFZhbHVlT3JVbmRlZmluZWQoXHJcbiAgICAgIHBvbHlnb25HcmFwaGljcy5tYXRlcmlhbCBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxyXG4gICAgICB0aW1lXHJcbiAgICApO1xyXG4gICAgbGV0IGZpbGxDb2xvcjtcclxuICAgIGlmIChpc0RlZmluZWQobWF0ZXJpYWwpICYmIGlzRGVmaW5lZChtYXRlcmlhbC5jb2xvcikpIHtcclxuICAgICAgZmlsbENvbG9yID0gbWF0ZXJpYWwuY29sb3I7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmaWxsQ29sb3IgPSBkZWZhdWx0Q29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGxheWVyID0gZGV0YWlscy5sYXllcjtcclxuICAgIGlmICghaXNEZWZpbmVkKGxheWVyKSkge1xyXG4gICAgICBjb25zdCBwb2x5Z29uT3B0aW9uczogUG9seWxpbmVPcHRpb25zID0ge1xyXG4gICAgICAgIGZpbGw6IGZpbGwsXHJcbiAgICAgICAgZmlsbENvbG9yOiBmaWxsQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxyXG4gICAgICAgIGZpbGxPcGFjaXR5OiBmaWxsQ29sb3IuYWxwaGEsXHJcbiAgICAgICAgd2VpZ2h0OiBvdXRsaW5lID8gb3V0bGluZVdpZHRoIDogMC4wLFxyXG4gICAgICAgIGNvbG9yOiBvdXRsaW5lQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxyXG4gICAgICAgIG9wYWNpdHk6IG91dGxpbmVDb2xvci5hbHBoYVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWYgKG91dGxpbmUgJiYgZGFzaEFycmF5KSB7XHJcbiAgICAgICAgcG9seWdvbk9wdGlvbnMuZGFzaEFycmF5ID0gZGFzaEFycmF5XHJcbiAgICAgICAgICAubWFwKCh4KSA9PiB4ICogb3V0bGluZVdpZHRoKVxyXG4gICAgICAgICAgLmpvaW4oXCIsXCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsYXllciA9IGRldGFpbHMubGF5ZXIgPSBMLnBvbHlnb24oXHJcbiAgICAgICAgaGllcmFyY2h5VG9MYXRMbmdzKGhpZXJhcmNoeSksXHJcbiAgICAgICAgcG9seWdvbk9wdGlvbnNcclxuICAgICAgKTtcclxuICAgICAgbGF5ZXIub24oXCJjbGlja1wiLCBmZWF0dXJlQ2xpY2tlZC5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIGxheWVyLm9uKFwibW91c2Vkb3duXCIsIGZlYXR1cmVNb3VzZWRvd24uYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xyXG4gICAgICBmZWF0dXJlR3JvdXAuYWRkTGF5ZXIobGF5ZXIpO1xyXG5cclxuICAgICAgZGV0YWlscy5sYXN0SGllcmFyY2h5ID0gaGllcmFyY2h5O1xyXG4gICAgICBkZXRhaWxzLmxhc3RGaWxsID0gZmlsbDtcclxuICAgICAgZGV0YWlscy5sYXN0T3V0bGluZSA9IG91dGxpbmU7XHJcbiAgICAgIENvbG9yLmNsb25lKGZpbGxDb2xvciwgZGV0YWlscy5sYXN0RmlsbENvbG9yKTtcclxuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xyXG5cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChoaWVyYXJjaHkgIT09IGRldGFpbHMubGFzdEhpZXJhcmNoeSkge1xyXG4gICAgICBsYXllci5zZXRMYXRMbmdzKGhpZXJhcmNoeVRvTGF0TG5ncyhoaWVyYXJjaHkpKTtcclxuICAgICAgZGV0YWlscy5sYXN0SGllcmFyY2h5ID0gaGllcmFyY2h5O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9wdGlvbnMgPSBsYXllci5vcHRpb25zO1xyXG4gICAgbGV0IGFwcGx5U3R5bGUgPSBmYWxzZTtcclxuXHJcbiAgICBpZiAoZmlsbCAhPT0gZGV0YWlscy5sYXN0RmlsbCkge1xyXG4gICAgICBvcHRpb25zLmZpbGwgPSBmaWxsO1xyXG4gICAgICBkZXRhaWxzLmxhc3RGaWxsID0gZmlsbDtcclxuICAgICAgYXBwbHlTdHlsZSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG91dGxpbmUgIT09IGRldGFpbHMubGFzdE91dGxpbmUpIHtcclxuICAgICAgb3B0aW9ucy53ZWlnaHQgPSBvdXRsaW5lID8gb3V0bGluZVdpZHRoIDogMC4wO1xyXG4gICAgICBkZXRhaWxzLmxhc3RPdXRsaW5lID0gb3V0bGluZTtcclxuICAgICAgYXBwbHlTdHlsZSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFDb2xvci5lcXVhbHMoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpKSB7XHJcbiAgICAgIG9wdGlvbnMuZmlsbENvbG9yID0gZmlsbENvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcclxuICAgICAgb3B0aW9ucy5maWxsT3BhY2l0eSA9IGZpbGxDb2xvci5hbHBoYTtcclxuICAgICAgQ29sb3IuY2xvbmUoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIUNvbG9yLmVxdWFscyhvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcikpIHtcclxuICAgICAgb3B0aW9ucy5jb2xvciA9IG91dGxpbmVDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCk7XHJcbiAgICAgIG9wdGlvbnMub3BhY2l0eSA9IG91dGxpbmVDb2xvci5hbHBoYTtcclxuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYXBwbHlTdHlsZSkge1xyXG4gICAgICBsYXllci5zZXRTdHlsZShvcHRpb25zKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwZGF0ZVBvbHlsaW5lKFxyXG4gICAgZW50aXR5OiBFbnRpdHksXHJcbiAgICB0aW1lOiBKdWxpYW5EYXRlLFxyXG4gICAgX2VudGl0eUhhc2g6IEVudGl0eUhhc2gsXHJcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbiAgKSB7XHJcbiAgICBjb25zdCBwb2x5bGluZUdyYXBoaWNzID0gZW50aXR5LnBvbHlsaW5lITtcclxuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcclxuICAgIGxldCBwb3NpdGlvbnMsIHBvbHlsaW5lO1xyXG5cclxuICAgIGxldCBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5wb2x5bGluZTtcclxuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XHJcbiAgICAgIGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLnBvbHlsaW5lID0ge1xyXG4gICAgICAgIGxheWVyOiB1bmRlZmluZWRcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBnZW9tTGF5ZXIgPSBkZXRhaWxzLmxheWVyO1xyXG5cclxuICAgIGxldCBzaG93ID1cclxuICAgICAgZW50aXR5LmlzQXZhaWxhYmxlKHRpbWUpICYmXHJcbiAgICAgIGdldFZhbHVlT3JEZWZhdWx0KHBvbHlsaW5lR3JhcGhpY3Muc2hvdywgdGltZSwgdHJ1ZSk7XHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICBwb3NpdGlvbnMgPSBnZXRWYWx1ZU9yVW5kZWZpbmVkKHBvbHlsaW5lR3JhcGhpY3MucG9zaXRpb25zLCB0aW1lKTtcclxuICAgICAgc2hvdyA9IGlzRGVmaW5lZChwb3NpdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFzaG93KSB7XHJcbiAgICAgIGNsZWFuUG9seWxpbmUoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2FydHMgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuQXJyYXlUb0NhcnRvZ3JhcGhpY0FycmF5KHBvc2l0aW9ucyk7XHJcbiAgICBjb25zdCBsYXRsbmdzID0gW107XHJcbiAgICBmb3IgKGxldCBwID0gMDsgcCA8IGNhcnRzLmxlbmd0aDsgcCsrKSB7XHJcbiAgICAgIGxhdGxuZ3MucHVzaChcclxuICAgICAgICBMLmxhdExuZyhcclxuICAgICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRzW3BdLmxhdGl0dWRlKSxcclxuICAgICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRzW3BdLmxvbmdpdHVkZSlcclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGNvbG9yO1xyXG4gICAgbGV0IGRhc2hBcnJheTogbnVtYmVyW10gfCB1bmRlZmluZWQ7XHJcbiAgICBsZXQgd2lkdGg6IG51bWJlcjtcclxuICAgIGlmIChwb2x5bGluZUdyYXBoaWNzLm1hdGVyaWFsIGluc3RhbmNlb2YgUG9seWxpbmVHbG93TWF0ZXJpYWxQcm9wZXJ0eSkge1xyXG4gICAgICBjb2xvciA9IGRlZmF1bHRDb2xvcjtcclxuICAgICAgd2lkdGggPSBkZWZhdWx0V2lkdGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBtYXRlcmlhbCA9IHBvbHlsaW5lR3JhcGhpY3MubWF0ZXJpYWwuZ2V0VmFsdWUodGltZSk7XHJcbiAgICAgIGlmIChpc0RlZmluZWQobWF0ZXJpYWwpKSB7XHJcbiAgICAgICAgY29sb3IgPSBtYXRlcmlhbC5jb2xvcjtcclxuICAgICAgfVxyXG4gICAgICBjb2xvciA9IGNvbG9yIHx8IGRlZmF1bHRDb2xvcjtcclxuICAgICAgd2lkdGggPSBnZXRWYWx1ZU9yRGVmYXVsdChcclxuICAgICAgICBwb2x5bGluZUdyYXBoaWNzLndpZHRoIGFzIHVua25vd24gYXMgUHJvcGVydHksXHJcbiAgICAgICAgdGltZSxcclxuICAgICAgICBkZWZhdWx0V2lkdGhcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIGlmIChwb2x5bGluZUdyYXBoaWNzLm1hdGVyaWFsIGluc3RhbmNlb2YgUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSkge1xyXG4gICAgICBkYXNoQXJyYXkgPSBnZXREYXNoQXJyYXkocG9seWxpbmVHcmFwaGljcy5tYXRlcmlhbCwgdGltZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcG9seWxpbmVPcHRpb25zOiBQb2x5bGluZU9wdGlvbnMgPSB7XHJcbiAgICAgIGNvbG9yOiBjb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXHJcbiAgICAgIHdlaWdodDogd2lkdGgsXHJcbiAgICAgIG9wYWNpdHk6IGNvbG9yLmFscGhhXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChkYXNoQXJyYXkpIHtcclxuICAgICAgcG9seWxpbmVPcHRpb25zLmRhc2hBcnJheSA9IGRhc2hBcnJheS5tYXAoKHgpID0+IHggKiB3aWR0aCkuam9pbihcIixcIik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFpc0RlZmluZWQoZ2VvbUxheWVyKSkge1xyXG4gICAgICBpZiAobGF0bG5ncy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcG9seWxpbmUgPSBMLnBvbHlsaW5lKGxhdGxuZ3MsIHBvbHlsaW5lT3B0aW9ucyk7XHJcbiAgICAgICAgcG9seWxpbmUub24oXCJjbGlja1wiLCBmZWF0dXJlQ2xpY2tlZC5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgICAgcG9seWxpbmUub24oXHJcbiAgICAgICAgICBcIm1vdXNlZG93blwiLFxyXG4gICAgICAgICAgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgZmVhdHVyZUdyb3VwLmFkZExheWVyKHBvbHlsaW5lKTtcclxuICAgICAgICBkZXRhaWxzLmxheWVyID0gcG9seWxpbmU7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBvbHlsaW5lID0gZ2VvbUxheWVyO1xyXG4gICAgICBjb25zdCBjdXJMYXRMbmdzID0gcG9seWxpbmUuZ2V0TGF0TG5ncygpO1xyXG4gICAgICBsZXQgYlBvc0NoYW5nZSA9IGxhdGxuZ3MubGVuZ3RoICE9PSBjdXJMYXRMbmdzLmxlbmd0aDtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjdXJMYXRMbmdzLmxlbmd0aCAmJiAhYlBvc0NoYW5nZTsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgbGF0bG5nID0gY3VyTGF0TG5nc1tpXTtcclxuICAgICAgICBpZiAobGF0bG5nIGluc3RhbmNlb2YgTC5MYXRMbmcgJiYgIWxhdGxuZy5lcXVhbHMobGF0bG5nc1tpXSkpIHtcclxuICAgICAgICAgIGJQb3NDaGFuZ2UgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAoYlBvc0NoYW5nZSkge1xyXG4gICAgICAgIHBvbHlsaW5lLnNldExhdExuZ3MobGF0bG5ncyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoY29uc3QgcHJvcCBpbiBwb2x5bGluZU9wdGlvbnMpIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAocG9seWxpbmVPcHRpb25zIGFzIGFueSlbcHJvcF0gIT09IChwb2x5bGluZS5vcHRpb25zIGFzIGFueSlbcHJvcF1cclxuICAgICAgICApIHtcclxuICAgICAgICAgIHBvbHlsaW5lLnNldFN0eWxlKHBvbHlsaW5lT3B0aW9ucyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIG9iamVjdCB3YXMgZGVzdHJveWVkOyBvdGhlcndpc2UsIGZhbHNlLlxyXG4gICAqXHJcbiAgICovXHJcbiAgaXNEZXN0cm95ZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmVzIGFuZCBkZXN0cm95cyBhbGwgcHJpbWl0aXZlcyBjcmVhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuXHJcbiAgICovXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5fZW50aXRpZXNUb1Zpc3VhbGl6ZS52YWx1ZXM7XHJcbiAgICBjb25zdCBlbnRpdHlIYXNoID0gdGhpcy5fZW50aXR5SGFzaDtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gZW50aXRpZXMubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHtcclxuICAgICAgY2xlYW5FbnRpdHkoZW50aXRpZXNbaV0sIHRoaXMuX2ZlYXR1cmVHcm91cCwgZW50aXR5SGFzaCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNvbGxlY3Rpb25DaGFuZ2VkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXHJcbiAgICAgIHRoaXMuX29uQ29sbGVjdGlvbkNoYW5nZWQsXHJcbiAgICAgIHRoaXNcclxuICAgICk7XHJcbiAgICB0aGlzLmxlYWZsZXRTY2VuZS5tYXAucmVtb3ZlTGF5ZXIodGhpcy5fZmVhdHVyZUdyb3VwKTtcclxuICAgIHJldHVybiBkZXN0cm95T2JqZWN0KHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29tcHV0ZXMgdGhlIHJlY3Rhbmd1bGFyIGJvdW5kcyB3aGljaCBlbmNsb3NlcyB0aGUgY29sbGVjdGlvbiBvZlxyXG4gICAqIGVudGl0aWVzIHRvIGJlIHZpc3VhbGl6ZWQuXHJcbiAgICovXHJcbiAgZ2V0TGF0TG5nQm91bmRzKCk6IExhdExuZ0JvdW5kcyB8IHVuZGVmaW5lZCB7XHJcbiAgICBsZXQgcmVzdWx0OiBMYXRMbmdCb3VuZHMgfCB1bmRlZmluZWQ7XHJcblxyXG4gICAgT2JqZWN0LmtleXModGhpcy5fZW50aXR5SGFzaCkuZm9yRWFjaCgoZW50aXR5SWQpID0+IHtcclxuICAgICAgY29uc3QgZW50aXR5RGV0YWlsczogYW55ID0gdGhpcy5fZW50aXR5SGFzaFtlbnRpdHlJZF07XHJcblxyXG4gICAgICBPYmplY3Qua2V5cyhlbnRpdHlEZXRhaWxzKS5mb3JFYWNoKChwcmltaXRpdmVJZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByaW1pdGl2ZSA9IGVudGl0eURldGFpbHNbcHJpbWl0aXZlSWRdO1xyXG5cclxuICAgICAgICBpZiAoaXNEZWZpbmVkKHByaW1pdGl2ZS5sYXllcikpIHtcclxuICAgICAgICAgIGlmIChpc0RlZmluZWQocHJpbWl0aXZlLmxheWVyLmdldEJvdW5kcykpIHtcclxuICAgICAgICAgICAgY29uc3QgYm91bmRzID0gcHJpbWl0aXZlLmxheWVyLmdldEJvdW5kcygpO1xyXG4gICAgICAgICAgICBpZiAoaXNEZWZpbmVkKGJvdW5kcykpIHtcclxuICAgICAgICAgICAgICByZXN1bHQgPVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID09PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgPyBMLmxhdExuZ0JvdW5kcyhib3VuZHMuZ2V0U291dGhXZXN0KCksIGJvdW5kcy5nZXROb3J0aEVhc3QoKSlcclxuICAgICAgICAgICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGJvdW5kcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChpc0RlZmluZWQocHJpbWl0aXZlLmxheWVyLmdldExhdExuZykpIHtcclxuICAgICAgICAgICAgY29uc3QgbGF0TG5nID0gcHJpbWl0aXZlLmxheWVyLmdldExhdExuZygpO1xyXG4gICAgICAgICAgICBpZiAoaXNEZWZpbmVkKGxhdExuZykpIHtcclxuICAgICAgICAgICAgICByZXN1bHQgPVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID09PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgPyBMLmxhdExuZ0JvdW5kcyhbbGF0TG5nXSlcclxuICAgICAgICAgICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGxhdExuZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldERhc2hBcnJheShcclxuICBtYXRlcmlhbDogUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSxcclxuICB0aW1lOiBKdWxpYW5EYXRlXHJcbik6IG51bWJlcltdIHtcclxuICBjb25zdCBkYXNoUGF0dGVybiA9IG1hdGVyaWFsLmRhc2hQYXR0ZXJuXHJcbiAgICA/IG1hdGVyaWFsLmRhc2hQYXR0ZXJuLmdldFZhbHVlKHRpbWUpXHJcbiAgICA6IHVuZGVmaW5lZDtcclxuXHJcbiAgcmV0dXJuIGdldExpbmVTdHlsZUxlYWZsZXQoZGFzaFBhdHRlcm4pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhbkVudGl0eShcclxuICBlbnRpdHk6IEVudGl0eSxcclxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXHJcbiAgZW50aXR5SGFzaDogRW50aXR5SGFzaFxyXG4pIHtcclxuICBjb25zdCBkZXRhaWxzID0gZW50aXR5SGFzaFtlbnRpdHkuaWRdO1xyXG5cclxuICBjbGVhblBvaW50KGVudGl0eSwgZ3JvdXAsIGRldGFpbHMpO1xyXG4gIGNsZWFuUG9seWdvbihlbnRpdHksIGdyb3VwLCBkZXRhaWxzKTtcclxuICBjbGVhbkJpbGxib2FyZChlbnRpdHksIGdyb3VwLCBkZXRhaWxzKTtcclxuICBjbGVhbkxhYmVsKGVudGl0eSwgZ3JvdXAsIGRldGFpbHMpO1xyXG4gIGNsZWFuUG9seWxpbmUoZW50aXR5LCBncm91cCwgZGV0YWlscyk7XHJcblxyXG4gIGRlbGV0ZSBlbnRpdHlIYXNoW2VudGl0eS5pZF07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFuUG9pbnQoXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5wb2ludCkgJiYgaXNEZWZpbmVkKGRldGFpbHMucG9pbnQubGF5ZXIpKSB7XHJcbiAgICBncm91cC5yZW1vdmVMYXllcihkZXRhaWxzLnBvaW50LmxheWVyKTtcclxuICAgIGRldGFpbHMucG9pbnQgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhblBvbHlnb24oXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5wb2x5Z29uKSAmJiBpc0RlZmluZWQoZGV0YWlscy5wb2x5Z29uLmxheWVyKSkge1xyXG4gICAgZ3JvdXAucmVtb3ZlTGF5ZXIoZGV0YWlscy5wb2x5Z29uLmxheWVyKTtcclxuICAgIGRldGFpbHMucG9seWdvbiA9IHVuZGVmaW5lZDtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFuQmlsbGJvYXJkKFxyXG4gIF9lbnRpdHk6IEVudGl0eSxcclxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXHJcbiAgZGV0YWlsczogRW50aXR5RGV0YWlsc1xyXG4pIHtcclxuICBpZiAoaXNEZWZpbmVkKGRldGFpbHMuYmlsbGJvYXJkKSAmJiBpc0RlZmluZWQoZGV0YWlscy5iaWxsYm9hcmQubGF5ZXIpKSB7XHJcbiAgICBncm91cC5yZW1vdmVMYXllcihkZXRhaWxzLmJpbGxib2FyZC5sYXllcik7XHJcbiAgICBkZXRhaWxzLmJpbGxib2FyZCA9IHVuZGVmaW5lZDtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFuTGFiZWwoXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5sYWJlbCkgJiYgaXNEZWZpbmVkKGRldGFpbHMubGFiZWwubGF5ZXIpKSB7XHJcbiAgICBncm91cC5yZW1vdmVMYXllcihkZXRhaWxzLmxhYmVsLmxheWVyKTtcclxuICAgIGRldGFpbHMubGFiZWwgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhblBvbHlsaW5lKFxyXG4gIF9lbnRpdHk6IEVudGl0eSxcclxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXHJcbiAgZGV0YWlsczogRW50aXR5RGV0YWlsc1xyXG4pIHtcclxuICBpZiAoaXNEZWZpbmVkKGRldGFpbHMucG9seWxpbmUpICYmIGlzRGVmaW5lZChkZXRhaWxzLnBvbHlsaW5lLmxheWVyKSkge1xyXG4gICAgZ3JvdXAucmVtb3ZlTGF5ZXIoZGV0YWlscy5wb2x5bGluZS5sYXllcik7XHJcbiAgICBkZXRhaWxzLnBvbHlsaW5lID0gdW5kZWZpbmVkO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2xlYW5SZWN0YW5nbGUoXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5yZWN0YW5nbGUpICYmIGlzRGVmaW5lZChkZXRhaWxzLnJlY3RhbmdsZS5sYXllcikpIHtcclxuICAgIGdyb3VwLnJlbW92ZUxheWVyKGRldGFpbHMucmVjdGFuZ2xlLmxheWVyKTtcclxuICAgIGRldGFpbHMucmVjdGFuZ2xlID0gdW5kZWZpbmVkO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gX2lzQ2xvc2VUb0Vhc3Rlcm5BbnRpTWVyaWRpYW4oYm91bmRzOiBMYXRMbmdCb3VuZHMpIHtcclxuICBjb25zdCB3ID0gYm91bmRzLmdldFdlc3QoKTtcclxuICBjb25zdCBlID0gYm91bmRzLmdldEVhc3QoKTtcclxuICBpZiAodyA+IDE0MCAmJiAoZSA8IC0xNDAgfHwgZSA+IDE4MCkpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9pc0Nsb3NlVG9XZXN0ZXJuQW50aU1lcmlkaWFuKGJvdW5kczogTGF0TG5nQm91bmRzKSB7XHJcbiAgY29uc3QgdyA9IGJvdW5kcy5nZXRXZXN0KCk7XHJcbiAgY29uc3QgZSA9IGJvdW5kcy5nZXRFYXN0KCk7XHJcbiAgaWYgKCh3ID4gMTgwIHx8IHcgPCAtMTQwKSAmJiBlIDwgLTE0MCkge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcG9zaXRpb25Ub0xhdExuZyhcclxuICBwb3NpdGlvbjogQ2FydGVzaWFuMyxcclxuICBib3VuZHM6IExhdExuZ0JvdW5kcyB8IHVuZGVmaW5lZFxyXG4pIHtcclxuICBjb25zdCBjYXJ0b2dyYXBoaWMgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMocG9zaXRpb24pO1xyXG4gIGxldCBsb24gPSBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubG9uZ2l0dWRlKTtcclxuICBpZiAoYm91bmRzICE9PSB1bmRlZmluZWQpIHtcclxuICAgIGlmIChfaXNDbG9zZVRvRWFzdGVybkFudGlNZXJpZGlhbihib3VuZHMpKSB7XHJcbiAgICAgIGlmIChsb24gPCAtMTQwKSB7XHJcbiAgICAgICAgbG9uID0gbG9uICsgMzYwO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKF9pc0Nsb3NlVG9XZXN0ZXJuQW50aU1lcmlkaWFuKGJvdW5kcykpIHtcclxuICAgICAgaWYgKGxvbiA+IDE0MCkge1xyXG4gICAgICAgIGxvbiA9IGxvbiAtIDM2MDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gTC5sYXRMbmcoQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxhdGl0dWRlKSwgbG9uKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGllcmFyY2h5VG9MYXRMbmdzKGhpZXJhcmNoeTogUG9seWdvbkhpZXJhcmNoeSkge1xyXG4gIGNvbnN0IGhvbGVzOiBMLkxhdExuZ1tdW10gPSBbXTtcclxuICBjb25zdCBwb3NpdGlvbnMgPSBBcnJheS5pc0FycmF5KGhpZXJhcmNoeSkgPyBoaWVyYXJjaHkgOiBoaWVyYXJjaHkucG9zaXRpb25zO1xyXG4gIGlmIChoaWVyYXJjaHkuaG9sZXMubGVuZ3RoID4gMCkge1xyXG4gICAgaGllcmFyY2h5LmhvbGVzLmZvckVhY2goKGhvbGUpID0+IHtcclxuICAgICAgaG9sZXMucHVzaChjb252ZXJ0RW50aXR5UG9zaXRpb25zVG9MYXRMb25zKGhvbGUucG9zaXRpb25zKSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBbY29udmVydEVudGl0eVBvc2l0aW9uc1RvTGF0TG9ucyhwb3NpdGlvbnMpLCAuLi5ob2xlc107XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBjb252ZXJ0RW50aXR5UG9zaXRpb25zVG9MYXRMb25zKHBvc2l0aW9ucyk7XHJcbiAgfVxyXG59XHJcblxyXG4vL1JlY29sb3IgYW4gaW1hZ2UgdXNpbmcgMmQgY2FudmFzXHJcbmZ1bmN0aW9uIHJlY29sb3JCaWxsYm9hcmQoXHJcbiAgaW1nOiBIVE1MSW1hZ2VFbGVtZW50LFxyXG4gIGNvbG9yOiBDb2xvclxyXG4pOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgY2FudmFzLndpZHRoID0gaW1nLndpZHRoO1xyXG4gIGNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xyXG5cclxuICAvLyBDb3B5IHRoZSBpbWFnZSBjb250ZW50cyB0byB0aGUgY2FudmFzXHJcbiAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgaWYgKGNvbnRleHQgPT09IG51bGwpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnRleHQuZHJhd0ltYWdlKGltZywgMCwgMCk7XHJcbiAgY29uc3QgaW1hZ2UgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gIGNvbnN0IG5vcm1DbHIgPSBbY29sb3IucmVkLCBjb2xvci5ncmVlbiwgY29sb3IuYmx1ZSwgY29sb3IuYWxwaGFdO1xyXG5cclxuICBjb25zdCBsZW5ndGggPSBpbWFnZS5kYXRhLmxlbmd0aDsgLy9waXhlbCBjb3VudCAqIDRcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSA0KSB7XHJcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IDQ7IGorKykge1xyXG4gICAgICBpbWFnZS5kYXRhW2ogKyBpXSAqPSBub3JtQ2xyW2pdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2UsIDAsIDApO1xyXG4gIHJldHVybiBjYW52YXMudG9EYXRhVVJMKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGZlYXR1cmVDbGlja2VkKFxyXG4gIHZpc3VhbGl6ZXI6IExlYWZsZXRHZW9tVmlzdWFsaXplcixcclxuICBlbnRpdHk6IEVudGl0eSxcclxuICBldmVudDogTC5MZWFmbGV0RXZlbnRcclxuKSB7XHJcbiAgdmlzdWFsaXplci5sZWFmbGV0U2NlbmUuZmVhdHVyZUNsaWNrZWQucmFpc2VFdmVudChlbnRpdHksIGV2ZW50KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZmVhdHVyZU1vdXNlZG93bihcclxuICB2aXN1YWxpemVyOiBMZWFmbGV0R2VvbVZpc3VhbGl6ZXIsXHJcbiAgZW50aXR5OiBFbnRpdHksXHJcbiAgZXZlbnQ6IEwuTGVhZmxldEV2ZW50XHJcbikge1xyXG4gIHZpc3VhbGl6ZXIubGVhZmxldFNjZW5lLmZlYXR1cmVNb3VzZWRvd24ucmFpc2VFdmVudChlbnRpdHksIGV2ZW50KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VmFsdWU8VD4oXHJcbiAgcHJvcGVydHk6IFByb3BlcnR5IHwgdW5kZWZpbmVkLFxyXG4gIHRpbWU6IEp1bGlhbkRhdGVcclxuKTogVCB8IHVuZGVmaW5lZCB7XHJcbiAgaWYgKGlzRGVmaW5lZChwcm9wZXJ0eSkpIHtcclxuICAgIHJldHVybiBwcm9wZXJ0eS5nZXRWYWx1ZSh0aW1lKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFZhbHVlT3JEZWZhdWx0PFQ+KFxyXG4gIHByb3BlcnR5OiBQcm9wZXJ0eSB8IHVuZGVmaW5lZCxcclxuICB0aW1lOiBKdWxpYW5EYXRlLFxyXG4gIGRlZmF1bHRWYWx1ZTogVFxyXG4pOiBUIHtcclxuICBpZiAoaXNEZWZpbmVkKHByb3BlcnR5KSkge1xyXG4gICAgY29uc3QgdmFsdWUgPSBwcm9wZXJ0eS5nZXRWYWx1ZSh0aW1lKTtcclxuICAgIGlmIChpc0RlZmluZWQodmFsdWUpKSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VmFsdWVPclVuZGVmaW5lZChwcm9wZXJ0eTogUHJvcGVydHkgfCB1bmRlZmluZWQsIHRpbWU6IEp1bGlhbkRhdGUpIHtcclxuICBpZiAoaXNEZWZpbmVkKHByb3BlcnR5KSkge1xyXG4gICAgcmV0dXJuIHByb3BlcnR5LmdldFZhbHVlKHRpbWUpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29udmVydEVudGl0eVBvc2l0aW9uc1RvTGF0TG9ucyhwb3NpdGlvbnM6IENhcnRlc2lhbjNbXSk6IEwuTGF0TG5nW10ge1xyXG4gIGNvbnN0IGNhcnRzID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhbkFycmF5VG9DYXJ0b2dyYXBoaWNBcnJheShwb3NpdGlvbnMpO1xyXG4gIGNvbnN0IGxhdGxuZ3M6IEwuTGF0TG5nW10gPSBbXTtcclxuICBsZXQgbGFzdExvbmdpdHVkZTtcclxuICBmb3IgKGxldCBwID0gMDsgcCA8IGNhcnRzLmxlbmd0aDsgcCsrKSB7XHJcbiAgICBsZXQgbG9uID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydHNbcF0ubG9uZ2l0dWRlKTtcclxuXHJcbiAgICBpZiAobGFzdExvbmdpdHVkZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGlmIChsYXN0TG9uZ2l0dWRlIC0gbG9uID4gMTgwKSB7XHJcbiAgICAgICAgbG9uID0gbG9uICsgMzYwO1xyXG4gICAgICB9IGVsc2UgaWYgKGxhc3RMb25naXR1ZGUgLSBsb24gPCAtMTgwKSB7XHJcbiAgICAgICAgbG9uID0gbG9uIC0gMzYwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbGF0bG5ncy5wdXNoKEwubGF0TG5nKENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRzW3BdLmxhdGl0dWRlKSwgbG9uKSk7XHJcbiAgICBsYXN0TG9uZ2l0dWRlID0gbG9uO1xyXG4gIH1cclxuICByZXR1cm4gbGF0bG5ncztcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGVhZmxldFZpc3VhbGl6ZXIge1xyXG4gIHZpc3VhbGl6ZXJzQ2FsbGJhY2soXHJcbiAgICBsZWFmbGV0U2NlbmU6IExlYWZsZXRTY2VuZSxcclxuICAgIF9lbnRpdHlDbHVzdGVyOiBFbnRpdHlDbHVzdGVyIHwgdW5kZWZpbmVkLFxyXG4gICAgZGF0YVNvdXJjZTogRGF0YVNvdXJjZVxyXG4gICkge1xyXG4gICAgY29uc3QgZW50aXRpZXMgPSBkYXRhU291cmNlLmVudGl0aWVzO1xyXG4gICAgcmV0dXJuIFtuZXcgTGVhZmxldEdlb21WaXN1YWxpemVyKGxlYWZsZXRTY2VuZSwgZW50aXRpZXMpXTtcclxuICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQXNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBUUE7QUFHQTtBQUFBO0FBRkE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBTUE7QUFBQTtBQUFBO0FBQUE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUFBO0FBQUE7QUFNQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQVVBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFLQTtBQU1BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFLQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFLQTtBQUtBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFNQTtBQU1BO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQU1BO0FBTUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUlBO0FBSUE7QUFDQTtBQUVBO0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFDQTtBQUNBO0FBQUE7QUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/LeafletPatched.ts":
/*!*****************************************************!*\
  !*** ./packages/terriajs/lib/Map/LeafletPatched.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\n// Function taken from Leaflet 1.0.1 (https://github.com/Leaflet/Leaflet/blob/v1.0.1/src/layer/vector/Canvas.js#L254-L267)\n// Leaflet 1.0.2 and later don't trigger click events for every Path, so feature selection only gives 1 result.\n// Updated to incorporate function changes up to v1.7.1\nvar Canvas = _leaflet[\"default\"].Canvas;\nCanvas.prototype._onClick = function (e) {\n  var point = this._map.mouseEventToLayerPoint(e);\n  var layers = [];\n  for (var order = this._drawFirst; order; order = order.next) {\n    var layer = order.layer;\n    if (layer.options.interactive && layer._containsPoint(point)) {\n      if (!(e.type === \"click\" || e.type !== \"preclick\") || !this._map._draggableMoved(layer)) {\n        layers.push(layer);\n      }\n    }\n  }\n  this._fireEvent(layers.length ? layers : false, e);\n};\nvar _default = exports[\"default\"] = _leaflet[\"default\"];//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXRQYXRjaGVkLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0UGF0Y2hlZC50cz9mMTdiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMIGZyb20gXCJsZWFmbGV0XCI7XHJcblxyXG4vLyBGdW5jdGlvbiB0YWtlbiBmcm9tIExlYWZsZXQgMS4wLjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9MZWFmbGV0L0xlYWZsZXQvYmxvYi92MS4wLjEvc3JjL2xheWVyL3ZlY3Rvci9DYW52YXMuanMjTDI1NC1MMjY3KVxyXG4vLyBMZWFmbGV0IDEuMC4yIGFuZCBsYXRlciBkb24ndCB0cmlnZ2VyIGNsaWNrIGV2ZW50cyBmb3IgZXZlcnkgUGF0aCwgc28gZmVhdHVyZSBzZWxlY3Rpb24gb25seSBnaXZlcyAxIHJlc3VsdC5cclxuLy8gVXBkYXRlZCB0byBpbmNvcnBvcmF0ZSBmdW5jdGlvbiBjaGFuZ2VzIHVwIHRvIHYxLjcuMVxyXG5jb25zdCBDYW52YXMgPSBMLkNhbnZhcyBhcyBhbnk7XHJcbkNhbnZhcy5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZTogYW55KSB7XHJcbiAgY29uc3QgcG9pbnQgPSB0aGlzLl9tYXAubW91c2VFdmVudFRvTGF5ZXJQb2ludChlKTtcclxuICBjb25zdCBsYXllcnMgPSBbXTtcclxuICBmb3IgKGxldCBvcmRlciA9IHRoaXMuX2RyYXdGaXJzdDsgb3JkZXI7IG9yZGVyID0gb3JkZXIubmV4dCkge1xyXG4gICAgY29uc3QgbGF5ZXIgPSBvcmRlci5sYXllcjtcclxuICAgIGlmIChsYXllci5vcHRpb25zLmludGVyYWN0aXZlICYmIGxheWVyLl9jb250YWluc1BvaW50KHBvaW50KSkge1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgIShlLnR5cGUgPT09IFwiY2xpY2tcIiB8fCBlLnR5cGUgIT09IFwicHJlY2xpY2tcIikgfHxcclxuICAgICAgICAhdGhpcy5fbWFwLl9kcmFnZ2FibGVNb3ZlZChsYXllcilcclxuICAgICAgKSB7XHJcbiAgICAgICAgbGF5ZXJzLnB1c2gobGF5ZXIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIHRoaXMuX2ZpcmVFdmVudChsYXllcnMubGVuZ3RoID8gbGF5ZXJzIDogZmFsc2UsIGUpO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgTDtcclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/LeafletPatched.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts":
/*!*********************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = rectangleToLatLngBounds;\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\n/**\r\n * Converts a Cesium Rectangle into a Leaflet LatLngBounds.\r\n * @param {Rectangle} rectangle The rectangle to convert.\r\n * @return {L.latLngBounds} The equivalent Leaflet latLngBounds.\r\n */\nfunction rectangleToLatLngBounds(rectangle) {\n  var west = _Math[\"default\"].toDegrees(rectangle.west);\n  var south = _Math[\"default\"].toDegrees(rectangle.south);\n  var east = _Math[\"default\"].toDegrees(rectangle.east);\n  var north = _Math[\"default\"].toDegrees(rectangle.north);\n  return _leaflet[\"default\"].latLngBounds([south, west], [north, east]);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL1ZlY3Rvci9yZWN0YW5nbGVUb0xhdExuZ0JvdW5kcy50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvVmVjdG9yL3JlY3RhbmdsZVRvTGF0TG5nQm91bmRzLnRzPzllOGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEwgZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0IENlc2l1bU1hdGggZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9NYXRoXCI7XHJcbmltcG9ydCBSZWN0YW5nbGUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9SZWN0YW5nbGVcIjtcclxuXHJcbi8qKlxyXG4gKiBDb252ZXJ0cyBhIENlc2l1bSBSZWN0YW5nbGUgaW50byBhIExlYWZsZXQgTGF0TG5nQm91bmRzLlxyXG4gKiBAcGFyYW0ge1JlY3RhbmdsZX0gcmVjdGFuZ2xlIFRoZSByZWN0YW5nbGUgdG8gY29udmVydC5cclxuICogQHJldHVybiB7TC5sYXRMbmdCb3VuZHN9IFRoZSBlcXVpdmFsZW50IExlYWZsZXQgbGF0TG5nQm91bmRzLlxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVjdGFuZ2xlVG9MYXRMbmdCb3VuZHMocmVjdGFuZ2xlOiBSZWN0YW5nbGUpIHtcclxuICBjb25zdCB3ZXN0ID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlLndlc3QpO1xyXG4gIGNvbnN0IHNvdXRoID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlLnNvdXRoKTtcclxuICBjb25zdCBlYXN0ID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlLmVhc3QpO1xyXG4gIGNvbnN0IG5vcnRoID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlLm5vcnRoKTtcclxuICByZXR1cm4gTC5sYXRMbmdCb3VuZHMoW3NvdXRoLCB3ZXN0XSwgW25vcnRoLCBlYXN0XSk7XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts":
/*!********************************************************************!*\
  !*** ./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getLineStyleCesium = getLineStyleCesium;\nexports.getLineStyleLeaflet = getLineStyleLeaflet;\nvar defaultDashArray = [4, 3];\nvar esriLineStyleCesium = {\n  esriSLSDot: 7,\n  //\"   -\"\n  esriSLSDashDot: 2017,\n  //\"   ----   -\"\n  esriSLSDashDotDot: 16273,\n  // '  --------   -   - '\n  esriSLSLongDash: 2047,\n  // '   --------'\n  esriSLSLongDashDot: 4081,\n  // '   --------   -'\n  esriSLSShortDash: 4095,\n  //' ----'\n  esriSLSShortDot: 13107,\n  //' ---- -'\n  esriSLSShortDashDot: 8179,\n  //' ---- - -'\n  esriSLSShortDashDotDot: 16281 //' - - - -'\n};\nvar esriLineStyleLealet = {\n  7: [1, 3],\n  2017: [4, 3, 1, 3],\n  16273: [8, 3, 1, 3, 1, 3],\n  2047: [8, 3],\n  4081: [8, 3, 1, 3],\n  4095: [4, 1],\n  13107: [1, 1],\n  8179: [4, 1, 1, 1],\n  16281: [4, 1, 1, 1, 1, 1]\n};\nfunction getLineStyleLeaflet(dashPattern) {\n  if (esriLineStyleLealet[dashPattern]) {\n    return esriLineStyleLealet[dashPattern];\n  }\n  return defaultDashArray;\n}\nfunction getLineStyleCesium(styleName) {\n  if (esriLineStyleCesium[styleName]) {\n    return esriLineStyleCesium[styleName];\n  }\n  return undefined;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0NhdGFsb2cvRXNyaS9lc3JpTGluZVN0eWxlLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01vZGVscy9DYXRhbG9nL0VzcmkvZXNyaUxpbmVTdHlsZS50cz82ODFmIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRlZmF1bHREYXNoQXJyYXkgPSBbNCwgM107XHJcblxyXG5jb25zdCBlc3JpTGluZVN0eWxlQ2VzaXVtOiB7XHJcbiAgW2tleTogc3RyaW5nXTogbnVtYmVyO1xyXG59ID0ge1xyXG4gIGVzcmlTTFNEb3Q6IDcsIC8vXCIgICAtXCJcclxuICBlc3JpU0xTRGFzaERvdDogMjAxNywgLy9cIiAgIC0tLS0gICAtXCJcclxuICBlc3JpU0xTRGFzaERvdERvdDogMTYyNzMsIC8vICcgIC0tLS0tLS0tICAgLSAgIC0gJ1xyXG4gIGVzcmlTTFNMb25nRGFzaDogMjA0NywgLy8gJyAgIC0tLS0tLS0tJ1xyXG4gIGVzcmlTTFNMb25nRGFzaERvdDogNDA4MSwgLy8gJyAgIC0tLS0tLS0tICAgLSdcclxuICBlc3JpU0xTU2hvcnREYXNoOiA0MDk1LCAvLycgLS0tLSdcclxuICBlc3JpU0xTU2hvcnREb3Q6IDEzMTA3LCAvLycgLS0tLSAtJ1xyXG4gIGVzcmlTTFNTaG9ydERhc2hEb3Q6IDgxNzksIC8vJyAtLS0tIC0gLSdcclxuICBlc3JpU0xTU2hvcnREYXNoRG90RG90OiAxNjI4MSAvLycgLSAtIC0gLSdcclxufTtcclxuXHJcbmNvbnN0IGVzcmlMaW5lU3R5bGVMZWFsZXQ6IHtcclxuICBba2V5OiBudW1iZXJdOiBudW1iZXJbXTtcclxufSA9IHtcclxuICA3OiBbMSwgM10sXHJcbiAgMjAxNzogWzQsIDMsIDEsIDNdLFxyXG4gIDE2MjczOiBbOCwgMywgMSwgMywgMSwgM10sXHJcbiAgMjA0NzogWzgsIDNdLFxyXG4gIDQwODE6IFs4LCAzLCAxLCAzXSxcclxuICA0MDk1OiBbNCwgMV0sXHJcbiAgMTMxMDc6IFsxLCAxXSxcclxuICA4MTc5OiBbNCwgMSwgMSwgMV0sXHJcbiAgMTYyODE6IFs0LCAxLCAxLCAxLCAxLCAxXVxyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldExpbmVTdHlsZUxlYWZsZXQoZGFzaFBhdHRlcm46IG51bWJlcik6IG51bWJlcltdIHtcclxuICBpZiAoZXNyaUxpbmVTdHlsZUxlYWxldFtkYXNoUGF0dGVybl0pIHtcclxuICAgIHJldHVybiBlc3JpTGluZVN0eWxlTGVhbGV0W2Rhc2hQYXR0ZXJuXTtcclxuICB9XHJcbiAgcmV0dXJuIGRlZmF1bHREYXNoQXJyYXk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRMaW5lU3R5bGVDZXNpdW0oc3R5bGVOYW1lOiBzdHJpbmcpIHtcclxuICBpZiAoZXNyaUxpbmVTdHlsZUNlc2l1bVtzdHlsZU5hbWVdKSB7XHJcbiAgICByZXR1cm4gZXNyaUxpbmVTdHlsZUNlc2l1bVtzdHlsZU5hbWVdO1xyXG4gIH1cclxuICByZXR1cm4gdW5kZWZpbmVkO1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUVBO0FBR0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Models/Leaflet.ts":
/*!*************************************************!*\
  !*** ./packages/terriajs/lib/Models/Leaflet.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.async-iterator.js */ \"./node_modules/core-js/modules/es.symbol.async-iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-string-tag.js */ \"./node_modules/core-js/modules/es.symbol.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.array.from.js */ \"./node_modules/core-js/modules/es.array.from.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-string.js */ \"./node_modules/core-js/modules/es.date.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.json.to-string-tag.js */ \"./node_modules/core-js/modules/es.json.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.math.to-string-tag.js */ \"./node_modules/core-js/modules/es.math.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.to-string.js */ \"./node_modules/core-js/modules/es.regexp.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.weak-map.js */ \"./node_modules/core-js/modules/es.weak-map.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.filter.js */ \"./node_modules/core-js/modules/es.array.filter.js\");\n__webpack_require__(/*! core-js/modules/es.array.find-index.js */ \"./node_modules/core-js/modules/es.array.find-index.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.index-of.js */ \"./node_modules/core-js/modules/es.array.index-of.js\");\n__webpack_require__(/*! core-js/modules/es.array.is-array.js */ \"./node_modules/core-js/modules/es.array.is-array.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.sort.js */ \"./node_modules/core-js/modules/es.array.sort.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.function.name.js */ \"./node_modules/core-js/modules/es.function.name.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.promise.js */ \"./node_modules/core-js/modules/es.promise.js\");\n__webpack_require__(/*! core-js/modules/es.promise.finally.js */ \"./node_modules/core-js/modules/es.promise.finally.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.exec.js */ \"./node_modules/core-js/modules/es.regexp.exec.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.string.replace.js */ \"./node_modules/core-js/modules/es.string.replace.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.timers.js */ \"./node_modules/core-js/modules/web.timers.js\");\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _mobxUtils = __webpack_require__(/*! mobx-utils */ \"./node_modules/mobx-utils/mobx-utils.module.js\");\nvar _Cartesian = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\"));\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _defaultValue = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/defaultValue */ \"./node_modules/terriajs-cesium/Source/Core/defaultValue.js\"));\nvar _Ellipsoid = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\"));\nvar _EventHelper = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/EventHelper */ \"./node_modules/terriajs-cesium/Source/Core/EventHelper.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _Rectangle = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Rectangle */ \"./node_modules/terriajs-cesium/Source/Core/Rectangle.js\"));\nvar _DataSource = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSource.js\"));\nvar _DataSourceCollection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSourceCollection */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSourceCollection.js\"));\nvar _SplitDirection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\"));\nvar _terriajsHtml2canvas = _interopRequireDefault(__webpack_require__(/*! terriajs-html2canvas */ \"./node_modules/terriajs-html2canvas/dist/npm/index.js\"));\nvar _filterOutUndefined = _interopRequireDefault(__webpack_require__(/*! ../Core/filterOutUndefined */ \"./packages/terriajs/lib/Core/filterOutUndefined.ts\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nvar _runLater = _interopRequireDefault(__webpack_require__(/*! ../Core/runLater */ \"./packages/terriajs/lib/Core/runLater.ts\"));\nvar _ImageryProviderLeafletGridLayer = _interopRequireWildcard(__webpack_require__(/*! ../Map/Leaflet/ImageryProviderLeafletGridLayer */ \"./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts\"));\nvar _ImageryProviderLeafletTileLayer = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/ImageryProviderLeafletTileLayer */ \"./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts\"));\nvar _LeafletDataSourceDisplay = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletDataSourceDisplay */ \"./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts\"));\nvar _LeafletScene = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletScene */ \"./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts\"));\nvar _LeafletSelectionIndicator = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletSelectionIndicator */ \"./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts\"));\nvar _LeafletVisualizer = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletVisualizer */ \"./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts\"));\nvar _LeafletPatched = _interopRequireDefault(__webpack_require__(/*! ../Map/LeafletPatched */ \"./packages/terriajs/lib/Map/LeafletPatched.ts\"));\nvar _PickedFeatures = _interopRequireDefault(__webpack_require__(/*! ../Map/PickedFeatures/PickedFeatures */ \"./packages/terriajs/lib/Map/PickedFeatures/PickedFeatures.ts\"));\nvar _rectangleToLatLngBounds = _interopRequireDefault(__webpack_require__(/*! ../Map/Vector/rectangleToLatLngBounds */ \"./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts\"));\nvar _FeatureInfoUrlTemplateMixin = _interopRequireDefault(__webpack_require__(/*! ../ModelMixins/FeatureInfoUrlTemplateMixin */ \"./packages/terriajs/lib/ModelMixins/FeatureInfoUrlTemplateMixin.ts\"));\nvar _MappableMixin = _interopRequireWildcard(__webpack_require__(/*! ../ModelMixins/MappableMixin */ \"./packages/terriajs/lib/ModelMixins/MappableMixin.ts\"));\nvar _TileErrorHandlerMixin = _interopRequireDefault(__webpack_require__(/*! ../ModelMixins/TileErrorHandlerMixin */ \"./packages/terriajs/lib/ModelMixins/TileErrorHandlerMixin.ts\"));\nvar _ImageryProviderTraits = _interopRequireDefault(__webpack_require__(/*! ../Traits/TraitsClasses/ImageryProviderTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/ImageryProviderTraits.ts\"));\nvar _SplitterTraits = _interopRequireDefault(__webpack_require__(/*! ../Traits/TraitsClasses/SplitterTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/SplitterTraits.ts\"));\nvar _CameraView = _interopRequireDefault(__webpack_require__(/*! ./CameraView */ \"./packages/terriajs/lib/Models/CameraView.ts\"));\nvar _hasTraits = _interopRequireDefault(__webpack_require__(/*! ./Definition/hasTraits */ \"./packages/terriajs/lib/Models/Definition/hasTraits.ts\"));\nvar _Feature = _interopRequireDefault(__webpack_require__(/*! ./Feature/Feature */ \"./packages/terriajs/lib/Models/Feature/Feature.ts\"));\nvar _GlobeOrMap2 = _interopRequireDefault(__webpack_require__(/*! ./GlobeOrMap */ \"./packages/terriajs/lib/Models/GlobeOrMap.ts\"));\nvar _LeafletAttribution = __webpack_require__(/*! ./LeafletAttribution */ \"./packages/terriajs/lib/Models/LeafletAttribution.ts\");\nvar _class, _descriptor, _descriptor2, _descriptor3;\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != _typeof(e) && \"function\" != typeof e) return { \"default\": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n[\"default\"] = e, t && t.set(e, n), n; }\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, \"catch\": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(t, e) { if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e; if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\"); return _assertThisInitialized(t); }\nfunction _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); return e; }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }\nfunction _inherits(t, e) { if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, \"prototype\", { writable: !1 }), e && _setPrototypeOf(t, e); }\nfunction _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\n// This class is an observer. It probably won't contain any observables itself\nvar Leaflet = exports[\"default\"] = (_class = /*#__PURE__*/function (_GlobeOrMap) {\n  function Leaflet(terriaViewer, container) {\n    var _this;\n    _classCallCheck(this, Leaflet);\n    _this = _callSuper(this, Leaflet);\n    _defineProperty(_this, \"type\", \"Leaflet\");\n    _defineProperty(_this, \"terria\", void 0);\n    _defineProperty(_this, \"terriaViewer\", void 0);\n    _defineProperty(_this, \"map\", void 0);\n    _defineProperty(_this, \"scene\", void 0);\n    _defineProperty(_this, \"dataSources\", new _DataSourceCollection[\"default\"]());\n    _defineProperty(_this, \"dataSourceDisplay\", void 0);\n    _defineProperty(_this, \"canShowSplitter\", true);\n    _defineProperty(_this, \"_attributionControl\", void 0);\n    _defineProperty(_this, \"_leafletVisualizer\", void 0);\n    _defineProperty(_this, \"_eventHelper\", void 0);\n    _defineProperty(_this, \"_selectionIndicator\", void 0);\n    _defineProperty(_this, \"_stopRequestAnimationFrame\", false);\n    _defineProperty(_this, \"_cesiumReqAnimFrameId\", void 0);\n    _defineProperty(_this, \"_pickedFeatures\", undefined);\n    _defineProperty(_this, \"_pauseMapInteractionCount\", 0);\n    /* Disposers */\n    _defineProperty(_this, \"_disposeWorkbenchMapItemsSubscription\", void 0);\n    _defineProperty(_this, \"_disposeDisableInteractionSubscription\", void 0);\n    _defineProperty(_this, \"_disposeSelectedFeatureSubscription\", void 0);\n    _defineProperty(_this, \"_disposeSplitterReaction\", void 0);\n    // These are used to split CesiumTileLayer and MapboxCanvasVectorTileLayer\n    _initializerDefineProperty(_this, \"size\", _descriptor, _this);\n    _initializerDefineProperty(_this, \"nw\", _descriptor2, _this);\n    _initializerDefineProperty(_this, \"se\", _descriptor3, _this);\n    _defineProperty(_this, \"_createImageryLayer\", (0, _mobxUtils.computedFn)(function (ip, clippingRectangle) {\n      var layerOptions = {\n        maxZoom: _this.terria.configParameters.leafletMaxZoom,\n        bounds: clippingRectangle && (0, _rectangleToLatLngBounds[\"default\"])(clippingRectangle)\n      };\n      // We have two different kinds of ImageryProviderLeaflet layers\n      // - Grid layer will use the ImageryProvider in the more traditional way - calling `requestImage` to draw the image on to a canvas\n      // - Tile layer will pass tile URLs to leaflet objects - which is a bit more \"Leaflety\" than Grid layer\n      // Tile layer is preferred. Grid layer mainly exists for custom Imagery Providers which aren't just a tile of image URLs\n      if ((0, _ImageryProviderLeafletGridLayer.isImageryProviderGridLayer)(ip)) {\n        return new _ImageryProviderLeafletGridLayer[\"default\"](_this, ip, layerOptions);\n      } else {\n        return new _ImageryProviderLeafletTileLayer[\"default\"](_this, ip, layerOptions);\n      }\n    }));\n    (0, _mobx.makeObservable)(_this);\n    _this.terria = terriaViewer.terria;\n    _this.terriaViewer = terriaViewer;\n    _this.map = _LeafletPatched[\"default\"].map(container, {\n      zoomControl: false,\n      attributionControl: false,\n      zoomSnap: 1,\n      // Change to  0.2 for incremental zoom when Chrome fixes canvas scaling gaps\n      preferCanvas: true,\n      worldCopyJump: false\n    }).setView([-28.5, 135], 5);\n    _this.map.on(\"move\", function () {\n      return _this.updateMapObservables();\n    });\n    _this.map.on(\"zoom\", function () {\n      return _this.updateMapObservables();\n    });\n    _this.scene = new _LeafletScene[\"default\"](_this.map);\n    _this._attributionControl = new _LeafletAttribution.LeafletAttribution(_this.terria);\n    _this.map.addControl(_this._attributionControl);\n    _this._leafletVisualizer = new _LeafletVisualizer[\"default\"]();\n    _this._selectionIndicator = new _LeafletSelectionIndicator[\"default\"](_this);\n    _this.dataSourceDisplay = new _LeafletDataSourceDisplay[\"default\"]({\n      scene: _this.scene,\n      dataSourceCollection: _this.dataSources,\n      visualizersCallback: _this._leafletVisualizer.visualizersCallback\n    });\n    _this._eventHelper = new _EventHelper[\"default\"]();\n    _this._eventHelper.add(_this.terria.timelineClock.onTick, function (clock) {\n      _this.dataSourceDisplay.update(clock.currentTime);\n    });\n    var _ticker = function ticker() {\n      if (!_this._stopRequestAnimationFrame) {\n        _this.terria.timelineClock.tick();\n        _this._cesiumReqAnimFrameId = requestAnimationFrame(_ticker);\n      }\n    };\n\n    // Start ticker asynchronously to avoid calling an action in the consctructor\n    (0, _runLater[\"default\"])(_ticker);\n    _this._disposeWorkbenchMapItemsSubscription = _this.observeModelLayer();\n    _this._disposeSplitterReaction = _this._reactToSplitterChanges();\n    _this._disposeDisableInteractionSubscription = (0, _mobx.autorun)(function () {\n      var map = _this.map;\n      var interactions = (0, _filterOutUndefined[\"default\"])([map.touchZoom, map.doubleClickZoom, map.scrollWheelZoom, map.boxZoom, map.keyboard, map.dragging, map.tapHold]);\n      var pickLocation = _this.pickLocation.bind(_this);\n      var pickFeature = function pickFeature(entity, event) {\n        _this._featurePicked(entity, event);\n      };\n\n      // Update mouse coords on mouse move\n      _this.map.on(\"mousemove\", function (e) {\n        var mouseEvent = e;\n        _this.mouseCoords.updateCoordinatesFromLeaflet(_this.terria, mouseEvent.originalEvent);\n      });\n      if (_this.terriaViewer.disableInteraction) {\n        interactions.forEach(function (handler) {\n          return handler.disable();\n        });\n        _this.map.off(\"click\", pickLocation);\n        _this.scene.featureClicked.removeEventListener(pickFeature);\n        _this._disposeSelectedFeatureSubscription && _this._disposeSelectedFeatureSubscription();\n      } else {\n        interactions.forEach(function (handler) {\n          return handler.enable();\n        });\n        _this.map.on(\"click\", pickLocation);\n        _this.scene.featureClicked.addEventListener(pickFeature);\n        _this._disposeSelectedFeatureSubscription = (0, _mobx.autorun)(function () {\n          var feature = _this.terria.selectedFeature;\n          _this._selectFeature(feature);\n        });\n      }\n    });\n    _this._initProgressEvent();\n    return _this;\n  }\n  _inherits(Leaflet, _GlobeOrMap);\n  return _createClass(Leaflet, [{\n    key: \"updateMapObservables\",\n    value: function updateMapObservables() {\n      this.size = this.map.getSize();\n      this.nw = this.map.containerPointToLayerPoint([0, 0]);\n      this.se = this.map.containerPointToLayerPoint(this.size);\n    }\n  }, {\n    key: \"_makeImageryLayerFromParts\",\n    value: function _makeImageryLayerFromParts(parts, item) {\n      if (parts.imageryProvider === undefined) return undefined;\n      if (_TileErrorHandlerMixin[\"default\"].isMixedInto(item)) {\n        // because this code path can run multiple times, make sure we remove the\n        // handler if it is already registered\n        parts.imageryProvider.errorEvent.removeEventListener(item.onTileLoadError, item);\n        parts.imageryProvider.errorEvent.addEventListener(item.onTileLoadError, item);\n      }\n      return this._createImageryLayer(parts.imageryProvider, parts.clippingRectangle);\n    }\n  }, {\n    key: \"attributionPrefix\",\n    get: function get() {\n      return this._attributionControl.prefix;\n    }\n  }, {\n    key: \"attributions\",\n    get: function get() {\n      return this._attributionControl.dataAttributions;\n    }\n\n    /**\r\n     * sets up loading listeners\r\n     */\n  }, {\n    key: \"_initProgressEvent\",\n    value: function _initProgressEvent() {\n      var _this2 = this;\n      var onTileLoadChange = function onTileLoadChange() {\n        var tilesLoadingCount = 0;\n        _this2.map.eachLayer(function (layerOrGridlayer) {\n          // _tiles is protected but our knockout-loading-logic accesses it here anyway\n          var layer = layerOrGridlayer;\n          if (layer !== null && layer !== void 0 && layer._tiles) {\n            // Count all tiles not marked as loaded\n            tilesLoadingCount += Object.keys(layer._tiles).filter(function (key) {\n              return !layer._tiles[key].loaded;\n            }).length;\n          }\n        });\n        _this2._updateTilesLoadingCount(tilesLoadingCount);\n      };\n      this.map.on(\"layeradd\", function (evt) {\n        // This check makes sure we only watch tile layers, and also protects us if this private variable gets changed.\n        if (typeof evt.layer._tiles !== \"undefined\") {\n          evt.layer.on(\"tileloadstart tileload load\", onTileLoadChange);\n        }\n      }.bind(this));\n      this.map.on(\"layerremove\", function (evt) {\n        evt.layer.off(\"tileloadstart tileload load\", onTileLoadChange);\n      }.bind(this));\n    }\n\n    /**\r\n     * Pick feature from mouse click event.\r\n     */\n  }, {\n    key: \"pickLocation\",\n    value: function pickLocation(e) {\n      var mouseEvent = e;\n\n      // Handle click events that cross the anti-meridian\n      if (mouseEvent.latlng.lng > 180 || mouseEvent.latlng.lng < -180) {\n        mouseEvent.latlng = mouseEvent.latlng.wrap();\n      }\n\n      // if (!this._dragboxcompleted && that.map.dragging.enabled()) {\n      this._pickFeatures(mouseEvent.latlng);\n      // }\n      // this._dragboxcompleted = false;\n    }\n  }, {\n    key: \"getContainer\",\n    value: function getContainer() {\n      return this.map.getContainer();\n    }\n  }, {\n    key: \"pauseMapInteraction\",\n    value: function pauseMapInteraction() {\n      ++this._pauseMapInteractionCount;\n      if (this._pauseMapInteractionCount === 1) {\n        this.map.dragging.disable();\n      }\n    }\n  }, {\n    key: \"resumeMapInteraction\",\n    value: function resumeMapInteraction() {\n      var _this3 = this;\n      --this._pauseMapInteractionCount;\n      if (this._pauseMapInteractionCount === 0) {\n        setTimeout(function () {\n          if (_this3._pauseMapInteractionCount === 0) {\n            _this3.map.dragging.enable();\n          }\n        }, 0);\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this._disposeSelectedFeatureSubscription && this._disposeSelectedFeatureSubscription();\n      this._disposeSplitterReaction();\n      this._disposeWorkbenchMapItemsSubscription();\n      this._eventHelper.removeAll();\n      this._disposeDisableInteractionSubscription();\n      // This variable prevents a race condition if destroy() is called\n      // synchronously as a result of timelineClock ticking due to ticker()\n      this._stopRequestAnimationFrame = true;\n      if ((0, _isDefined[\"default\"])(this._cesiumReqAnimFrameId)) {\n        cancelAnimationFrame(this._cesiumReqAnimFrameId);\n      }\n      this.dataSourceDisplay.destroy();\n      this.map.off(\"move\");\n      this.map.off(\"zoom\");\n      this.map.remove();\n    }\n  }, {\n    key: \"availableCatalogItems\",\n    get: function get() {\n      var catalogItems = [].concat(_toConsumableArray(this.terriaViewer.items.get()), [this.terriaViewer.baseMap]);\n      return catalogItems;\n    }\n  }, {\n    key: \"availableDataSources\",\n    get: function get() {\n      var _ref;\n      var catalogItems = this.availableCatalogItems;\n      /* Handle datasources */\n      var allMapItems = (_ref = []).concat.apply(_ref, _toConsumableArray(catalogItems.filter(_isDefined[\"default\"]).map(function (item) {\n        return item.mapItems;\n      })));\n      var dataSources = allMapItems.filter(isDataSource);\n      return dataSources;\n    }\n  }, {\n    key: \"observeModelLayer\",\n    value: function observeModelLayer() {\n      var _this4 = this;\n      // Setup reaction to sync datSources collection with availableDataSources\n      //\n      // To avoid buggy concurrent syncs, we have to ensure that even when\n      // multiple sync reactions are triggered, we run them one after the\n      // other. To do this, we make each run of the reaction wait for the\n      // previous `syncDataSourcesPromise` to finish before starting itself.\n      var syncDataSourcesPromise = Promise.resolve();\n      var dataSourcesReactionDisposer = (0, _mobx.reaction)(function () {\n        return _this4.availableDataSources;\n      }, function () {\n        syncDataSourcesPromise = syncDataSourcesPromise.then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return _this4.syncDataSourceCollection(_this4.availableDataSources, _this4.dataSources);\n              case 2:\n                _this4.notifyRepaintRequired();\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee);\n        })))[\"catch\"](console.error);\n      }, {\n        fireImmediately: true\n      });\n\n      // Reaction to sync imagery from model layer with cesium map\n      var imageryReactionDisposer = (0, _mobx.autorun)(function () {\n        var _ref3;\n        var catalogItems = _this4.availableCatalogItems;\n        // Flatmap\n        var allImageryMapItems = (_ref3 = []).concat.apply(_ref3, _toConsumableArray(catalogItems.filter(_isDefined[\"default\"]).map(function (item) {\n          return item.mapItems.filter(_MappableMixin.ImageryParts.is).map(function (parts) {\n            return {\n              item: item,\n              parts: parts\n            };\n          });\n        })));\n        var allImagery = allImageryMapItems.map(function (_ref4) {\n          var item = _ref4.item,\n            parts = _ref4.parts;\n          if ((0, _hasTraits[\"default\"])(item, _ImageryProviderTraits[\"default\"], \"leafletUpdateInterval\")) {\n            parts.imageryProvider._leafletUpdateInterval = item.leafletUpdateInterval;\n          }\n          return {\n            parts: parts,\n            layer: _this4._makeImageryLayerFromParts(parts, item)\n          };\n        });\n\n        // Delete imagery layers no longer in the model\n        _this4.map.eachLayer(function (mapLayer) {\n          if (isImageryLayer(mapLayer) || mapLayer instanceof _ImageryProviderLeafletGridLayer[\"default\"]) {\n            var index = allImagery.findIndex(function (im) {\n              return im.layer === mapLayer;\n            });\n            if (index === -1) {\n              _this4.map.removeLayer(mapLayer);\n            }\n          }\n        });\n\n        // Add layer and update its zIndex\n        var zIndex = 100; // Start at an arbitrary value\n        allImagery.reverse().forEach(function (_ref5) {\n          var parts = _ref5.parts,\n            layer = _ref5.layer;\n          if (layer && parts.show) {\n            layer.setOpacity(parts.alpha);\n            layer.setZIndex(zIndex);\n            zIndex++;\n            if (!_this4.map.hasLayer(layer)) {\n              _this4.map.addLayer(layer);\n            }\n          } else if (layer) {\n            _this4.map.removeLayer(layer);\n          }\n        });\n      });\n      return function () {\n        dataSourcesReactionDisposer();\n        imageryReactionDisposer();\n      };\n    }\n\n    /**\r\n     * Syncs the `dataSources` collection against the latest `availableDataSources`.\r\n     *\r\n     */\n  }, {\n    key: \"syncDataSourceCollection\",\n    value: (function () {\n      var _syncDataSourceCollection = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(availableDataSources, dataSources) {\n        var i, ds, _iterator, _step, _ds;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              // 1. Remove deleted data sources\n              //\n              // Iterate backwards because we're removing items.\n              for (i = dataSources.length - 1; i >= 0; i--) {\n                ds = dataSources.get(i);\n                if (availableDataSources.indexOf(ds) === -1 || !ds.show) {\n                  dataSources.remove(ds);\n                }\n              }\n\n              // 2. Add new data sources\n              _iterator = _createForOfIteratorHelper(availableDataSources);\n              _context2.prev = 2;\n              _iterator.s();\n            case 4:\n              if ((_step = _iterator.n()).done) {\n                _context2.next = 11;\n                break;\n              }\n              _ds = _step.value;\n              if (!(!dataSources.contains(_ds) && _ds.show)) {\n                _context2.next = 9;\n                break;\n              }\n              _context2.next = 9;\n              return dataSources.add(_ds);\n            case 9:\n              _context2.next = 4;\n              break;\n            case 11:\n              _context2.next = 16;\n              break;\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](2);\n              _iterator.e(_context2.t0);\n            case 16:\n              _context2.prev = 16;\n              _iterator.f();\n              return _context2.finish(16);\n            case 19:\n              // 3. Ensure stacking order matches order in `availableDataSources` - first item appears on top.\n              (0, _mobx.runInAction)(function () {\n                return availableDataSources.forEach(function (ds) {\n                  // There is a buggy/un-intended side-effect when calling raiseToTop() with\n                  // a source that doesn't exist in the collection. Doing this will replace\n                  // the last entry in the collection with the new one. So we should be\n                  // careful to raiseToTop() only if the DS already exists in the collection.\n                  // Relevant code:\n                  //   https://github.com/CesiumGS/cesium/blob/dbd452328a48bfc4e192146862a9f8fa15789dc8/packages/engine/Source/DataSources/DataSourceCollection.js#L298-L299\n                  dataSources.contains(ds) && dataSources.raiseToTop(ds);\n                });\n              });\n            case 20:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 13, 16, 19]]);\n      }));\n      function syncDataSourceCollection(_x, _x2) {\n        return _syncDataSourceCollection.apply(this, arguments);\n      }\n      return syncDataSourceCollection;\n    }())\n  }, {\n    key: \"doZoomTo\",\n    value: function doZoomTo(target) {\n      var flightDurationSeconds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3.0;\n      if (!(0, _isDefined[\"default\"])(target)) {\n        return Promise.resolve();\n      }\n      var bounds;\n      if ((0, _isDefined[\"default\"])(target.entities)) {\n        if ((0, _isDefined[\"default\"])(this.dataSourceDisplay)) {\n          bounds = this.dataSourceDisplay.getLatLngBounds(target);\n        }\n      } else {\n        var extent;\n        if (target instanceof _Rectangle[\"default\"]) {\n          extent = target;\n        } else if (target instanceof _CameraView[\"default\"]) {\n          extent = target.rectangle;\n        } else if (_MappableMixin[\"default\"].isMixedInto(target)) {\n          if ((0, _isDefined[\"default\"])(target.cesiumRectangle)) {\n            extent = target.cesiumRectangle;\n          }\n          if (!(0, _isDefined[\"default\"])(extent)) {\n            return this.doZoomTo(target.mapItems[0], flightDurationSeconds);\n          }\n        } else {\n          extent = target.rectangle;\n        }\n\n        // Ensure extent is defined before accessing its properties\n        if ((0, _isDefined[\"default\"])(extent)) {\n          // Account for a bounding box crossing the date line.\n          if (extent.east < extent.west) {\n            extent = _Rectangle[\"default\"].clone(extent);\n            extent.east += _Math[\"default\"].TWO_PI;\n          }\n          bounds = (0, _rectangleToLatLngBounds[\"default\"])(extent);\n        } else {\n          // Handle the case where extent is undefined\n          console.error(\"Unable to determine bounds for zooming.\");\n          return Promise.resolve();\n        }\n      }\n      if ((0, _isDefined[\"default\"])(bounds)) {\n        this.map.flyToBounds(bounds, {\n          animate: flightDurationSeconds > 0.0,\n          duration: flightDurationSeconds\n        });\n      }\n      return Promise.resolve();\n    }\n  }, {\n    key: \"getCurrentCameraView\",\n    value: function getCurrentCameraView() {\n      var bounds = this.map.getBounds();\n      return new _CameraView[\"default\"](_Rectangle[\"default\"].fromDegrees(bounds.getWest(), bounds.getSouth(), bounds.getEast(), bounds.getNorth()));\n    }\n  }, {\n    key: \"notifyRepaintRequired\",\n    value: function notifyRepaintRequired() {\n      // No action necessary.\n    }\n  }, {\n    key: \"pickFromLocation\",\n    value: function pickFromLocation(latLngHeight, providerCoords, existingFeatures) {\n      this._pickFeatures(_LeafletPatched[\"default\"].latLng({\n        lat: latLngHeight.latitude,\n        lng: latLngHeight.longitude,\n        alt: latLngHeight.height\n      }), providerCoords, existingFeatures);\n    }\n\n    /*\r\n     * There are two \"listeners\" for clicks which are set up in our constructor.\r\n     * - One fires for any click: `map.on('click', ...`.  It calls `pickFeatures`.\r\n     * - One fires only for vector features: `this.scene.featureClicked.addEventListener`.\r\n     *    It calls `featurePicked`, which calls `pickFeatures` and then adds the feature it found, if any.\r\n     * These events can fire in either order.\r\n     * Billboards do not fire the first event.\r\n     *\r\n     * Note that `pickFeatures` does nothing if `leaflet._pickedFeatures` is already set.\r\n     * Otherwise, it sets it, runs `runLater` to clear it, and starts the asynchronous raster feature picking.\r\n     *\r\n     * So:\r\n     * If only the first event is received, it triggers the raster-feature picking as desired.\r\n     * If both are received in the order above, the second adds the vector features to the list of raster features as desired.\r\n     * If both are received in the reverse order, the vector-feature click kicks off the same behavior as the other click would have;\r\n     * and when the next click is received, it is ignored - again, as desired.\r\n     */\n  }, {\n    key: \"_featurePicked\",\n    value: (function () {\n      var _featurePicked2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(entity, event) {\n        var owner, feature, catalogItem, _this$_pickedFeatures, result, _this$_pickedFeatures2;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              this._pickFeatures(event.latlng);\n\n              // Ignore clicks on the feature highlight.\n              if (!(entity.entityCollection && entity.entityCollection.owner)) {\n                _context3.next = 5;\n                break;\n              }\n              owner = entity.entityCollection.owner;\n              if (!(owner instanceof _DataSource[\"default\"] && owner.name === _GlobeOrMap2[\"default\"]._featureHighlightName)) {\n                _context3.next = 5;\n                break;\n              }\n              return _context3.abrupt(\"return\");\n            case 5:\n              feature = _Feature[\"default\"].fromEntityCollectionOrEntity(entity);\n              catalogItem = feature._catalogItem;\n              if (!(_FeatureInfoUrlTemplateMixin[\"default\"].isMixedInto(catalogItem) && typeof catalogItem.getFeaturesFromPickResult === \"function\" && this.terria.allowFeatureInfoRequests)) {\n                _context3.next = 14;\n                break;\n              }\n              _context3.next = 10;\n              return catalogItem.getFeaturesFromPickResult.bind(catalogItem)(undefined, entity, (((_this$_pickedFeatures = this._pickedFeatures) === null || _this$_pickedFeatures === void 0 ? void 0 : _this$_pickedFeatures.features.length) || 0) < catalogItem.maxRequests);\n            case 10:\n              result = _context3.sent;\n              if (result && (0, _isDefined[\"default\"])(this._pickedFeatures)) {\n                if (Array.isArray(result)) {\n                  (_this$_pickedFeatures2 = this._pickedFeatures.features).push.apply(_this$_pickedFeatures2, _toConsumableArray(result));\n                } else {\n                  this._pickedFeatures.features.push(result);\n                }\n              }\n              _context3.next = 15;\n              break;\n            case 14:\n              if ((0, _isDefined[\"default\"])(this._pickedFeatures)) {\n                this._pickedFeatures.features.push(feature);\n              }\n            case 15:\n              if ((0, _isDefined[\"default\"])(this._pickedFeatures) && (0, _isDefined[\"default\"])(feature) && feature.position) {\n                this._pickedFeatures.pickPosition = feature.position._value;\n              }\n            case 16:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function _featurePicked(_x3, _x4) {\n        return _featurePicked2.apply(this, arguments);\n      }\n      return _featurePicked;\n    }())\n  }, {\n    key: \"_pickFeatures\",\n    value: function _pickFeatures(latlng, tileCoordinates, existingFeatures) {\n      var _this5 = this;\n      var ignoreSplitter = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      if ((0, _isDefined[\"default\"])(this._pickedFeatures)) {\n        // Picking is already in progress.\n        return;\n      }\n      this._pickedFeatures = new _PickedFeatures[\"default\"]();\n      if ((0, _isDefined[\"default\"])(existingFeatures)) {\n        this._pickedFeatures.features = existingFeatures;\n      }\n\n      // We run this later because vector click events and the map click event can come through in any order, but we can\n      // be reasonably sure that all of them will be processed by the time our runLater func is invoked.\n      var cleanup = (0, _runLater[\"default\"])(function () {\n        // Set this again just in case a vector pick came through and reset it to the vector's position.\n        var newPickLocation = _Ellipsoid[\"default\"].WGS84.cartographicToCartesian(pickedLocation);\n        (0, _mobx.runInAction)(function () {\n          var mapInteractionModeStack = _this5.terria.mapInteractionModeStack;\n          if ((0, _isDefined[\"default\"])(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n            var _pickedFeatures = mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures;\n            if ((0, _isDefined[\"default\"])(_pickedFeatures)) {\n              _pickedFeatures.pickPosition = newPickLocation;\n            }\n          } else if ((0, _isDefined[\"default\"])(_this5.terria.pickedFeatures)) {\n            _this5.terria.pickedFeatures.pickPosition = newPickLocation;\n          }\n        });\n\n        // Unset this so that the next click will start building features from scratch.\n        _this5._pickedFeatures = undefined;\n      });\n      var imageryLayers = [];\n      if (this.terria.allowFeatureInfoRequests) {\n        this.map.eachLayer(function (layer) {\n          if (isImageryLayer(layer)) {\n            imageryLayers.push(layer);\n          }\n        });\n      }\n\n      // we need items sorted in reverse order by their zIndex to get correct ordering of feature info\n      imageryLayers.sort(function (a, b) {\n        if (!(0, _isDefined[\"default\"])(a.options.zIndex) || !(0, _isDefined[\"default\"])(b.options.zIndex)) {\n          return 0;\n        }\n        if (a.options.zIndex < b.options.zIndex) {\n          return 1;\n        }\n        if (a.options.zIndex > b.options.zIndex) {\n          return -1;\n        }\n        return 0;\n      });\n      tileCoordinates = (0, _defaultValue[\"default\"])(tileCoordinates, {});\n      var pickedLocation = _Cartographic[\"default\"].fromDegrees(latlng.lng, latlng.lat);\n      this._pickedFeatures.pickPosition = _Ellipsoid[\"default\"].WGS84.cartographicToCartesian(pickedLocation);\n      var imageryFeaturePromises = imageryLayers.map(/*#__PURE__*/function () {\n        var _ref6 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(imageryLayer) {\n          var _tileCoordinates$imag, _tileCoordinates;\n          var imageryLayerUrl, longRadians, latRadians, coords, features;\n          return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n            while (1) switch (_context4.prev = _context4.next) {\n              case 0:\n                imageryLayerUrl = imageryLayer.imageryProvider.url;\n                longRadians = _Math[\"default\"].toRadians(latlng.lng);\n                latRadians = _Math[\"default\"].toRadians(latlng.lat);\n                if (!((_tileCoordinates$imag = (_tileCoordinates = tileCoordinates) === null || _tileCoordinates === void 0 ? void 0 : _tileCoordinates[imageryLayerUrl]) !== null && _tileCoordinates$imag !== void 0)) {\n                  _context4.next = 7;\n                  break;\n                }\n                _context4.t0 = _tileCoordinates$imag;\n                _context4.next = 10;\n                break;\n              case 7:\n                _context4.next = 9;\n                return imageryLayer.getFeaturePickingCoords(_this5.map, longRadians, latRadians);\n              case 9:\n                _context4.t0 = _context4.sent;\n              case 10:\n                coords = _context4.t0;\n                _context4.next = 13;\n                return imageryLayer.pickFeatures(coords.x, coords.y, coords.level, longRadians, latRadians);\n              case 13:\n                features = _context4.sent;\n                // Make sure ImageryLayerFeatureInfo has imagery layer property\n                features === null || features === void 0 ? void 0 : features.forEach(function (feature) {\n                  return feature.imageryLayer = imageryLayer;\n                });\n                return _context4.abrupt(\"return\", {\n                  features: features,\n                  imageryLayer: imageryLayer,\n                  coords: coords\n                });\n              case 16:\n              case \"end\":\n                return _context4.stop();\n            }\n          }, _callee4);\n        }));\n        return function (_x5) {\n          return _ref6.apply(this, arguments);\n        };\n      }());\n      var pickedFeatures = this._pickedFeatures;\n\n      // We want the all available promise to return after the cleanup one to\n      // make sure all vector click events have resolved.\n      pickedFeatures.allFeaturesAvailablePromise = Promise.all([cleanup, Promise.all(imageryFeaturePromises).then(function (results) {\n        (0, _mobx.runInAction)(function () {\n          pickedFeatures.isLoading = false;\n        });\n        pickedFeatures.providerCoords = {};\n        var filteredResults = results.filter(function (result) {\n          return (0, _isDefined[\"default\"])(result.features) && result.features.length > 0;\n        });\n        pickedFeatures.providerCoords = filteredResults.reduce(function (coordsSoFar, result) {\n          var _result$imageryLayer;\n          var imageryProvider = (_result$imageryLayer = result.imageryLayer) === null || _result$imageryLayer === void 0 ? void 0 : _result$imageryLayer.imageryProvider;\n          if (imageryProvider) coordsSoFar[imageryProvider.url] = result.coords;\n          return coordsSoFar;\n        }, {});\n        var features = filteredResults.reduce(function (allFeatures, result) {\n          if (_this5.terria.showSplitter && ignoreSplitter === false && (0, _isDefined[\"default\"])(pickedFeatures.pickPosition)) {\n            // Skip this feature, unless the imagery layer is on the picked side or\n            // belongs to both sides of the splitter\n            var screenPosition = _this5._computePositionOnScreen(pickedFeatures.pickPosition);\n            var pickedSide = _this5._getSplitterSideForScreenPosition(screenPosition);\n            var layerDirection = result.imageryLayer.splitDirection;\n            if (!(layerDirection === pickedSide || layerDirection === _SplitDirection[\"default\"].NONE)) {\n              return allFeatures;\n            }\n          }\n          return allFeatures.concat(result.features.map(function (feature) {\n            // For features without a position, use the picked location.\n            if (!(0, _isDefined[\"default\"])(feature.position)) {\n              feature.position = pickedLocation;\n            }\n            return _this5._createFeatureFromImageryLayerFeature(feature);\n          }));\n        }, pickedFeatures.features);\n        (0, _mobx.runInAction)(function () {\n          pickedFeatures.features = features;\n        });\n      })[\"catch\"](function (e) {\n        (0, _mobx.runInAction)(function () {\n          pickedFeatures.isLoading = false;\n          pickedFeatures.error = \"An unknown error occurred while picking features.\";\n        });\n        throw e;\n      })]).then(function () {\n        return undefined;\n      });\n      (0, _mobx.runInAction)(function () {\n        var mapInteractionModeStack = _this5.terria.mapInteractionModeStack;\n        if ((0, _isDefined[\"default\"])(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n          mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures = _this5._pickedFeatures;\n        } else {\n          _this5.terria.pickedFeatures = _this5._pickedFeatures;\n        }\n      });\n    }\n  }, {\n    key: \"_reactToSplitterChanges\",\n    value: function _reactToSplitterChanges() {\n      var _this6 = this;\n      return (0, _mobx.autorun)(function () {\n        var items = _this6.terria.mainViewer.items.get();\n        var showSplitter = _this6.terria.showSplitter;\n        var splitPosition = _this6.terria.splitPosition;\n        items.forEach(function (item) {\n          if (_MappableMixin[\"default\"].isMixedInto(item) && (0, _hasTraits[\"default\"])(item, _SplitterTraits[\"default\"], \"splitDirection\")) {\n            var layers = _this6.getImageryLayersForItem(item);\n            var splitDirection = item.splitDirection;\n            layers.forEach((0, _mobx.action)(function (layer) {\n              if (showSplitter) {\n                layer.splitDirection = splitDirection;\n                layer.splitPosition = splitPosition;\n              } else {\n                layer.splitDirection = _SplitDirection[\"default\"].NONE;\n                layer.splitPosition = splitPosition;\n              }\n            }));\n          }\n        });\n        _this6.notifyRepaintRequired();\n      });\n    }\n  }, {\n    key: \"getImageryLayersForItem\",\n    value: function getImageryLayersForItem(item) {\n      var _this7 = this;\n      return (0, _filterOutUndefined[\"default\"])(item.mapItems.map(function (m) {\n        if (_MappableMixin.ImageryParts.is(m)) {\n          var layer = _this7._makeImageryLayerFromParts(m, item);\n          return layer instanceof _ImageryProviderLeafletTileLayer[\"default\"] || layer instanceof _ImageryProviderLeafletGridLayer[\"default\"] ? layer : undefined;\n        }\n      }));\n    }\n\n    /**\r\n     * Computes the screen position of a given world position.\r\n     * @param position The world position in Earth-centered Fixed coordinates.\r\n     * @param [result] The instance to which to copy the result.\r\n     * @return The screen position, or undefined if the position is not on the screen.\r\n     */\n  }, {\n    key: \"_computePositionOnScreen\",\n    value: function _computePositionOnScreen(position, result) {\n      var cartographicScratch = new _Cartographic[\"default\"]();\n      var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(position, cartographicScratch);\n      var point = this.map.latLngToContainerPoint(_LeafletPatched[\"default\"].latLng(_Math[\"default\"].toDegrees(cartographic.latitude), _Math[\"default\"].toDegrees(cartographic.longitude)));\n      if ((0, _isDefined[\"default\"])(result)) {\n        result.x = point.x;\n        result.y = point.y;\n      } else {\n        result = new _Cartesian[\"default\"](point.x, point.y);\n      }\n      return result;\n    }\n  }, {\n    key: \"_selectFeature\",\n    value: function _selectFeature(feature) {\n      this._highlightFeature(feature);\n      if ((0, _isDefined[\"default\"])(feature) && (0, _isDefined[\"default\"])(feature.position)) {\n        var cartographicScratch = new _Cartographic[\"default\"]();\n        var cartesianPosition = feature.position.getValue(this.terria.timelineClock.currentTime);\n        if (cartesianPosition === undefined) {\n          this._selectionIndicator.animateSelectionIndicatorDepart();\n          return;\n        }\n        var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(cartesianPosition, cartographicScratch);\n        this._selectionIndicator.setLatLng(_LeafletPatched[\"default\"].latLng([_Math[\"default\"].toDegrees(cartographic.latitude), _Math[\"default\"].toDegrees(cartographic.longitude)]));\n        this._selectionIndicator.animateSelectionIndicatorAppear();\n      } else {\n        this._selectionIndicator.animateSelectionIndicatorDepart();\n      }\n    }\n  }, {\n    key: \"getClipsForSplitter\",\n    value: function getClipsForSplitter() {\n      var clipLeft = \"\";\n      var clipRight = \"\";\n      var clipPositionWithinMap = 0;\n      var clipX = 0;\n      if (this.terria.showSplitter) {\n        var map = this.map;\n        var size = map.getSize();\n        var nw = map.containerPointToLayerPoint([0, 0]);\n        var se = map.containerPointToLayerPoint(size);\n        clipPositionWithinMap = size.x * this.terria.splitPosition;\n        clipX = Math.round(nw.x + clipPositionWithinMap);\n        clipLeft = \"rect(\" + [nw.y, clipX, se.y, nw.x].join(\"px,\") + \"px)\";\n        clipRight = \"rect(\" + [nw.y, se.x, se.y, clipX].join(\"px,\") + \"px)\";\n      }\n      return {\n        left: clipLeft,\n        right: clipRight,\n        clipPositionWithinMap: clipPositionWithinMap,\n        clipX: clipX\n      };\n    }\n  }, {\n    key: \"isSplitterDragThumb\",\n    value: function isSplitterDragThumb(element) {\n      return element.className && element.className.indexOf && element.className.indexOf(\"tjs-splitter__thumb\") >= 0;\n    }\n  }, {\n    key: \"captureScreenshot\",\n    value: function captureScreenshot() {\n      var _this8 = this;\n      // Temporarily hide the map credits.\n      this._attributionControl.remove();\n      try {\n        // html2canvas can't handle the clip style which is used for the splitter. So if the splitter is active, we render\n        // a left image and a right image and compose them. Also remove the splitter drag thumb.\n        var promise;\n        if (this.terria.showSplitter) {\n          var clips = this.getClipsForSplitter();\n          var clipLeft = clips.left.replace(/ /g, \"\");\n          var clipRight = clips.right.replace(/ /g, \"\");\n          promise = (0, _terriajsHtml2canvas[\"default\"])(this.map.getContainer(), {\n            useCORS: true,\n            ignoreElements: function ignoreElements(element) {\n              return element.style.clip !== undefined && element.style.clip !== null && element.style.clip.replace(/ /g, \"\") === clipRight || _this8.isSplitterDragThumb(element);\n            }\n          }).then(function (leftCanvas) {\n            return (0, _terriajsHtml2canvas[\"default\"])(_this8.map.getContainer(), {\n              useCORS: true,\n              ignoreElements: function ignoreElements(element) {\n                return element.style.clip !== undefined && element.style.clip !== null && element.style.clip.replace(/ /g, \"\") === clipLeft || _this8.isSplitterDragThumb(element);\n              }\n            }).then(function (rightCanvas) {\n              var combined = document.createElement(\"canvas\");\n              combined.width = leftCanvas.width;\n              combined.height = leftCanvas.height;\n              var context = combined.getContext(\"2d\");\n              if (context === undefined || context === null) {\n                // Error\n                return null;\n              }\n              var split = clips.clipPositionWithinMap * window.devicePixelRatio;\n              context.drawImage(leftCanvas, 0, 0, split, combined.height, 0, 0, split, combined.height);\n              context.drawImage(rightCanvas, split, 0, combined.width - split, combined.height, split, 0, combined.width - split, combined.height);\n              return combined;\n            });\n          });\n        } else {\n          promise = (0, _terriajsHtml2canvas[\"default\"])(this.map.getContainer(), {\n            useCORS: true\n          });\n        }\n        return promise.then(function (canvas) {\n          return canvas.toDataURL(\"image/png\");\n        })[\"finally\"](function () {\n          _this8._attributionControl.addTo(_this8.map);\n        });\n      } catch (e) {\n        this._attributionControl.addTo(this.map);\n        return Promise.reject(e);\n      }\n    }\n  }, {\n    key: \"_addVectorTileHighlight\",\n    value: function _addVectorTileHighlight(imageryProvider, rectangle) {\n      var map = this.map;\n      var options = {\n        opacity: 1,\n        bounds: (0, _rectangleToLatLngBounds[\"default\"])(rectangle)\n      };\n      if ((0, _isDefined[\"default\"])(map.options.maxZoom)) {\n        options.maxZoom = map.options.maxZoom;\n      }\n      var layer = new _ImageryProviderLeafletGridLayer[\"default\"](this, imageryProvider, options);\n      layer.addTo(map);\n      layer.bringToFront();\n      return function () {\n        map.removeLayer(layer);\n      };\n    }\n  }]);\n}(_GlobeOrMap2[\"default\"]), _descriptor = _applyDecoratedDescriptor(_class.prototype, \"size\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"nw\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"se\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _applyDecoratedDescriptor(_class.prototype, \"updateMapObservables\", [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, \"updateMapObservables\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"attributions\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"attributions\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"availableCatalogItems\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"availableCatalogItems\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"availableDataSources\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"availableDataSources\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"_featurePicked\", [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, \"_featurePicked\"), _class.prototype), _class);\nfunction isImageryLayer(someLayer) {\n  return \"imageryProvider\" in someLayer;\n}\nfunction isDataSource(object) {\n  return \"entities\" in object;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXQudHM/ZmQ4MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHcmlkTGF5ZXIgfSBmcm9tIFwibGVhZmxldFwiO1xyXG5pbXBvcnQge1xyXG4gIGFjdGlvbixcclxuICBhdXRvcnVuLFxyXG4gIGNvbXB1dGVkLFxyXG4gIElSZWFjdGlvbkRpc3Bvc2VyLFxyXG4gIG1ha2VPYnNlcnZhYmxlLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgcmVhY3Rpb24sXHJcbiAgcnVuSW5BY3Rpb25cclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgeyBjb21wdXRlZEZuIH0gZnJvbSBcIm1vYngtdXRpbHNcIjtcclxuaW1wb3J0IENhcnRlc2lhbjIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9DYXJ0ZXNpYW4yXCI7XHJcbmltcG9ydCBDYXJ0ZXNpYW4zIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydGVzaWFuM1wiO1xyXG5pbXBvcnQgQ2FydG9ncmFwaGljIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydG9ncmFwaGljXCI7XHJcbmltcG9ydCBDbG9jayBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0Nsb2NrXCI7XHJcbmltcG9ydCBkZWZhdWx0VmFsdWUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9kZWZhdWx0VmFsdWVcIjtcclxuaW1wb3J0IEVsbGlwc29pZCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0VsbGlwc29pZFwiO1xyXG5pbXBvcnQgRXZlbnRIZWxwZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9FdmVudEhlbHBlclwiO1xyXG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcclxuaW1wb3J0IFJlY3RhbmdsZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL1JlY3RhbmdsZVwiO1xyXG5pbXBvcnQgRGF0YVNvdXJjZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9EYXRhU291cmNlXCI7XHJcbmltcG9ydCBEYXRhU291cmNlQ29sbGVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9EYXRhU291cmNlQ29sbGVjdGlvblwiO1xyXG5pbXBvcnQgRW50aXR5IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eVwiO1xyXG5pbXBvcnQgSW1hZ2VyeVByb3ZpZGVyIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL1NjZW5lL0ltYWdlcnlQcm92aWRlclwiO1xyXG5pbXBvcnQgU3BsaXREaXJlY3Rpb24gZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvU3BsaXREaXJlY3Rpb25cIjtcclxuaW1wb3J0IGh0bWwyY2FudmFzIGZyb20gXCJ0ZXJyaWFqcy1odG1sMmNhbnZhc1wiO1xyXG5pbXBvcnQgZmlsdGVyT3V0VW5kZWZpbmVkIGZyb20gXCIuLi9Db3JlL2ZpbHRlck91dFVuZGVmaW5lZFwiO1xyXG5pbXBvcnQgaXNEZWZpbmVkIGZyb20gXCIuLi9Db3JlL2lzRGVmaW5lZFwiO1xyXG5pbXBvcnQgTGF0TG9uSGVpZ2h0IGZyb20gXCIuLi9Db3JlL0xhdExvbkhlaWdodFwiO1xyXG5pbXBvcnQgcnVuTGF0ZXIgZnJvbSBcIi4uL0NvcmUvcnVuTGF0ZXJcIjtcclxuaW1wb3J0IE1hcGJveFZlY3RvclRpbGVJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcIi4uL01hcC9JbWFnZXJ5UHJvdmlkZXIvTWFwYm94VmVjdG9yVGlsZUltYWdlcnlQcm92aWRlclwiO1xyXG5pbXBvcnQgUHJvdG9tYXBzSW1hZ2VyeVByb3ZpZGVyIGZyb20gXCIuLi9NYXAvSW1hZ2VyeVByb3ZpZGVyL1Byb3RvbWFwc0ltYWdlcnlQcm92aWRlclwiO1xyXG5pbXBvcnQgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllciwge1xyXG4gIGlzSW1hZ2VyeVByb3ZpZGVyR3JpZExheWVyIGFzIHN1cHBvcnRzSW1hZ2VyeVByb3ZpZGVyR3JpZExheWVyXHJcbn0gZnJvbSBcIi4uL01hcC9MZWFmbGV0L0ltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXJcIjtcclxuaW1wb3J0IEltYWdlcnlQcm92aWRlckxlYWZsZXRUaWxlTGF5ZXIgZnJvbSBcIi4uL01hcC9MZWFmbGV0L0ltYWdlcnlQcm92aWRlckxlYWZsZXRUaWxlTGF5ZXJcIjtcclxuaW1wb3J0IExlYWZsZXREYXRhU291cmNlRGlzcGxheSBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5XCI7XHJcbmltcG9ydCBMZWFmbGV0U2NlbmUgZnJvbSBcIi4uL01hcC9MZWFmbGV0L0xlYWZsZXRTY2VuZVwiO1xyXG5pbXBvcnQgTGVhZmxldFNlbGVjdGlvbkluZGljYXRvciBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvTGVhZmxldFNlbGVjdGlvbkluZGljYXRvclwiO1xyXG5pbXBvcnQgTGVhZmxldFZpc3VhbGl6ZXIgZnJvbSBcIi4uL01hcC9MZWFmbGV0L0xlYWZsZXRWaXN1YWxpemVyXCI7XHJcbmltcG9ydCBMIGZyb20gXCIuLi9NYXAvTGVhZmxldFBhdGNoZWRcIjtcclxuaW1wb3J0IFBpY2tlZEZlYXR1cmVzLCB7XHJcbiAgUHJvdmlkZXJDb29yZHMsXHJcbiAgUHJvdmlkZXJDb29yZHNNYXBcclxufSBmcm9tIFwiLi4vTWFwL1BpY2tlZEZlYXR1cmVzL1BpY2tlZEZlYXR1cmVzXCI7XHJcbmltcG9ydCByZWN0YW5nbGVUb0xhdExuZ0JvdW5kcyBmcm9tIFwiLi4vTWFwL1ZlY3Rvci9yZWN0YW5nbGVUb0xhdExuZ0JvdW5kc1wiO1xyXG5pbXBvcnQgRmVhdHVyZUluZm9VcmxUZW1wbGF0ZU1peGluIGZyb20gXCIuLi9Nb2RlbE1peGlucy9GZWF0dXJlSW5mb1VybFRlbXBsYXRlTWl4aW5cIjtcclxuaW1wb3J0IE1hcHBhYmxlTWl4aW4sIHtcclxuICBJbWFnZXJ5UGFydHMsXHJcbiAgTWFwSXRlbVxyXG59IGZyb20gXCIuLi9Nb2RlbE1peGlucy9NYXBwYWJsZU1peGluXCI7XHJcbmltcG9ydCBUaWxlRXJyb3JIYW5kbGVyTWl4aW4gZnJvbSBcIi4uL01vZGVsTWl4aW5zL1RpbGVFcnJvckhhbmRsZXJNaXhpblwiO1xyXG5pbXBvcnQgSW1hZ2VyeVByb3ZpZGVyVHJhaXRzIGZyb20gXCIuLi9UcmFpdHMvVHJhaXRzQ2xhc3Nlcy9JbWFnZXJ5UHJvdmlkZXJUcmFpdHNcIjtcclxuaW1wb3J0IFNwbGl0dGVyVHJhaXRzIGZyb20gXCIuLi9UcmFpdHMvVHJhaXRzQ2xhc3Nlcy9TcGxpdHRlclRyYWl0c1wiO1xyXG5pbXBvcnQgVGVycmlhVmlld2VyIGZyb20gXCIuLi9WaWV3TW9kZWxzL1RlcnJpYVZpZXdlclwiO1xyXG5pbXBvcnQgQ2FtZXJhVmlldyBmcm9tIFwiLi9DYW1lcmFWaWV3XCI7XHJcbmltcG9ydCBoYXNUcmFpdHMgZnJvbSBcIi4vRGVmaW5pdGlvbi9oYXNUcmFpdHNcIjtcclxuaW1wb3J0IFRlcnJpYUZlYXR1cmUgZnJvbSBcIi4vRmVhdHVyZS9GZWF0dXJlXCI7XHJcbmltcG9ydCBHbG9iZU9yTWFwIGZyb20gXCIuL0dsb2JlT3JNYXBcIjtcclxuaW1wb3J0IHsgTGVhZmxldEF0dHJpYnV0aW9uIH0gZnJvbSBcIi4vTGVhZmxldEF0dHJpYnV0aW9uXCI7XHJcbmltcG9ydCBUZXJyaWEgZnJvbSBcIi4vVGVycmlhXCI7XHJcblxyXG4vLyBUaGlzIGNsYXNzIGlzIGFuIG9ic2VydmVyLiBJdCBwcm9iYWJseSB3b24ndCBjb250YWluIGFueSBvYnNlcnZhYmxlcyBpdHNlbGZcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExlYWZsZXQgZXh0ZW5kcyBHbG9iZU9yTWFwIHtcclxuICByZWFkb25seSB0eXBlID0gXCJMZWFmbGV0XCI7XHJcbiAgcmVhZG9ubHkgdGVycmlhOiBUZXJyaWE7XHJcbiAgcmVhZG9ubHkgdGVycmlhVmlld2VyOiBUZXJyaWFWaWV3ZXI7XHJcbiAgcmVhZG9ubHkgbWFwOiBMLk1hcDtcclxuICByZWFkb25seSBzY2VuZTogTGVhZmxldFNjZW5lO1xyXG4gIHJlYWRvbmx5IGRhdGFTb3VyY2VzOiBEYXRhU291cmNlQ29sbGVjdGlvbiA9IG5ldyBEYXRhU291cmNlQ29sbGVjdGlvbigpO1xyXG4gIHJlYWRvbmx5IGRhdGFTb3VyY2VEaXNwbGF5OiBMZWFmbGV0RGF0YVNvdXJjZURpc3BsYXk7XHJcbiAgcmVhZG9ubHkgY2FuU2hvd1NwbGl0dGVyID0gdHJ1ZTtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9hdHRyaWJ1dGlvbkNvbnRyb2w6IExlYWZsZXRBdHRyaWJ1dGlvbjtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9sZWFmbGV0VmlzdWFsaXplcjogTGVhZmxldFZpc3VhbGl6ZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZXZlbnRIZWxwZXI6IEV2ZW50SGVscGVyO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX3NlbGVjdGlvbkluZGljYXRvcjogTGVhZmxldFNlbGVjdGlvbkluZGljYXRvcjtcclxuICBwcml2YXRlIF9zdG9wUmVxdWVzdEFuaW1hdGlvbkZyYW1lOiBib29sZWFuID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSBfY2VzaXVtUmVxQW5pbUZyYW1lSWQ6IG51bWJlciB8IHVuZGVmaW5lZDtcclxuICBwcml2YXRlIF9waWNrZWRGZWF0dXJlczogUGlja2VkRmVhdHVyZXMgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XHJcbiAgcHJpdmF0ZSBfcGF1c2VNYXBJbnRlcmFjdGlvbkNvdW50ID0gMDtcclxuXHJcbiAgLyogRGlzcG9zZXJzICovXHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZGlzcG9zZVdvcmtiZW5jaE1hcEl0ZW1zU3Vic2NyaXB0aW9uOiAoKSA9PiB2b2lkO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2Rpc3Bvc2VEaXNhYmxlSW50ZXJhY3Rpb25TdWJzY3JpcHRpb246ICgpID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSBfZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbj86ICgpID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSBfZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb246ICgpID0+IHZvaWQ7XHJcblxyXG4gIC8vIFRoZXNlIGFyZSB1c2VkIHRvIHNwbGl0IENlc2l1bVRpbGVMYXllciBhbmQgTWFwYm94Q2FudmFzVmVjdG9yVGlsZUxheWVyXHJcbiAgQG9ic2VydmFibGUgc2l6ZTogTC5Qb2ludCB8IHVuZGVmaW5lZDtcclxuICBAb2JzZXJ2YWJsZSBudzogTC5Qb2ludCB8IHVuZGVmaW5lZDtcclxuICBAb2JzZXJ2YWJsZSBzZTogTC5Qb2ludCB8IHVuZGVmaW5lZDtcclxuXHJcbiAgQGFjdGlvblxyXG4gIHByaXZhdGUgdXBkYXRlTWFwT2JzZXJ2YWJsZXMoKSB7XHJcbiAgICB0aGlzLnNpemUgPSB0aGlzLm1hcC5nZXRTaXplKCk7XHJcbiAgICB0aGlzLm53ID0gdGhpcy5tYXAuY29udGFpbmVyUG9pbnRUb0xheWVyUG9pbnQoWzAsIDBdKTtcclxuICAgIHRoaXMuc2UgPSB0aGlzLm1hcC5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludCh0aGlzLnNpemUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfY3JlYXRlSW1hZ2VyeUxheWVyOiAoXHJcbiAgICBpcDogSW1hZ2VyeVByb3ZpZGVyLFxyXG4gICAgY2xpcHBpbmdSZWN0YW5nbGU6IFJlY3RhbmdsZSB8IHVuZGVmaW5lZFxyXG4gICkgPT4gR3JpZExheWVyID0gY29tcHV0ZWRGbigoaXAsIGNsaXBwaW5nUmVjdGFuZ2xlKSA9PiB7XHJcbiAgICBjb25zdCBsYXllck9wdGlvbnMgPSB7XHJcbiAgICAgIG1heFpvb206IHRoaXMudGVycmlhLmNvbmZpZ1BhcmFtZXRlcnMubGVhZmxldE1heFpvb20sXHJcbiAgICAgIGJvdW5kczogY2xpcHBpbmdSZWN0YW5nbGUgJiYgcmVjdGFuZ2xlVG9MYXRMbmdCb3VuZHMoY2xpcHBpbmdSZWN0YW5nbGUpXHJcbiAgICB9O1xyXG4gICAgLy8gV2UgaGF2ZSB0d28gZGlmZmVyZW50IGtpbmRzIG9mIEltYWdlcnlQcm92aWRlckxlYWZsZXQgbGF5ZXJzXHJcbiAgICAvLyAtIEdyaWQgbGF5ZXIgd2lsbCB1c2UgdGhlIEltYWdlcnlQcm92aWRlciBpbiB0aGUgbW9yZSB0cmFkaXRpb25hbCB3YXkgLSBjYWxsaW5nIGByZXF1ZXN0SW1hZ2VgIHRvIGRyYXcgdGhlIGltYWdlIG9uIHRvIGEgY2FudmFzXHJcbiAgICAvLyAtIFRpbGUgbGF5ZXIgd2lsbCBwYXNzIHRpbGUgVVJMcyB0byBsZWFmbGV0IG9iamVjdHMgLSB3aGljaCBpcyBhIGJpdCBtb3JlIFwiTGVhZmxldHlcIiB0aGFuIEdyaWQgbGF5ZXJcclxuICAgIC8vIFRpbGUgbGF5ZXIgaXMgcHJlZmVycmVkLiBHcmlkIGxheWVyIG1haW5seSBleGlzdHMgZm9yIGN1c3RvbSBJbWFnZXJ5IFByb3ZpZGVycyB3aGljaCBhcmVuJ3QganVzdCBhIHRpbGUgb2YgaW1hZ2UgVVJMc1xyXG4gICAgaWYgKHN1cHBvcnRzSW1hZ2VyeVByb3ZpZGVyR3JpZExheWVyKGlwKSkge1xyXG4gICAgICByZXR1cm4gbmV3IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIodGhpcywgaXAsIGxheWVyT3B0aW9ucyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmV3IEltYWdlcnlQcm92aWRlckxlYWZsZXRUaWxlTGF5ZXIodGhpcywgaXAsIGxheWVyT3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIHByaXZhdGUgX21ha2VJbWFnZXJ5TGF5ZXJGcm9tUGFydHMoXHJcbiAgICBwYXJ0czogSW1hZ2VyeVBhcnRzLFxyXG4gICAgaXRlbTogTWFwcGFibGVNaXhpbi5JbnN0YW5jZVxyXG4gICkge1xyXG4gICAgaWYgKHBhcnRzLmltYWdlcnlQcm92aWRlciA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdW5kZWZpbmVkO1xyXG5cclxuICAgIGlmIChUaWxlRXJyb3JIYW5kbGVyTWl4aW4uaXNNaXhlZEludG8oaXRlbSkpIHtcclxuICAgICAgLy8gYmVjYXVzZSB0aGlzIGNvZGUgcGF0aCBjYW4gcnVuIG11bHRpcGxlIHRpbWVzLCBtYWtlIHN1cmUgd2UgcmVtb3ZlIHRoZVxyXG4gICAgICAvLyBoYW5kbGVyIGlmIGl0IGlzIGFscmVhZHkgcmVnaXN0ZXJlZFxyXG4gICAgICBwYXJ0cy5pbWFnZXJ5UHJvdmlkZXIuZXJyb3JFdmVudC5yZW1vdmVFdmVudExpc3RlbmVyKFxyXG4gICAgICAgIGl0ZW0ub25UaWxlTG9hZEVycm9yLFxyXG4gICAgICAgIGl0ZW1cclxuICAgICAgKTtcclxuICAgICAgcGFydHMuaW1hZ2VyeVByb3ZpZGVyLmVycm9yRXZlbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICBpdGVtLm9uVGlsZUxvYWRFcnJvcixcclxuICAgICAgICBpdGVtXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5fY3JlYXRlSW1hZ2VyeUxheWVyKFxyXG4gICAgICBwYXJ0cy5pbWFnZXJ5UHJvdmlkZXIsXHJcbiAgICAgIHBhcnRzLmNsaXBwaW5nUmVjdGFuZ2xlXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IodGVycmlhVmlld2VyOiBUZXJyaWFWaWV3ZXIsIGNvbnRhaW5lcjogc3RyaW5nIHwgSFRNTEVsZW1lbnQpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICBtYWtlT2JzZXJ2YWJsZSh0aGlzKTtcclxuICAgIHRoaXMudGVycmlhID0gdGVycmlhVmlld2VyLnRlcnJpYTtcclxuICAgIHRoaXMudGVycmlhVmlld2VyID0gdGVycmlhVmlld2VyO1xyXG4gICAgdGhpcy5tYXAgPSBMLm1hcChjb250YWluZXIsIHtcclxuICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICBhdHRyaWJ1dGlvbkNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICB6b29tU25hcDogMSwgLy8gQ2hhbmdlIHRvICAwLjIgZm9yIGluY3JlbWVudGFsIHpvb20gd2hlbiBDaHJvbWUgZml4ZXMgY2FudmFzIHNjYWxpbmcgZ2Fwc1xyXG4gICAgICBwcmVmZXJDYW52YXM6IHRydWUsXHJcbiAgICAgIHdvcmxkQ29weUp1bXA6IGZhbHNlXHJcbiAgICB9KS5zZXRWaWV3KFstMjguNSwgMTM1XSwgNSk7XHJcblxyXG4gICAgdGhpcy5tYXAub24oXCJtb3ZlXCIsICgpID0+IHRoaXMudXBkYXRlTWFwT2JzZXJ2YWJsZXMoKSk7XHJcbiAgICB0aGlzLm1hcC5vbihcInpvb21cIiwgKCkgPT4gdGhpcy51cGRhdGVNYXBPYnNlcnZhYmxlcygpKTtcclxuXHJcbiAgICB0aGlzLnNjZW5lID0gbmV3IExlYWZsZXRTY2VuZSh0aGlzLm1hcCk7XHJcblxyXG4gICAgdGhpcy5fYXR0cmlidXRpb25Db250cm9sID0gbmV3IExlYWZsZXRBdHRyaWJ1dGlvbih0aGlzLnRlcnJpYSk7XHJcbiAgICB0aGlzLm1hcC5hZGRDb250cm9sKHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbCk7XHJcblxyXG4gICAgdGhpcy5fbGVhZmxldFZpc3VhbGl6ZXIgPSBuZXcgTGVhZmxldFZpc3VhbGl6ZXIoKTtcclxuICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvciA9IG5ldyBMZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yKHRoaXMpO1xyXG5cclxuICAgIHRoaXMuZGF0YVNvdXJjZURpc3BsYXkgPSBuZXcgTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5KHtcclxuICAgICAgc2NlbmU6IHRoaXMuc2NlbmUsXHJcbiAgICAgIGRhdGFTb3VyY2VDb2xsZWN0aW9uOiB0aGlzLmRhdGFTb3VyY2VzLFxyXG4gICAgICB2aXN1YWxpemVyc0NhbGxiYWNrOiB0aGlzLl9sZWFmbGV0VmlzdWFsaXplci52aXN1YWxpemVyc0NhbGxiYWNrXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9ldmVudEhlbHBlciA9IG5ldyBFdmVudEhlbHBlcigpO1xyXG5cclxuICAgIHRoaXMuX2V2ZW50SGVscGVyLmFkZCh0aGlzLnRlcnJpYS50aW1lbGluZUNsb2NrLm9uVGljaywgKChjbG9jazogQ2xvY2spID0+IHtcclxuICAgICAgdGhpcy5kYXRhU291cmNlRGlzcGxheS51cGRhdGUoY2xvY2suY3VycmVudFRpbWUpO1xyXG4gICAgfSkgYXMgYW55KTtcclxuXHJcbiAgICBjb25zdCB0aWNrZXIgPSAoKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5fc3RvcFJlcXVlc3RBbmltYXRpb25GcmFtZSkge1xyXG4gICAgICAgIHRoaXMudGVycmlhLnRpbWVsaW5lQ2xvY2sudGljaygpO1xyXG4gICAgICAgIHRoaXMuX2Nlc2l1bVJlcUFuaW1GcmFtZUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2tlcik7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8gU3RhcnQgdGlja2VyIGFzeW5jaHJvbm91c2x5IHRvIGF2b2lkIGNhbGxpbmcgYW4gYWN0aW9uIGluIHRoZSBjb25zY3RydWN0b3JcclxuICAgIHJ1bkxhdGVyKHRpY2tlcik7XHJcblxyXG4gICAgdGhpcy5fZGlzcG9zZVdvcmtiZW5jaE1hcEl0ZW1zU3Vic2NyaXB0aW9uID0gdGhpcy5vYnNlcnZlTW9kZWxMYXllcigpO1xyXG4gICAgdGhpcy5fZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24gPSB0aGlzLl9yZWFjdFRvU3BsaXR0ZXJDaGFuZ2VzKCk7XHJcblxyXG4gICAgdGhpcy5fZGlzcG9zZURpc2FibGVJbnRlcmFjdGlvblN1YnNjcmlwdGlvbiA9IGF1dG9ydW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXAgPSB0aGlzLm1hcDtcclxuICAgICAgY29uc3QgaW50ZXJhY3Rpb25zID0gZmlsdGVyT3V0VW5kZWZpbmVkKFtcclxuICAgICAgICBtYXAudG91Y2hab29tLFxyXG4gICAgICAgIG1hcC5kb3VibGVDbGlja1pvb20sXHJcbiAgICAgICAgbWFwLnNjcm9sbFdoZWVsWm9vbSxcclxuICAgICAgICBtYXAuYm94Wm9vbSxcclxuICAgICAgICBtYXAua2V5Ym9hcmQsXHJcbiAgICAgICAgbWFwLmRyYWdnaW5nLFxyXG4gICAgICAgIG1hcC50YXBIb2xkXHJcbiAgICAgIF0pO1xyXG4gICAgICBjb25zdCBwaWNrTG9jYXRpb24gPSB0aGlzLnBpY2tMb2NhdGlvbi5iaW5kKHRoaXMpO1xyXG4gICAgICBjb25zdCBwaWNrRmVhdHVyZSA9IChlbnRpdHk6IEVudGl0eSwgZXZlbnQ6IEwuTGVhZmxldE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICB0aGlzLl9mZWF0dXJlUGlja2VkKGVudGl0eSwgZXZlbnQpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gVXBkYXRlIG1vdXNlIGNvb3JkcyBvbiBtb3VzZSBtb3ZlXHJcbiAgICAgIHRoaXMubWFwLm9uKFwibW91c2Vtb3ZlXCIsIChlOiBMLkxlYWZsZXRFdmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1vdXNlRXZlbnQgPSBlIGFzIEwuTGVhZmxldE1vdXNlRXZlbnQ7XHJcbiAgICAgICAgdGhpcy5tb3VzZUNvb3Jkcy51cGRhdGVDb29yZGluYXRlc0Zyb21MZWFmbGV0KFxyXG4gICAgICAgICAgdGhpcy50ZXJyaWEsXHJcbiAgICAgICAgICBtb3VzZUV2ZW50Lm9yaWdpbmFsRXZlbnRcclxuICAgICAgICApO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICh0aGlzLnRlcnJpYVZpZXdlci5kaXNhYmxlSW50ZXJhY3Rpb24pIHtcclxuICAgICAgICBpbnRlcmFjdGlvbnMuZm9yRWFjaCgoaGFuZGxlcikgPT4gaGFuZGxlci5kaXNhYmxlKCkpO1xyXG4gICAgICAgIHRoaXMubWFwLm9mZihcImNsaWNrXCIsIHBpY2tMb2NhdGlvbik7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5mZWF0dXJlQ2xpY2tlZC5yZW1vdmVFdmVudExpc3RlbmVyKHBpY2tGZWF0dXJlKTtcclxuICAgICAgICB0aGlzLl9kaXNwb3NlU2VsZWN0ZWRGZWF0dXJlU3Vic2NyaXB0aW9uICYmXHJcbiAgICAgICAgICB0aGlzLl9kaXNwb3NlU2VsZWN0ZWRGZWF0dXJlU3Vic2NyaXB0aW9uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaW50ZXJhY3Rpb25zLmZvckVhY2goKGhhbmRsZXIpID0+IGhhbmRsZXIuZW5hYmxlKCkpO1xyXG4gICAgICAgIHRoaXMubWFwLm9uKFwiY2xpY2tcIiwgcGlja0xvY2F0aW9uKTtcclxuICAgICAgICB0aGlzLnNjZW5lLmZlYXR1cmVDbGlja2VkLmFkZEV2ZW50TGlzdGVuZXIocGlja0ZlYXR1cmUpO1xyXG4gICAgICAgIHRoaXMuX2Rpc3Bvc2VTZWxlY3RlZEZlYXR1cmVTdWJzY3JpcHRpb24gPSBhdXRvcnVuKCgpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGZlYXR1cmUgPSB0aGlzLnRlcnJpYS5zZWxlY3RlZEZlYXR1cmU7XHJcbiAgICAgICAgICB0aGlzLl9zZWxlY3RGZWF0dXJlKGZlYXR1cmUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9pbml0UHJvZ3Jlc3NFdmVudCgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGF0dHJpYnV0aW9uUHJlZml4KCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5wcmVmaXg7XHJcbiAgfVxyXG5cclxuICBAY29tcHV0ZWRcclxuICBnZXQgYXR0cmlidXRpb25zKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5kYXRhQXR0cmlidXRpb25zO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogc2V0cyB1cCBsb2FkaW5nIGxpc3RlbmVyc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgX2luaXRQcm9ncmVzc0V2ZW50KCkge1xyXG4gICAgY29uc3Qgb25UaWxlTG9hZENoYW5nZSA9ICgpID0+IHtcclxuICAgICAgbGV0IHRpbGVzTG9hZGluZ0NvdW50ID0gMDtcclxuXHJcbiAgICAgIHRoaXMubWFwLmVhY2hMYXllcihmdW5jdGlvbiAobGF5ZXJPckdyaWRsYXllcikge1xyXG4gICAgICAgIC8vIF90aWxlcyBpcyBwcm90ZWN0ZWQgYnV0IG91ciBrbm9ja291dC1sb2FkaW5nLWxvZ2ljIGFjY2Vzc2VzIGl0IGhlcmUgYW55d2F5XHJcbiAgICAgICAgY29uc3QgbGF5ZXIgPSBsYXllck9yR3JpZGxheWVyIGFzIGFueTtcclxuICAgICAgICBpZiAobGF5ZXI/Ll90aWxlcykge1xyXG4gICAgICAgICAgLy8gQ291bnQgYWxsIHRpbGVzIG5vdCBtYXJrZWQgYXMgbG9hZGVkXHJcbiAgICAgICAgICB0aWxlc0xvYWRpbmdDb3VudCArPSBPYmplY3Qua2V5cyhsYXllci5fdGlsZXMpLmZpbHRlcihcclxuICAgICAgICAgICAgKGtleSkgPT4gIWxheWVyLl90aWxlc1trZXldLmxvYWRlZFxyXG4gICAgICAgICAgKS5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuX3VwZGF0ZVRpbGVzTG9hZGluZ0NvdW50KHRpbGVzTG9hZGluZ0NvdW50KTtcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5tYXAub24oXHJcbiAgICAgIFwibGF5ZXJhZGRcIixcclxuICAgICAgZnVuY3Rpb24gKGV2dDogYW55KSB7XHJcbiAgICAgICAgLy8gVGhpcyBjaGVjayBtYWtlcyBzdXJlIHdlIG9ubHkgd2F0Y2ggdGlsZSBsYXllcnMsIGFuZCBhbHNvIHByb3RlY3RzIHVzIGlmIHRoaXMgcHJpdmF0ZSB2YXJpYWJsZSBnZXRzIGNoYW5nZWQuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBldnQubGF5ZXIuX3RpbGVzICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICBldnQubGF5ZXIub24oXCJ0aWxlbG9hZHN0YXJ0IHRpbGVsb2FkIGxvYWRcIiwgb25UaWxlTG9hZENoYW5nZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LmJpbmQodGhpcylcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5tYXAub24oXHJcbiAgICAgIFwibGF5ZXJyZW1vdmVcIixcclxuICAgICAgZnVuY3Rpb24gKGV2dDogYW55KSB7XHJcbiAgICAgICAgZXZ0LmxheWVyLm9mZihcInRpbGVsb2Fkc3RhcnQgdGlsZWxvYWQgbG9hZFwiLCBvblRpbGVMb2FkQ2hhbmdlKTtcclxuICAgICAgfS5iaW5kKHRoaXMpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGljayBmZWF0dXJlIGZyb20gbW91c2UgY2xpY2sgZXZlbnQuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBwaWNrTG9jYXRpb24oZTogTC5MZWFmbGV0RXZlbnQpIHtcclxuICAgIGNvbnN0IG1vdXNlRXZlbnQgPSBlIGFzIEwuTGVhZmxldE1vdXNlRXZlbnQ7XHJcblxyXG4gICAgLy8gSGFuZGxlIGNsaWNrIGV2ZW50cyB0aGF0IGNyb3NzIHRoZSBhbnRpLW1lcmlkaWFuXHJcbiAgICBpZiAobW91c2VFdmVudC5sYXRsbmcubG5nID4gMTgwIHx8IG1vdXNlRXZlbnQubGF0bG5nLmxuZyA8IC0xODApIHtcclxuICAgICAgbW91c2VFdmVudC5sYXRsbmcgPSBtb3VzZUV2ZW50LmxhdGxuZy53cmFwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaWYgKCF0aGlzLl9kcmFnYm94Y29tcGxldGVkICYmIHRoYXQubWFwLmRyYWdnaW5nLmVuYWJsZWQoKSkge1xyXG4gICAgdGhpcy5fcGlja0ZlYXR1cmVzKG1vdXNlRXZlbnQubGF0bG5nKTtcclxuICAgIC8vIH1cclxuICAgIC8vIHRoaXMuX2RyYWdib3hjb21wbGV0ZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGdldENvbnRhaW5lcigpOiBIVE1MRWxlbWVudCB7XHJcbiAgICByZXR1cm4gdGhpcy5tYXAuZ2V0Q29udGFpbmVyKCk7XHJcbiAgfVxyXG5cclxuICBwYXVzZU1hcEludGVyYWN0aW9uKCk6IHZvaWQge1xyXG4gICAgKyt0aGlzLl9wYXVzZU1hcEludGVyYWN0aW9uQ291bnQ7XHJcbiAgICBpZiAodGhpcy5fcGF1c2VNYXBJbnRlcmFjdGlvbkNvdW50ID09PSAxKSB7XHJcbiAgICAgIHRoaXMubWFwLmRyYWdnaW5nLmRpc2FibGUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlc3VtZU1hcEludGVyYWN0aW9uKCk6IHZvaWQge1xyXG4gICAgLS10aGlzLl9wYXVzZU1hcEludGVyYWN0aW9uQ291bnQ7XHJcbiAgICBpZiAodGhpcy5fcGF1c2VNYXBJbnRlcmFjdGlvbkNvdW50ID09PSAwKSB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLl9wYXVzZU1hcEludGVyYWN0aW9uQ291bnQgPT09IDApIHtcclxuICAgICAgICAgIHRoaXMubWFwLmRyYWdnaW5nLmVuYWJsZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgMCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbiAmJlxyXG4gICAgICB0aGlzLl9kaXNwb3NlU2VsZWN0ZWRGZWF0dXJlU3Vic2NyaXB0aW9uKCk7XHJcbiAgICB0aGlzLl9kaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbigpO1xyXG4gICAgdGhpcy5fZGlzcG9zZVdvcmtiZW5jaE1hcEl0ZW1zU3Vic2NyaXB0aW9uKCk7XHJcbiAgICB0aGlzLl9ldmVudEhlbHBlci5yZW1vdmVBbGwoKTtcclxuICAgIHRoaXMuX2Rpc3Bvc2VEaXNhYmxlSW50ZXJhY3Rpb25TdWJzY3JpcHRpb24oKTtcclxuICAgIC8vIFRoaXMgdmFyaWFibGUgcHJldmVudHMgYSByYWNlIGNvbmRpdGlvbiBpZiBkZXN0cm95KCkgaXMgY2FsbGVkXHJcbiAgICAvLyBzeW5jaHJvbm91c2x5IGFzIGEgcmVzdWx0IG9mIHRpbWVsaW5lQ2xvY2sgdGlja2luZyBkdWUgdG8gdGlja2VyKClcclxuICAgIHRoaXMuX3N0b3BSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB0cnVlO1xyXG4gICAgaWYgKGlzRGVmaW5lZCh0aGlzLl9jZXNpdW1SZXFBbmltRnJhbWVJZCkpIHtcclxuICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fY2VzaXVtUmVxQW5pbUZyYW1lSWQpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5kYXRhU291cmNlRGlzcGxheS5kZXN0cm95KCk7XHJcbiAgICB0aGlzLm1hcC5vZmYoXCJtb3ZlXCIpO1xyXG4gICAgdGhpcy5tYXAub2ZmKFwiem9vbVwiKTtcclxuICAgIHRoaXMubWFwLnJlbW92ZSgpO1xyXG4gIH1cclxuXHJcbiAgQGNvbXB1dGVkXHJcbiAgZ2V0IGF2YWlsYWJsZUNhdGFsb2dJdGVtcygpIHtcclxuICAgIGNvbnN0IGNhdGFsb2dJdGVtcyA9IFtcclxuICAgICAgLi4udGhpcy50ZXJyaWFWaWV3ZXIuaXRlbXMuZ2V0KCksXHJcbiAgICAgIHRoaXMudGVycmlhVmlld2VyLmJhc2VNYXBcclxuICAgIF07XHJcbiAgICByZXR1cm4gY2F0YWxvZ0l0ZW1zO1xyXG4gIH1cclxuXHJcbiAgQGNvbXB1dGVkXHJcbiAgZ2V0IGF2YWlsYWJsZURhdGFTb3VyY2VzKCkge1xyXG4gICAgY29uc3QgY2F0YWxvZ0l0ZW1zID0gdGhpcy5hdmFpbGFibGVDYXRhbG9nSXRlbXM7XHJcbiAgICAvKiBIYW5kbGUgZGF0YXNvdXJjZXMgKi9cclxuICAgIGNvbnN0IGFsbE1hcEl0ZW1zID0gKFtdIGFzIE1hcEl0ZW1bXSkuY29uY2F0KFxyXG4gICAgICAuLi5jYXRhbG9nSXRlbXMuZmlsdGVyKGlzRGVmaW5lZCkubWFwKChpdGVtKSA9PiBpdGVtLm1hcEl0ZW1zKVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGRhdGFTb3VyY2VzID0gYWxsTWFwSXRlbXMuZmlsdGVyKGlzRGF0YVNvdXJjZSk7XHJcbiAgICByZXR1cm4gZGF0YVNvdXJjZXM7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9ic2VydmVNb2RlbExheWVyKCkge1xyXG4gICAgLy8gU2V0dXAgcmVhY3Rpb24gdG8gc3luYyBkYXRTb3VyY2VzIGNvbGxlY3Rpb24gd2l0aCBhdmFpbGFibGVEYXRhU291cmNlc1xyXG4gICAgLy9cclxuICAgIC8vIFRvIGF2b2lkIGJ1Z2d5IGNvbmN1cnJlbnQgc3luY3MsIHdlIGhhdmUgdG8gZW5zdXJlIHRoYXQgZXZlbiB3aGVuXHJcbiAgICAvLyBtdWx0aXBsZSBzeW5jIHJlYWN0aW9ucyBhcmUgdHJpZ2dlcmVkLCB3ZSBydW4gdGhlbSBvbmUgYWZ0ZXIgdGhlXHJcbiAgICAvLyBvdGhlci4gVG8gZG8gdGhpcywgd2UgbWFrZSBlYWNoIHJ1biBvZiB0aGUgcmVhY3Rpb24gd2FpdCBmb3IgdGhlXHJcbiAgICAvLyBwcmV2aW91cyBgc3luY0RhdGFTb3VyY2VzUHJvbWlzZWAgdG8gZmluaXNoIGJlZm9yZSBzdGFydGluZyBpdHNlbGYuXHJcbiAgICBsZXQgc3luY0RhdGFTb3VyY2VzUHJvbWlzZTogUHJvbWlzZTx2b2lkPiA9IFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgY29uc3QgZGF0YVNvdXJjZXNSZWFjdGlvbkRpc3Bvc2VyID0gcmVhY3Rpb24oXHJcbiAgICAgICgpID0+IHRoaXMuYXZhaWxhYmxlRGF0YVNvdXJjZXMsXHJcbiAgICAgICgpID0+IHtcclxuICAgICAgICBzeW5jRGF0YVNvdXJjZXNQcm9taXNlID0gc3luY0RhdGFTb3VyY2VzUHJvbWlzZVxyXG4gICAgICAgICAgLnRoZW4oYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnN5bmNEYXRhU291cmNlQ29sbGVjdGlvbihcclxuICAgICAgICAgICAgICB0aGlzLmF2YWlsYWJsZURhdGFTb3VyY2VzLFxyXG4gICAgICAgICAgICAgIHRoaXMuZGF0YVNvdXJjZXNcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlSZXBhaW50UmVxdWlyZWQoKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XHJcbiAgICAgIH0sXHJcbiAgICAgIHsgZmlyZUltbWVkaWF0ZWx5OiB0cnVlIH1cclxuICAgICk7XHJcblxyXG4gICAgLy8gUmVhY3Rpb24gdG8gc3luYyBpbWFnZXJ5IGZyb20gbW9kZWwgbGF5ZXIgd2l0aCBjZXNpdW0gbWFwXHJcbiAgICBjb25zdCBpbWFnZXJ5UmVhY3Rpb25EaXNwb3NlciA9IGF1dG9ydW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCBjYXRhbG9nSXRlbXMgPSB0aGlzLmF2YWlsYWJsZUNhdGFsb2dJdGVtcztcclxuICAgICAgLy8gRmxhdG1hcFxyXG4gICAgICBjb25zdCBhbGxJbWFnZXJ5TWFwSXRlbXMgPSAoXHJcbiAgICAgICAgW10gYXMge1xyXG4gICAgICAgICAgaXRlbTogTWFwcGFibGVNaXhpbi5JbnN0YW5jZTtcclxuICAgICAgICAgIHBhcnRzOiBJbWFnZXJ5UGFydHM7XHJcbiAgICAgICAgfVtdXHJcbiAgICAgICkuY29uY2F0KFxyXG4gICAgICAgIC4uLmNhdGFsb2dJdGVtc1xyXG4gICAgICAgICAgLmZpbHRlcihpc0RlZmluZWQpXHJcbiAgICAgICAgICAubWFwKChpdGVtKSA9PlxyXG4gICAgICAgICAgICBpdGVtLm1hcEl0ZW1zXHJcbiAgICAgICAgICAgICAgLmZpbHRlcihJbWFnZXJ5UGFydHMuaXMpXHJcbiAgICAgICAgICAgICAgLm1hcCgocGFydHM6IEltYWdlcnlQYXJ0cykgPT4gKHsgaXRlbSwgcGFydHMgfSkpXHJcbiAgICAgICAgICApXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCBhbGxJbWFnZXJ5ID0gYWxsSW1hZ2VyeU1hcEl0ZW1zLm1hcCgoeyBpdGVtLCBwYXJ0cyB9KSA9PiB7XHJcbiAgICAgICAgaWYgKGhhc1RyYWl0cyhpdGVtLCBJbWFnZXJ5UHJvdmlkZXJUcmFpdHMsIFwibGVhZmxldFVwZGF0ZUludGVydmFsXCIpKSB7XHJcbiAgICAgICAgICAocGFydHMuaW1hZ2VyeVByb3ZpZGVyIGFzIGFueSkuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbCA9XHJcbiAgICAgICAgICAgIGl0ZW0ubGVhZmxldFVwZGF0ZUludGVydmFsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgcGFydHM6IHBhcnRzLFxyXG4gICAgICAgICAgbGF5ZXI6IHRoaXMuX21ha2VJbWFnZXJ5TGF5ZXJGcm9tUGFydHMocGFydHMsIGl0ZW0pXHJcbiAgICAgICAgfTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBEZWxldGUgaW1hZ2VyeSBsYXllcnMgbm8gbG9uZ2VyIGluIHRoZSBtb2RlbFxyXG4gICAgICB0aGlzLm1hcC5lYWNoTGF5ZXIoKG1hcExheWVyKSA9PiB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgaXNJbWFnZXJ5TGF5ZXIobWFwTGF5ZXIpIHx8XHJcbiAgICAgICAgICBtYXBMYXllciBpbnN0YW5jZW9mIEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXJcclxuICAgICAgICApIHtcclxuICAgICAgICAgIGNvbnN0IGluZGV4ID0gYWxsSW1hZ2VyeS5maW5kSW5kZXgoKGltKSA9PiBpbS5sYXllciA9PT0gbWFwTGF5ZXIpO1xyXG4gICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLm1hcC5yZW1vdmVMYXllcihtYXBMYXllcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIEFkZCBsYXllciBhbmQgdXBkYXRlIGl0cyB6SW5kZXhcclxuICAgICAgbGV0IHpJbmRleCA9IDEwMDsgLy8gU3RhcnQgYXQgYW4gYXJiaXRyYXJ5IHZhbHVlXHJcbiAgICAgIGFsbEltYWdlcnkucmV2ZXJzZSgpLmZvckVhY2goKHsgcGFydHMsIGxheWVyIH0pID0+IHtcclxuICAgICAgICBpZiAobGF5ZXIgJiYgcGFydHMuc2hvdykge1xyXG4gICAgICAgICAgbGF5ZXIuc2V0T3BhY2l0eShwYXJ0cy5hbHBoYSk7XHJcbiAgICAgICAgICBsYXllci5zZXRaSW5kZXgoekluZGV4KTtcclxuICAgICAgICAgIHpJbmRleCsrO1xyXG5cclxuICAgICAgICAgIGlmICghdGhpcy5tYXAuaGFzTGF5ZXIobGF5ZXIpKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFwLmFkZExheWVyKGxheWVyKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGxheWVyKSB7XHJcbiAgICAgICAgICB0aGlzLm1hcC5yZW1vdmVMYXllcihsYXllcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGRhdGFTb3VyY2VzUmVhY3Rpb25EaXNwb3NlcigpO1xyXG4gICAgICBpbWFnZXJ5UmVhY3Rpb25EaXNwb3NlcigpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN5bmNzIHRoZSBgZGF0YVNvdXJjZXNgIGNvbGxlY3Rpb24gYWdhaW5zdCB0aGUgbGF0ZXN0IGBhdmFpbGFibGVEYXRhU291cmNlc2AuXHJcbiAgICpcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHN5bmNEYXRhU291cmNlQ29sbGVjdGlvbihcclxuICAgIGF2YWlsYWJsZURhdGFTb3VyY2VzOiBEYXRhU291cmNlW10sXHJcbiAgICBkYXRhU291cmNlczogRGF0YVNvdXJjZUNvbGxlY3Rpb25cclxuICApIHtcclxuICAgIC8vIDEuIFJlbW92ZSBkZWxldGVkIGRhdGEgc291cmNlc1xyXG4gICAgLy9cclxuICAgIC8vIEl0ZXJhdGUgYmFja3dhcmRzIGJlY2F1c2Ugd2UncmUgcmVtb3ZpbmcgaXRlbXMuXHJcbiAgICBmb3IgKGxldCBpID0gZGF0YVNvdXJjZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgY29uc3QgZHMgPSBkYXRhU291cmNlcy5nZXQoaSk7XHJcbiAgICAgIGlmIChhdmFpbGFibGVEYXRhU291cmNlcy5pbmRleE9mKGRzKSA9PT0gLTEgfHwgIWRzLnNob3cpIHtcclxuICAgICAgICBkYXRhU291cmNlcy5yZW1vdmUoZHMpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMi4gQWRkIG5ldyBkYXRhIHNvdXJjZXNcclxuICAgIGZvciAoY29uc3QgZHMgb2YgYXZhaWxhYmxlRGF0YVNvdXJjZXMpIHtcclxuICAgICAgaWYgKCFkYXRhU291cmNlcy5jb250YWlucyhkcykgJiYgZHMuc2hvdykge1xyXG4gICAgICAgIGF3YWl0IGRhdGFTb3VyY2VzLmFkZChkcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAzLiBFbnN1cmUgc3RhY2tpbmcgb3JkZXIgbWF0Y2hlcyBvcmRlciBpbiBgYXZhaWxhYmxlRGF0YVNvdXJjZXNgIC0gZmlyc3QgaXRlbSBhcHBlYXJzIG9uIHRvcC5cclxuICAgIHJ1bkluQWN0aW9uKCgpID0+XHJcbiAgICAgIGF2YWlsYWJsZURhdGFTb3VyY2VzLmZvckVhY2goKGRzKSA9PiB7XHJcbiAgICAgICAgLy8gVGhlcmUgaXMgYSBidWdneS91bi1pbnRlbmRlZCBzaWRlLWVmZmVjdCB3aGVuIGNhbGxpbmcgcmFpc2VUb1RvcCgpIHdpdGhcclxuICAgICAgICAvLyBhIHNvdXJjZSB0aGF0IGRvZXNuJ3QgZXhpc3QgaW4gdGhlIGNvbGxlY3Rpb24uIERvaW5nIHRoaXMgd2lsbCByZXBsYWNlXHJcbiAgICAgICAgLy8gdGhlIGxhc3QgZW50cnkgaW4gdGhlIGNvbGxlY3Rpb24gd2l0aCB0aGUgbmV3IG9uZS4gU28gd2Ugc2hvdWxkIGJlXHJcbiAgICAgICAgLy8gY2FyZWZ1bCB0byByYWlzZVRvVG9wKCkgb25seSBpZiB0aGUgRFMgYWxyZWFkeSBleGlzdHMgaW4gdGhlIGNvbGxlY3Rpb24uXHJcbiAgICAgICAgLy8gUmVsZXZhbnQgY29kZTpcclxuICAgICAgICAvLyAgIGh0dHBzOi8vZ2l0aHViLmNvbS9DZXNpdW1HUy9jZXNpdW0vYmxvYi9kYmQ0NTIzMjhhNDhiZmM0ZTE5MjE0Njg2MmE5ZjhmYTE1Nzg5ZGM4L3BhY2thZ2VzL2VuZ2luZS9Tb3VyY2UvRGF0YVNvdXJjZXMvRGF0YVNvdXJjZUNvbGxlY3Rpb24uanMjTDI5OC1MMjk5XHJcbiAgICAgICAgZGF0YVNvdXJjZXMuY29udGFpbnMoZHMpICYmIGRhdGFTb3VyY2VzLnJhaXNlVG9Ub3AoZHMpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGRvWm9vbVRvKFxyXG4gICAgdGFyZ2V0OiBDYW1lcmFWaWV3IHwgUmVjdGFuZ2xlIHwgRGF0YVNvdXJjZSB8IE1hcHBhYmxlTWl4aW4uSW5zdGFuY2UgfCBhbnksXHJcbiAgICBmbGlnaHREdXJhdGlvblNlY29uZHM6IG51bWJlciA9IDMuMFxyXG4gICk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKCFpc0RlZmluZWQodGFyZ2V0KSkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9XHJcbiAgICBsZXQgYm91bmRzO1xyXG5cclxuICAgIGlmIChpc0RlZmluZWQodGFyZ2V0LmVudGl0aWVzKSkge1xyXG4gICAgICBpZiAoaXNEZWZpbmVkKHRoaXMuZGF0YVNvdXJjZURpc3BsYXkpKSB7XHJcbiAgICAgICAgYm91bmRzID0gdGhpcy5kYXRhU291cmNlRGlzcGxheS5nZXRMYXRMbmdCb3VuZHModGFyZ2V0KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IGV4dGVudDtcclxuXHJcbiAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBSZWN0YW5nbGUpIHtcclxuICAgICAgICBleHRlbnQgPSB0YXJnZXQ7XHJcbiAgICAgIH0gZWxzZSBpZiAodGFyZ2V0IGluc3RhbmNlb2YgQ2FtZXJhVmlldykge1xyXG4gICAgICAgIGV4dGVudCA9IHRhcmdldC5yZWN0YW5nbGU7XHJcbiAgICAgIH0gZWxzZSBpZiAoTWFwcGFibGVNaXhpbi5pc01peGVkSW50byh0YXJnZXQpKSB7XHJcbiAgICAgICAgaWYgKGlzRGVmaW5lZCh0YXJnZXQuY2VzaXVtUmVjdGFuZ2xlKSkge1xyXG4gICAgICAgICAgZXh0ZW50ID0gdGFyZ2V0LmNlc2l1bVJlY3RhbmdsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFpc0RlZmluZWQoZXh0ZW50KSkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZG9ab29tVG8odGFyZ2V0Lm1hcEl0ZW1zWzBdLCBmbGlnaHREdXJhdGlvblNlY29uZHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBleHRlbnQgPSB0YXJnZXQucmVjdGFuZ2xlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBFbnN1cmUgZXh0ZW50IGlzIGRlZmluZWQgYmVmb3JlIGFjY2Vzc2luZyBpdHMgcHJvcGVydGllc1xyXG4gICAgICBpZiAoaXNEZWZpbmVkKGV4dGVudCkpIHtcclxuICAgICAgICAvLyBBY2NvdW50IGZvciBhIGJvdW5kaW5nIGJveCBjcm9zc2luZyB0aGUgZGF0ZSBsaW5lLlxyXG4gICAgICAgIGlmIChleHRlbnQuZWFzdCA8IGV4dGVudC53ZXN0KSB7XHJcbiAgICAgICAgICBleHRlbnQgPSBSZWN0YW5nbGUuY2xvbmUoZXh0ZW50KTtcclxuICAgICAgICAgIGV4dGVudC5lYXN0ICs9IENlc2l1bU1hdGguVFdPX1BJO1xyXG4gICAgICAgIH1cclxuICAgICAgICBib3VuZHMgPSByZWN0YW5nbGVUb0xhdExuZ0JvdW5kcyhleHRlbnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBleHRlbnQgaXMgdW5kZWZpbmVkXHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuYWJsZSB0byBkZXRlcm1pbmUgYm91bmRzIGZvciB6b29taW5nLlwiKTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNEZWZpbmVkKGJvdW5kcykpIHtcclxuICAgICAgdGhpcy5tYXAuZmx5VG9Cb3VuZHMoYm91bmRzLCB7XHJcbiAgICAgICAgYW5pbWF0ZTogZmxpZ2h0RHVyYXRpb25TZWNvbmRzID4gMC4wLFxyXG4gICAgICAgIGR1cmF0aW9uOiBmbGlnaHREdXJhdGlvblNlY29uZHNcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q3VycmVudENhbWVyYVZpZXcoKTogQ2FtZXJhVmlldyB7XHJcbiAgICBjb25zdCBib3VuZHMgPSB0aGlzLm1hcC5nZXRCb3VuZHMoKTtcclxuICAgIHJldHVybiBuZXcgQ2FtZXJhVmlldyhcclxuICAgICAgUmVjdGFuZ2xlLmZyb21EZWdyZWVzKFxyXG4gICAgICAgIGJvdW5kcy5nZXRXZXN0KCksXHJcbiAgICAgICAgYm91bmRzLmdldFNvdXRoKCksXHJcbiAgICAgICAgYm91bmRzLmdldEVhc3QoKSxcclxuICAgICAgICBib3VuZHMuZ2V0Tm9ydGgoKVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbm90aWZ5UmVwYWludFJlcXVpcmVkKCk6IHZvaWQge1xyXG4gICAgLy8gTm8gYWN0aW9uIG5lY2Vzc2FyeS5cclxuICB9XHJcblxyXG4gIHBpY2tGcm9tTG9jYXRpb24oXHJcbiAgICBsYXRMbmdIZWlnaHQ6IExhdExvbkhlaWdodCxcclxuICAgIHByb3ZpZGVyQ29vcmRzOiBQcm92aWRlckNvb3Jkc01hcCxcclxuICAgIGV4aXN0aW5nRmVhdHVyZXM6IFRlcnJpYUZlYXR1cmVbXVxyXG4gICk6IHZvaWQge1xyXG4gICAgdGhpcy5fcGlja0ZlYXR1cmVzKFxyXG4gICAgICBMLmxhdExuZyh7XHJcbiAgICAgICAgbGF0OiBsYXRMbmdIZWlnaHQubGF0aXR1ZGUsXHJcbiAgICAgICAgbG5nOiBsYXRMbmdIZWlnaHQubG9uZ2l0dWRlLFxyXG4gICAgICAgIGFsdDogbGF0TG5nSGVpZ2h0LmhlaWdodFxyXG4gICAgICB9KSxcclxuICAgICAgcHJvdmlkZXJDb29yZHMsXHJcbiAgICAgIGV4aXN0aW5nRmVhdHVyZXNcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIFRoZXJlIGFyZSB0d28gXCJsaXN0ZW5lcnNcIiBmb3IgY2xpY2tzIHdoaWNoIGFyZSBzZXQgdXAgaW4gb3VyIGNvbnN0cnVjdG9yLlxyXG4gICAqIC0gT25lIGZpcmVzIGZvciBhbnkgY2xpY2s6IGBtYXAub24oJ2NsaWNrJywgLi4uYC4gIEl0IGNhbGxzIGBwaWNrRmVhdHVyZXNgLlxyXG4gICAqIC0gT25lIGZpcmVzIG9ubHkgZm9yIHZlY3RvciBmZWF0dXJlczogYHRoaXMuc2NlbmUuZmVhdHVyZUNsaWNrZWQuYWRkRXZlbnRMaXN0ZW5lcmAuXHJcbiAgICogICAgSXQgY2FsbHMgYGZlYXR1cmVQaWNrZWRgLCB3aGljaCBjYWxscyBgcGlja0ZlYXR1cmVzYCBhbmQgdGhlbiBhZGRzIHRoZSBmZWF0dXJlIGl0IGZvdW5kLCBpZiBhbnkuXHJcbiAgICogVGhlc2UgZXZlbnRzIGNhbiBmaXJlIGluIGVpdGhlciBvcmRlci5cclxuICAgKiBCaWxsYm9hcmRzIGRvIG5vdCBmaXJlIHRoZSBmaXJzdCBldmVudC5cclxuICAgKlxyXG4gICAqIE5vdGUgdGhhdCBgcGlja0ZlYXR1cmVzYCBkb2VzIG5vdGhpbmcgaWYgYGxlYWZsZXQuX3BpY2tlZEZlYXR1cmVzYCBpcyBhbHJlYWR5IHNldC5cclxuICAgKiBPdGhlcndpc2UsIGl0IHNldHMgaXQsIHJ1bnMgYHJ1bkxhdGVyYCB0byBjbGVhciBpdCwgYW5kIHN0YXJ0cyB0aGUgYXN5bmNocm9ub3VzIHJhc3RlciBmZWF0dXJlIHBpY2tpbmcuXHJcbiAgICpcclxuICAgKiBTbzpcclxuICAgKiBJZiBvbmx5IHRoZSBmaXJzdCBldmVudCBpcyByZWNlaXZlZCwgaXQgdHJpZ2dlcnMgdGhlIHJhc3Rlci1mZWF0dXJlIHBpY2tpbmcgYXMgZGVzaXJlZC5cclxuICAgKiBJZiBib3RoIGFyZSByZWNlaXZlZCBpbiB0aGUgb3JkZXIgYWJvdmUsIHRoZSBzZWNvbmQgYWRkcyB0aGUgdmVjdG9yIGZlYXR1cmVzIHRvIHRoZSBsaXN0IG9mIHJhc3RlciBmZWF0dXJlcyBhcyBkZXNpcmVkLlxyXG4gICAqIElmIGJvdGggYXJlIHJlY2VpdmVkIGluIHRoZSByZXZlcnNlIG9yZGVyLCB0aGUgdmVjdG9yLWZlYXR1cmUgY2xpY2sga2lja3Mgb2ZmIHRoZSBzYW1lIGJlaGF2aW9yIGFzIHRoZSBvdGhlciBjbGljayB3b3VsZCBoYXZlO1xyXG4gICAqIGFuZCB3aGVuIHRoZSBuZXh0IGNsaWNrIGlzIHJlY2VpdmVkLCBpdCBpcyBpZ25vcmVkIC0gYWdhaW4sIGFzIGRlc2lyZWQuXHJcbiAgICovXHJcblxyXG4gIEBhY3Rpb25cclxuICBwcml2YXRlIGFzeW5jIF9mZWF0dXJlUGlja2VkKGVudGl0eTogRW50aXR5LCBldmVudDogTC5MZWFmbGV0TW91c2VFdmVudCkge1xyXG4gICAgdGhpcy5fcGlja0ZlYXR1cmVzKGV2ZW50LmxhdGxuZyk7XHJcblxyXG4gICAgLy8gSWdub3JlIGNsaWNrcyBvbiB0aGUgZmVhdHVyZSBoaWdobGlnaHQuXHJcbiAgICBpZiAoZW50aXR5LmVudGl0eUNvbGxlY3Rpb24gJiYgZW50aXR5LmVudGl0eUNvbGxlY3Rpb24ub3duZXIpIHtcclxuICAgICAgY29uc3Qgb3duZXIgPSBlbnRpdHkuZW50aXR5Q29sbGVjdGlvbi5vd25lcjtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIG93bmVyIGluc3RhbmNlb2YgRGF0YVNvdXJjZSAmJlxyXG4gICAgICAgIG93bmVyLm5hbWUgPT09IEdsb2JlT3JNYXAuX2ZlYXR1cmVIaWdobGlnaHROYW1lXHJcbiAgICAgICkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGZlYXR1cmUgPSBUZXJyaWFGZWF0dXJlLmZyb21FbnRpdHlDb2xsZWN0aW9uT3JFbnRpdHkoZW50aXR5KTtcclxuXHJcbiAgICBjb25zdCBjYXRhbG9nSXRlbSA9IGZlYXR1cmUuX2NhdGFsb2dJdGVtO1xyXG5cclxuICAgIGlmIChcclxuICAgICAgRmVhdHVyZUluZm9VcmxUZW1wbGF0ZU1peGluLmlzTWl4ZWRJbnRvKGNhdGFsb2dJdGVtKSAmJlxyXG4gICAgICB0eXBlb2YgY2F0YWxvZ0l0ZW0uZ2V0RmVhdHVyZXNGcm9tUGlja1Jlc3VsdCA9PT0gXCJmdW5jdGlvblwiICYmXHJcbiAgICAgIHRoaXMudGVycmlhLmFsbG93RmVhdHVyZUluZm9SZXF1ZXN0c1xyXG4gICAgKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhdGFsb2dJdGVtLmdldEZlYXR1cmVzRnJvbVBpY2tSZXN1bHQuYmluZChcclxuICAgICAgICBjYXRhbG9nSXRlbVxyXG4gICAgICApKFxyXG4gICAgICAgIHVuZGVmaW5lZCxcclxuICAgICAgICBlbnRpdHksXHJcbiAgICAgICAgKHRoaXMuX3BpY2tlZEZlYXR1cmVzPy5mZWF0dXJlcy5sZW5ndGggfHwgMCkgPCBjYXRhbG9nSXRlbS5tYXhSZXF1ZXN0c1xyXG4gICAgICApO1xyXG4gICAgICBpZiAocmVzdWx0ICYmIGlzRGVmaW5lZCh0aGlzLl9waWNrZWRGZWF0dXJlcykpIHtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXN1bHQpKSB7XHJcbiAgICAgICAgICB0aGlzLl9waWNrZWRGZWF0dXJlcy5mZWF0dXJlcy5wdXNoKC4uLnJlc3VsdCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzLmZlYXR1cmVzLnB1c2gocmVzdWx0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoaXNEZWZpbmVkKHRoaXMuX3BpY2tlZEZlYXR1cmVzKSkge1xyXG4gICAgICB0aGlzLl9waWNrZWRGZWF0dXJlcy5mZWF0dXJlcy5wdXNoKGZlYXR1cmUpO1xyXG4gICAgfVxyXG4gICAgaWYgKFxyXG4gICAgICBpc0RlZmluZWQodGhpcy5fcGlja2VkRmVhdHVyZXMpICYmXHJcbiAgICAgIGlzRGVmaW5lZChmZWF0dXJlKSAmJlxyXG4gICAgICBmZWF0dXJlLnBvc2l0aW9uXHJcbiAgICApIHtcclxuICAgICAgdGhpcy5fcGlja2VkRmVhdHVyZXMucGlja1Bvc2l0aW9uID0gKGZlYXR1cmUucG9zaXRpb24gYXMgYW55KS5fdmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9waWNrRmVhdHVyZXMoXHJcbiAgICBsYXRsbmc6IEwuTGF0TG5nLFxyXG4gICAgdGlsZUNvb3JkaW5hdGVzPzogUmVjb3JkPHN0cmluZywgUHJvdmlkZXJDb29yZHM+LFxyXG4gICAgZXhpc3RpbmdGZWF0dXJlcz86IFRlcnJpYUZlYXR1cmVbXSxcclxuICAgIGlnbm9yZVNwbGl0dGVyOiBib29sZWFuID0gZmFsc2VcclxuICApIHtcclxuICAgIGlmIChpc0RlZmluZWQodGhpcy5fcGlja2VkRmVhdHVyZXMpKSB7XHJcbiAgICAgIC8vIFBpY2tpbmcgaXMgYWxyZWFkeSBpbiBwcm9ncmVzcy5cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzID0gbmV3IFBpY2tlZEZlYXR1cmVzKCk7XHJcblxyXG4gICAgaWYgKGlzRGVmaW5lZChleGlzdGluZ0ZlYXR1cmVzKSkge1xyXG4gICAgICB0aGlzLl9waWNrZWRGZWF0dXJlcy5mZWF0dXJlcyA9IGV4aXN0aW5nRmVhdHVyZXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gV2UgcnVuIHRoaXMgbGF0ZXIgYmVjYXVzZSB2ZWN0b3IgY2xpY2sgZXZlbnRzIGFuZCB0aGUgbWFwIGNsaWNrIGV2ZW50IGNhbiBjb21lIHRocm91Z2ggaW4gYW55IG9yZGVyLCBidXQgd2UgY2FuXHJcbiAgICAvLyBiZSByZWFzb25hYmx5IHN1cmUgdGhhdCBhbGwgb2YgdGhlbSB3aWxsIGJlIHByb2Nlc3NlZCBieSB0aGUgdGltZSBvdXIgcnVuTGF0ZXIgZnVuYyBpcyBpbnZva2VkLlxyXG4gICAgY29uc3QgY2xlYW51cCA9IHJ1bkxhdGVyKCgpID0+IHtcclxuICAgICAgLy8gU2V0IHRoaXMgYWdhaW4ganVzdCBpbiBjYXNlIGEgdmVjdG9yIHBpY2sgY2FtZSB0aHJvdWdoIGFuZCByZXNldCBpdCB0byB0aGUgdmVjdG9yJ3MgcG9zaXRpb24uXHJcbiAgICAgIGNvbnN0IG5ld1BpY2tMb2NhdGlvbiA9XHJcbiAgICAgICAgRWxsaXBzb2lkLldHUzg0LmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKHBpY2tlZExvY2F0aW9uKTtcclxuICAgICAgcnVuSW5BY3Rpb24oKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1hcEludGVyYWN0aW9uTW9kZVN0YWNrID0gdGhpcy50ZXJyaWEubWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2s7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgaXNEZWZpbmVkKG1hcEludGVyYWN0aW9uTW9kZVN0YWNrKSAmJlxyXG4gICAgICAgICAgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2subGVuZ3RoID4gMFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgY29uc3QgcGlja2VkRmVhdHVyZXMgPVxyXG4gICAgICAgICAgICBtYXBJbnRlcmFjdGlvbk1vZGVTdGFja1ttYXBJbnRlcmFjdGlvbk1vZGVTdGFjay5sZW5ndGggLSAxXVxyXG4gICAgICAgICAgICAgIC5waWNrZWRGZWF0dXJlcztcclxuICAgICAgICAgIGlmIChpc0RlZmluZWQocGlja2VkRmVhdHVyZXMpKSB7XHJcbiAgICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLnBpY2tQb3NpdGlvbiA9IG5ld1BpY2tMb2NhdGlvbjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGlzRGVmaW5lZCh0aGlzLnRlcnJpYS5waWNrZWRGZWF0dXJlcykpIHtcclxuICAgICAgICAgIHRoaXMudGVycmlhLnBpY2tlZEZlYXR1cmVzLnBpY2tQb3NpdGlvbiA9IG5ld1BpY2tMb2NhdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gVW5zZXQgdGhpcyBzbyB0aGF0IHRoZSBuZXh0IGNsaWNrIHdpbGwgc3RhcnQgYnVpbGRpbmcgZmVhdHVyZXMgZnJvbSBzY3JhdGNoLlxyXG4gICAgICB0aGlzLl9waWNrZWRGZWF0dXJlcyA9IHVuZGVmaW5lZDtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGltYWdlcnlMYXllcnM6IEltYWdlcnlQcm92aWRlckxlYWZsZXRUaWxlTGF5ZXJbXSA9IFtdO1xyXG4gICAgaWYgKHRoaXMudGVycmlhLmFsbG93RmVhdHVyZUluZm9SZXF1ZXN0cykge1xyXG4gICAgICB0aGlzLm1hcC5lYWNoTGF5ZXIoKGxheWVyKSA9PiB7XHJcbiAgICAgICAgaWYgKGlzSW1hZ2VyeUxheWVyKGxheWVyKSkge1xyXG4gICAgICAgICAgaW1hZ2VyeUxheWVycy5wdXNoKGxheWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHdlIG5lZWQgaXRlbXMgc29ydGVkIGluIHJldmVyc2Ugb3JkZXIgYnkgdGhlaXIgekluZGV4IHRvIGdldCBjb3JyZWN0IG9yZGVyaW5nIG9mIGZlYXR1cmUgaW5mb1xyXG4gICAgaW1hZ2VyeUxheWVycy5zb3J0KFxyXG4gICAgICAoXHJcbiAgICAgICAgYTogSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllcixcclxuICAgICAgICBiOiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyXHJcbiAgICAgICkgPT4ge1xyXG4gICAgICAgIGlmICghaXNEZWZpbmVkKGEub3B0aW9ucy56SW5kZXgpIHx8ICFpc0RlZmluZWQoYi5vcHRpb25zLnpJbmRleCkpIHtcclxuICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYS5vcHRpb25zLnpJbmRleCA8IGIub3B0aW9ucy56SW5kZXgpIHtcclxuICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYS5vcHRpb25zLnpJbmRleCA+IGIub3B0aW9ucy56SW5kZXgpIHtcclxuICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgdGlsZUNvb3JkaW5hdGVzID0gZGVmYXVsdFZhbHVlKHRpbGVDb29yZGluYXRlcywge30pO1xyXG5cclxuICAgIGNvbnN0IHBpY2tlZExvY2F0aW9uID0gQ2FydG9ncmFwaGljLmZyb21EZWdyZWVzKGxhdGxuZy5sbmcsIGxhdGxuZy5sYXQpO1xyXG4gICAgdGhpcy5fcGlja2VkRmVhdHVyZXMucGlja1Bvc2l0aW9uID1cclxuICAgICAgRWxsaXBzb2lkLldHUzg0LmNhcnRvZ3JhcGhpY1RvQ2FydGVzaWFuKHBpY2tlZExvY2F0aW9uKTtcclxuXHJcbiAgICBjb25zdCBpbWFnZXJ5RmVhdHVyZVByb21pc2VzID0gaW1hZ2VyeUxheWVycy5tYXAoYXN5bmMgKGltYWdlcnlMYXllcikgPT4ge1xyXG4gICAgICBjb25zdCBpbWFnZXJ5TGF5ZXJVcmwgPSAoaW1hZ2VyeUxheWVyLmltYWdlcnlQcm92aWRlciBhcyBhbnkpLnVybDtcclxuICAgICAgY29uc3QgbG9uZ1JhZGlhbnMgPSBDZXNpdW1NYXRoLnRvUmFkaWFucyhsYXRsbmcubG5nKTtcclxuICAgICAgY29uc3QgbGF0UmFkaWFucyA9IENlc2l1bU1hdGgudG9SYWRpYW5zKGxhdGxuZy5sYXQpO1xyXG5cclxuICAgICAgY29uc3QgY29vcmRzID1cclxuICAgICAgICB0aWxlQ29vcmRpbmF0ZXM/LltpbWFnZXJ5TGF5ZXJVcmxdID8/XHJcbiAgICAgICAgKGF3YWl0IGltYWdlcnlMYXllci5nZXRGZWF0dXJlUGlja2luZ0Nvb3JkcyhcclxuICAgICAgICAgIHRoaXMubWFwLFxyXG4gICAgICAgICAgbG9uZ1JhZGlhbnMsXHJcbiAgICAgICAgICBsYXRSYWRpYW5zXHJcbiAgICAgICAgKSk7XHJcblxyXG4gICAgICBjb25zdCBmZWF0dXJlcyA9IGF3YWl0IGltYWdlcnlMYXllci5waWNrRmVhdHVyZXMoXHJcbiAgICAgICAgY29vcmRzLngsXHJcbiAgICAgICAgY29vcmRzLnksXHJcbiAgICAgICAgY29vcmRzLmxldmVsLFxyXG4gICAgICAgIGxvbmdSYWRpYW5zLFxyXG4gICAgICAgIGxhdFJhZGlhbnNcclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIE1ha2Ugc3VyZSBJbWFnZXJ5TGF5ZXJGZWF0dXJlSW5mbyBoYXMgaW1hZ2VyeSBsYXllciBwcm9wZXJ0eVxyXG4gICAgICBmZWF0dXJlcz8uZm9yRWFjaCgoZmVhdHVyZSkgPT4gKGZlYXR1cmUuaW1hZ2VyeUxheWVyID0gaW1hZ2VyeUxheWVyKSk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGZlYXR1cmVzOiBmZWF0dXJlcyxcclxuICAgICAgICBpbWFnZXJ5TGF5ZXI6IGltYWdlcnlMYXllcixcclxuICAgICAgICBjb29yZHM6IGNvb3Jkc1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgcGlja2VkRmVhdHVyZXMgPSB0aGlzLl9waWNrZWRGZWF0dXJlcztcclxuXHJcbiAgICAvLyBXZSB3YW50IHRoZSBhbGwgYXZhaWxhYmxlIHByb21pc2UgdG8gcmV0dXJuIGFmdGVyIHRoZSBjbGVhbnVwIG9uZSB0b1xyXG4gICAgLy8gbWFrZSBzdXJlIGFsbCB2ZWN0b3IgY2xpY2sgZXZlbnRzIGhhdmUgcmVzb2x2ZWQuXHJcbiAgICBwaWNrZWRGZWF0dXJlcy5hbGxGZWF0dXJlc0F2YWlsYWJsZVByb21pc2UgPSBQcm9taXNlLmFsbChbXHJcbiAgICAgIGNsZWFudXAsXHJcbiAgICAgIFByb21pc2UuYWxsKGltYWdlcnlGZWF0dXJlUHJvbWlzZXMpXHJcbiAgICAgICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcclxuICAgICAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcclxuICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMuaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBwaWNrZWRGZWF0dXJlcy5wcm92aWRlckNvb3JkcyA9IHt9O1xyXG4gICAgICAgICAgY29uc3QgZmlsdGVyZWRSZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoXHJcbiAgICAgICAgICAgIChyZXN1bHQpID0+IGlzRGVmaW5lZChyZXN1bHQuZmVhdHVyZXMpICYmIHJlc3VsdC5mZWF0dXJlcy5sZW5ndGggPiAwXHJcbiAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLnByb3ZpZGVyQ29vcmRzID0gZmlsdGVyZWRSZXN1bHRzLnJlZHVjZShmdW5jdGlvbiAoXHJcbiAgICAgICAgICAgIGNvb3Jkc1NvRmFyOiBQcm92aWRlckNvb3Jkc01hcCxcclxuICAgICAgICAgICAgcmVzdWx0XHJcbiAgICAgICAgICApIHtcclxuICAgICAgICAgICAgY29uc3QgaW1hZ2VyeVByb3ZpZGVyID0gcmVzdWx0LmltYWdlcnlMYXllcj8uaW1hZ2VyeVByb3ZpZGVyO1xyXG4gICAgICAgICAgICBpZiAoaW1hZ2VyeVByb3ZpZGVyKVxyXG4gICAgICAgICAgICAgIGNvb3Jkc1NvRmFyWyhpbWFnZXJ5UHJvdmlkZXIgYXMgYW55KS51cmxdID0gcmVzdWx0LmNvb3JkcztcclxuICAgICAgICAgICAgcmV0dXJuIGNvb3Jkc1NvRmFyO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHt9KTtcclxuXHJcbiAgICAgICAgICBjb25zdCBmZWF0dXJlcyA9IGZpbHRlcmVkUmVzdWx0cy5yZWR1Y2UoKGFsbEZlYXR1cmVzLCByZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgIHRoaXMudGVycmlhLnNob3dTcGxpdHRlciAmJlxyXG4gICAgICAgICAgICAgIGlnbm9yZVNwbGl0dGVyID09PSBmYWxzZSAmJlxyXG4gICAgICAgICAgICAgIGlzRGVmaW5lZChwaWNrZWRGZWF0dXJlcy5waWNrUG9zaXRpb24pXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgIC8vIFNraXAgdGhpcyBmZWF0dXJlLCB1bmxlc3MgdGhlIGltYWdlcnkgbGF5ZXIgaXMgb24gdGhlIHBpY2tlZCBzaWRlIG9yXHJcbiAgICAgICAgICAgICAgLy8gYmVsb25ncyB0byBib3RoIHNpZGVzIG9mIHRoZSBzcGxpdHRlclxyXG4gICAgICAgICAgICAgIGNvbnN0IHNjcmVlblBvc2l0aW9uID0gdGhpcy5fY29tcHV0ZVBvc2l0aW9uT25TY3JlZW4oXHJcbiAgICAgICAgICAgICAgICBwaWNrZWRGZWF0dXJlcy5waWNrUG9zaXRpb25cclxuICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgIGNvbnN0IHBpY2tlZFNpZGUgPVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fZ2V0U3BsaXR0ZXJTaWRlRm9yU2NyZWVuUG9zaXRpb24oc2NyZWVuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgIGNvbnN0IGxheWVyRGlyZWN0aW9uID0gcmVzdWx0LmltYWdlcnlMYXllci5zcGxpdERpcmVjdGlvbjtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgIShcclxuICAgICAgICAgICAgICAgICAgbGF5ZXJEaXJlY3Rpb24gPT09IHBpY2tlZFNpZGUgfHxcclxuICAgICAgICAgICAgICAgICAgbGF5ZXJEaXJlY3Rpb24gPT09IFNwbGl0RGlyZWN0aW9uLk5PTkVcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhbGxGZWF0dXJlcztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhbGxGZWF0dXJlcy5jb25jYXQoXHJcbiAgICAgICAgICAgICAgcmVzdWx0LmZlYXR1cmVzIS5tYXAoKGZlYXR1cmUpID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIEZvciBmZWF0dXJlcyB3aXRob3V0IGEgcG9zaXRpb24sIHVzZSB0aGUgcGlja2VkIGxvY2F0aW9uLlxyXG4gICAgICAgICAgICAgICAgaWYgKCFpc0RlZmluZWQoZmVhdHVyZS5wb3NpdGlvbikpIHtcclxuICAgICAgICAgICAgICAgICAgZmVhdHVyZS5wb3NpdGlvbiA9IHBpY2tlZExvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVGZWF0dXJlRnJvbUltYWdlcnlMYXllckZlYXR1cmUoZmVhdHVyZSk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH0sIHBpY2tlZEZlYXR1cmVzLmZlYXR1cmVzKTtcclxuICAgICAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcclxuICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMuZmVhdHVyZXMgPSBmZWF0dXJlcztcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlKSA9PiB7XHJcbiAgICAgICAgICBydW5JbkFjdGlvbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBwaWNrZWRGZWF0dXJlcy5lcnJvciA9XHJcbiAgICAgICAgICAgICAgXCJBbiB1bmtub3duIGVycm9yIG9jY3VycmVkIHdoaWxlIHBpY2tpbmcgZmVhdHVyZXMuXCI7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgfSlcclxuICAgIF0pLnRoZW4oKCkgPT4gdW5kZWZpbmVkKTtcclxuXHJcbiAgICBydW5JbkFjdGlvbigoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG1hcEludGVyYWN0aW9uTW9kZVN0YWNrID0gdGhpcy50ZXJyaWEubWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2s7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBpc0RlZmluZWQobWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2spICYmXHJcbiAgICAgICAgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2subGVuZ3RoID4gMFxyXG4gICAgICApIHtcclxuICAgICAgICBtYXBJbnRlcmFjdGlvbk1vZGVTdGFja1tcclxuICAgICAgICAgIG1hcEludGVyYWN0aW9uTW9kZVN0YWNrLmxlbmd0aCAtIDFcclxuICAgICAgICBdLnBpY2tlZEZlYXR1cmVzID0gdGhpcy5fcGlja2VkRmVhdHVyZXM7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy50ZXJyaWEucGlja2VkRmVhdHVyZXMgPSB0aGlzLl9waWNrZWRGZWF0dXJlcztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfcmVhY3RUb1NwbGl0dGVyQ2hhbmdlcygpOiBJUmVhY3Rpb25EaXNwb3NlciB7XHJcbiAgICByZXR1cm4gYXV0b3J1bigoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy50ZXJyaWEubWFpblZpZXdlci5pdGVtcy5nZXQoKTtcclxuICAgICAgY29uc3Qgc2hvd1NwbGl0dGVyID0gdGhpcy50ZXJyaWEuc2hvd1NwbGl0dGVyO1xyXG4gICAgICBjb25zdCBzcGxpdFBvc2l0aW9uID0gdGhpcy50ZXJyaWEuc3BsaXRQb3NpdGlvbjtcclxuICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIE1hcHBhYmxlTWl4aW4uaXNNaXhlZEludG8oaXRlbSkgJiZcclxuICAgICAgICAgIGhhc1RyYWl0cyhpdGVtLCBTcGxpdHRlclRyYWl0cywgXCJzcGxpdERpcmVjdGlvblwiKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgY29uc3QgbGF5ZXJzID0gdGhpcy5nZXRJbWFnZXJ5TGF5ZXJzRm9ySXRlbShpdGVtKTtcclxuICAgICAgICAgIGNvbnN0IHNwbGl0RGlyZWN0aW9uID0gaXRlbS5zcGxpdERpcmVjdGlvbjtcclxuXHJcbiAgICAgICAgICBsYXllcnMuZm9yRWFjaChcclxuICAgICAgICAgICAgYWN0aW9uKChsYXllcikgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChzaG93U3BsaXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGxheWVyLnNwbGl0RGlyZWN0aW9uID0gc3BsaXREaXJlY3Rpb247XHJcbiAgICAgICAgICAgICAgICBsYXllci5zcGxpdFBvc2l0aW9uID0gc3BsaXRQb3NpdGlvbjtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGF5ZXIuc3BsaXREaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5OT05FO1xyXG4gICAgICAgICAgICAgICAgbGF5ZXIuc3BsaXRQb3NpdGlvbiA9IHNwbGl0UG9zaXRpb247XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm5vdGlmeVJlcGFpbnRSZXF1aXJlZCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbWFnZXJ5TGF5ZXJzRm9ySXRlbShcclxuICAgIGl0ZW06IE1hcHBhYmxlTWl4aW4uSW5zdGFuY2VcclxuICApOiAoSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciB8IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIpW10ge1xyXG4gICAgcmV0dXJuIGZpbHRlck91dFVuZGVmaW5lZChcclxuICAgICAgaXRlbS5tYXBJdGVtcy5tYXAoKG0pID0+IHtcclxuICAgICAgICBpZiAoSW1hZ2VyeVBhcnRzLmlzKG0pKSB7XHJcbiAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX21ha2VJbWFnZXJ5TGF5ZXJGcm9tUGFydHMobSwgaXRlbSk7XHJcbiAgICAgICAgICByZXR1cm4gbGF5ZXIgaW5zdGFuY2VvZiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyIHx8XHJcbiAgICAgICAgICAgIGxheWVyIGluc3RhbmNlb2YgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllclxyXG4gICAgICAgICAgICA/IGxheWVyXHJcbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21wdXRlcyB0aGUgc2NyZWVuIHBvc2l0aW9uIG9mIGEgZ2l2ZW4gd29ybGQgcG9zaXRpb24uXHJcbiAgICogQHBhcmFtIHBvc2l0aW9uIFRoZSB3b3JsZCBwb3NpdGlvbiBpbiBFYXJ0aC1jZW50ZXJlZCBGaXhlZCBjb29yZGluYXRlcy5cclxuICAgKiBAcGFyYW0gW3Jlc3VsdF0gVGhlIGluc3RhbmNlIHRvIHdoaWNoIHRvIGNvcHkgdGhlIHJlc3VsdC5cclxuICAgKiBAcmV0dXJuIFRoZSBzY3JlZW4gcG9zaXRpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGUgcG9zaXRpb24gaXMgbm90IG9uIHRoZSBzY3JlZW4uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfY29tcHV0ZVBvc2l0aW9uT25TY3JlZW4oXHJcbiAgICBwb3NpdGlvbjogQ2FydGVzaWFuMyxcclxuICAgIHJlc3VsdD86IENhcnRlc2lhbjJcclxuICApOiBDYXJ0ZXNpYW4yIHtcclxuICAgIGNvbnN0IGNhcnRvZ3JhcGhpY1NjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XHJcbiAgICBjb25zdCBjYXJ0b2dyYXBoaWMgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMoXHJcbiAgICAgIHBvc2l0aW9uLFxyXG4gICAgICBjYXJ0b2dyYXBoaWNTY3JhdGNoXHJcbiAgICApO1xyXG4gICAgY29uc3QgcG9pbnQgPSB0aGlzLm1hcC5sYXRMbmdUb0NvbnRhaW5lclBvaW50KFxyXG4gICAgICBMLmxhdExuZyhcclxuICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubGF0aXR1ZGUpLFxyXG4gICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRvZ3JhcGhpYy5sb25naXR1ZGUpXHJcbiAgICAgIClcclxuICAgICk7XHJcblxyXG4gICAgaWYgKGlzRGVmaW5lZChyZXN1bHQpKSB7XHJcbiAgICAgIHJlc3VsdC54ID0gcG9pbnQueDtcclxuICAgICAgcmVzdWx0LnkgPSBwb2ludC55O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzdWx0ID0gbmV3IENhcnRlc2lhbjIocG9pbnQueCwgcG9pbnQueSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc2VsZWN0RmVhdHVyZShmZWF0dXJlOiBUZXJyaWFGZWF0dXJlIHwgdW5kZWZpbmVkKSB7XHJcbiAgICB0aGlzLl9oaWdobGlnaHRGZWF0dXJlKGZlYXR1cmUpO1xyXG5cclxuICAgIGlmIChpc0RlZmluZWQoZmVhdHVyZSkgJiYgaXNEZWZpbmVkKGZlYXR1cmUucG9zaXRpb24pKSB7XHJcbiAgICAgIGNvbnN0IGNhcnRvZ3JhcGhpY1NjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XHJcbiAgICAgIGNvbnN0IGNhcnRlc2lhblBvc2l0aW9uID0gZmVhdHVyZS5wb3NpdGlvbi5nZXRWYWx1ZShcclxuICAgICAgICB0aGlzLnRlcnJpYS50aW1lbGluZUNsb2NrLmN1cnJlbnRUaW1lXHJcbiAgICAgICk7XHJcbiAgICAgIGlmIChjYXJ0ZXNpYW5Qb3NpdGlvbiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLmFuaW1hdGVTZWxlY3Rpb25JbmRpY2F0b3JEZXBhcnQoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgY2FydG9ncmFwaGljID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhblRvQ2FydG9ncmFwaGljKFxyXG4gICAgICAgIGNhcnRlc2lhblBvc2l0aW9uLFxyXG4gICAgICAgIGNhcnRvZ3JhcGhpY1NjcmF0Y2hcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLnNldExhdExuZyhcclxuICAgICAgICBMLmxhdExuZyhbXHJcbiAgICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubGF0aXR1ZGUpLFxyXG4gICAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxvbmdpdHVkZSlcclxuICAgICAgICBdKVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3IuYW5pbWF0ZVNlbGVjdGlvbkluZGljYXRvckFwcGVhcigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLmFuaW1hdGVTZWxlY3Rpb25JbmRpY2F0b3JEZXBhcnQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldENsaXBzRm9yU3BsaXR0ZXIoKTogYW55IHtcclxuICAgIGxldCBjbGlwTGVmdDogc3RyaW5nID0gXCJcIjtcclxuICAgIGxldCBjbGlwUmlnaHQ6IHN0cmluZyA9IFwiXCI7XHJcbiAgICBsZXQgY2xpcFBvc2l0aW9uV2l0aGluTWFwOiBudW1iZXIgPSAwO1xyXG4gICAgbGV0IGNsaXBYOiBudW1iZXIgPSAwO1xyXG4gICAgaWYgKHRoaXMudGVycmlhLnNob3dTcGxpdHRlcikge1xyXG4gICAgICBjb25zdCBtYXAgPSB0aGlzLm1hcDtcclxuICAgICAgY29uc3Qgc2l6ZSA9IG1hcC5nZXRTaXplKCk7XHJcbiAgICAgIGNvbnN0IG53ID0gbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KFswLCAwXSk7XHJcbiAgICAgIGNvbnN0IHNlID0gbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KHNpemUpO1xyXG4gICAgICBjbGlwUG9zaXRpb25XaXRoaW5NYXAgPSBzaXplLnggKiB0aGlzLnRlcnJpYS5zcGxpdFBvc2l0aW9uO1xyXG4gICAgICBjbGlwWCA9IE1hdGgucm91bmQobncueCArIGNsaXBQb3NpdGlvbldpdGhpbk1hcCk7XHJcbiAgICAgIGNsaXBMZWZ0ID0gXCJyZWN0KFwiICsgW253LnksIGNsaXBYLCBzZS55LCBudy54XS5qb2luKFwicHgsXCIpICsgXCJweClcIjtcclxuICAgICAgY2xpcFJpZ2h0ID0gXCJyZWN0KFwiICsgW253LnksIHNlLngsIHNlLnksIGNsaXBYXS5qb2luKFwicHgsXCIpICsgXCJweClcIjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsZWZ0OiBjbGlwTGVmdCxcclxuICAgICAgcmlnaHQ6IGNsaXBSaWdodCxcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwOiBjbGlwUG9zaXRpb25XaXRoaW5NYXAsXHJcbiAgICAgIGNsaXBYOiBjbGlwWFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGlzU3BsaXR0ZXJEcmFnVGh1bWIoZWxlbWVudDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHwgXCJcIiB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBlbGVtZW50LmNsYXNzTmFtZSAmJlxyXG4gICAgICBlbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mICYmXHJcbiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoXCJ0anMtc3BsaXR0ZXJfX3RodW1iXCIpID49IDBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjYXB0dXJlU2NyZWVuc2hvdCgpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgLy8gVGVtcG9yYXJpbHkgaGlkZSB0aGUgbWFwIGNyZWRpdHMuXHJcbiAgICB0aGlzLl9hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlKCk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gaHRtbDJjYW52YXMgY2FuJ3QgaGFuZGxlIHRoZSBjbGlwIHN0eWxlIHdoaWNoIGlzIHVzZWQgZm9yIHRoZSBzcGxpdHRlci4gU28gaWYgdGhlIHNwbGl0dGVyIGlzIGFjdGl2ZSwgd2UgcmVuZGVyXHJcbiAgICAgIC8vIGEgbGVmdCBpbWFnZSBhbmQgYSByaWdodCBpbWFnZSBhbmQgY29tcG9zZSB0aGVtLiBBbHNvIHJlbW92ZSB0aGUgc3BsaXR0ZXIgZHJhZyB0aHVtYi5cclxuICAgICAgbGV0IHByb21pc2U6IGFueTtcclxuICAgICAgaWYgKHRoaXMudGVycmlhLnNob3dTcGxpdHRlcikge1xyXG4gICAgICAgIGNvbnN0IGNsaXBzID0gdGhpcy5nZXRDbGlwc0ZvclNwbGl0dGVyKCk7XHJcbiAgICAgICAgY29uc3QgY2xpcExlZnQgPSBjbGlwcy5sZWZ0LnJlcGxhY2UoLyAvZywgXCJcIik7XHJcbiAgICAgICAgY29uc3QgY2xpcFJpZ2h0ID0gY2xpcHMucmlnaHQucmVwbGFjZSgvIC9nLCBcIlwiKTtcclxuICAgICAgICBwcm9taXNlID0gaHRtbDJjYW52YXModGhpcy5tYXAuZ2V0Q29udGFpbmVyKCksIHtcclxuICAgICAgICAgIHVzZUNPUlM6IHRydWUsXHJcbiAgICAgICAgICBpZ25vcmVFbGVtZW50czogKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSA9PlxyXG4gICAgICAgICAgICAoZWxlbWVudC5zdHlsZS5jbGlwICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAgIT09IG51bGwgJiZcclxuICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAucmVwbGFjZSgvIC9nLCBcIlwiKSA9PT0gY2xpcFJpZ2h0KSB8fFxyXG4gICAgICAgICAgICB0aGlzLmlzU3BsaXR0ZXJEcmFnVGh1bWIoZWxlbWVudClcclxuICAgICAgICB9KS50aGVuKChsZWZ0Q2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGh0bWwyY2FudmFzKHRoaXMubWFwLmdldENvbnRhaW5lcigpLCB7XHJcbiAgICAgICAgICAgIHVzZUNPUlM6IHRydWUsXHJcbiAgICAgICAgICAgIGlnbm9yZUVsZW1lbnRzOiAoZWxlbWVudDogSFRNTEVsZW1lbnQpID0+XHJcbiAgICAgICAgICAgICAgKGVsZW1lbnQuc3R5bGUuY2xpcCAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAgIT09IG51bGwgJiZcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuY2xpcC5yZXBsYWNlKC8gL2csIFwiXCIpID09PSBjbGlwTGVmdCkgfHxcclxuICAgICAgICAgICAgICB0aGlzLmlzU3BsaXR0ZXJEcmFnVGh1bWIoZWxlbWVudClcclxuICAgICAgICAgIH0pLnRoZW4oKHJpZ2h0Q2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb21iaW5lZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgICAgIGNvbWJpbmVkLndpZHRoID0gbGVmdENhbnZhcy53aWR0aDtcclxuICAgICAgICAgICAgY29tYmluZWQuaGVpZ2h0ID0gbGVmdENhbnZhcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCB8IG51bGwgPVxyXG4gICAgICAgICAgICAgIGNvbWJpbmVkLmdldENvbnRleHQoXCIyZFwiKTtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQgPT09IHVuZGVmaW5lZCB8fCBjb250ZXh0ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgLy8gRXJyb3JcclxuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3BsaXQgPSBjbGlwcy5jbGlwUG9zaXRpb25XaXRoaW5NYXAgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcclxuICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoXHJcbiAgICAgICAgICAgICAgbGVmdENhbnZhcyxcclxuICAgICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgICAgc3BsaXQsXHJcbiAgICAgICAgICAgICAgY29tYmluZWQuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICBzcGxpdCxcclxuICAgICAgICAgICAgICBjb21iaW5lZC5oZWlnaHRcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoXHJcbiAgICAgICAgICAgICAgcmlnaHRDYW52YXMsXHJcbiAgICAgICAgICAgICAgc3BsaXQsXHJcbiAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICBjb21iaW5lZC53aWR0aCAtIHNwbGl0LFxyXG4gICAgICAgICAgICAgIGNvbWJpbmVkLmhlaWdodCxcclxuICAgICAgICAgICAgICBzcGxpdCxcclxuICAgICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICAgIGNvbWJpbmVkLndpZHRoIC0gc3BsaXQsXHJcbiAgICAgICAgICAgICAgY29tYmluZWQuaGVpZ2h0XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHJldHVybiBjb21iaW5lZDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHByb21pc2UgPSBodG1sMmNhbnZhcyh0aGlzLm1hcC5nZXRDb250YWluZXIoKSwge1xyXG4gICAgICAgICAgdXNlQ09SUzogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gcHJvbWlzZVxyXG4gICAgICAgIC50aGVuKChjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5hZGRUbyh0aGlzLm1hcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5hZGRUbyh0aGlzLm1hcCk7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9hZGRWZWN0b3JUaWxlSGlnaGxpZ2h0KFxyXG4gICAgaW1hZ2VyeVByb3ZpZGVyOiBNYXBib3hWZWN0b3JUaWxlSW1hZ2VyeVByb3ZpZGVyIHwgUHJvdG9tYXBzSW1hZ2VyeVByb3ZpZGVyLFxyXG4gICAgcmVjdGFuZ2xlOiBSZWN0YW5nbGVcclxuICApOiAoKSA9PiB2b2lkIHtcclxuICAgIGNvbnN0IG1hcCA9IHRoaXMubWFwO1xyXG4gICAgY29uc3Qgb3B0aW9uczogYW55ID0ge1xyXG4gICAgICBvcGFjaXR5OiAxLFxyXG4gICAgICBib3VuZHM6IHJlY3RhbmdsZVRvTGF0TG5nQm91bmRzKHJlY3RhbmdsZSlcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGlzRGVmaW5lZChtYXAub3B0aW9ucy5tYXhab29tKSkge1xyXG4gICAgICBvcHRpb25zLm1heFpvb20gPSBtYXAub3B0aW9ucy5tYXhab29tO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxheWVyID0gbmV3IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIoXHJcbiAgICAgIHRoaXMsXHJcbiAgICAgIGltYWdlcnlQcm92aWRlcixcclxuICAgICAgb3B0aW9uc1xyXG4gICAgKTtcclxuICAgIGxheWVyLmFkZFRvKG1hcCk7XHJcbiAgICBsYXllci5icmluZ1RvRnJvbnQoKTtcclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICBtYXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzSW1hZ2VyeUxheWVyKFxyXG4gIHNvbWVMYXllcjogTC5MYXllclxyXG4pOiBzb21lTGF5ZXIgaXMgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciB7XHJcbiAgcmV0dXJuIFwiaW1hZ2VyeVByb3ZpZGVyXCIgaW4gc29tZUxheWVyO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0RhdGFTb3VyY2Uob2JqZWN0OiBNYXBJdGVtKTogb2JqZWN0IGlzIERhdGFTb3VyY2Uge1xyXG4gIHJldHVybiBcImVudGl0aWVzXCIgaW4gb2JqZWN0O1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBO0FBVUE7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUEzREE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBOERBO0FBQUE7QUFpRkE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQS9FQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUFBO0FBRUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQTVJQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQXlCQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFJQTtBQUNBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFpR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBUUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBakNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBc0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFPQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoQkE7QUFBQTtBQUFBO0FBQUE7QUFtQkE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFFQTtBQUFBO0FBS0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVFBO0FBTkE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUEvQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFzREE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFJQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUFBO0FBQUE7QUFOQTtBQUFBO0FBQUE7QUFjQTtBQU5BO0FBUUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFHQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUVBO0FBTUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUFBO0FBQUE7QUFVQTtBQUNBO0FBSUE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQVdBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQTkrQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBKytCQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/Leaflet.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Models/LeafletAttribution.ts":
/*!************************************************************!*\
  !*** ./packages/terriajs/lib/Models/LeafletAttribution.ts ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.get.js */ \"./node_modules/core-js/modules/es.reflect.get.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LeafletAttribution = void 0;\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _class, _descriptor;\nfunction _interopRequireDefault(e) { return e && e.__esModule ? e : { \"default\": e }; }\nfunction _initializerDefineProperty(e, i, r, l) { r && Object.defineProperty(e, i, { enumerable: r.enumerable, configurable: r.configurable, writable: r.writable, value: r.initializer ? r.initializer.call(l) : void 0 }); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(t, e) { if (e && (\"object\" == _typeof(e) || \"function\" == typeof e)) return e; if (void 0 !== e) throw new TypeError(\"Derived constructors may only return object or undefined\"); return _assertThisInitialized(t); }\nfunction _assertThisInitialized(e) { if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); return e; }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _superPropGet(t, o, e, r) { var p = _get(_getPrototypeOf(1 & r ? t.prototype : t), o, e); return 2 & r && \"function\" == typeof p ? function (t) { return p.apply(e, t); } : p; }\nfunction _get() { return _get = \"undefined\" != typeof Reflect && Reflect.get ? Reflect.get.bind() : function (e, t, r) { var p = _superPropBase(e, t); if (p) { var n = Object.getOwnPropertyDescriptor(p, t); return n.get ? n.get.call(arguments.length < 3 ? e : r) : n.value; } }, _get.apply(null, arguments); }\nfunction _superPropBase(t, o) { for (; !{}.hasOwnProperty.call(t, o) && null !== (t = _getPrototypeOf(t));); return t; }\nfunction _getPrototypeOf(t) { return _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function (t) { return t.__proto__ || Object.getPrototypeOf(t); }, _getPrototypeOf(t); }\nfunction _inherits(t, e) { if (\"function\" != typeof e && null !== e) throw new TypeError(\"Super expression must either be null or a function\"); t.prototype = Object.create(e && e.prototype, { constructor: { value: t, writable: !0, configurable: !0 } }), Object.defineProperty(t, \"prototype\", { writable: !1 }), e && _setPrototypeOf(t, e); }\nfunction _setPrototypeOf(t, e) { return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) { return t.__proto__ = e, t; }, _setPrototypeOf(t, e); }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(i, e, r, n, l) { var a = {}; return Object.keys(n).forEach(function (i) { a[i] = n[i]; }), a.enumerable = !!a.enumerable, a.configurable = !!a.configurable, (\"value\" in a || a.initializer) && (a.writable = !0), a = r.slice().reverse().reduce(function (r, n) { return n(i, e, r) || r; }, a), l && void 0 !== a.initializer && (a.value = a.initializer ? a.initializer.call(l) : void 0, a.initializer = void 0), void 0 === a.initializer ? (Object.defineProperty(i, e, a), null) : a; }\nfunction _initializerWarningHelper(r, e) { throw Error(\"Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.\"); }\nvar LeafletAttribution = exports.LeafletAttribution = (_class = /*#__PURE__*/function (_L$Control$Attributio) {\n  function LeafletAttribution(terria) {\n    var _this;\n    _classCallCheck(this, LeafletAttribution);\n    var options = {\n      position: \"bottomleft\"\n    };\n    if (terria.configParameters.leafletAttributionPrefix) {\n      options.prefix = terria.configParameters.leafletAttributionPrefix;\n    }\n    _this = _callSuper(this, LeafletAttribution, [options]);\n    _defineProperty(_this, \"_attributions\", void 0);\n    _defineProperty(_this, \"map\", void 0);\n    _defineProperty(_this, \"_container\", void 0);\n    _initializerDefineProperty(_this, \"dataAttributions\", _descriptor, _this);\n    (0, _mobx.makeObservable)(_this);\n    _this._attributions = {};\n    _this.dataAttributions = (0, _mobx.observable)([]);\n    return _this;\n  }\n  _inherits(LeafletAttribution, _L$Control$Attributio);\n  return _createClass(LeafletAttribution, [{\n    key: \"onAdd\",\n    value: function onAdd(map) {\n      var _this2 = this;\n      map.attributionControl = this;\n      this.map = map;\n      this._container = _leaflet[\"default\"].DomUtil.create(\"div\", \"leaflet-control-attribution\");\n      _leaflet[\"default\"].DomEvent.disableClickPropagation(this._container);\n      map.eachLayer(function (layer) {\n        if (layer.getAttribution) {\n          var att = layer.getAttribution();\n          if (att) _this2.addAttribution(att);\n        }\n      });\n      return this._container;\n    }\n  }, {\n    key: \"onRemove\",\n    value: function onRemove() {\n      this.map = undefined;\n    }\n  }, {\n    key: \"_update\",\n    value: function _update() {\n      if (!this.map) {\n        return;\n      }\n      var attribs = [];\n      var attributions = this._attributions;\n      for (var i in attributions) {\n        if (attributions[i]) {\n          attribs.push(i);\n        }\n      }\n    }\n  }, {\n    key: \"addAttribution\",\n    value: function addAttribution(text) {\n      var _this3 = this;\n      _superPropGet(LeafletAttribution, \"addAttribution\", this, 3)([text]);\n      if (this.map) {\n        (0, _mobx.runInAction)(function () {\n          _this3.dataAttributions.push(text);\n        });\n      }\n      return this;\n    }\n  }, {\n    key: \"removeAttribution\",\n    value: function removeAttribution(text) {\n      var _this4 = this;\n      _superPropGet(LeafletAttribution, \"removeAttribution\", this, 3)([text]);\n      if (this.map) {\n        (0, _mobx.runInAction)(function () {\n          _this4.dataAttributions.remove(text);\n        });\n      }\n      return this;\n    }\n  }, {\n    key: \"attributions\",\n    get: function get() {\n      var attributionsList = [];\n      var attributions = this._attributions;\n      for (var i in attributions) {\n        if (attributions[i]) {\n          attributionsList.push(i);\n        }\n      }\n      return attributionsList;\n    }\n  }, {\n    key: \"prefix\",\n    get: function get() {\n      if (!this.options.prefix) return undefined;\n      return \"\".concat(this.options.prefix);\n    }\n  }]);\n}(_leaflet[\"default\"].Control.Attribution), _descriptor = _applyDecoratedDescriptor(_class.prototype, \"dataAttributions\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _class);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXRBdHRyaWJ1dGlvbi50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9Nb2RlbHMvTGVhZmxldEF0dHJpYnV0aW9uLnRzPzdmMDEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBJT2JzZXJ2YWJsZUFycmF5LFxyXG4gIHJ1bkluQWN0aW9uLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgbWFrZU9ic2VydmFibGVcclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xyXG5pbXBvcnQgVGVycmlhIGZyb20gXCIuL1RlcnJpYVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIExlYWZsZXRBdHRyaWJ1dGlvbiBleHRlbmRzIEwuQ29udHJvbC5BdHRyaWJ1dGlvbiB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfYXR0cmlidXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xyXG4gIHByaXZhdGUgbWFwPzogTC5NYXA7XHJcbiAgcHJpdmF0ZSBfY29udGFpbmVyITogSFRNTEVsZW1lbnQ7XHJcbiAgQG9ic2VydmFibGVcclxuICBkYXRhQXR0cmlidXRpb25zOiBJT2JzZXJ2YWJsZUFycmF5PHN0cmluZz47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHRlcnJpYTogVGVycmlhKSB7XHJcbiAgICBjb25zdCBvcHRpb25zOiBMLkNvbnRyb2wuQXR0cmlidXRpb25PcHRpb25zID0ge1xyXG4gICAgICBwb3NpdGlvbjogXCJib3R0b21sZWZ0XCJcclxuICAgIH07XHJcbiAgICBpZiAodGVycmlhLmNvbmZpZ1BhcmFtZXRlcnMubGVhZmxldEF0dHJpYnV0aW9uUHJlZml4KSB7XHJcbiAgICAgIG9wdGlvbnMucHJlZml4ID0gdGVycmlhLmNvbmZpZ1BhcmFtZXRlcnMubGVhZmxldEF0dHJpYnV0aW9uUHJlZml4O1xyXG4gICAgfVxyXG4gICAgc3VwZXIob3B0aW9ucyk7XHJcbiAgICBtYWtlT2JzZXJ2YWJsZSh0aGlzKTtcclxuXHJcbiAgICB0aGlzLl9hdHRyaWJ1dGlvbnMgPSB7fTtcclxuICAgIHRoaXMuZGF0YUF0dHJpYnV0aW9ucyA9IG9ic2VydmFibGUoW10pO1xyXG4gIH1cclxuXHJcbiAgb25BZGQobWFwOiBMLk1hcCk6IEhUTUxFbGVtZW50IHtcclxuICAgIG1hcC5hdHRyaWJ1dGlvbkNvbnRyb2wgPSB0aGlzO1xyXG4gICAgdGhpcy5tYXAgPSBtYXA7XHJcblxyXG4gICAgdGhpcy5fY29udGFpbmVyID0gTC5Eb21VdGlsLmNyZWF0ZShcImRpdlwiLCBcImxlYWZsZXQtY29udHJvbC1hdHRyaWJ1dGlvblwiKTtcclxuICAgIEwuRG9tRXZlbnQuZGlzYWJsZUNsaWNrUHJvcGFnYXRpb24odGhpcy5fY29udGFpbmVyKTtcclxuXHJcbiAgICBtYXAuZWFjaExheWVyKChsYXllcikgPT4ge1xyXG4gICAgICBpZiAobGF5ZXIuZ2V0QXR0cmlidXRpb24pIHtcclxuICAgICAgICBjb25zdCBhdHQgPSBsYXllci5nZXRBdHRyaWJ1dGlvbigpO1xyXG4gICAgICAgIGlmIChhdHQpIHRoaXMuYWRkQXR0cmlidXRpb24oYXR0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjtcclxuICB9XHJcblxyXG4gIG9uUmVtb3ZlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5tYXAgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBfdXBkYXRlKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLm1hcCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYXR0cmliczogc3RyaW5nW10gPSBbXTtcclxuICAgIGNvbnN0IGF0dHJpYnV0aW9ucyA9IHRoaXMuX2F0dHJpYnV0aW9ucztcclxuICAgIGZvciAoY29uc3QgaSBpbiBhdHRyaWJ1dGlvbnMpIHtcclxuICAgICAgaWYgKGF0dHJpYnV0aW9uc1tpXSkge1xyXG4gICAgICAgIGF0dHJpYnMucHVzaChpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkQXR0cmlidXRpb24odGV4dDogc3RyaW5nKTogdGhpcyB7XHJcbiAgICBzdXBlci5hZGRBdHRyaWJ1dGlvbih0ZXh0KTtcclxuICAgIGlmICh0aGlzLm1hcCkge1xyXG4gICAgICBydW5JbkFjdGlvbigoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5kYXRhQXR0cmlidXRpb25zLnB1c2godGV4dCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICByZW1vdmVBdHRyaWJ1dGlvbih0ZXh0OiBzdHJpbmcpOiB0aGlzIHtcclxuICAgIHN1cGVyLnJlbW92ZUF0dHJpYnV0aW9uKHRleHQpO1xyXG4gICAgaWYgKHRoaXMubWFwKSB7XHJcbiAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcclxuICAgICAgICB0aGlzLmRhdGFBdHRyaWJ1dGlvbnMucmVtb3ZlKHRleHQpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGF0dHJpYnV0aW9ucygpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBhdHRyaWJ1dGlvbnNMaXN0OiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgYXR0cmlidXRpb25zID0gdGhpcy5fYXR0cmlidXRpb25zO1xyXG4gICAgZm9yIChjb25zdCBpIGluIGF0dHJpYnV0aW9ucykge1xyXG4gICAgICBpZiAoYXR0cmlidXRpb25zW2ldKSB7XHJcbiAgICAgICAgYXR0cmlidXRpb25zTGlzdC5wdXNoKGkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGF0dHJpYnV0aW9uc0xpc3Q7XHJcbiAgfVxyXG5cclxuICBnZXQgcHJlZml4KCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgICBpZiAoIXRoaXMub3B0aW9ucy5wcmVmaXgpIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICByZXR1cm4gYCR7dGhpcy5vcHRpb25zLnByZWZpeH1gO1xyXG4gIH1cclxufVxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFNQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBVUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBdkZBO0FBQUE7QUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/LeafletAttribution.ts\n");

/***/ })

}]);